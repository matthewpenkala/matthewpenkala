$(document).ready(function() {
    let rotating = true;

    function rotateArrow(element, duration, reverse) {
        const easingFunction = t => t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;
        return new Promise(resolve => {
            let start = performance.now();

            function animate(timestamp) {
                let elapsed = timestamp - start;
                let progress = Math.min(elapsed / duration, 1);
                let easedProgress = reverse ? easingFunction(progress) : 1 - easingFunction(progress);
                element.style.transform = `rotate(${reverse ? -180 * easedProgress : 180 * easedProgress}deg)`;

                if (elapsed < duration && rotating) {
                    requestAnimationFrame(animate);
                } else {
                    resolve();
                }
            }

            requestAnimationFrame(animate);
        });
    }

    const hoverableElements = $("[class*='navbar-menu-item']").filter(":contains('Explore')").closest("[data-hover]").find("*:not(path)");
    const toggleElement = hoverableElements.filter(".w-dropdown-toggle").first();
    const arrowElement = hoverableElements.find("svg").parent().first();

    toggleElement.hover(
        function() {
            if (arrowElement.length) {
                $(this).addClass("w-hover");
                rotateArrow(arrowElement[0], 250, true);
            }
        },
        function() {
            $(this).removeClass("w-hover");
            rotateArrow(arrowElement[0], 250, false).then(() =>
                setTimeout(() => {
                    arrowElement.css("transform", "none"); // Ensure it resets
                }, 100)
            );
        }
    ).click(function() {
        $(this).removeClass("w-hover");
        rotateArrow(arrowElement[0], 250, false);
    });
});
