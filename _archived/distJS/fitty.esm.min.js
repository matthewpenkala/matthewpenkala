const fitty=function(a){function b(a,b){const c=Object.assign({},w,b),d=a.map(a=>{const b=Object.assign({},c,{element:a});return t(b),v(b),{element:a,fit:s(b,e.DIRTY),unsubscribe:u(b)}});return i(),d}function c(a,c={}){return"string"==typeof a?b(d(document.querySelectorAll(a)),c):b([a],c)[0]}if(!a)return;const d=a=>[].slice.call(a),e={IDLE:0,DIRTY_CONTENT:1,DIRTY_LAYOUT:2,DIRTY:3};let g=[],h=null;const i="requestAnimationFrame"in a?()=>{a.cancelAnimationFrame(h),h=a.requestAnimationFrame(()=>{k(g.filter(a=>a.dirty))})}:()=>{},j=a=>()=>{g.forEach(b=>{b.dirty=a}),i()},k=a=>{a.filter(a=>!a.styleComputed).forEach(a=>{a.styleComputed=o(a)}),a.filter(p).forEach(q);const b=a.filter(n);b.forEach(m),b.forEach(a=>{q(a),l(a)}),b.forEach(r)},l=a=>a.dirty=e.IDLE,m=a=>{a.availableWidth=a.element.parentNode.clientWidth,a.currentWidth=a.element.scrollWidth,a.previousFontSize=a.currentFontSize,a.currentFontSize=Math.min(Math.max(a.minSize,a.availableWidth/a.currentWidth*a.previousFontSize),a.maxSize),a.whiteSpace=a.multiLine&&a.currentFontSize===a.minSize?"normal":"nowrap"},n=a=>a.dirty!==e.DIRTY_LAYOUT||a.dirty===e.DIRTY_LAYOUT&&a.element.parentNode.clientWidth!==a.availableWidth,o=b=>{const c=a.getComputedStyle(b.element,null);b.currentFontSize=parseInt(c.getPropertyValue("font-size"),10),b.display=c.getPropertyValue("display"),b.whiteSpace=c.getPropertyValue("white-space")},p=a=>{if(a.preStyleTestCompleted)return!1;let b=!1;return /inline-/.test(a.display)||(b=!0,a.display="inline-block"),"nowrap"!==a.whiteSpace&&(b=!0,a.whiteSpace="nowrap"),a.preStyleTestCompleted=!0,b},q=a=>{a.originalStyle||(a.originalStyle=a.element.getAttribute("style")||""),a.element.style.cssText=a.originalStyle+";white-space:"+a.whiteSpace+";display:"+a.display+";font-size:"+a.currentFontSize+"px"},r=a=>{a.element.dispatchEvent(new CustomEvent("fit",{detail:{oldValue:a.previousFontSize,newValue:a.currentFontSize,scaleFactor:a.currentFontSize/a.previousFontSize}}))},s=(a,b)=>()=>{a.dirty=b,i()},t=a=>{a.newbie=!0,a.dirty=!0,g.push(a)},u=a=>()=>{g=g.filter(b=>b.element!==a.element),a.observeMutations&&a.observer.disconnect(),a.element.style.cssText=a.originalStyle},v=a=>{a.observeMutations&&(a.observer=new MutationObserver(s(a,e.DIRTY_CONTENT)),a.observer.observe(a.element,a.observeMutations))},w={minSize:16,maxSize:512,multiLine:!0,observeMutations:!!("MutationObserver"in a)&&{subtree:!0,childList:!0,characterData:!0}};let x=null;const y=()=>{a.clearTimeout(x),x=a.setTimeout(j(e.DIRTY_LAYOUT),c.observeWindowDelay)},z=["resize","orientationchange"];return Object.defineProperty(c,"observeWindow",{set:b=>{const c=`${b?"add":"remove"}EventListener`;z.forEach(b=>{a[c](b,y)})}}),c.observeWindow=!0,c.observeWindowDelay=100,c.fitAll=j(e.DIRTY),c}("undefined"==typeof window?null:window);export default fitty;