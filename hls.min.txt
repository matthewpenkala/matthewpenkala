!function Ss(Ls){var t=this,e=function(){"use strict";function e(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function g(i){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e(Object(n),!0).forEach(function(t){var e,r;e=i,t=n[r=t],(r=c(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach(function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(n,t))})}return i}function i(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,c(i.key),i)}}function o(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function et(){return(et=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r,i=arguments[e];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}function l(t,e){t.prototype=Object.create(e.prototype),a(t.prototype.constructor=t,e)}function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e,r){return(s=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(t){return}}}()?Reflect.construct.bind():function(t,e,r){var i=[null];i.push.apply(i,e);i=new(Function.bind.apply(t,i));return r&&a(i,r.prototype),i}).apply(null,arguments)}function u(t){var r="function"==typeof Map?new Map:void 0;return(u=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,e)}function e(){return s(t,arguments,n(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a(e,t)})(t)}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function d(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t){if(t){if("string"==typeof t)return h(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?h(t,void 0):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(t){t=function(t){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return String(t);t=e.call(t,"string");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(t);return"symbol"==typeof t?t:String(t)}var r,f,m,v,p,t={exports:{}};r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,f=/^(?=([^\/?#]*))\1([^]*)$/,m=/(?:\/|^)\.(?=\/)/g,v=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g;var y=t.exports=p={buildAbsoluteURL:function(t,e,r){if(r=r||{},t=t.trim(),!(e=e.trim())){if(!r.alwaysNormalize)return t;var i=p.parseURL(t);if(!i)throw new Error("Error trying to parse base URL.");return i.path=p.normalizePath(i.path),p.buildURLFromParts(i)}i=p.parseURL(e);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return r.alwaysNormalize?(i.path=p.normalizePath(i.path),p.buildURLFromParts(i)):e;e=p.parseURL(t);if(!e)throw new Error("Error trying to parse base URL.");!e.netLoc&&e.path&&"/"!==e.path[0]&&(n=f.exec(e.path),e.netLoc=n[1],e.path=n[2]),e.netLoc&&!e.path&&(e.path="/");var n,t={scheme:e.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};return i.netLoc||(t.netLoc=e.netLoc,"/"===i.path[0])||(i.path?(n=(n=e.path).substring(0,n.lastIndexOf("/")+1)+i.path,t.path=p.normalizePath(n)):(t.path=e.path,i.params||(t.params=e.params,i.query||(t.query=e.query)))),null===t.path&&(t.path=r.alwaysNormalize?p.normalizePath(i.path):i.path),p.buildURLFromParts(t)},parseURL:function(t){t=r.exec(t);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(m,"");t.length!==(t=t.replace(v,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},G=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},rt=((Un={}).MEDIA_ATTACHING="hlsMediaAttaching",Un.MEDIA_ATTACHED="hlsMediaAttached",Un.MEDIA_DETACHING="hlsMediaDetaching",Un.MEDIA_DETACHED="hlsMediaDetached",Un.BUFFER_RESET="hlsBufferReset",Un.BUFFER_CODECS="hlsBufferCodecs",Un.BUFFER_CREATED="hlsBufferCreated",Un.BUFFER_APPENDING="hlsBufferAppending",Un.BUFFER_APPENDED="hlsBufferAppended",Un.BUFFER_EOS="hlsBufferEos",Un.BUFFER_FLUSHING="hlsBufferFlushing",Un.BUFFER_FLUSHED="hlsBufferFlushed",Un.MANIFEST_LOADING="hlsManifestLoading",Un.MANIFEST_LOADED="hlsManifestLoaded",Un.MANIFEST_PARSED="hlsManifestParsed",Un.LEVEL_SWITCHING="hlsLevelSwitching",Un.LEVEL_SWITCHED="hlsLevelSwitched",Un.LEVEL_LOADING="hlsLevelLoading",Un.LEVEL_LOADED="hlsLevelLoaded",Un.LEVEL_UPDATED="hlsLevelUpdated",Un.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",Un.LEVELS_UPDATED="hlsLevelsUpdated",Un.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",Un.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",Un.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",Un.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",Un.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",Un.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",Un.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",Un.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",Un.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",Un.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",Un.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",Un.CUES_PARSED="hlsCuesParsed",Un.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",Un.INIT_PTS_FOUND="hlsInitPtsFound",Un.FRAG_LOADING="hlsFragLoading",Un.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",Un.FRAG_LOADED="hlsFragLoaded",Un.FRAG_DECRYPTED="hlsFragDecrypted",Un.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",Un.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",Un.FRAG_PARSING_METADATA="hlsFragParsingMetadata",Un.FRAG_PARSED="hlsFragParsed",Un.FRAG_BUFFERED="hlsFragBuffered",Un.FRAG_CHANGED="hlsFragChanged",Un.FPS_DROP="hlsFpsDrop",Un.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",Un.ERROR="hlsError",Un.DESTROYING="hlsDestroying",Un.KEY_LOADING="hlsKeyLoading",Un.KEY_LOADED="hlsKeyLoaded",Un.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",Un.BACK_BUFFER_REACHED="hlsBackBufferReached",Un),it=((ki={}).NETWORK_ERROR="networkError",ki.MEDIA_ERROR="mediaError",ki.KEY_SYSTEM_ERROR="keySystemError",ki.MUX_ERROR="muxError",ki.OTHER_ERROR="otherError",ki),nt=((Tr={}).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",Tr.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",Tr.KEY_SYSTEM_NO_SESSION="keySystemNoSession",Tr.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",Tr.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",Tr.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",Tr.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",Tr.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",Tr.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",Tr.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",Tr.MANIFEST_LOAD_ERROR="manifestLoadError",Tr.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",Tr.MANIFEST_PARSING_ERROR="manifestParsingError",Tr.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",Tr.LEVEL_EMPTY_ERROR="levelEmptyError",Tr.LEVEL_LOAD_ERROR="levelLoadError",Tr.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",Tr.LEVEL_PARSING_ERROR="levelParsingError",Tr.LEVEL_SWITCH_ERROR="levelSwitchError",Tr.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",Tr.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",Tr.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",Tr.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",Tr.FRAG_LOAD_ERROR="fragLoadError",Tr.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",Tr.FRAG_DECRYPT_ERROR="fragDecryptError",Tr.FRAG_PARSING_ERROR="fragParsingError",Tr.FRAG_GAP="fragGap",Tr.REMUX_ALLOC_ERROR="remuxAllocError",Tr.KEY_LOAD_ERROR="keyLoadError",Tr.KEY_LOAD_TIMEOUT="keyLoadTimeOut",Tr.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",Tr.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",Tr.BUFFER_APPEND_ERROR="bufferAppendError",Tr.BUFFER_APPENDING_ERROR="bufferAppendingError",Tr.BUFFER_STALLED_ERROR="bufferStalledError",Tr.BUFFER_FULL_ERROR="bufferFullError",Tr.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",Tr.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",Tr.INTERNAL_EXCEPTION="internalException",Tr.INTERNAL_ABORTED="aborted",Tr.UNKNOWN="unknown",Tr),T=function(){},E={trace:T,debug:T,log:T,warn:T,info:T,error:T},S=E;function L(t,e){if(self.console&&!0===t||"object"==typeof t){!function(r){for(var t=arguments.length,e=new Array(1<t?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];e.forEach(function(t){var e;S[t]=r[t]?r[t].bind(r):(e=t,(t=self.console[e])?t.bind(self.console,"["+e+"] >"):T)})}(t,"debug","log","info","warn","error");try{S.log('Debug logs enabled for "'+e+'" in hls.js version 1.4.5')}catch(t){S=E}}else S=E}var at=S,R=/^(\d+)x(\d+)$/,A=/(.+?)=(".*?"|.*?)(?:,|$)/g,K=((Pi=k.prototype).decimalInteger=function(t){t=parseInt(this[t],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},Pi.hexadecimalInteger=function(t){if(this[t]){for(var e=(1&(e=(this[t]||"0x").slice(2)).length?"0":"")+e,r=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)r[i]=parseInt(e.slice(2*i,2*i+2),16);return r}return null},Pi.hexadecimalIntegerAsNumber=function(t){t=parseInt(this[t],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},Pi.decimalFloatingPoint=function(t){return parseFloat(this[t])},Pi.optionalFloat=function(t,e){t=this[t];return t?parseFloat(t):e},Pi.enumeratedString=function(t){return this[t]},Pi.bool=function(t){return"YES"===this[t]},Pi.decimalResolution=function(t){t=R.exec(this[t]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},k.parseAttrList=function(t){var e,r={};for(A.lastIndex=0;null!==(e=A.exec(t));){var i=e[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[e[1].trim()]=i}return r},k);function k(t){for(var e in"string"==typeof t&&(t=k.parseAttrList(t)),t)t.hasOwnProperty(e)&&("X-"===e.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(e)),this[e]=t[e])}function b(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}var D,H=(o(M,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var t=this.duration;return null!==t?new Date(this._startDate.getTime()+1e3*t):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var t=this.attr.decimalFloatingPoint("DURATION");if(G(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&G(this.startDate.getTime())&&(null===this.duration||0<=this.duration)&&(!this.endOnNext||!!this.class)}}]),M),I="audio",w="video",C="audiovideo",_=(F.prototype.setByteRange=function(t,e){var r=t.split("@",2),t=[];1===r.length?t[0]=e?e.byteRangeEndOffset:0:t[0]=parseInt(r[1]),t[1]=parseInt(r[0])+t[0],this._byteRange=t},o(F,[{key:"byteRange",get:function(){return this._byteRange||[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=y.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),F),V=function(r){function t(t,e){return(e=r.call(this,e)||this)._decryptdata=null,e.rawProgramDateTime=null,e.programDateTime=null,e.tagList=[],e.duration=0,e.sn=0,e.levelkeys=void 0,e.type=void 0,e.loader=null,e.keyLoader=null,e.level=-1,e.cc=0,e.startPTS=void 0,e.endPTS=void 0,e.startDTS=void 0,e.endDTS=void 0,e.start=0,e.deltaPTS=void 0,e.maxStartPTS=void 0,e.minEndPTS=void 0,e.stats=new b,e.urlId=0,e.data=void 0,e.bitrateTest=!1,e.title=null,e.initSegment=null,e.endList=void 0,e.gap=void 0,e.type=t,e}l(t,r);var e=t.prototype;return e.setKeyFormat=function(t){!this.levelkeys||(t=this.levelkeys[t])&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))},e.abortRequests=function(){var t;null==(t=this.loader)||t.abort(),null==(t=this.keyLoader)||t.abort()},e.setElementaryStreamInfo=function(t,e,r,i,n,a){void 0===a&&(a=!1);var s=this.elementaryStreams,o=s[t];o?(o.startPTS=Math.min(o.startPTS,e),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,n)):s[t]={startPTS:e,endPTS:r,startDTS:i,endDTS:n,partial:a}},e.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[I]=null,t[w]=null,t[C]=null},o(t,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{t=Object.keys(this.levelkeys);if(1===t.length)return this._decryptdata=this.levelkeys[t[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!G(this.programDateTime))return null;var t=G(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t=Object.keys(this.levelkeys),e=t.length;if(1<e||1===e&&this.levelkeys[t[0]].encrypted)return!0}return!1}}]),t}(_),Y=(l(x,D=_),o(x,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),x),W=(P.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var e=this.lastPartSn-t.lastPartSn,r=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!r||!!e,this.advanced=this.endSN>t.endSN||0<e||0==e&&0<r,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay},o(P,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&G(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return 0<t?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return null!=(t=this.fragments)&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),P);function P(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}function x(t,e,r,i,n){(r=D.call(this,r)||this).fragOffset=0,r.duration=0,r.gap=!1,r.independent=!1,r.relurl=void 0,r.fragment=void 0,r.index=void 0,r.stats=new b,r.duration=t.decimalFloatingPoint("DURATION"),r.gap=t.bool("GAP"),r.independent=t.bool("INDEPENDENT"),r.relurl=t.enumeratedString("URI"),r.fragment=e,r.index=i;t=t.enumeratedString("BYTERANGE");return t&&r.setByteRange(t,n),n&&(r.fragOffset=n.fragOffset+n.duration),r}function F(t){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((e={})[I]=null,e[w]=null,e[C]=null,e),this.baseurl=t}function M(t,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){var r,i=e.attr;for(r in i)if(Object.prototype.hasOwnProperty.call(t,r)&&t[r]!==i[r]){at.warn('DATERANGE tag attribute: "'+r+'" does not match for tags with ID: "'+t.ID+'"'),this._badValueForSameId=r;break}t=et(new K({}),i,t)}this.attr=t,this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr&&(e=new Date(this.attr["END-DATE"]),G(e.getTime())&&(this._endDate=e))}function O(t){return Uint8Array.from(atob(t),function(t){return t.charCodeAt(0)})}function N(t){return Uint8Array.from(unescape(encodeURIComponent(t)),function(t){return t.charCodeAt(0)})}var U={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},B="org.w3.clearkey",j="com.apple.streamingkeydelivery",q="com.microsoft.playready",X="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function z(t){switch(t){case j:return U.FAIRPLAY;case q:return U.PLAYREADY;case X:return U.WIDEVINE;case B:return U.CLEARKEY}}var Q="edef8ba979d64acea3c827dcd51d21ed";function $(t){switch(t){case U.FAIRPLAY:return j;case U.PLAYREADY:return q;case U.WIDEVINE:return X;case U.CLEARKEY:return B}}function J(t){var e=t.drmSystems,r=t.widevineLicenseUrl,t=e?[U.FAIRPLAY,U.WIDEVINE,U.PLAYREADY,U.CLEARKEY].filter(function(t){return!!e[t]}):[];return!t[U.WIDEVINE]&&r&&t.push(U.WIDEVINE),t}var Z="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function tt(t,e,r){return Uint8Array.prototype.slice?t.slice(e,r):new Uint8Array(Array.prototype.slice.call(t,e,r))}function st(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128}function ot(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128}function lt(t,e){for(var r=e,i=0;st(t,e);)i+=10,i+=ct(t,e+6),ot(t,e+10)&&(i+=10),e+=i;if(0<i)return t.subarray(r,r+i)}function ut(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info}function ht(t){for(var e,r=0,i=[];st(t,r);){for(var n=ct(t,r+6),a=(r+=10)+n;r+8<a;){var s=(s=t.subarray(r),o=e=void 0,e=String.fromCharCode(s[0],s[1],s[2],s[3]),o=ct(s,4),{type:e,size:o,data:s.subarray(10,10+o)}),o=ft(s);o&&i.push(o),r+=s.size+10}ot(t,r)&&(r+=10)}return i}var dt,ct=function(t,e){var r=0,r=(127&t[e])<<21;return r|=(127&t[e+1])<<14,(r|=(127&t[e+2])<<7)|127&t[e+3]},ft=function(t){return("PRIV"===t.type?gt:"W"===t.type[0]?vt:mt)(t)},gt=function(t){if(!(t.size<2)){var e=pt(t.data,!0),r=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:r.buffer}}},mt=function(t){if(!(t.size<2)){if("TXXX"===t.type){var e=1,r=pt(t.data.subarray(1),!0);e+=r.length+1;e=pt(t.data.subarray(e));return{key:t.type,info:r,data:e}}e=pt(t.data.subarray(1));return{key:t.type,data:e}}},vt=function(t){if("WXXX"===t.type){if(t.size<2)return;var e=1,r=pt(t.data.subarray(1),!0);e+=r.length+1;e=pt(t.data.subarray(e));return{key:t.type,info:r,data:e}}e=pt(t.data);return{key:t.type,data:e}},pt=function(t,e){void 0===e&&(e=!1);var r=(dt||void 0===self.TextDecoder||(dt=new self.TextDecoder("utf-8")),dt);if(r){var i=r.decode(t);if(e){r=i.indexOf("\0");return-1!==r?i.substring(0,r):i}return i.replace(/\0/g,"")}for(var n,a,s,o=t.length,l="",u=0;u<o;){if(0===(n=t[u++])&&e)return l;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(n);break;case 12:case 13:a=t[u++],l+=String.fromCharCode((31&n)<<6|63&a);break;case 14:a=t[u++],s=t[u++],l+=String.fromCharCode((15&n)<<12|(63&a)<<6|(63&s)<<0)}}return l};function yt(t){for(var e="",r=0;r<t.length;r++){var i=t[r].toString(16);i.length<2&&(i="0"+i),e+=i}return e}var Tt=Math.pow(2,32)-1,Et=[].push,St={video:1,audio:2,id3:3,text:4};function Lt(t){return String.fromCharCode.apply(null,t)}function Rt(t,e){e=t[e]<<8|t[e+1];return e<0?65536+e:e}function At(t,e){e=kt(t,e);return e<0?4294967296+e:e}function kt(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function bt(t,e,r){t[e]=r>>24,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=255&r}function Dt(t,e){var r=[];if(!e.length)return r;for(var i=t.byteLength,n=0;n<i;){var a=At(t,n),s=1<a?n+a:i;Lt(t.subarray(n+4,n+8))===e[0]&&(1===e.length?r.push(t.subarray(n+8,s)):(a=Dt(t.subarray(n+8,s),e.slice(1))).length&&Et.apply(r,a)),n=s}return r}function It(t){for(var r=[],e=Dt(t,["moov","trak"]),i=0;i<e.length;i++){var n,a,s,o=e[i],l=Dt(o,["tkhd"])[0];l&&(n=At(l,0===l[0]?12:20),(s=Dt(o,["mdia","mdhd"])[0])&&(a=At(s,0===s[0]?12:20),(l=Dt(o,["mdia","hdlr"])[0])&&(s=Lt(l.subarray(8,12)),(l={soun:I,vide:w}[s])&&(s=void 0,(o=Dt(o,["mdia","minf","stbl","stsd"])[0])&&(s=Lt(o.subarray(12,16))),r[n]={timescale:a,type:l},r[l]={timescale:a,id:n,codec:s}))))}return Dt(t,["moov","mvex","trex"]).forEach(function(t){var e=At(t,4),e=r[e];e&&(e.default={duration:At(t,12),flags:At(t,20)})}),r}function wt(t){var e=Dt(t,["schm"])[0];if(e){e=Lt(e.subarray(4,8));if("cbcs"===e||"cenc"===e)return Dt(t,["schi","tenc"])[0]}return at.error("[eme] missing 'schm' box"),null}function Ct(t,e){var r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}function _t(L,R){var A=[],k=R.samples,b=R.timescale,o=R.id,D=!1;return Dt(k,["moof"]).map(function(t){var S=t.byteOffset-8;Dt(t,["traf"]).map(function(s){var t=Dt(s,["tfdt"]).map(function(t){var e=t[0],r=At(t,4);return 1===e&&(r*=Math.pow(2,32),r+=At(t,8)),r/b})[0];return void 0!==t&&(L=t),Dt(s,["tfhd"]).map(function(t){var e=At(t,4),r=16777215&At(t,0),T=0,i=0!=(16&r),E=0,n=0!=(32&r),a=8;e===o&&(0!=(1&r)&&(a+=8),0!=(2&r)&&(a+=4),0!=(8&r)&&(T=At(t,a),a+=4),i&&(E=At(t,a),a+=4),n&&(a+=4),"video"===R.type&&(D=function(t){if(!t)return!1;var e=t.indexOf("."),e=e<0?t:t.substring(0,e);return"hvc1"===e||"hev1"===e||"dvh1"===e||"dvhe"===e}(R.codec)),Dt(s,["trun"]).map(function(t){var e=t[0],r=16777215&At(t,0),i=0!=(1&r),n=0,a=0!=(4&r),s=0!=(256&r),o=0,l=0!=(512&r),u=0,h=0!=(1024&r),d=0!=(2048&r),c=0,f=At(t,4),g=8;i&&(n=At(t,g),g+=4),a&&(g+=4);for(var m=n+S,v=0;v<f;v++){if(s?(o=At(t,g),g+=4):o=T,l?(u=At(t,g),g+=4):u=E,h&&(g+=4),d&&(c=(0===e?At:kt)(t,g),g+=4),R.type===w)for(var p=0;p<u;){var y=At(k,m);!function(t,e){if(t){t=e>>1&63;return 39==t||40==t}return 6==(31&e)}(D,k[m+=4])||Pt(k.subarray(m,m+y),D?2:1,L+c/b,A),m+=y,p+=y+4}L+=o/b}}))})})}),A}function Pt(t,e,r,i){var n=xt(t),a=0;a+=e;for(var s=0,o=0,l=!1,u=0;a<n.length;){for(s=0;!(a>=n.length)&&(s+=u=n[a++],255===u););for(o=0;!(a>=n.length)&&(o+=u=n[a++],255===u););var h=n.length-a;if(!l&&4===s&&a<n.length){if(l=!0,181===n[a++]){var d=Rt(n,a);if(a+=2,49===d){var c=At(n,a);if(a+=4,1195456820===c){var f=n[a++];if(3===f){var d=n[a++],c=64&d,g=c?2+3*(31&d):0,m=new Uint8Array(g);if(c){m[0]=d;for(var v=1;v<g;v++)m[v]=n[a++]}i.push({type:f,payloadType:s,pts:r,bytes:m})}}}}}else if(5===s&&o<h){if(l=!0,16<o){for(var p=[],y=0;y<16;y++){var T=n[a++].toString(16);p.push(1==T.length?"0"+T:T),3!==y&&5!==y&&7!==y&&9!==y||p.push("-")}for(var E=o-16,S=new Uint8Array(E),L=0;L<E;L++)S[L]=n[a++];i.push({payloadType:s,pts:r,uuid:p.join(""),userData:pt(S),userDataBytes:S})}}else if(o<h)a+=o;else if(h<o)break}}function xt(t){for(var e=t.byteLength,r=[],i=1;i<e-2;)0===t[i]&&0===t[i+1]&&3===t[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return t;for(var n=e-r.length,a=new Uint8Array(n),s=0,i=0;i<n;s++,i++)s===r[0]&&(s++,r.shift()),a[i]=t[s];return a}var Ft={},Mt=function(){function u(t,e,r,i,n){void 0===i&&(i=[1]),void 0===n&&(n=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=r,this.keyFormatVersions=i,this.iv=n,this.encrypted=!!t&&"NONE"!==t,this.isCommonEncryption=this.encrypted&&"AES-128"!==t}u.clearKeyUriToKeyIdMap=function(){Ft={}};var t=u.prototype;return t.isSupported=function(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case j:case X:case q:case B:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1},t.getDecryptData=function(t){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof t&&("AES-128"!==this.method||this.iv||at.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),t=0);var e=function(t){for(var e=new Uint8Array(16),r=12;r<16;r++)e[r]=t>>8*(15-r)&255;return e}(t);return new u(this.method,this.uri,"identity",this.keyFormatVersions,e)}var r,i,n=(i=this.uri,r=i.split(":"),t=null,"data"!==r[0]||2!==r.length||2===(i=(e=r[1].split(";"))[e.length-1].split(",")).length&&(r="base64"===i[0],i=i[1],t=r?(e.splice(-1,1),O(i)):(e=N(i).subarray(0,16),(i=new Uint8Array(16)).set(e,16-e.length),i)),t);if(n)switch(this.keyFormat){case X:22<=(this.pssh=n).length&&(this.keyId=n.subarray(n.length-22,n.length-6));break;case q:var a=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function(t,e,r){if(16!==t.byteLength)throw new RangeError("Invalid system id");var i,n,a;if(e){i=1,n=new Uint8Array(16*e.length);for(var s=0;s<e.length;s++){var o=e[s];if(16!==o.byteLength)throw new RangeError("Invalid key");n.set(o,16*s)}}else i=0,n=new Uint8Array;0<i?(a=new Uint8Array(4),0<e.length&&new DataView(a.buffer).setUint32(0,e.length,!1)):a=new Uint8Array;var l=new Uint8Array(4);return r&&0<r.byteLength&&new DataView(l.buffer).setUint32(0,r.byteLength,!1),function(t){for(var e=arguments.length,r=new Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];for(var n=r.length,a=8,s=n;s--;)a+=r[s].byteLength;var o=new Uint8Array(a);for(o[0]=a>>24&255,o[1]=a>>16&255,o[2]=a>>8&255,o[3]=255&a,o.set(t,4),s=0,a=8;s<n;s++)o.set(r[s],a),a+=r[s].byteLength;return o}([112,115,115,104],new Uint8Array([i,0,0,0]),t,a,n,l,r||new Uint8Array)}(a,null,n);a=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),a=String.fromCharCode.apply(null,Array.from(a)),a=a.substring(a.indexOf("<"),a.length),a=(new DOMParser).parseFromString(a,"text/xml").getElementsByTagName("KID")[0];!a||(a=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE"))&&(s=O(a).subarray(0,16),l(o=s,0,3),l(o,1,2),l(o,4,5),l(o,6,7),this.keyId=s);break;default:var s,o=n.subarray(0,16);16!==o.length&&((s=new Uint8Array(16)).set(o,16-o.length),o=s),this.keyId=o}function l(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}return this.keyId&&16===this.keyId.byteLength||((i=Ft[this.uri])||(t=Object.keys(Ft).length%Number.MAX_SAFE_INTEGER,i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,t),Ft[this.uri]=i),this.keyId=i),this},u}(),Ot=/\{\$([a-zA-Z0-9-_]+)\}/g;function Nt(t){return Ot.test(t)}function Ut(t,e,r){if(null!==t.variableList||t.hasVariableRefs)for(var i=r.length;i--;){var n=r[i],a=e[n];a&&(e[n]=Bt(t,a))}}function Bt(i,t){if(null!==i.variableList||i.hasVariableRefs){var n=i.variableList;return t.replace(Ot,function(t){var e=t.substring(2,t.length-1),r=null==n?void 0:n[e];return void 0===r?(i.playlistParsingError||(i.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'+e+'"')),t):r})}return t}function Gt(t,e,r){var i,n,a=t.variableList;if(a||(t.variableList=a={}),"QUERYPARAM"in e){i=e.QUERYPARAM;try{var s=new self.URL(r).searchParams;if(!s.has(i))throw new Error('"'+i+'" does not match any query parameter in URI: "'+r+'"');n=s.get(i)}catch(e){t.playlistParsingError||(t.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+e.message))}}else i=e.NAME,n=e.VALUE;i in a?t.playlistParsingError||(t.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'+i+'"')):a[i]=n||""}function Kt(){if("undefined"!=typeof self)return self.MediaSource||self.WebKitMediaSource}var Ht={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},Vt=Kt();function Yt(t,e){return null!=(t=null==Vt?void 0:Vt.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"'))&&t}var Wt=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,jt=/#EXT-X-MEDIA:(.*)/g,qt=/^#EXT(?:INF|-X-TARGETDURATION):/m,Xt=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),zt=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Qt=($t.findGroup=function(t,e){for(var r=0;r<t.length;r++){var i=t[r];if(i.id===e)return i}},$t.convertAVC1ToAVCOTI=function(t){var e=t.split(".");if(2<e.length){var r=e.shift()+".";return(r+=parseInt(e.shift()).toString(16))+("000"+parseInt(e.shift()).toString(16)).slice(-4)}return t},$t.resolve=function(t,e){return y.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},$t.isMediaPlaylist=function(t){return qt.test(t)},$t.parseMasterPlaylist=function(t,e){var r,i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Nt(t)},n=[];for(Wt.lastIndex=0;null!=(r=Wt.exec(t));)if(r[1]){var a=new K(r[1]);Ut(i,a,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);var s=Bt(i,r[2]),o={attrs:a,bitrate:a.decimalInteger("AVERAGE-BANDWIDTH")||a.decimalInteger("BANDWIDTH"),name:a.NAME,url:$t.resolve(s,e)},s=a.decimalResolution("RESOLUTION");s&&(o.width=s.width,o.height=s.height),function(i,n){["video","audio","text"].forEach(function(r){var t,e=i.filter(function(t){return!!(e=Ht[r])&&!0===e[t.slice(0,4)];var e});e.length&&(t=e.filter(function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}),n[r+"Codec"]=(0<t.length?t:e)[0],i=i.filter(function(t){return-1===e.indexOf(t)}))}),n.unknownCodecs=i}((a.CODECS||"").split(/[ ,]+/).filter(function(t){return t}),o),o.videoCodec&&-1!==o.videoCodec.indexOf("avc1")&&(o.videoCodec=$t.convertAVC1ToAVCOTI(o.videoCodec)),null!=(a=o.unknownCodecs)&&a.length||n.push(o),i.levels.push(o)}else if(r[3]){var o=r[3],l=r[4];switch(o){case"SESSION-DATA":var u=new K(l);Ut(i,u,["DATA-ID","LANGUAGE","VALUE","URI"]);var h=u["DATA-ID"];h&&(null===i.sessionData&&(i.sessionData={}),i.sessionData[h]=u);break;case"SESSION-KEY":u=Jt(l,e,i);u.encrypted&&u.isSupported()?(null===i.sessionKeys&&(i.sessionKeys=[]),i.sessionKeys.push(u)):at.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+l+'"');break;case"DEFINE":var d=new K(l);Ut(i,d,["NAME","VALUE","QUERYPARAM"]),Gt(i,d,e);break;case"CONTENT-STEERING":d=new K(l);Ut(i,d,["SERVER-URI","PATHWAY-ID"]),i.contentSteering={uri:$t.resolve(d["SERVER-URI"],e),pathwayId:d["PATHWAY-ID"]||"."};break;case"START":i.startTimeOffset=Zt(l)}}var c=0<n.length&&n.length<i.levels.length;return i.levels=c?n:i.levels,0===i.levels.length&&(i.playlistParsingError=new Error("no levels found in manifest")),i},$t.parseMasterPlaylistMedia=function(t,e,r){var i={},n=r.levels,a={AUDIO:n.map(function(t){return{id:t.attrs.AUDIO,audioCodec:t.audioCodec}}),SUBTITLES:n.map(function(t){return{id:t.attrs.SUBTITLES,textCodec:t.textCodec}}),"CLOSED-CAPTIONS":[]},s=0;for(jt.lastIndex=0;null!==(o=jt.exec(t));){var o,l,u=new K(o[1]),h=u.TYPE;h&&(l=a[h],o=i[h]||[],i[h]=o,Ut(r,u,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]),u={attrs:u,bitrate:0,id:s++,groupId:u["GROUP-ID"]||"",instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE||"",type:h,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:u.LANGUAGE,url:u.URI?$t.resolve(u.URI,e):""},null!=l&&l.length&&(te(u,l=$t.findGroup(l,u.groupId)||l[0],"audioCodec"),te(u,l,"textCodec")),o.push(u))}return i},$t.parseLevelPlaylist=function(t,e,r,i,n,a){var s,o,l,u=new W(e),h=u.fragments,d=null,c=0,f=0,g=0,m=0,v=null,p=new V(i,e),y=-1,T=!1;for(Xt.lastIndex=0,u.m3u8=t,u.hasVariableRefs=Nt(t);null!==(s=Xt.exec(t));){T&&(T=!1,(p=new V(i,e)).start=g,p.sn=c,p.cc=m,p.level=r,d&&(p.initSegment=d,p.rawProgramDateTime=d.rawProgramDateTime,d.rawProgramDateTime=null));var E=s[1];if(E){p.duration=parseFloat(E);var S=(" "+s[2]).slice(1);p.title=S||null,p.tagList.push(S?["INF",E,S]:["INF",E])}else if(s[3])G(p.duration)&&(p.start=g,l&&ie(p,l,u),p.sn=c,p.level=r,p.cc=m,p.urlId=n,h.push(p),L=(" "+s[3]).slice(1),p.relurl=Bt(u,L),ee(p,v),g+=(v=p).duration,c++,T=!(f=0));else if(s[4]){var L=(" "+s[4]).slice(1);v?p.setByteRange(L,v):p.setByteRange(L)}else if(s[5])p.rawProgramDateTime=(" "+s[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),-1===y&&(y=h.length);else if(s=s[0].match(zt)){for(o=1;o<s.length&&void 0===s[o];o++);var R=(" "+s[o]).slice(1),A=(" "+s[o+1]).slice(1),k=s[o+2]?(" "+s[o+2]).slice(1):"";switch(R){case"PLAYLIST-TYPE":u.type=A.toUpperCase();break;case"MEDIA-SEQUENCE":c=u.startSN=parseInt(A);break;case"SKIP":var b=new K(A);Ut(u,b,["RECENTLY-REMOVED-DATERANGES"]);var D=b.decimalInteger("SKIPPED-SEGMENTS");if(G(D)){for(var I=u.skippedSegments=D;I--;)h.unshift(null);c+=D}var D=b.enumeratedString("RECENTLY-REMOVED-DATERANGES");D&&(u.recentlyRemovedDateranges=D.split("\t"));break;case"TARGETDURATION":u.targetduration=Math.max(parseInt(A),1);break;case"VERSION":u.version=parseInt(A);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"#":(A||k)&&p.tagList.push(k?[A,k]:[A]);break;case"DISCONTINUITY":m++,p.tagList.push(["DIS"]);break;case"GAP":p.gap=!0,p.tagList.push([R]);break;case"BITRATE":p.tagList.push([R,A]);break;case"DATERANGE":var w=new K(A);Ut(u,w,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Ut(u,w,w.clientAttrs);var C=new H(w,u.dateRanges[w.ID]);C.isValid||u.skippedSegments?u.dateRanges[C.id]=C:at.warn('Ignoring invalid DATERANGE tag: "'+A+'"'),p.tagList.push(["EXT-X-DATERANGE",A]);break;case"DEFINE":var _=new K(A);Ut(u,_,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in _?(b=u,D=a,w=void 0,w=(C=_).IMPORT,D&&w in D?((C=b.variableList)||(b.variableList=C={}),C[w]=D[w]):b.playlistParsingError||(b.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'+w+'"'))):Gt(u,_,e);break;case"DISCONTINUITY-SEQUENCE":m=parseInt(A);break;case"KEY":_=Jt(A,e,u);if(_.isSupported()){if("NONE"===_.method){l=void 0;break}(l=l||{})[_.keyFormat]&&(l=et({},l)),l[_.keyFormat]=_}else at.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+A+'"');break;case"START":u.startTimeOffset=Zt(A);break;case"MAP":var P=new K(A);Ut(u,P,["BYTERANGE","URI"]),p.duration?(re(M=new V(i,e),P,r,l),d=M,(p.initSegment=d).rawProgramDateTime&&!p.rawProgramDateTime&&(p.rawProgramDateTime=d.rawProgramDateTime)):(re(p,P,r,l),d=p,T=!0);break;case"SERVER-CONTROL":var x=new K(A);u.canBlockReload=x.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=x.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=0<u.canSkipUntil&&x.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=x.optionalFloat("PART-HOLD-BACK",0),u.holdBack=x.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var F=new K(A);u.partTarget=F.decimalFloatingPoint("PART-TARGET");break;case"PART":var M=(M=u.partList)||(u.partList=[]),P=0<f?M[M.length-1]:void 0,x=f++,F=new K(A);Ut(u,F,["BYTERANGE","URI"]);P=new Y(F,p,e,x,P);M.push(P),p.duration+=P.duration;break;case"PRELOAD-HINT":var O=new K(A);Ut(u,O,["URI"]),u.preloadHint=O;break;case"RENDITION-REPORT":O=new K(A);Ut(u,O,["URI"]),u.renditionReports=u.renditionReports||[],u.renditionReports.push(O);break;default:at.warn("line parsed but not handled: "+s)}}else at.warn("No matches on slow regex match for level playlist!")}v&&!v.relurl?(h.pop(),g-=v.duration,u.partList&&(u.fragmentHint=v)):u.partList&&(ee(p,v),p.cc=m,u.fragmentHint=p,l&&ie(p,l,u));var N=h.length,U=h[0],B=h[N-1];return 0<(g+=u.skippedSegments*u.targetduration)&&N&&B?(u.averagetargetduration=g/N,N=B.sn,u.endSN="initSegment"!==N?N:0,u.live||(B.endList=!0),U&&(u.startCC=U.cc)):(u.endSN=0,u.startCC=0),u.fragmentHint&&(g+=u.fragmentHint.duration),u.totalduration=g,u.endCC=m,0<y&&function(t){for(var e=t[y],r=y;r--;){var i=t[r];if(!i)return;i.programDateTime=e.programDateTime-1e3*i.duration,e=i}}(h),u},$t);function $t(){}function Jt(t,e,r){var i=new K(t);Ut(r,i,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);var n=null!=(s=i.METHOD)?s:"",a=i.URI,t=i.hexadecimalInteger("IV"),r=i.KEYFORMATVERSIONS,s=null!=(s=i.KEYFORMAT)?s:"identity";a&&i.IV&&!t&&at.error("Invalid IV: "+i.IV);e=a?Qt.resolve(a,e):"",r=(r||"1").split("/").map(Number).filter(Number.isFinite);return new Mt(n,e,s,r,t)}function Zt(t){t=new K(t).decimalFloatingPoint("TIME-OFFSET");return G(t)?t:null}function te(t,e,r){e=e[r];e&&(t[r]=e)}function ee(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):null!=e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),G(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}function re(t,e,r,i){t.relurl=e.URI,e.BYTERANGE&&t.setByteRange(e.BYTERANGE),t.level=r,t.sn="initSegment",i&&(t.levelkeys=i),t.initSegment=null}function ie(t,e,r){t.levelkeys=e;r=r.encryptedFragments;r.length&&r[r.length-1].levelkeys===e||!Object.keys(e).some(function(t){return e[t].isCommonEncryption})||r.push(t)}var ne="manifest",ae="level",se="audioTrack",oe="subtitleTrack",le="main",ue="audio",he="subtitle";function de(t){switch(t.type){case se:return ue;case oe:return he;default:return le}}function ce(t,e){t=t.url;return void 0!==t&&0!==t.indexOf("data:")||(t=e.url),t}var fe=((jr=ge.prototype).startLoad=function(t){},jr.stopLoad=function(){this.destroyInternalLoaders()},jr.registerListeners=function(){var t=this.hls;t.on(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.on(rt.LEVEL_LOADING,this.onLevelLoading,this),t.on(rt.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(rt.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},jr.unregisterListeners=function(){var t=this.hls;t.off(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.off(rt.LEVEL_LOADING,this.onLevelLoading,this),t.off(rt.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(rt.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},jr.createInternalLoader=function(t){var e=this.hls.config,r=e.pLoader,i=e.loader,e=new(r||i)(e);return this.loaders[t.type]=e},jr.getInternalLoader=function(t){return this.loaders[t.type]},jr.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},jr.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},jr.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},jr.onManifestLoading=function(t,e){e=e.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ne,url:e,deliveryDirectives:null})},jr.onLevelLoading=function(t,e){var r=e.id,i=e.level,n=e.url,e=e.deliveryDirectives;this.load({id:r,level:i,responseType:"text",type:ae,url:n,deliveryDirectives:e})},jr.onAudioTrackLoading=function(t,e){var r=e.id,i=e.groupId,n=e.url,e=e.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:se,url:n,deliveryDirectives:e})},jr.onSubtitleTrackLoading=function(t,e){var r=e.id,i=e.groupId,n=e.url,e=e.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:oe,url:n,deliveryDirectives:e})},jr.load=function(t){var e,s=this,r=this.hls.config,i=this.getInternalLoader(t);if(i){var n=i.context;if(n&&n.url===t.url)return void at.trace("[playlist-loader]: playlist request ongoing");at.log("[playlist-loader]: aborting previous loader for type: "+t.type),i.abort()}n=t.type===ne?r.manifestLoadPolicy.default:et({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(t),null!=(r=t.deliveryDirectives)&&r.part&&(t.type===ae&&null!==t.level?e=this.hls.levels[t.level].details:t.type===se&&null!==t.id?e=this.hls.audioTracks[t.id].details:t.type===oe&&null!==t.id&&(e=this.hls.subtitleTracks[t.id].details),e)&&(r=e.partTarget,e=e.targetduration,r&&e&&(a=1e3*Math.max(3*r,.8*e),n=et({},n,{maxTimeToFirstByteMs:Math.min(a,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(a,n.maxTimeToFirstByteMs)})));var a=n.errorRetry||n.timeoutRetry||{},n={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},a={onSuccess:function(t,e,r,i){var n=s.getInternalLoader(r);s.resetInternalLoader(r.type);var a=t.data;0===a.indexOf("#EXTM3U")?(e.parsing.start=performance.now(),Qt.isMediaPlaylist(a)?s.handleTrackOrLevelPlaylist(t,e,r,i||null,n):s.handleMasterPlaylist(t,e,r,i)):s.handleManifestParsingError(t,r,new Error("no EXTM3U delimiter"),i||null,e)},onError:function(t,e,r,i){s.handleNetworkError(e,r,!1,t,i)},onTimeout:function(t,e,r){s.handleNetworkError(e,r,!0,void 0,t)}};i.load(t,n,a)},jr.handleMasterPlaylist=function(t,e,r,i){var n,a,s,o,l,u=this.hls,h=t.data,d=ce(t,r),c=Qt.parseMasterPlaylist(h,d);c.playlistParsingError?this.handleManifestParsingError(t,r,c.playlistParsingError,i,e):(n=c.contentSteering,a=c.levels,s=c.sessionData,o=c.sessionKeys,l=c.startTimeOffset,t=c.variableList,this.variableList=t,c=void 0===(h=(r=Qt.parseMasterPlaylistMedia(h,d,c)).AUDIO)?[]:h,h=r.SUBTITLES,r=r["CLOSED-CAPTIONS"],c.length&&(c.some(function(t){return!t.url})||!a[0].audioCodec||a[0].attrs.AUDIO||(at.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),c.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new K({}),bitrate:0,url:""}))),u.trigger(rt.MANIFEST_LOADED,{levels:a,audioTracks:c,subtitles:h,captions:r,contentSteering:n,url:d,stats:e,networkDetails:i,sessionData:s,sessionKeys:o,startTimeOffset:l,variableList:t}))},jr.handleTrackOrLevelPlaylist=function(t,e,r,i,n){var a=this.hls,s=r.id,o=r.level,l=r.type,u=ce(t,r),h=G(s)?s:0,s=G(o)?o:h,o=de(r),h=Qt.parseLevelPlaylist(t.data,u,s,o,h,this.variableList);l===ne&&(l={attrs:new K({}),bitrate:0,details:h,name:"",url:u},a.trigger(rt.MANIFEST_LOADED,{levels:[l],audioTracks:[],url:u,stats:e,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})),e.parsing.end=performance.now(),r.levelDetails=h,this.handlePlaylistLoaded(h,t,e,r,i,n)},jr.handleManifestParsingError=function(t,e,r,i,n){this.hls.trigger(rt.ERROR,{type:it.NETWORK_ERROR,details:nt.MANIFEST_PARSING_ERROR,fatal:e.type===ne,url:t.url,err:r,error:r,reason:r.message,response:t,context:e,networkDetails:i,stats:n})},jr.handleNetworkError=function(t,e,r,i,n){void 0===r&&(r=!1);var a="A network "+(r?"timeout":"error"+(i?" (status "+i.code+")":""))+" occurred while loading "+t.type;t.type===ae?a+=": "+t.level+" id: "+t.id:t.type!==se&&t.type!==oe||(a+=" id: "+t.id+' group-id: "'+t.groupId+'"');var s=new Error(a);at.warn("[playlist-loader]: "+a);var o=nt.UNKNOWN,l=!1,a=this.getInternalLoader(t);switch(t.type){case ne:o=r?nt.MANIFEST_LOAD_TIMEOUT:nt.MANIFEST_LOAD_ERROR,l=!0;break;case ae:o=r?nt.LEVEL_LOAD_TIMEOUT:nt.LEVEL_LOAD_ERROR,l=!1;break;case se:o=r?nt.AUDIO_TRACK_LOAD_TIMEOUT:nt.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case oe:o=r?nt.SUBTITLE_TRACK_LOAD_TIMEOUT:nt.SUBTITLE_LOAD_ERROR,l=!1}a&&this.resetInternalLoader(t.type);n={type:it.NETWORK_ERROR,details:o,fatal:l,url:t.url,loader:a,context:t,error:s,networkDetails:e,stats:n};i&&(t=(null==e?void 0:e.url)||t.url,n.response=g({url:t,data:void 0},i)),this.hls.trigger(rt.ERROR,n)},jr.handlePlaylistLoaded=function(t,e,r,i,n,a){var s=this.hls,o=i.type,l=i.level,u=i.id,h=i.groupId,d=i.deliveryDirectives,c=ce(e,i),f=de(i),g="number"==typeof i.level&&f===le?l:void 0;if(t.fragments.length){t.targetduration||(t.playlistParsingError=new Error("Missing Target Duration"));l=t.playlistParsingError;if(l)s.trigger(rt.ERROR,{type:it.NETWORK_ERROR,details:nt.LEVEL_PARSING_ERROR,fatal:!1,url:c,error:l,reason:l.message,response:e,context:i,level:g,parent:f,networkDetails:n,stats:r});else switch(t.live&&a&&(a.getCacheAge&&(t.ageHeader=a.getCacheAge()||0),a.getCacheAge&&!isNaN(t.ageHeader)||(t.ageHeader=0)),o){case ne:case ae:s.trigger(rt.LEVEL_LOADED,{details:t,level:g||0,id:u||0,stats:r,networkDetails:n,deliveryDirectives:d});break;case se:s.trigger(rt.AUDIO_TRACK_LOADED,{details:t,id:u||0,groupId:h||"",stats:r,networkDetails:n,deliveryDirectives:d});break;case oe:s.trigger(rt.SUBTITLE_TRACK_LOADED,{details:t,id:u||0,groupId:h||"",stats:r,networkDetails:n,deliveryDirectives:d})}}else{o=new Error("No Segments found in Playlist");s.trigger(rt.ERROR,{type:it.NETWORK_ERROR,details:nt.LEVEL_EMPTY_ERROR,fatal:!1,url:c,error:o,reason:o.message,response:e,context:i,level:g,parent:f,networkDetails:n,stats:r})}},ge);function ge(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=t,this.registerListeners()}function me(t,e){var r;try{r=new Event("addtrack")}catch(t){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=t,e.dispatchEvent(r)}function ve(t,e){var r=t.mode;if("disabled"===r&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(r){at.debug("[texttrack-utils]: "+r);var i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,t.addCue(i)}"disabled"===r&&(t.mode=r)}function pe(t){var e=t.mode;if("disabled"===e&&(t.mode="hidden"),t.cues)for(var r=t.cues.length;r--;)t.removeCue(t.cues[r]);"disabled"===e&&(t.mode=e)}function ye(t,e,r,i){var n=t.mode;if("disabled"===n&&(t.mode="hidden"),t.cues&&0<t.cues.length)for(var a=function(t,e,r){var i=[],n=function(t,e){if(e<t[0].startTime)return 0;var r=t.length-1;if(e>t[r].endTime)return-1;for(var i=0,n=r;i<=n;){var a=Math.floor((n+i)/2);if(e<t[a].startTime)n=a-1;else{if(!(e>t[a].startTime&&i<r))return a;i=a+1}}return t[i].startTime-e<e-t[n].startTime?i:n}(t,e);if(-1<n)for(var a=n,s=t.length;a<s;a++){var o=t[a];if(o.startTime>=e&&o.endTime<=r)i.push(o);else if(o.startTime>r)return i}return i}(t.cues,e,r),s=0;s<a.length;s++)i&&!i(a[s])||t.removeCue(a[s]);"disabled"===n&&(t.mode=n)}var Te="org.id3",Ee="https://aomedia.org/emsg/ID3";function Se(){if("undefined"!=typeof self)return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var Le=function(){var t=Se();try{new t(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function Re(t,e){return t.getTime()/1e3-e}var Ae=((Wn=Pe.prototype).destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},Wn._registerListeners=function(){var t=this.hls;t.on(rt.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(rt.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.on(rt.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(rt.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(rt.LEVEL_UPDATED,this.onLevelUpdated,this)},Wn._unregisterListeners=function(){var t=this.hls;t.off(rt.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(rt.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.off(rt.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(rt.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(rt.LEVEL_UPDATED,this.onLevelUpdated,this)},Wn.onMediaAttached=function(t,e){this.media=e.media},Wn.onMediaDetaching=function(){this.id3Track&&(pe(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},Wn.onManifestLoading=function(){this.dateRangeCuesAppended={}},Wn.createTrack=function(t){t=this.getID3Track(t.textTracks);return t.mode="hidden",t},Wn.getID3Track=function(t){if(this.media){for(var e=0;e<t.length;e++){var r=t[e];if("metadata"===r.kind&&"id3"===r.label)return me(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},Wn.onFragParsingMetadata=function(t,e){if(this.media){var r=this.hls.config,i=r.enableEmsgMetadataCues,n=r.enableID3MetadataCues;if(i||n){var a=e.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var s=Se(),o=0;o<a.length;o++){var l=a[o].type;if((l!==Ee||i)&&n){var u=ht(a[o].data);if(u){var h=a[o].pts,d=h+a[o].duration;Le<d&&(d=Le),d-h<=0&&(d=h+.25);for(var c=0;c<u.length;c++){var f,g=u[c];ut(g)||(this.updateId3CueEnds(h,l),(f=new s(h,d,"")).value=g,l&&(f.type=l),this.id3Track.addCue(f))}}}}}}},Wn.updateId3CueEnds=function(t,e){var r,i=null==(r=this.id3Track)?void 0:r.cues;if(i)for(var n=i.length;n--;){var a=i[n];a.type===e&&a.startTime<t&&a.endTime===Le&&(a.endTime=t)}},Wn.onBufferFlushing=function(t,e){var r,i,n=e.startOffset,a=e.endOffset,s=e.type,o=this.id3Track,e=this.hls;e&&(e=e.config,r=e.enableEmsgMetadataCues,i=e.enableID3MetadataCues,o&&(r||i)&&ye(o,n,a,"audio"===s?function(t){return t.type===Te&&i}:"video"===s?function(t){return t.type===Ee&&r}:function(t){return t.type===Te&&i||t.type===Ee&&r}))},Wn.onLevelUpdated=function(t,e){var g=this,e=e.details;if(this.media&&e.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var m=this.dateRangeCuesAppended,r=this.id3Track,v=e.dateRanges,p=Object.keys(v);if(r)for(var i=Object.keys(m).filter(function(t){return!p.includes(t)}),n=i.length;n--;)!function(){var e=i[n];Object.keys(m[e].cues).forEach(function(t){r.removeCue(m[e].cues[t])}),delete m[e]}();e=e.fragments[e.fragments.length-1];if(0!==p.length&&G(null==e?void 0:e.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var y=e.programDateTime/1e3-e.start,T=Se(),E=0;E<p.length;E++)!function(){var t=p[E],i=v[t],e=m[t],r=(null==e?void 0:e.cues)||{},n=(null==e?void 0:e.durationKnown)||!1,a=Re(i.startDate,y),s=Le,o=i.endDate;o?(s=Re(o,y),n=!0):!i.endOnNext||n||(o=p.reduce(function(t,e){var r=v[e];return r.class===i.class&&r.id!==e&&r.startDate>i.startDate&&t.push(r),t},[]).sort(function(t,e){return t.startDate.getTime()-e.startDate.getTime()})[0])&&(s=Re(o.startDate,y),n=!0);for(var l,u=Object.keys(i.attr),h=0;h<u.length;h++){var d,c,f=u[h];"ID"!==f&&"CLASS"!==f&&"START-DATE"!==f&&"DURATION"!==f&&"END-DATE"!==f&&"END-ON-NEXT"!==f&&((c=r[f])?n&&!e.durationKnown&&(c.endTime=s):(d=i.attr[f],c=new T(a,s,""),"SCTE35-OUT"!==(l=f)&&"SCTE35-IN"!==l||(d=Uint8Array.from(d.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),c.value={key:f,data:d},c.type="com.apple.quicktime.HLS",c.id=t,g.id3Track.addCue(c),r[f]=c))}m[t]={cues:r,dateRange:i,durationKnown:n}}()}}},Pe),ke=((Zr=_e.prototype).destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},Zr.registerListeners=function(){this.hls.on(rt.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(rt.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(rt.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(rt.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(rt.ERROR,this.onError,this)},Zr.unregisterListeners=function(){this.hls.off(rt.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(rt.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(rt.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(rt.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(rt.ERROR,this.onError,this)},Zr.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},Zr.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},Zr.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},Zr.onLevelUpdated=function(t,e){e=e.details;(this.levelDetails=e).advanced&&this.timeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},Zr.onError=function(t,e){e.details===nt.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(e=this.levelDetails)&&e.live&&at.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},Zr.timeupdate=function(){var t,e,r,i=this.media,n=this.levelDetails;i&&n&&(this.currentTime=i.currentTime,null!==(r=this.computeLatency())&&(this._latency=r,t=(e=this.config).lowLatencyMode,e=e.maxLiveSyncPlaybackRate,!t||1===e||null!==(t=this.targetLatency)&&(t=(r=r-t)<Math.min(this.maxLatency,t+n.targetduration),n.live&&t&&.05<r&&1<this.forwardBufferLength?(e=Math.min(2,Math.max(1,e)),r=Math.round(2/(1+Math.exp(-.75*r-this.edgeStalled))*20)/20,i.playbackRate=Math.min(e,Math.max(1,r))):1!==i.playbackRate&&0!==i.playbackRate&&(i.playbackRate=1))))},Zr.estimateLiveEdge=function(){var t=this.levelDetails;return null===t?null:t.edge+t.age},Zr.computeLatency=function(){var t=this.estimateLiveEdge();return null===t?null:t-this.currentTime},o(_e,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var t=this.config,e=this.levelDetails;return void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}},{key:"targetLatency",get:function(){var t=this.levelDetails;if(null===t)return null;var e=t.holdBack,r=t.partHoldBack,i=t.targetduration,n=this.config,a=n.liveSyncDuration,s=n.liveSyncDurationCount,t=n.lowLatencyMode,n=this.hls.userConfig,e=t&&r||e;(n.liveSyncDuration||n.liveSyncDurationCount||0===e)&&(e=void 0!==a?a:s*i);return e+Math.min(+this.stallCount,i)}},{key:"liveSyncPosition",get:function(){var t=this.estimateLiveEdge(),e=this.targetLatency,r=this.levelDetails;if(null===t||null===e||null===r)return null;var i=r.edge,t=t-e-this.edgeStalled,e=i-r.totalduration,r=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(e,t),r)}},{key:"drift",get:function(){var t=this.levelDetails;return null===t?1:t.drift}},{key:"edgeStalled",get:function(){var t=this.levelDetails;if(null===t)return 0;var e=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.max(t.age-e,0)}},{key:"forwardBufferLength",get:function(){var t=this.media,e=this.levelDetails;if(!t||!e)return 0;var r=t.buffered.length;return(r?t.buffered.end(r-1):e.edge)-this.currentTime}}]),_e),be=["NONE","TYPE-0","TYPE-1",null],De=(Ce.prototype.addDirectives=function(t){t=new self.URL(t);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href},Ce),Ie=(we.prototype.addFallback=function(t){this.url.push(t.url),this._attrs.push(t.attrs)},o(we,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"attrs",get:function(){return this._attrs[this._urlId]}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){t%=this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}},{key:"audioGroupId",get:function(){var t;return null==(t=this.audioGroupIds)?void 0:t[this.urlId]}},{key:"textGroupId",get:function(){var t;return null==(t=this.textGroupIds)?void 0:t[this.urlId]}}]),we);function we(t){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter(function(t){return t}).join(",").replace(/\.[^.,]+/g,"")}function Ce(t,e,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=r}function _e(t){var e=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return e.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}function Pe(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}function xe(t,e){var r,i=e.startPTS;G(i)?(r=0,(i=e.sn>t.sn?(r=i-t.start,t):(r=t.start-i,e)).duration!==r&&(i.duration=r)):e.sn>t.sn?t.cc===e.cc&&t.minEndPTS?e.start=t.start+(t.minEndPTS-t.start):e.start=t.start+t.duration:e.start=Math.max(t.start-e.duration,0)}function Fe(t,e,r,i,n,a){i-r<=0&&(at.warn("Fragment should have a positive duration",e),i=r+e.duration,a=n+e.duration);var s,o=r,l=i,u=e.startPTS,h=e.endPTS;G(u)&&(s=Math.abs(u-r),G(e.deltaPTS)?e.deltaPTS=Math.max(s,e.deltaPTS):e.deltaPTS=s,o=Math.max(r,u),r=Math.min(r,u),n=Math.min(n,e.startDTS),l=Math.min(i,h),i=Math.max(i,h),a=Math.max(a,e.endDTS));h=r-e.start;0!==e.start&&(e.start=r),e.duration=i-e.start,e.startPTS=r,e.maxStartPTS=o,e.startDTS=n,e.endPTS=i,e.minEndPTS=l,e.endDTS=a;var d,a=e.sn;if(!t||a<t.startSN||a>t.endSN)return 0;var a=a-t.startSN,c=t.fragments;for(c[a]=e,d=a;0<d;d--)xe(c[d],c[d-1]);for(d=a;d<c.length-1;d++)xe(c[d],c[d+1]);return t.fragmentHint&&xe(c[c.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,h}function Me(t,d){for(var c=null,e=t.fragments,r=e.length-1;0<=r;r--){var i=e[r].initSegment;if(i){c=i;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var f,n,a,g=0;if(function(t,e){for(var r=e.skippedSegments,i=Math.max(t.startSN,e.startSN)-e.startSN,n=(t.fragmentHint?1:0)+(r?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,a=e.startSN-t.startSN,s=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=i;l<=n;l++){var u=o[a+l],h=s[l];r&&!h&&l<r&&(h=e.fragments[l]=u),u&&h&&(h=h,(u=u).relurl&&(g=u.cc-h.cc),G(u.startPTS)&&G(u.endPTS)&&(h.start=h.startPTS=u.startPTS,h.startDTS=u.startDTS,h.maxStartPTS=u.maxStartPTS,h.endPTS=u.endPTS,h.endDTS=u.endDTS,h.minEndPTS=u.minEndPTS,h.duration=u.endPTS-u.startPTS,h.duration&&(f=h),d.PTSKnown=d.alignedSliding=!0),h.elementaryStreams=u.elementaryStreams,h.loader=u.loader,h.stats=u.stats,h.urlId=u.urlId,u.initSegment&&(h.initSegment=u.initSegment,c=u.initSegment))}}(t,d),c&&(d.fragmentHint?d.fragments.concat(d.fragmentHint):d.fragments).forEach(function(t){t.initSegment&&t.initSegment.relurl!==(null==c?void 0:c.relurl)||(t.initSegment=c)}),d.skippedSegments)if(d.deltaUpdateFailed=d.fragments.some(function(t){return!t}),d.deltaUpdateFailed){at.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var s=d.skippedSegments;s--;)d.fragments.shift();d.startSN=d.fragments[0].sn,d.startCC=d.fragments[0].cc}else d.canSkipDateRanges&&(d.dateRanges=(h=t.dateRanges,n=d.dateRanges,u=d.recentlyRemovedDateranges,a=et({},h),u&&u.forEach(function(t){delete a[t]}),Object.keys(n).forEach(function(t){var e=new H(n[t].attr,a[t]);e.isValid?a[t]=e:at.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(n[t].attr)+'"')}),a));var o=d.fragments;if(g){at.warn("discontinuity sliding from playlist, take drift into account");for(var l=0;l<o.length;l++)o[l].cc+=g}d.skippedSegments&&(d.startCC=d.fragments[0].cc),function(t,e){if(t&&e)for(var r=0,i=0,n=t.length;i<=n;i++){var a=t[i],s=e[i+r];a&&s&&a.index===s.index&&a.fragment.sn===s.fragment.sn?(a=a,(s=s).elementaryStreams=a.elementaryStreams,s.stats=a.stats):r--}}(t.partList,d.partList),f?Fe(d,f,f.startPTS,f.endPTS,f.startDTS,f.endDTS):Oe(t,d),o.length&&(d.totalduration=d.edge-o[0].start),d.driftStartTime=t.driftStartTime,d.driftStart=t.driftStart;var u,h=d.advancedDateTime;d.advanced&&h?(u=d.edge,d.driftStart||(d.driftStartTime=h,d.driftStart=u),d.driftEndTime=h,d.driftEnd=u):(d.driftEndTime=t.driftEndTime,d.driftEnd=t.driftEnd,d.advancedDateTime=t.advancedDateTime)}function Oe(t,e){var r=e.startSN+e.skippedSegments-t.startSN,t=t.fragments;r<0||r>=t.length||Ne(e,t[r].start)}function Ne(t,e){if(e){for(var r=t.fragments,i=t.skippedSegments;i<r.length;i++)r[i].start+=e;t.fragmentHint&&(t.fragmentHint.start+=e)}}function Ue(t,e,r){return null!=t&&t.details?Be(null==(t=t.details)?void 0:t.partList,e,r):null}function Be(t,e,r){if(t)for(var i=t.length;i--;){var n=t[i];if(n.index===r&&n.fragment.sn===e)return n}return null}function Ge(t){switch(t.details){case nt.FRAG_LOAD_TIMEOUT:case nt.KEY_LOAD_TIMEOUT:case nt.LEVEL_LOAD_TIMEOUT:case nt.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ke(t,e){e=Ge(e);return t.default[(e?"timeout":"error")+"Retry"]}function He(t,e){e="linear"===t.backoff?1:Math.pow(2,e);return Math.min(e*t.retryDelayMs,t.maxRetryDelayMs)}function Ve(t){return g(g({},t),{errorRetry:null,timeoutRetry:null})}function Ye(t,e,r,i){return t&&e<t.maxNumRetry&&(0===i&&!1===navigator.onLine||i&&(i<400||499<i)||r)}var We=function(t,e){for(var r,i,n=0,a=t.length-1;n<=a;){var s=e(i=t[r=(n+a)/2|0]);if(0<s)n=1+r;else{if(!(s<0))return i;a=r-1}}return null};function je(t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=null;if(t?n=e[t.sn-e[0].sn+1]||null:0===r&&0===e[0].start&&(n=e[0]),n&&0===qe(r,i,n))return n;i=We(e,qe.bind(null,r,i));return!i||i===t&&n?n:i}function qe(t,e,r){if(void 0===t&&(t=0),void 0===e&&(e=0),r.start<=t&&r.start+r.duration>t)return 0;e=Math.min(e,r.duration+(r.deltaPTS||0));return r.start+r.duration-e<=t?1:r.start-e>t&&r.start?-1:0}var Xe,ze=((ui=Ze.prototype).registerListeners=function(){var t=this.hls;t.on(rt.ERROR,this.onError,this),t.on(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.on(rt.LEVEL_UPDATED,this.onLevelUpdated,this)},ui.unregisterListeners=function(){var t=this.hls;t&&(t.off(rt.ERROR,this.onError,this),t.off(rt.ERROR,this.onErrorOut,this),t.off(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.off(rt.LEVEL_UPDATED,this.onLevelUpdated,this))},ui.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},ui.startLoad=function(t){this.playlistError=0},ui.stopLoad=function(){},ui.getVariantLevelIndex=function(t){return(null==t?void 0:t.type)===le?t.level:this.hls.loadLevel},ui.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},ui.onLevelUpdated=function(){this.playlistError=0},ui.onError=function(t,e){if(!e.fatal){var r=this.hls,i=e.context;switch(e.details){case nt.FRAG_LOAD_ERROR:case nt.FRAG_LOAD_TIMEOUT:case nt.KEY_LOAD_ERROR:case nt.KEY_LOAD_TIMEOUT:return void(e.errorAction=this.getFragRetryOrSwitchAction(e));case nt.FRAG_GAP:case nt.FRAG_PARSING_ERROR:case nt.FRAG_DECRYPT_ERROR:return e.errorAction=this.getFragRetryOrSwitchAction(e),void(e.errorAction.action=2);case nt.LEVEL_EMPTY_ERROR:case nt.LEVEL_PARSING_ERROR:var n,a,s=e.parent===le?e.level:r.loadLevel;return void(e.details===nt.LEVEL_EMPTY_ERROR&&null!=(n=e.context)&&null!=(a=n.levelDetails)&&a.live?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,s):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,s)));case nt.LEVEL_LOAD_ERROR:case nt.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==i?void 0:i.level)&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,i.level)));case nt.AUDIO_TRACK_LOAD_ERROR:case nt.AUDIO_TRACK_LOAD_TIMEOUT:case nt.SUBTITLE_LOAD_ERROR:case nt.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){s=r.levels[r.loadLevel];if(s&&(i.type===se&&i.groupId===s.audioGroupId||i.type===oe&&i.groupId===s.textGroupId))return e.errorAction=this.getPlaylistRetryOrSwitchAction(e,r.loadLevel),e.errorAction.action=2,void(e.errorAction.flags=1)}return;case nt.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var o=r.levels[r.loadLevel],o=null==o?void 0:o.attrs["HDCP-LEVEL"];return void(o&&(e.errorAction={action:2,flags:2,hdcpLevel:o}));case nt.BUFFER_ADD_CODEC_ERROR:case nt.REMUX_ALLOC_ERROR:return void(e.errorAction=this.getLevelSwitchAction(e,null!=(o=e.level)?o:r.loadLevel));case nt.INTERNAL_EXCEPTION:case nt.BUFFER_APPENDING_ERROR:case nt.BUFFER_APPEND_ERROR:case nt.BUFFER_FULL_ERROR:case nt.LEVEL_SWITCH_ERROR:case nt.BUFFER_STALLED_ERROR:case nt.BUFFER_SEEK_OVER_HOLE:case nt.BUFFER_NUDGE_ON_STALL:return void(e.errorAction={action:0,flags:0})}if(e.type===it.KEY_SYSTEM_ERROR){var l=this.getVariantLevelIndex(e.frag);return e.levelRetry=!1,void(e.errorAction=this.getLevelSwitchAction(e,l))}}},ui.getPlaylistRetryOrSwitchAction=function(t,e){var r=Ke(this.hls.config.playlistLoadPolicy,t),i=this.playlistError++,n=null==(n=t.response)?void 0:n.code;if(Ye(r,i,Ge(t),n))return{action:5,flags:0,retryConfig:r,retryCount:i};e=this.getLevelSwitchAction(t,e);return r&&(e.retryConfig=r,e.retryCount=i),e},ui.getFragRetryOrSwitchAction=function(t){var e=this.hls,r=this.getVariantLevelIndex(t.frag),i=e.levels[r],n=e.config,a=n.fragLoadPolicy,n=n.keyLoadPolicy,a=Ke(t.details.startsWith("key")?n:a,t),e=e.levels.reduce(function(t,e){return t+e.fragmentError},0);if(i){t.details!==nt.FRAG_GAP&&i.fragmentError++;i=null==(i=t.response)?void 0:i.code;if(Ye(a,e,Ge(t),i))return{action:5,flags:0,retryConfig:a,retryCount:e}}r=this.getLevelSwitchAction(t,r);return a&&(r.retryConfig=a,r.retryCount=e),r},ui.getLevelSwitchAction=function(t,e){var r=this.hls;null==e&&(e=r.loadLevel);var i=this.hls.levels[e];if(i&&(i.loadError++,r.autoLevelEnabled)){for(var n=-1,a=r.levels,s=null==(e=t.frag)?void 0:e.type,e=null!=(e=t.context)?e:{},o=e.type,l=e.groupId,u=a.length;u--;){var h=(u+r.loadLevel)%a.length;if(h!==r.loadLevel&&0===a[h].loadError){var d=a[h];if(t.details===nt.FRAG_GAP&&t.frag){var c=a[h].details;if(c){c=je(t.frag,c.fragments,t.frag.start);if(null!=c&&c.gap)continue}}else{if(o===se&&l===d.audioGroupId||o===oe&&l===d.textGroupId)continue;if(s===ue&&i.audioGroupId===d.audioGroupId||s===he&&i.textGroupId===d.textGroupId)continue}n=h;break}}if(-1<n&&r.loadLevel!==n)return t.levelRetry=!0,{action:2,flags:this.playlistError=0,nextAutoLevel:n}}return{action:2,flags:1}},ui.onErrorOut=function(t,e){var r;switch(null==(r=e.errorAction)?void 0:r.action){case 0:break;case 2:this.sendAlternateToPenaltyBox(e),e.errorAction.resolved||e.details===nt.FRAG_GAP||(e.fatal=!0)}e.fatal&&this.hls.stopLoad()},ui.sendAlternateToPenaltyBox=function(t){var e=this.hls,r=t.errorAction;if(r){var i=r.flags,n=r.hdcpLevel,a=r.nextAutoLevel;switch(i){case 0:this.switchLevel(t,a);break;case 1:r.resolved||(r.resolved=this.redundantFailover(t));break;case 2:n&&(e.maxHdcpLevel=be[be.indexOf(n)-1],r.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+e.maxHdcpLevel+'" or lower')}r.resolved||this.switchLevel(t,a)}},ui.switchLevel=function(t,e){void 0!==e&&t.errorAction&&(this.warn("switching to level "+e+" after "+t.details),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)},ui.redundantFailover=function(r){var i=this,n=this.hls,a=this.penalizedRenditions,s=r.parent===le?r.level:n.loadLevel,o=n.levels[s],l=o.url.length,u=(r.frag||o).urlId;o.urlId!==u||r.frag&&!o.details||this.penalizeRendition(o,r);for(var h=1;h<l;h++){var t=function(){var e=(u+h)%l,t=a[e];if(!t||function(t,e,r){if(3e5<performance.now()-t.lastErrorPerfMs)return 1;var i=t.details;if(e.details===nt.FRAG_GAP&&i&&e.frag){var n=e.frag.start,n=je(null,i.fragments,n);if(n&&!n.gap)return 1}if(r&&t.errors.length<r.errors.length){t=t.errors[t.errors.length-1];if(i&&t.frag&&e.frag&&Math.abs(t.frag.start-e.frag.start)>3*i.targetduration)return 1}}(t,r,a[u]))return i.warn("Switching to Redundant Stream "+(1+e)+"/"+l+': "'+o.url[e]+'" after '+r.details),i.playlistError=0,n.levels.forEach(function(t){t.urlId=e}),n.nextLoadLevel=s,{v:!0}}();if("object"==typeof t)return t.v}return!1},ui.penalizeRendition=function(t,e){var r=this.penalizedRenditions,i=r[t.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};i.lastErrorPerfMs=performance.now(),i.errors.push(e),i.details=t.details,r[t.urlId]=i},Ze),Qe=((zi=Je.prototype).destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},zi.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},zi.startLoad=function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()},zi.stopLoad=function(){this.canLoad=!1,this.clearTimer()},zi.switchParams=function(t,e){var r=null==e?void 0:e.renditionReports;if(r){for(var i=-1,n=0;n<r.length;n++){var a=r[n],s=void 0;try{s=new self.URL(a.URI,e.url).href}catch(t){at.warn("Could not construct new URL for Rendition Report: "+t),s=a.URI||""}if(s===t){i=n;break}s===t.substring(0,s.length)&&(i=n)}if(-1!==i){var o=r[i],l=parseInt(o["LAST-MSN"])||(null==e?void 0:e.lastPartSn),u=parseInt(o["LAST-PART"])||(null==e?void 0:e.lastPartIndex);return this.hls.config.lowLatencyMode&&(o=Math.min(e.age-e.partTarget,e.targetduration),0<=u&&o>e.partTarget&&(u+=1)),new De(l,0<=u?u:void 0,"")}}},zi.loadPlaylist=function(t){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())},zi.shouldLoadPlaylist=function(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)},zi.shouldReloadPlaylist=function(t){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(t)},zi.playlistLoaded=function(t,e,r){var i=this,n=e.details,a=e.stats,s=self.performance.now(),o=a.loading.first?Math.max(0,s-a.loading.first):0;if(n.advancedDateTime=Date.now()-o,n.live||null!=r&&r.live){if(n.reloaded(r),r&&this.log("live playlist "+t+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),r&&0<n.fragments.length&&Me(r,n),this.canLoad&&n.live){var l,u=void 0,h=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var d=this.hls.config.lowLatencyMode,c=n.lastPartSn,f=n.endSN,g=n.lastPartIndex,o=c===f;-1!==g?(u=o?f+1:c,h=o?d?0:g:g+1):u=f+1;g=n.age,f=g+n.ageHeader,f=Math.min(f-n.partTarget,1.5*n.targetduration);if(0<f&&(r&&f>r.tuneInGoal?(this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+f+" with playlist age: "+n.age),f=0):(u+=r=Math.floor(f/n.targetduration),void 0!==h&&(h+=Math.round(f%n.targetduration/n.partTarget)),this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+g.toFixed(2)+"s goal: "+f+" skip sn "+r+" to part "+h)),n.tuneInGoal=f),l=this.getDeliveryDirectives(n,e.deliveryDirectives,u,h),d||!o)return void this.loadPlaylist(l)}else n.canBlockReload&&(l=this.getDeliveryDirectives(n,e.deliveryDirectives,u,h));h=this.hls.mainForwardBufferInfo,h=h?h.end-h.len:0,h=function(t){void 0===t&&(t=1/0);var e,r=1e3*n.targetduration;return n.updated?(e=n.fragments).length&&t<4*r&&((e=1e3*e[e.length-1].duration)<r&&(r=e)):r/=2,Math.round(r)}(1e3*(n.edge-h));n.updated&&s>this.requestScheduled+h&&(this.requestScheduled=a.loading.start),void 0!==u&&n.canBlockReload?this.requestScheduled=a.loading.first+h-(1e3*n.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+h<s?this.requestScheduled=s:this.requestScheduled-s<=0&&(this.requestScheduled+=h);s=this.requestScheduled-s,s=Math.max(0,s);this.log("reload live playlist "+t+" in "+Math.round(s)+" ms"),this.timer=self.setTimeout(function(){return i.loadPlaylist(l)},s)}}else this.clearTimer()},zi.getDeliveryDirectives=function(t,e,r,i){var n,a,s,a=(n=t.canSkipUntil,a=t.canSkipDateRanges,s=t.endSN,n&&(void 0!==r?r-s:0)<n?a?"v2":"YES":"");return null!=e&&e.skip&&t.deltaUpdateFailed&&(r=e.msn,i=e.part,a=""),new De(r,i,a)},zi.checkRetry=function(t){var e,r=this,i=t.details,n=Ge(t),a=t.errorAction,s=a||{},o=s.action,l=s.retryCount,l=void 0===l?0:l,s=s.retryConfig,o=!!a&&!!s&&(5===o||!a.resolved&&2===o);if(o){if(this.requestScheduled=-1,l>=s.maxNumRetry)return!1;n&&null!=(e=t.context)&&e.deliveryDirectives?(this.warn("Retrying playlist loading "+(l+1)+"/"+s.maxNumRetry+' after "'+i+'" without delivery-directives'),this.loadPlaylist()):(e=He(s,l),this.timer=self.setTimeout(function(){return r.loadPlaylist()},e),this.warn("Retrying playlist loading "+(l+1)+"/"+s.maxNumRetry+' after "'+i+'" in '+e+"ms")),t.levelRetry=!0,a.resolved=!0}return o},Je),$e=function(s){function t(t,e){return(t=s.call(this,t,"[level-controller]")||this)._levels=[],t._firstLevel=-1,t._startLevel=void 0,t.currentLevel=null,t.currentLevelIndex=-1,t.manualLevelIndex=-1,t.steering=void 0,t.onParsedComplete=void 0,t.steering=e,t._registerListeners(),t}l(t,s);var e=t.prototype;return e._registerListeners=function(){var t=this.hls;t.on(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.on(rt.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(rt.LEVEL_LOADED,this.onLevelLoaded,this),t.on(rt.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(rt.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(rt.FRAG_LOADED,this.onFragLoaded,this),t.on(rt.ERROR,this.onError,this)},e._unregisterListeners=function(){var t=this.hls;t.off(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.off(rt.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(rt.LEVEL_LOADED,this.onLevelLoaded,this),t.off(rt.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(rt.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(rt.FRAG_LOADED,this.onFragLoaded,this),t.off(rt.ERROR,this.onError,this)},e.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),s.prototype.destroy.call(this)},e.startLoad=function(){this._levels.forEach(function(t){t.loadError=0,t.fragmentError=0}),s.prototype.startLoad.call(this)},e.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]},e.onManifestLoading=function(t,e){this.resetLevels()},e.onManifestLoaded=function(t,e){var o,l=[],u={};e.levels.forEach(function(t){var e=t.attrs;-1===(null==(s=t.audioCodec)?void 0:s.indexOf("mp4a.40.34"))||(Xe=Xe||/chrome|firefox/i.test(navigator.userAgent))&&(t.audioCodec=void 0);var r=e.AUDIO,i=e.CODECS,n=e["FRAME-RATE"],a=e["PATHWAY-ID"],s=e.RESOLUTION,e=e.SUBTITLES,i=(a||".")+"-"+t.bitrate+"-"+s+"-"+n+"-"+i;(o=u[i])?o.addFallback(t):(o=new Ie(t),u[i]=o,l.push(o)),tr(o,"audio",r),tr(o,"text",e)}),this.filterAndSortMediaOptions(l,e)},e.filterAndSortMediaOptions=function(t,e){var r=this,i=[],n=[],a=!1,s=!1,o=!1,l=t.filter(function(t){var e=t.audioCodec,r=t.videoCodec,i=t.width,n=t.height,t=t.unknownCodecs;return a=a||!(!i||!n),s=s||!!r,o=o||!!e,!(null!=t&&t.length)&&(!e||Yt(e,"audio"))&&(!r||Yt(r,"video"))});if((a||s)&&o&&(l=l.filter(function(t){var e=t.videoCodec,r=t.width,t=t.height;return!!e||!(!r||!t)})),0!==l.length){e.audioTracks&&er(i=e.audioTracks.filter(function(t){return!t.audioCodec||Yt(t.audioCodec,"audio")})),e.subtitles&&er(n=e.subtitles);var u=l.slice(0);l.sort(function(t,e){return t.attrs["HDCP-LEVEL"]!==e.attrs["HDCP-LEVEL"]?(t.attrs["HDCP-LEVEL"]||"")>(e.attrs["HDCP-LEVEL"]||"")?1:-1:t.bitrate!==e.bitrate?t.bitrate-e.bitrate:t.attrs["FRAME-RATE"]!==e.attrs["FRAME-RATE"]?t.attrs.decimalFloatingPoint("FRAME-RATE")-e.attrs.decimalFloatingPoint("FRAME-RATE"):t.attrs.SCORE!==e.attrs.SCORE?t.attrs.decimalFloatingPoint("SCORE")-e.attrs.decimalFloatingPoint("SCORE"):a&&t.height!==e.height?t.height-e.height:0});var h=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l)).length!==u.length)for(var d=0;d<u.length;d++)if(u[d].pathwayId===l[0].pathwayId){h=u[d];break}this._levels=l;for(var c=0;c<l.length;c++)if(l[c]===h){this._firstLevel=c,this.log("manifest loaded, "+l.length+" level(s) found, first bitrate: "+h.bitrate);break}t=o&&!s,i={levels:l,audioTracks:i,subtitleTracks:n,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:o,video:s,altAudio:!t&&i.some(function(t){return!!t.url})};this.hls.trigger(rt.MANIFEST_PARSED,i),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else Promise.resolve().then(function(){var t;r.hls&&(t=new Error("no level with compatible codecs found in manifest"),r.hls.trigger(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:t,reason:t.message}))})},e.onError=function(t,e){!e.fatal&&e.context&&e.context.type===ae&&e.context.level===this.level&&this.checkRetry(e)},e.onFragLoaded=function(t,e){e=e.frag;void 0===e||e.type!==le||void 0!==(e=this._levels[e.level])&&(e.loadError=0)},e.onLevelLoaded=function(t,e){var r,i=e.level,n=e.details,a=this._levels[i];if(!a)return this.warn("Invalid level index "+i),void(null!=(r=e.deliveryDirectives)&&r.skip&&(n.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===a.fragmentError&&(a.loadError=0),this.playlistLoaded(i,e,a.details)):null!=(e=e.deliveryDirectives)&&e.skip&&(n.deltaUpdateFailed=!0)},e.onAudioTrackSwitched=function(t,e){var r=this.currentLevel;if(r){var i=this.hls.audioTracks[e.id].groupId;if(r.audioGroupIds&&r.audioGroupId!==i){for(var n=-1,a=0;a<r.audioGroupIds.length;a++)if(r.audioGroupIds[a]===i){n=a;break}-1!==n&&n!==r.urlId&&(r.urlId=n,this.canLoad&&this.startLoad())}}},e.loadPlaylist=function(t){s.prototype.loadPlaylist.call(this);var e=this.currentLevelIndex,r=this.currentLevel;if(r&&this.shouldLoadPlaylist(r)){var i=r.urlId,n=r.uri;if(t)try{n=t.addDirectives(n)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}var a=r.attrs["PATHWAY-ID"];this.log("Loading level index "+e+(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"")+" with"+(a?" Pathway "+a:"")+" URI "+(i+1)+"/"+r.url.length+" "+n),this.clearTimer(),this.hls.trigger(rt.LEVEL_LOADING,{url:n,level:e,id:i,deliveryDirectives:t||null})}},e.removeLevel=function(r,i){function n(t,e){return e!==i}var a=this,t=this._levels.filter(function(t,e){return e!==r||(1<t.url.length&&void 0!==i?(t.url=t.url.filter(n),t.audioGroupIds&&(t.audioGroupIds=t.audioGroupIds.filter(n)),t.textGroupIds&&(t.textGroupIds=t.textGroupIds.filter(n)),!(t.urlId=0)):(a.steering&&a.steering.removeLevel(t),!1))});this.hls.trigger(rt.LEVELS_UPDATED,{levels:t})},e.onLevelsUpdated=function(t,e){e=e.levels;e.forEach(function(t,e){t=t.details;null!=t&&t.fragments&&t.fragments.forEach(function(t){t.level=e})}),this._levels=e},o(t,[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;if(0!==e.length){if(t<0||t>=e.length){var r=new Error("invalid level idx"),i=t<0;if(this.hls.trigger(rt.ERROR,{type:it.OTHER_ERROR,details:nt.LEVEL_SWITCH_ERROR,level:t,fatal:i,error:r,reason:r.message}),i)return;t=Math.min(t,e.length-1)}var n=this.currentLevelIndex,a=this.currentLevel,r=a?a.attrs["PATHWAY-ID"]:void 0,i=e[t],e=i.attrs["PATHWAY-ID"];this.currentLevelIndex=t,this.currentLevel=i,n===t&&i.details&&a&&r===e||(this.log("Switching to level "+t+(e?" with Pathway "+e:"")+" from level "+n+(r?" with Pathway "+r:"")),delete(t=et({},i,{level:t,maxBitrate:i.maxBitrate,attrs:i.attrs,uri:i.uri,urlId:i.urlId}))._attrs,delete t._urlId,this.hls.trigger(rt.LEVEL_SWITCHING,t),(t=i.details)&&!t.live||(a=this.switchParams(i.uri,null==a?void 0:a.details),this.loadPlaylist(a)))}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0!==this._startLevel)return this._startLevel;var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}]),t}(Qe);function Je(t,e){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=at.log.bind(at,e+":"),this.warn=at.warn.bind(at,e+":"),this.hls=t}function Ze(t){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=t,this.log=at.log.bind(at,"[info]:"),this.warn=at.warn.bind(at,"[warning]:"),this.error=at.error.bind(at,"[error]:"),this.registerListeners()}function tr(t,e,r){r&&("audio"===e?(t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds[t.url.length-1]=r):"text"===e&&(t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds[t.url.length-1]=r))}function er(t){var r={};t.forEach(function(t){var e=t.groupId||"";t.id=r[e]=r[e]||0,r[e]++})}var rr="NOT_LOADED",ir="APPENDING",nr="PARTIAL",ar="OK",sr=((di=or.prototype)._registerListeners=function(){var t=this.hls;t.on(rt.BUFFER_APPENDED,this.onBufferAppended,this),t.on(rt.FRAG_BUFFERED,this.onFragBuffered,this),t.on(rt.FRAG_LOADED,this.onFragLoaded,this)},di._unregisterListeners=function(){var t=this.hls;t.off(rt.BUFFER_APPENDED,this.onBufferAppended,this),t.off(rt.FRAG_BUFFERED,this.onFragBuffered,this),t.off(rt.FRAG_LOADED,this.onFragLoaded,this)},di.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},di.getAppendedFrag=function(t,e){var r=this.activePartLists[e];if(r)for(var i=r.length;i--;){var n=r[i];if(!n)break;var a=n.end;if(n.start<=t&&null!==a&&t<=a)return n}return this.getBufferedFrag(t,e)},di.getBufferedFrag=function(t,e){for(var r=this.fragments,i=Object.keys(r),n=i.length;n--;){var a=r[i[n]];if((null==a?void 0:a.body.type)===e&&a.buffered){a=a.body;if(a.start<=t&&t<=a.end)return a}}return null},di.detectEvictedFragments=function(r,i,n,t){var a=this;this.timeRanges&&(this.timeRanges[r]=i);var s=(null==t?void 0:t.fragment.sn)||-1;Object.keys(this.fragments).forEach(function(t){var e=a.fragments[t];!e||s>=e.body.sn||(e.buffered||e.loaded?(t=e.range[r])&&t.time.some(function(t){t=!a.isTimeBuffered(t.startPTS,t.endPTS,i);return t&&a.removeFragment(e.body),t}):e.body.type===n&&a.removeFragment(e.body))})},di.detectPartialFragments=function(t){var i,n,a=this,s=this.timeRanges,o=t.frag,l=t.part;s&&"initSegment"!==o.sn&&(t=ur(o),(i=this.fragments[t])&&(n=!o.relurl,Object.keys(s).forEach(function(t){var e,r=o.elementaryStreams[t];r&&(e=s[t],r=n||!0===r.partial,i.range[t]=a.getBufferedTimes(o,l,r,e))}),i.loaded=null,Object.keys(i.range).length?(i.buffered=!0,i.body.endList&&(this.endListFragments[i.body.type]=i),lr(i)||this.removeParts(o.sn-1,o.type)):this.removeFragment(i.body)))},di.removeParts=function(e,t){var r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter(function(t){return t.fragment.sn>=e}))},di.fragBuffered=function(t,e){var r=ur(t),i=this.fragments[r];!i&&e&&(i=this.fragments[r]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)},di.getBufferedTimes=function(t,e,r,i){for(var n={time:[],partial:r},a=t.start,s=t.end,o=t.minEndPTS||s,l=t.maxStartPTS||a,u=0;u<i.length;u++){var h=i.start(u)-this.bufferPadding,d=i.end(u)+this.bufferPadding;if(h<=l&&o<=d){n.time.push({startPTS:Math.max(a,i.start(u)),endPTS:Math.min(s,i.end(u))});break}if(a<d&&h<s)n.partial=!0,n.time.push({startPTS:Math.max(a,i.start(u)),endPTS:Math.min(s,i.end(u))});else if(s<=h)break}return n},di.getPartialFragment=function(e){var r,i,n=null,a=0,s=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach(function(t){t=o[t];t&&lr(t)&&(r=t.body.start-s,i=t.body.end+s,r<=e&&e<=i&&(i=Math.min(e-r,i-e),a<=i&&(n=t.body,a=i)))}),n},di.isEndListAppended=function(t){t=this.endListFragments[t];return void 0!==t&&(t.buffered||lr(t))},di.getState=function(t){t=ur(t),t=this.fragments[t];return t?t.buffered?lr(t)?nr:ar:ir:rr},di.isTimeBuffered=function(t,e,r){for(var i,n,a=0;a<r.length;a++){if(i=r.start(a)-this.bufferPadding,n=r.end(a)+this.bufferPadding,i<=t&&e<=n)return!0;if(e<=i)return!1}return!1},di.onFragLoaded=function(t,e){var r=e.frag,i=e.part;"initSegment"===r.sn||r.bitrateTest||(i=i?null:e,e=ur(r),this.fragments[e]={body:r,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)})},di.onBufferAppended=function(t,e){var r,i=this,n=e.frag,a=e.part,s=e.timeRanges;"initSegment"!==n.sn&&(r=n.type,a&&((n=this.activePartLists[r])||(this.activePartLists[r]=n=[]),n.push(a)),this.timeRanges=s,Object.keys(s).forEach(function(t){var e=s[t];i.detectEvictedFragments(t,e,r,a)}))},di.onFragBuffered=function(t,e){this.detectPartialFragments(e)},di.hasFragment=function(t){t=ur(t);return!!this.fragments[t]},di.hasParts=function(t){return!(null==(t=this.activePartLists[t])||!t.length)},di.removeFragmentsInRange=function(r,i,n,a,s){var o=this;a&&!this.hasGaps||Object.keys(this.fragments).forEach(function(t){var e=o.fragments[t];e&&((t=e.body).type!==n||a&&!t.gap||t.start<i&&t.end>r&&(e.buffered||s)&&o.removeFragment(t))})},di.removeFragment=function(t){var e=ur(t);t.stats.loaded=0,t.clearElementaryStreamInfo();var r,i=this.activePartLists[t.type];i&&(r=t.sn,this.activePartLists[t.type]=i.filter(function(t){return t.fragment.sn!==r})),delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]},di.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1},or);function or(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}function lr(t){var e;return t.buffered&&(t.body.gap||(null==(e=t.range.video)?void 0:e.partial)||(null==(e=t.range.audio)?void 0:e.partial)||(null==(t=t.range.audiovideo)?void 0:t.partial))}function ur(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn}var hr=Math.pow(2,17),dr=((t=cr.prototype).destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(o,l){var u=this,h=o.url;if(!h)return Promise.reject(new pr({type:it.NETWORK_ERROR,details:nt.FRAG_LOAD_ERROR,fatal:!1,frag:o,error:new Error("Fragment does not have a "+(h?"part list":"url")),networkDetails:null}));this.abort();var r=this.config,d=r.fLoader,c=r.loader;return new Promise(function(n,a){var s,t,e,i;u.loader&&u.loader.destroy(),o.gap?a(gr(o)):(s=u.loader=o.loader=new(d||c)(r),t=fr(o),e=Ve(r.fragLoadPolicy.default),i={loadPolicy:e,timeout:e.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===o.sn?1/0:hr},o.stats=s.stats,s.load(t,i,{onSuccess:function(t,e,r,i){u.resetLoader(o,s);t=t.data;r.resetIV&&o.decryptdata&&(o.decryptdata.iv=new Uint8Array(t.slice(0,16)),t=t.slice(16)),n({frag:o,part:null,payload:t,networkDetails:i})},onError:function(t,e,r,i){u.resetLoader(o,s),a(new pr({type:it.NETWORK_ERROR,details:nt.FRAG_LOAD_ERROR,fatal:!1,frag:o,response:g({url:h,data:void 0},t),error:new Error("HTTP Error "+t.code+" "+t.text),networkDetails:r,stats:i}))},onAbort:function(t,e,r){u.resetLoader(o,s),a(new pr({type:it.NETWORK_ERROR,details:nt.INTERNAL_ABORTED,fatal:!1,frag:o,error:new Error("Aborted"),networkDetails:r,stats:t}))},onTimeout:function(t,e,r){u.resetLoader(o,s),a(new pr({type:it.NETWORK_ERROR,details:nt.FRAG_LOAD_TIMEOUT,fatal:!1,frag:o,error:new Error("Timeout after "+i.timeout+"ms"),networkDetails:r,stats:t}))},onProgress:function(t,e,r,i){l&&l({frag:o,part:null,payload:r,networkDetails:i})}}))})},t.loadPart=function(l,u,h){var d=this;this.abort();var e=this.config,r=e.fLoader,c=e.loader;return new Promise(function(n,a){var s,o,t,i;d.loader&&d.loader.destroy(),l.gap||u.gap?a(gr(l,u)):(s=d.loader=l.loader=new(r||c)(e),o=fr(l,u),t=Ve(e.fragLoadPolicy.default),i={loadPolicy:t,timeout:t.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:hr},u.stats=s.stats,s.load(o,i,{onSuccess:function(t,e,r,i){d.resetLoader(l,s),d.updateStatsFromPart(l,u);i={frag:l,part:u,payload:t.data,networkDetails:i};h(i),n(i)},onError:function(t,e,r,i){d.resetLoader(l,s),a(new pr({type:it.NETWORK_ERROR,details:nt.FRAG_LOAD_ERROR,fatal:!1,frag:l,part:u,response:g({url:o.url,data:void 0},t),error:new Error("HTTP Error "+t.code+" "+t.text),networkDetails:r,stats:i}))},onAbort:function(t,e,r){l.stats.aborted=u.stats.aborted,d.resetLoader(l,s),a(new pr({type:it.NETWORK_ERROR,details:nt.INTERNAL_ABORTED,fatal:!1,frag:l,part:u,error:new Error("Aborted"),networkDetails:r,stats:t}))},onTimeout:function(t,e,r){d.resetLoader(l,s),a(new pr({type:it.NETWORK_ERROR,details:nt.FRAG_LOAD_TIMEOUT,fatal:!1,frag:l,part:u,error:new Error("Timeout after "+i.timeout+"ms"),networkDetails:r,stats:t}))}}))})},t.updateStatsFromPart=function(t,e){var r=t.stats,i=e.stats,n=i.total;r.loaded+=i.loaded,n?(e=((e=Math.round(t.duration/e.duration))-(e=Math.min(Math.round(r.loaded/n),e)))*Math.round(r.loaded/e),r.total=r.loaded+e):r.total=Math.max(r.loaded,r.total);r=r.loading,i=i.loading;r.start?r.first+=i.first-i.start:(r.start=i.start,r.first=i.first),r.end=i.end},t.resetLoader=function(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},cr);function cr(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}function fr(t,e){void 0===e&&(e=null);var r,i=e||t,n={frag:t,part:e,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},a=i.byteRangeStartOffset,s=i.byteRangeEndOffset;return G(a)&&G(s)&&(e=a,i=s,"initSegment"===t.sn&&"AES-128"===(null==(r=t.decryptdata)?void 0:r.method)&&((r=s-a)%16&&(i=s+(16-r%16)),0!==a&&(n.resetIV=!0,e=a-16)),n.rangeStart=e,n.rangeEnd=i),n}function gr(t,e){var r=new Error("GAP "+(t.gap?"tag":"attribute")+" found"),r={type:it.MEDIA_ERROR,details:nt.FRAG_GAP,fatal:!1,frag:t,error:r,networkDetails:null};return e&&(r.part=e),(e||t).stats.aborted=!0,new pr(r)}function mr(t,e,r,i,n,a){void 0===i&&(i=0),void 0===n&&(n=-1),void 0===a&&(a=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=e,this.id=r,this.size=i,this.part=n,this.partial=a}var vr,pr=(l(kr,vr=u(Error)),kr),yr=((Un=Ar.prototype).abort=function(t){for(var e in this.keyUriToKeyInfo){var r=this.keyUriToKeyInfo[e].loader;if(r){if(t&&t!==r.context.frag.type)return;r.abort()}}},Un.detach=function(){for(var t in this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[t]}},Un.destroy=function(){for(var t in this.detach(),this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[t].loader;e&&e.destroy()}this.keyUriToKeyInfo={}},Un.createKeyLoadError=function(t,e,r,i,n){return void 0===e&&(e=nt.KEY_LOAD_ERROR),new pr({type:it.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:n,error:r,networkDetails:i})},Un.loadClear=function(t,r){var i=this;if(this.emeController&&this.config.emeEnabled)for(var n=t.sn,a=t.cc,s=0;s<r.length&&"break"!==function(){var e=r[s];if(a<=e.cc&&("initSegment"===n||"initSegment"===e.sn||n<e.sn))return i.emeController.selectKeySystemFormat(e).then(function(t){e.setKeyFormat(t)}),"break"}();s++);},Un.load=function(e){var r=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(function(t){return r.loadInternal(e,t)}):this.loadInternal(e)},Un.loadInternal=function(e,t){t&&e.setKeyFormat(t);var r=e.decryptdata;if(!r){var i=new Error(t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,nt.KEY_LOAD_ERROR,i))}t=r.uri;if(!t)return Promise.reject(this.createKeyLoadError(e,nt.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+t+'"')));var n=this.keyUriToKeyInfo[t];if(null!=n&&n.decryptdata.key)return r.key=n.decryptdata.key,Promise.resolve({frag:e,keyInfo:n});if(null!=n&&n.keyLoadPromise)switch(null==(i=n.mediaKeySessionContext)?void 0:i.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return n.keyLoadPromise.then(function(t){return r.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:n}})}switch(n=this.keyUriToKeyInfo[t]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(n,e):this.loadKeyEME(n,e);case"AES-128":return this.loadKeyHTTP(n,e);default:return Promise.reject(this.createKeyLoadError(e,nt.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+r.method+'"')))}},Un.loadKeyEME=function(e,t){var r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){t=this.emeController.loadKey(r);if(t)return(e.keyLoadPromise=t.then(function(t){return e.mediaKeySessionContext=t,r})).catch(function(t){throw e.keyLoadPromise=null,t})}return Promise.resolve(r)},Un.loadKeyHTTP=function(r,a){var l=this,i=this.config,u=new i.loader(i);return a.keyLoader=r.loader=u,r.keyLoadPromise=new Promise(function(s,o){var n={keyInfo:r,frag:a,responseType:"arraybuffer",url:r.decryptdata.uri},t=i.keyLoadPolicy.default,e={loadPolicy:t,timeout:t.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},t={onSuccess:function(t,e,r,i){var n=r.frag,a=r.keyInfo,r=r.url;if(!n.decryptdata||a!==l.keyUriToKeyInfo[r])return o(l.createKeyLoadError(n,nt.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),i));a.decryptdata.key=n.decryptdata.key=new Uint8Array(t.data),n.keyLoader=null,a.loader=null,s({frag:n,keyInfo:a})},onError:function(t,e,r,i){l.resetLoader(e),o(l.createKeyLoadError(a,nt.KEY_LOAD_ERROR,new Error("HTTP Error "+t.code+" loading key "+t.text),r,g({url:n.url,data:void 0},t)))},onTimeout:function(t,e,r){l.resetLoader(e),o(l.createKeyLoadError(a,nt.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),r))},onAbort:function(t,e,r){l.resetLoader(e),o(l.createKeyLoadError(a,nt.INTERNAL_ABORTED,new Error("key loading aborted"),r))}};u.load(n,e,t)})},Un.resetLoader=function(t){var e=t.frag,r=t.keyInfo,i=t.url,t=r.loader;e.keyLoader===t&&(e.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],t&&t.destroy()},Ar),Tr=((ki=Rr.prototype).destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},ki.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},ki.onHandlerDestroyed=function(){},ki.hasInterval=function(){return!!this._tickInterval},ki.hasNextTick=function(){return!!this._tickTimer},ki.setInterval=function(t){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)},ki.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),!(this._tickInterval=null))},ki.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),!(this._tickTimer=null))},ki.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&this.tickImmediate(),this._tickCallCount=0)},ki.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},ki.doTick=function(){},Rr),Er={length:0,start:function(){return 0},end:function(){return 0}},Sr=(Lr.isBuffered=function(t,e){try{if(t)for(var r=Lr.getBuffered(t),i=0;i<r.length;i++)if(e>=r.start(i)&&e<=r.end(i))return!0}catch(t){}return!1},Lr.bufferInfo=function(t,e,r){try{if(t){for(var i=Lr.getBuffered(t),n=[],a=0;a<i.length;a++)n.push({start:i.start(a),end:i.end(a)});return this.bufferedInfo(n,e,r)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},Lr.bufferedInfo=function(t,e,r){e=Math.max(0,e),t.sort(function(t,e){return t.start-e.start||e.end-t.end});var i=[];if(r)for(var n=0;n<t.length;n++){var a,s=i.length;s?(a=i[s-1].end,t[n].start-a<r?t[n].end>a&&(i[s-1].end=t[n].end):i.push(t[n])):i.push(t[n])}else i=t;for(var o,l=0,u=e,h=e,d=0;d<i.length;d++){var c=i[d].start,f=i[d].end;if(c<=e+r&&e<f)u=c,l=(h=f)-e;else if(e+r<c){o=c;break}}return{len:l,start:u||0,end:h||0,nextStart:o}},Lr.getBuffered=function(t){try{return t.buffered}catch(t){return at.log("failed to get media.buffered",t),Er}},Lr);function Lr(){}function Rr(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}function Ar(t){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=t}function kr(t){var e;return(e=vr.call(this,t.error.message)||this).data=void 0,e.data=t,e}function br(t,e){for(var r=null,i=0,n=t.length;i<n;i++){var a=t[i];if(a&&a.cc===e){r=a;break}}return r}function Dr(t,e){t&&(e=t.start+e,t.start=t.startPTS=e,t.endPTS=e+t.duration)}function Ir(t,e){for(var r=e.fragments,i=0,n=r.length;i<n;i++)Dr(r[i],t);e.fragmentHint&&Dr(e.fragmentHint,t),e.alignedSliding=!0}function wr(t,e){var r,i,n;t.hasProgramDateTime&&e.hasProgramDateTime&&(n=t.fragments,i=e.fragments,n.length&&i.length&&(e=br(n,(r=i[Math.round(i.length/2)-1]).cc)||n[Math.round(n.length/2)-1],i=r.programDateTime,n=e.programDateTime,null!==i&&null!==n&&Ir((n-i)/1e3-(e.start-r.start),t)))}var Cr=(Qr.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},Qr),_r=(zr.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},zr),Pr=((Pi=Xr.prototype).uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),r=new Uint32Array(4),i=0;i<4;i++)r[i]=e.getUint32(4*i);return r},Pi.initTable=function(){for(var t=this.sBox,e=this.invSBox,r=this.subMix,i=r[0],n=r[1],a=r[2],s=r[3],r=this.invSubMix,o=r[0],l=r[1],u=r[2],h=r[3],d=new Uint32Array(256),c=0,f=0,g=0,g=0;g<256;g++)d[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){var m=(m=f^f<<1^f<<2^f<<3^f<<4)>>>8^255&m^99,v=d[e[t[c]=m]=c],p=d[v],y=d[p],T=257*d[m]^16843008*m;i[c]=T<<24|T>>>8,n[c]=T<<16|T>>>16,a[c]=T<<8|T>>>24,s[c]=T,T=16843009*y^65537*p^257*v^16843008*c,o[m]=T<<24|T>>>8,l[m]=T<<16|T>>>16,u[m]=T<<8|T>>>24,h[m]=T,c?(c=v^d[d[d[y^v]]],f^=d[d[f]]):c=f=1}},Pi.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),r=!0,i=0;i<e.length&&r;)r=e[i]===this.key[i],i++;if(!r){this.key=e;var n=this.keySize=e.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);for(var a,s,o,l=this.ksRows=4*(n+6+1),u=this.keySchedule=new Uint32Array(l),h=this.invKeySchedule=new Uint32Array(l),d=this.sBox,c=this.rcon,t=this.invSubMix,f=t[0],g=t[1],m=t[2],v=t[3],p=0;p<l;p++)p<n?s=u[p]=e[p]:(o=s,p%n==0?(o=d[(o=o<<8|o>>>24)>>>24]<<24|d[o>>>16&255]<<16|d[o>>>8&255]<<8|d[255&o],o^=c[p/n|0]<<24):6<n&&p%n==4&&(o=d[o>>>24]<<24|d[o>>>16&255]<<16|d[o>>>8&255]<<8|d[255&o]),u[p]=s=(u[p-n]^o)>>>0);for(a=0;a<l;a++)p=l-a,o=3&a?u[p]:u[p-4],h[a]=a<4||p<=4?o:f[d[o>>>24]]^g[d[o>>>16&255]]^m[d[o>>>8&255]]^v[d[255&o]],h[a]=h[a]>>>0}},Pi.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},Pi.decrypt=function(t,e,r){for(var i,n,a,s,o,l,u,h,d,c,f,g,m,v,p=this.keySize+6,y=this.invKeySchedule,T=this.invSBox,E=this.invSubMix,S=E[0],L=E[1],R=E[2],A=E[3],r=this.uint8ArrayToUint32Array_(r),k=r[0],b=r[1],D=r[2],I=r[3],w=new Int32Array(t),C=new Int32Array(w.length),_=this.networkToHostOrderSwap;e<w.length;){for(d=_(w[e]),c=_(w[e+1]),f=_(w[e+2]),g=_(w[e+3]),o=d^y[0],l=g^y[1],u=f^y[2],h=c^y[3],m=4,v=1;v<p;v++)i=S[o>>>24]^L[l>>16&255]^R[u>>8&255]^A[255&h]^y[m],n=S[l>>>24]^L[u>>16&255]^R[h>>8&255]^A[255&o]^y[m+1],a=S[u>>>24]^L[h>>16&255]^R[o>>8&255]^A[255&l]^y[m+2],s=S[h>>>24]^L[o>>16&255]^R[l>>8&255]^A[255&u]^y[m+3],o=i,l=n,u=a,h=s,m+=4;i=T[o>>>24]<<24^T[l>>16&255]<<16^T[u>>8&255]<<8^T[255&h]^y[m],n=T[l>>>24]<<24^T[u>>16&255]<<16^T[h>>8&255]<<8^T[255&o]^y[m+1],a=T[u>>>24]<<24^T[h>>16&255]<<16^T[o>>8&255]<<8^T[255&l]^y[m+2],s=T[h>>>24]<<24^T[o>>16&255]<<16^T[l>>8&255]<<8^T[255&u]^y[m+3],C[e]=_(i^k),C[e+1]=_(s^b),C[e+2]=_(a^D),C[e+3]=_(n^I),k=d,b=c,D=f,I=g,e+=4}return C.buffer},Xr),xr=((_=qr.prototype).destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},_.isSync=function(){return this.useSoftware},_.flush=function(){var t=this.currentResult,e=this.remainderData;if(!t||e)return this.reset(),null;var r,i=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?(t=(e=(r=i).byteLength)&&new DataView(r.buffer).getUint8(e-1))?tt(r,0,e-t):r:i},_.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},_.decrypt=function(i,n,a){var s=this;return this.useSoftware?new Promise(function(t,e){s.softwareDecrypt(new Uint8Array(i),n,a);var r=s.flush();r?t(r.buffer):e(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(i),n,a)},_.softwareDecrypt=function(t,e,r){var i=this.currentIV,n=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(t=Ct(a,t),this.remainderData=null);t=this.getValidChunk(t);if(!t.length)return null;i&&(r=i);i=this.softwareDecrypter;(i=i||(this.softwareDecrypter=new Pr)).expandKey(e);return this.currentResult=i.decrypt(t.buffer,0,r),this.currentIV=tt(t,-16).buffer,n||null},_.webCryptoDecrypt=function(e,r,i){var n=this,a=this.subtle;return this.key===r&&this.fastAesKey||(this.key=r,this.fastAesKey=new _r(a,r)),this.fastAesKey.expandKey().then(function(t){return a?(n.logOnce("WebCrypto AES decrypt"),new Cr(a,new Uint8Array(i)).decrypt(e.buffer,t)):Promise.reject(new Error("web crypto not initialized"))}).catch(function(t){return at.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+t.name+": "+t.message),n.onWebCryptoError(e,r,i)})},_.onWebCryptoError=function(t,e,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,r);r=this.flush();if(r)return r.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},_.getValidChunk=function(t){var e=t,r=t.length-t.length%16;return r!==t.length&&(e=tt(t,0,r),this.remainderData=tt(t,r)),e},_.logOnce=function(t){this.logEnabled&&(at.log("[decrypter]: "+t),this.logEnabled=!1)},qr),Fr="STOPPED",Mr="IDLE",Or="KEY_LOADING",Nr="FRAG_LOADING",Ur="FRAG_LOADING_WAITING_RETRY",Br="WAITING_TRACK",Gr="PARSING",Kr="PARSED",Hr="ENDED",Vr="ERROR",Yr="WAITING_INIT_PTS",Wr="WAITING_LEVEL",jr=function(s){function t(t,e,r,i,n){var a;return(a=s.call(this)||this).hls=void 0,a.fragPrevious=null,a.fragCurrent=null,a.fragmentTracker=void 0,a.transmuxer=null,a._state=Fr,a.playlistType=void 0,a.media=null,a.mediaBuffer=null,a.config=void 0,a.bitrateTest=!1,a.lastCurrentTime=0,a.nextLoadPosition=0,a.startPosition=0,a.startTimeOffset=null,a.loadedmetadata=!1,a.retryDate=0,a.levels=null,a.fragmentLoader=void 0,a.keyLoader=void 0,a.levelLastLoaded=null,a.startFragRequested=!1,a.decrypter=void 0,a.initPTS=[],a.onvseeking=null,a.onvended=null,a.logPrefix="",a.log=void 0,a.warn=void 0,a.playlistType=n,a.logPrefix=i,a.log=at.log.bind(at,i+":"),a.warn=at.warn.bind(at,i+":"),a.hls=t,a.fragmentLoader=new dr(t.config),a.keyLoader=r,a.fragmentTracker=e,a.config=t.config,a.decrypter=new xr(t.config),t.on(rt.MANIFEST_LOADED,a.onManifestLoaded,function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(a)),a}l(t,s);var e=t.prototype;return e.doTick=function(){this.onTickEnd()},e.onTickEnd=function(){},e.startLoad=function(t){},e.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var t=this.fragCurrent;null!=t&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Fr},e._streamEnded=function(t,e){if(e.live||t.nextStart||!t.end||!this.media)return!1;t=e.partList;if(null!=t&&t.length){t=t[t.length-1];return Sr.isBuffered(this.media,t.start+t.duration/2)}e=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(e)},e.getLevelDetails=function(){var t;if(this.levels&&null!==this.levelLastLoaded)return null==(t=this.levels[this.levelLastLoaded])?void 0:t.details},e.onMediaAttached=function(t,e){e=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);e=this.config;this.levels&&e.autoStartLoad&&this.state===Fr&&this.startLoad(e.startPosition)},e.onMediaDetaching=function(){var t=this.media;null!=t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},e.onMediaSeeking=function(){var t=this.config,e=this.fragCurrent,r=this.media,i=this.mediaBuffer,n=this.state,a=r?r.currentTime:0,i=Sr.bufferInfo(i||r,a,t.maxBufferHole);this.log("media seeking to "+(G(a)?a.toFixed(3):a)+", state: "+n),this.state===Hr?this.resetLoadingState():e&&(n=t.maxFragLookUpTolerance,t=e.start-n,n=e.start+e.duration+n,(!i.len||n<i.start||t>i.end)&&(n=n<a,(a<t||n)&&(n&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.abortRequests(),this.resetLoadingState()),this.fragPrevious=null))),r&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),this.lastCurrentTime=a),this.loadedmetadata||i.len||(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()},e.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},e.onManifestLoaded=function(t,e){this.startTimeOffset=e.startTimeOffset,this.initPTS=[]},e.onHandlerDestroying=function(){this.stopLoad(),s.prototype.onHandlerDestroying.call(this)},e.onHandlerDestroyed=function(){this.state=Fr,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,s.prototype.onHandlerDestroyed.call(this)},e.loadFragment=function(t,e,r){this._loadFragForPlayback(t,e,r)},e._loadFragForPlayback=function(r,t,e){var i=this;this._doFragLoad(r,t,e,function(t){return i.fragContextChanged(r)?(i.warn("Fragment "+r.sn+(t.part?" p: "+t.part.index:"")+" of level "+r.level+" was dropped during download."),void i.fragmentTracker.removeFragment(r)):(r.stats.chunkCount++,void i._handleFragmentLoadProgress(t))}).then(function(t){var e;t&&(e=i.state,i.fragContextChanged(r)?e!==Nr&&(i.fragCurrent||e!==Gr)||(i.fragmentTracker.removeFragment(r),i.state=Mr):("payload"in t&&(i.log("Loaded fragment "+r.sn+" of level "+r.level),i.hls.trigger(rt.FRAG_LOADED,t)),i._handleFragmentLoadComplete(t)))}).catch(function(t){i.state!==Fr&&i.state!==Vr&&(i.warn(t),i.resetFragmentLoading(r))})},e.clearTrackerIfNeeded=function(t){var e,r=this.fragmentTracker;r.getState(t)===ir?(e=t.type,e=this.getFwdBufferInfo(this.mediaBuffer,e),e=Math.max(t.duration,e?e.len:this.config.maxBufferLength),this.reduceMaxBufferLength(e)&&r.removeFragment(t)):0===(null==(e=this.mediaBuffer)?void 0:e.buffered.length)?r.removeAllFragments():r.hasParts(t.type)&&(r.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),r.getState(t)===nr&&r.removeFragment(t))},e.flushMainBuffer=function(t,e,r){void 0===r&&(r=null),t-e&&(r={startOffset:t,endOffset:e,type:r},this.hls.trigger(rt.BUFFER_FLUSHING,r))},e._loadInitSegment=function(a,n){var s=this;this._doFragLoad(a,n).then(function(t){if(!t||s.fragContextChanged(a)||!s.levels)throw new Error("init load aborted");return t}).then(function(r){var i=s.hls,t=r.payload,e=a.decryptdata;if(t&&0<t.byteLength&&e&&e.key&&e.iv&&"AES-128"===e.method){var n=self.performance.now();return s.decrypter.decrypt(new Uint8Array(t),e.key.buffer,e.iv.buffer).catch(function(t){throw i.trigger(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:a}),t}).then(function(t){var e=self.performance.now();return i.trigger(rt.FRAG_DECRYPTED,{frag:a,payload:t,stats:{tstart:n,tdecrypt:e}}),r.payload=t,r})}return r}).then(function(t){var e=s.fragCurrent,r=s.hls;if(!s.levels)throw new Error("init load aborted, missing levels");var i=a.stats;s.state=Mr,n.fragmentError=0,a.data=new Uint8Array(t.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),t.frag===e&&r.trigger(rt.FRAG_BUFFERED,{stats:i,frag:e,part:null,id:a.type}),s.tick()}).catch(function(t){s.state!==Fr&&s.state!==Vr&&(s.warn(t),s.resetFragmentLoading(a))})},e.fragContextChanged=function(t){var e=this.fragCurrent;return!t||!e||t.level!==e.level||t.sn!==e.sn||t.urlId!==e.urlId},e.fragBufferedComplete=function(t,e){var r=this.mediaBuffer||this.media;this.log("Buffered "+t.type+" sn: "+t.sn+(e?" part: "+e.index:"")+" of "+(this.playlistType===le?"level":"track")+" "+t.level+" (frag:["+(null!=(e=t.startPTS)?e:NaN).toFixed(3)+"-"+(null!=(e=t.endPTS)?e:NaN).toFixed(3)+"] > buffer:"+(r?function(t){for(var e="",r=t.length,i=0;i<r;i++)e+="["+t.start(i).toFixed(3)+"-"+t.end(i).toFixed(3)+"]";return e}(Sr.getBuffered(r)):"(detached)")+")"),this.state=Mr,r&&(!this.loadedmetadata&&t.type==le&&r.buffered.length&&(null==(r=this.fragCurrent)?void 0:r.sn)===(null==(r=this.fragPrevious)?void 0:r.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},e.seekToStartPos=function(){},e._handleFragmentLoadComplete=function(t){var e,r,i=this.transmuxer;i&&(e=t.frag,r=t.part,t=!(t=t.partsLoaded)||0===t.length||t.some(function(t){return!t}),t=new mr(e.level,e.sn,e.stats.chunkCount+1,0,r?r.index:-1,!t),i.flush(t))},e._handleFragmentLoadProgress=function(t){},e._doFragLoad=function(e,r,t,i){var n=this;void 0===t&&(t=null);var a=null==r?void 0:r.details;if(!this.levels||!a)throw new Error("frag load aborted, missing level"+(a?"":" detail")+"s");var s=null;if(!e.encrypted||null!=(l=e.decryptdata)&&l.key?!e.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(e,a.encryptedFragments):(this.log("Loading key for "+e.sn+" of ["+a.startSN+"-"+a.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level),this.state=Or,this.fragCurrent=e,s=this.keyLoader.load(e).then(function(t){if(!n.fragContextChanged(t.frag))return n.hls.trigger(rt.KEY_LOADED,t),n.state===Or&&(n.state=Mr),t}),this.hls.trigger(rt.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(s=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),t=Math.max(e.start,t||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){var o=a.partList;if(o&&i){t>e.end&&a.fragmentHint&&(e=a.fragmentHint);var l=this.getNextPart(o,e,t);if(-1<l){var u=o[l];return this.log("Loading part sn: "+e.sn+" p: "+u.index+" cc: "+e.cc+" of playlist ["+a.startSN+"-"+a.endSN+"] parts [0-"+l+"-"+(o.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(t.toFixed(3))),this.nextLoadPosition=u.start+u.duration,this.state=Nr,l=s?s.then(function(t){return!t||n.fragContextChanged(t.frag)?null:n.doFragPartsLoad(e,u,r,i)}).catch(function(t){return n.handleFragLoadError(t)}):this.doFragPartsLoad(e,u,r,i).catch(function(t){return n.handleFragLoadError(t)}),this.hls.trigger(rt.FRAG_LOADING,{frag:e,part:u,targetBufferTime:t}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):l}if(!e.url||this.loadedEndOfParts(o,t))return Promise.resolve(null)}}this.log("Loading fragment "+e.sn+" cc: "+e.cc+" "+(a?"of ["+a.startSN+"-"+a.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(t.toFixed(3))),G(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Nr;var h=this.config.progressive,s=h&&s?s.then(function(t){return!t||n.fragContextChanged(null==t?void 0:t.frag)?null:n.fragmentLoader.load(e,i)}).catch(function(t){return n.handleFragLoadError(t)}):Promise.all([this.fragmentLoader.load(e,h?i:void 0),s]).then(function(t){t=t[0];return!h&&t&&i&&i(t),t}).catch(function(t){return n.handleFragLoadError(t)});return this.hls.trigger(rt.FRAG_LOADING,{frag:e,targetBufferTime:t}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):s},e.doFragPartsLoad=function(o,r,l,u){var h=this;return new Promise(function(n,t){var e,a=[],s=null==(e=l.details)?void 0:e.partList;!function r(i){h.fragmentLoader.loadPart(o,i,u).then(function(t){var e=(a[i.index]=t).part;h.hls.trigger(rt.FRAG_LOADED,t);t=Ue(l,o.sn,i.index+1)||Be(s,o.sn,i.index+1);if(!t)return n({frag:o,part:e,partsLoaded:a});r(t)}).catch(t)}(r)})},e.handleFragLoadError=function(t){var e;return"data"in t?(e=t.data,t.data&&e.details===nt.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):this.hls.trigger(rt.ERROR,e)):this.hls.trigger(rt.ERROR,{type:it.OTHER_ERROR,details:nt.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0}),null},e._handleTransmuxerFlush=function(t){var e,r,i,n=this.getCurrentContext(t);n&&this.state===Gr?(e=n.frag,r=n.part,i=n.level,n=self.performance.now(),e.stats.parsing.end=n,r&&(r.stats.parsing.end=n),this.updateLevelTiming(e,r,i,t.partial)):this.fragCurrent||this.state===Fr||this.state===Vr||(this.state=Mr)},e.getCurrentContext=function(t){var e=this.levels,r=this.fragCurrent,i=t.level,n=t.sn,t=t.part;if(null==e||!e[i])return this.warn("Levels object was unset while buffering fragment "+n+" of level "+i+". The current chunk will not be buffered."),null;var a=e[i],i=-1<t?Ue(a,n,t):null,t=i?i.fragment:function(){if(null==a||!a.details)return null;var t=a.details,e=t.fragments[n-t.startSN];return e||((e=t.fragmentHint)&&e.sn===n?e:n<t.startSN&&r&&r.sn===n?r:null)}();return t?(r&&r!==t&&(t.stats=r.stats),{frag:t,part:i,level:a}):null},e.bufferFragmentData=function(t,e,r,i){var n,a,s;t&&this.state===Gr&&(n=t.data1,a=t.data2,(s=n)&&a&&(s=Ct(n,a)),null!=s&&s.length&&(s={type:t.type,frag:e,part:r,chunkMeta:i,parent:e.type,data:s},this.hls.trigger(rt.BUFFER_APPENDING,s),t.dropped&&t.independent&&!r&&this.flushBufferGap(e)))},e.flushBufferGap=function(t){var e,r,i=this.media;i&&(Sr.isBuffered(i,i.currentTime)?(r=i.currentTime,e=Sr.bufferInfo(i,r,0),i=t.duration,i=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),r=Math.max(Math.min(t.start-i,e.end-i),r+i),t.start-r>i&&this.flushMainBuffer(r,t.start)):this.flushMainBuffer(0,t.start))},e.getFwdBufferInfo=function(t,e){var r=this.getLoadPosition();return G(r)?this.getFwdBufferInfoAtPos(t,r,e):null},e.getFwdBufferInfoAtPos=function(t,e,r){var i=this.config.maxBufferHole,n=Sr.bufferInfo(t,e,i);if(0===n.len&&void 0!==n.nextStart){r=this.fragmentTracker.getBufferedFrag(e,r);if(r&&n.nextStart<r.end)return Sr.bufferInfo(t,e,Math.max(n.nextStart,i))}return n},e.getMaxBufferLength=function(t){var e=this.config,t=t?Math.max(8*e.maxBufferSize/t,e.maxBufferLength):e.maxBufferLength;return Math.min(t,e.maxMaxBufferLength)},e.reduceMaxBufferLength=function(t){var e=this.config,t=t||e.maxBufferLength;return e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},e.getAppendedFrag=function(t,e){t=this.fragmentTracker.getAppendedFrag(t,le);return t&&"fragment"in t?t.fragment:t},e.getNextFragment=function(t,e){var r=e.fragments,i=r.length;if(!i)return null;var n,a=this.config,s=r[0].start;if(e.live){var o=a.initialLiveManifestSize;if(i<o)return this.warn("Not enough fragments to start playback (have: "+i+", need: "+o+")"),null;e.PTSKnown||this.startFragRequested||-1!==this.startPosition||(n=this.getInitialLiveFragment(e,r),this.startPosition=n?this.hls.liveSyncPosition||n.start:t)}else t<=s&&(n=r[0]);return n||(a=a.lowLatencyMode?e.partEnd:e.fragmentEnd,n=this.getFragmentAtPosition(t,a,e)),this.mapToInitFragWhenRequired(n)},e.isLoopLoading=function(t,e){var r=this.fragmentTracker.getState(t);return(r===ar||r===nr&&!!t.gap)&&this.nextLoadPosition>e},e.getNextFragmentLoopLoading=function(t,e,r,i,n){var a=t.gap,e=this.getNextFragment(this.nextLoadPosition,e);if(null===e)return e;if(t=e,a&&t&&!t.gap&&r.nextStart){a=this.getFwdBufferInfoAtPos(this.mediaBuffer||this.media,r.nextStart,i);if(null!==a&&r.len+a.len>=n)return this.log('buffer full after gaps in "'+i+'" playlist starting at sn: '+t.sn),null}return t},e.mapToInitFragWhenRequired=function(t){return null==t||!t.initSegment||null!=t&&t.initSegment.data||this.bitrateTest?t:t.initSegment},e.getNextPart=function(t,e,r){for(var i=-1,n=!1,a=!0,s=0,o=t.length;s<o;s++){var l=t[s],a=a&&!l.independent;if(-1<i&&r<l.start)break;var u=l.loaded;u?i=-1:(n||l.independent||a)&&l.fragment===e&&(i=s),n=u}return i},e.loadedEndOfParts=function(t,e){t=t[t.length-1];return t&&e>t.start&&t.loaded},e.getInitialLiveFragment=function(t,e){var r,i,n=this.fragPrevious,a=null;return n?(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),a=function(t,e,r){if(null===e||!Array.isArray(t)||!t.length||!G(e))return null;if(e<(t[0].programDateTime||0))return null;if(e>=(t[t.length-1].endProgramDateTime||0))return null;r=r||0;for(var i,n,a,s=0;s<t.length;++s){var o=t[s];if(i=e,n=r,a=o,n=1e3*Math.min(n,a.duration+(a.deltaPTS||0)),(a.endProgramDateTime||0)-n>i)return o}return null}(e,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),a||((r=n.sn+1)>=t.startSN&&r<=t.endSN&&(r=e[r-t.startSN],n.cc===r.cc&&(a=r,this.log("Live playlist, switching playlist, load frag with next SN: "+a.sn))),a||(i=n.cc,(a=We(e,function(t){return t.cc<i?1:t.cc>i?-1:0}))&&this.log("Live playlist, switching playlist, load frag with same CC: "+a.sn)))):null!==(e=this.hls.liveSyncPosition)&&(a=this.getFragmentAtPosition(e,this.bitrateTest?t.fragmentEnd:t.edge,t)),a},e.getFragmentAtPosition=function(t,e,r){var i=this.config,n=this.fragPrevious,a=r.fragments,s=r.endSN,o=r.fragmentHint,l=i.maxFragLookUpTolerance,u=r.partList,i=!!(i.lowLatencyMode&&null!=u&&u.length&&o);return i&&o&&!this.bitrateTest&&(a=a.concat(o),s=o.sn),(t=t<e?je(n,a,t,e-l<t?0:l):a[a.length-1])&&(l=t.sn-r.startSN,((r=this.fragmentTracker.getState(t))===ar||r===nr&&t.gap)&&(n=t),n&&t.sn===n.sn&&(!i||u[0].fragment.sn>t.sn)&&n&&t.level===n.level&&(l=a[1+l],t=t.sn<s&&this.fragmentTracker.getState(l)!==ar?l:null)),t},e.synchronizeToLiveEdge=function(t){var e,r,i,n,a=this.config,s=this.media;s&&(e=this.hls.liveSyncPosition,r=s.currentTime,n=t.fragments[0].start,i=t.edge,n=r>=n-a.maxFragLookUpTolerance&&r<=i,null!==e&&s.duration>e&&(r<e||!n)&&(t=void 0!==a.liveMaxLatencyDuration?a.liveMaxLatencyDuration:a.liveMaxLatencyDurationCount*t.targetduration,(!n&&s.readyState<4||r<i-t)&&(this.loadedmetadata||(this.nextLoadPosition=e),s.readyState&&(this.warn("Playback: "+r.toFixed(3)+" is located too far from the end of live sliding playlist: "+i+", reset currentTime to : "+e.toFixed(3)),s.currentTime=e))))},e.alignPlaylists=function(t,e){var r=this.levels,i=this.levelLastLoaded,n=this.fragPrevious,a=null!==i?r[i]:null,s=t.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;var o,l,u=t.fragments[0].start,h=!e,d=t.alignedSliding&&G(u);if(h||!d&&!u){o=n,r=t,(i=a)&&(h=o,l=r,(d=i).details&&(l.endCC>l.startCC||h&&h.cc<l.startCC)&&((d=function(t){var e=t.fragments,t=l.fragments;if(t.length&&e.length){t=br(e,t[0].cc);if(t&&(!t||t.startPTS))return t;at.log("No frag in previous level to align on")}else at.log("No fragments to align")}(d.details))&&G(d.start)&&(at.log("Adjusting PTS using last level due to CC increase within current level "+l.url),Ir(d.start,l))),!r.alignedSliding&&i.details&&(a=r,(o=i.details).fragments.length&&a.hasProgramDateTime&&o.hasProgramDateTime&&(h=o.fragments[0].programDateTime,(o=((d=a.fragments[0].programDateTime)-h)/1e3+o.fragments[0].start)&&G(o)&&(at.log("Adjusting PTS using programDateTime delta "+(d-h)+"ms, sliding:"+o.toFixed(3)+" "+a.url+" "),Ir(o,a)))),r.alignedSliding||!i.details||r.skippedSegments||Oe(i.details,r));r=t.fragments[0].start;return this.log("Live playlist sliding: "+r.toFixed(2)+" start-sn: "+(e?e.startSN:"na")+"->"+t.startSN+" prev-sn: "+(n?n.sn:"na")+" fragments: "+s),r}return u},e.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},e.setStartPosition=function(t,e){var r,i,n=this.startPosition;n<e&&(n=-1),-1!==n&&-1!==this.lastCurrentTime||(null!==(i=((r=null!==this.startTimeOffset)?this:t).startTimeOffset)&&G(i)?(n=e+i,i<0&&(n+=t.totalduration),n=Math.min(Math.max(e,n),e+t.totalduration),this.log("Start time offset "+i+" found in "+(r?"multivariant":"media")+" playlist, adjust startPosition to "+n),this.startPosition=n):t.live?n=this.hls.liveSyncPosition||e:this.startPosition=n=0,this.lastCurrentTime=n),this.nextLoadPosition=n},e.getLoadPosition=function(){var t=this.media,e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e},e.handleFragLoadAborted=function(t,e){this.transmuxer&&"initSegment"!==t.sn&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(e?" part "+e.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},e.resetFragmentLoading=function(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===Ur)||(this.state=Mr)},e.onFragmentOrKeyLoadError=function(t,e){!e.chunkMeta||e.frag||(a=this.getCurrentContext(e.chunkMeta))&&(e.frag=a.frag);var r,i,n,a,s,o=e.frag;o&&o.type===t&&this.levels&&(this.fragContextChanged(o)?this.warn("Frag load error must match current frag to retry "+o.url+" > "+(null==(n=this.fragCurrent)?void 0:n.url)):((r=e.details===nt.FRAG_GAP)&&this.fragmentTracker.fragBuffered(o,!0),n=void 0===(a=(s=(i=e.errorAction)||{}).retryCount)?0:a,a=s.retryConfig,i&&5===s.action&&a?(this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),s=He(a,n),this.warn("Fragment "+o.sn+" of "+t+" "+o.level+" errored with "+e.details+", retrying loading "+(n+1)+"/"+a.maxNumRetry+" in "+s+"ms"),i.resolved=!0,this.retryDate=self.performance.now()+s,this.state=Ur):a&&i?(this.resetFragmentErrors(t),n<a.maxNumRetry?r||(i.resolved=!0):at.warn(e.details+" reached or exceeded max retry ("+n+")")):this.state=Vr,this.tickImmediate()))},e.reduceLengthAndFlushBuffer=function(t){if(this.state!==Gr&&this.state!==Kr)return!1;var e=t.parent,r=this.getFwdBufferInfo(this.mediaBuffer,e),i=r&&.5<r.len;i&&this.reduceMaxBufferLength(r.len);i=!i;return i&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+e+" buffer"),t.frag&&(this.fragmentTracker.removeFragment(t.frag),this.nextLoadPosition=t.frag.start),this.resetLoadingState(),i},e.resetFragmentErrors=function(t){t===ue&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Fr&&(this.state=Mr)},e.afterBufferFlushed=function(t,e,r){t&&(t=Sr.getBuffered(t),this.fragmentTracker.detectEvictedFragments(e,t,r),this.state===Hr&&this.resetLoadingState())},e.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Mr},e.resetStartWhenNotLoaded=function(t){this.loadedmetadata||(this.startFragRequested=!1,null!=(t=this.levels?this.levels[t].details:null)&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition)},e.resetWhenMissingContext=function(t){this.warn("The loading context changed while buffering fragment "+t.sn+" of level "+t.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(t.level),this.resetLoadingState()},e.removeUnbufferedFrags=function(t){void 0===t&&(t=0),this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)},e.updateLevelTiming=function(n,t,a,s){var o=this,l=a.details;if(l){if(Object.keys(n.elementaryStreams).reduce(function(t,e){var r=n.elementaryStreams[e];if(r){var i=r.endPTS-r.startPTS;if(i<=0)return o.warn("Could not parse fragment "+n.sn+" "+e+" duration reliably ("+i+")"),t||!1;i=s?0:Fe(l,n,r.startPTS,r.endPTS,r.startDTS,r.endDTS);return o.hls.trigger(rt.LEVEL_PTS_UPDATED,{details:l,level:a,drift:i,type:e,frag:n,start:r.startPTS,end:r.endPTS}),!0}return t},!1))a.fragmentError=0;else if(null===(null==(e=this.transmuxer)?void 0:e.error)){var e=new Error("Found no media in fragment "+n.sn+" of level "+a.id+" resetting transmuxer to fallback to playlist timing");if(this.warn(e.message),this.hls.trigger(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.FRAG_PARSING_ERROR,fatal:!1,error:e,frag:n,reason:"Found no media in msn "+n.sn+' of level "'+a.url+'"'}),!this.hls)return;this.resetTransmuxer()}this.state=Kr,this.hls.trigger(rt.FRAG_PARSED,{frag:n,part:t})}else this.warn("level.details undefined")},e.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},e.recoverWorkerError=function(t){"demuxerWorker"===t.event&&(this.resetTransmuxer(),this.resetLoadingState())},o(t,[{key:"state",get:function(){return this._state},set:function(t){var e=this._state;e!==t&&(this._state=t,this.log(e+"->"+t))}}]),t}(Tr);function qr(t,e){e=(void 0===e?{}:e).removePKCS7Padding,e=void 0===e||e;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=t.enableSoftwareAES,this.removePKCS7Padding=e)try{var r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch(t){}null===this.subtle&&(this.useSoftware=!0)}function Xr(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}function zr(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}function Qr(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}function $r(){return self.SourceBuffer||self.WebKitSourceBuffer}function Jr(t,e){return void 0===t&&(t=""),void 0===e&&(e=9e4),{type:t,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}var Zr=((Wn=ei.prototype).resetInitSegment=function(t,e,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},Wn.resetTimeStamp=function(t){this.initPTS=t,this.resetContiguity()},Wn.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},Wn.canParse=function(t,e){return!1},Wn.appendFrame=function(t,e,r){},Wn.demux=function(t,e){this.cachedData&&(t=Ct(this.cachedData,t),this.cachedData=null);var r,i,n,a=lt(t,0),s=a?a.length:0,o=this._audioTrack,l=this._id3Track,u=a?function(){for(var t=ht(a),e=0;e<t.length;e++){var r=t[e];if(ut(r))return function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),t=1&e[3],e=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return e/=45,t&&(e+=47721858.84),Math.round(e)}}(r)}}():void 0,h=t.length;for((null===this.basePTS||0===this.frameIndex&&G(u))&&(this.basePTS=ti(u,e,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),a&&0<a.length&&l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:a,type:Te,duration:Number.POSITIVE_INFINITY});s<h;)this.canParse(t,s)?(i=this.appendFrame(o,t,s))?(this.frameIndex++,this.lastPTS=i.sample.pts,r=s+=i.length):s=h:st(i=t,n=s)&&ct(i,n+6)+10<=i.length-n?(a=lt(t,s),l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:a,type:Te,duration:Number.POSITIVE_INFINITY}),r=s+=a.length):s++,s===h&&r!==h&&(n=tt(t,r),this.cachedData?this.cachedData=Ct(this.cachedData,n):this.cachedData=n);return{audioTrack:o,videoTrack:Jr(),id3Track:l,textTrack:Jr()}},Wn.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},Wn.flush=function(t){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:Jr(),id3Track:this._id3Track,textTrack:Jr()}},Wn.destroy=function(){},ei),ti=function(t,e,r){return G(t)?90*t:9e4*e+(r?9e4*r.baseTime/r.timescale:0)};function ei(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}function ri(t,e){return 255===t[e]&&240==(246&t[e+1])}function ii(t,e){return 1&t[e+1]?7:9}function ni(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function ai(t,e){return e+1<t.length&&ri(t,e)}function si(t,e,r,i,n){t.samplerate||(n=function(t,e,r,i){var n,a,s=navigator.userAgent.toLowerCase(),o=i,l=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],u=1+((192&e[r+2])>>>6),h=(60&e[r+2])>>>2;if(!(l.length-1<h))return n=(1&e[r+2])<<2,n|=(192&e[r+3])>>>6,at.log("manifest codec:"+i+", ADTS type:"+u+", samplingIndex:"+h),i=/firefox/i.test(s)?6<=h?(u=5,a=new Array(4),h-3):(u=2,a=new Array(2),h):-1!==s.indexOf("android")?(u=2,a=new Array(2),h):(u=5,a=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&6<=h?h-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(6<=h&&1==n||/vivaldi/i.test(s))||!i&&1==n)&&(u=2,a=new Array(2)),h)),a[0]=u<<3,a[0]|=(14&h)>>1,a[1]|=(1&h)<<7,a[1]|=n<<3,5===u&&(a[1]|=(14&i)>>1,a[2]=(1&i)<<7,a[2]|=8,a[3]=0),{config:a,samplerate:l[h],channelCount:n,codec:"mp4a.40."+u,manifestCodec:o};t.trigger(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+h})}(e,r,i,n))&&(t.config=n.config,t.samplerate=n.samplerate,t.channelCount=n.channelCount,t.codec=n.codec,t.manifestCodec=n.manifestCodec,at.log("parsed codec:"+t.codec+", rate:"+n.samplerate+", channels:"+n.channelCount))}function oi(t){return 9216e4/t}function li(t,r,i,e,n){var a,s=e+n*oi(t.samplerate),e=function(){var t=ii(r,i);if(i+t<=r.length){var e=ni(r,i)-t;if(0<e)return{headerLength:t,frameLength:e}}}();if(e){var o=e.frameLength,n=e.headerLength,e=n+o,o=Math.max(0,i+e-r.length);o?(a=new Uint8Array(e-n)).set(r.subarray(i+n,r.length),0):a=r.subarray(i+n,i+e);n={unit:a,pts:s};return o||t.samples.push(n),{sample:n,length:e,missing:o}}o=r.length-i;return(a=new Uint8Array(o)).set(r.subarray(i,r.length),0),{sample:{unit:a,pts:s},length:o,missing:-1}}var ui=function(n){function t(t,e){var r;return(r=n.call(this)||this).observer=void 0,r.config=void 0,r.observer=t,r.config=e,r}l(t,n);var e=t.prototype;return e.resetInitSegment=function(t,e,r,i){n.prototype.resetInitSegment.call(this,t,e,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:i,inputTimeScale:9e4,dropped:0}},t.probe=function(t){if(!t)return!1;for(var e=(lt(t,0)||[]).length,r=t.length;e<r;e++)if(function(t,e){if(ai(t,e)){var r=ii(t,e);if(e+r>=t.length)return;var i=ni(t,e);if(i<=r)return;i=e+i;return i===t.length||ai(t,i)}}(t,e))return at.log("ADTS sync word found !"),!0;return!1},e.canParse=function(t,e){return(e=e)+5<(t=t).length&&ri(t,e)&&ni(t,e)<=t.length-e},e.appendFrame=function(t,e,r){si(t,this.observer,e,r,t.manifestCodec);r=li(t,e,r,this.basePTS,this.frameIndex);if(r&&0===r.missing)return r},t}(Zr),hi=/\/emsg[-/]ID3/i,di=((zi=pi.prototype).resetTimeStamp=function(){},zi.resetInitSegment=function(t,e,r,i){var n,a,s,o=this.videoTrack=Jr("video",1),l=this.audioTrack=Jr("audio",1),u=this.txtTrack=Jr("text",1);this.id3Track=Jr("id3",1),this.timeOffset=0,null!=t&&t.byteLength&&((a=It(t)).video&&(t=(n=a.video).id,s=n.timescale,n=n.codec,o.id=t,o.timescale=u.timescale=s,o.codec=n),a.audio&&(n=(s=a.audio).id,a=s.timescale,s=s.codec,l.id=n,l.timescale=a,l.codec=s),u.id=St.text,o.sampleDuration=0,o.duration=l.duration=i)},zi.resetContiguity=function(){this.remainderData=null},pi.probe=function(t){return 0<Dt(t=16384<t.length?t.subarray(0,16384):t,["moof"]).length},zi.demux=function(t,e){this.timeOffset=e;var r=t,i=this.videoTrack,n=this.txtTrack;this.config.progressive?(this.remainderData&&(r=Ct(this.remainderData,t)),t=function(t){var e={valid:null,remainder:null},r=Dt(t,["moof"]);if(!r)return e;if(r.length<2)return e.remainder=t,e;r=r[r.length-1];return e.valid=tt(t,0,r.byteOffset-8),e.remainder=tt(t,r.byteOffset-8),e}(r),this.remainderData=t.remainder,i.samples=t.valid||new Uint8Array):i.samples=r;r=this.extractID3Track(i,e);return n.samples=_t(e,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:r,textTrack:this.txtTrack}},zi.flush=function(){var t=this.timeOffset,e=this.videoTrack,r=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(e,this.timeOffset);return r.samples=_t(t,e),{videoTrack:e,audioTrack:Jr(),id3Track:i,textTrack:Jr()}},zi.extractID3Track=function(t,i){var n=this.id3Track;return!t.samples.length||(t=Dt(t.samples,["emsg"]))&&t.forEach(function(t){var e,r=function(t){var e=t[0],r="",i="",n=0,a=0,s=0,o=0,l=0,u=0;if(0===e){for(;"\0"!==Lt(t.subarray(u,u+1));)r+=Lt(t.subarray(u,u+1)),u+=1;for(r+=Lt(t.subarray(u,u+1)),u+=1;"\0"!==Lt(t.subarray(u,u+1));)i+=Lt(t.subarray(u,u+1)),u+=1;i+=Lt(t.subarray(u,u+1)),u+=1,n=At(t,12),a=At(t,16),o=At(t,20),l=At(t,24),u=28}else if(1===e){n=At(t,u+=4);var h=At(t,u+=4),e=At(t,u+=4);for(u+=4,s=Math.pow(2,32)*h+e,Number.isSafeInteger(s)||(s=Number.MAX_SAFE_INTEGER,at.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=At(t,u),l=At(t,u+=4),u+=4;"\0"!==Lt(t.subarray(u,u+1));)r+=Lt(t.subarray(u,u+1)),u+=1;for(r+=Lt(t.subarray(u,u+1)),u+=1;"\0"!==Lt(t.subarray(u,u+1));)i+=Lt(t.subarray(u,u+1)),u+=1;i+=Lt(t.subarray(u,u+1)),u+=1}return{schemeIdUri:r,value:i,timeScale:n,presentationTime:s,presentationTimeDelta:a,eventDuration:o,id:l,payload:t.subarray(u,t.byteLength)}}(t);hi.test(r.schemeIdUri)&&(e=G(r.presentationTime)?r.presentationTime/r.timeScale:i+r.presentationTimeDelta/r.timeScale,(t=4294967295===r.eventDuration?Number.POSITIVE_INFINITY:r.eventDuration/r.timeScale)<=.001&&(t=Number.POSITIVE_INFINITY),r=r.payload,n.samples.push({data:r,len:r.byteLength,dts:e,pts:e,type:Ee,duration:t}))}),n},zi.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},zi.destroy=function(){},pi),ci=null,fi=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],gi=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],mi=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],vi=[0,1,1,4];function pi(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}function yi(t,e,r,i,n){if(!(r+24>e.length)){var a=Ti(e,r);if(a&&r+a.frameLength<=e.length){n=i+n*(9e4*a.samplesPerFrame/a.sampleRate),n={unit:e.subarray(r,r+a.frameLength),pts:n,dts:n};return t.config=[],t.channelCount=a.channelCount,t.samplerate=a.sampleRate,t.samples.push(n),{sample:n,length:a.frameLength,missing:0}}}}function Ti(t,e){var r=t[e+1]>>3&3,i=t[e+1]>>1&3,n=t[e+2]>>4&15,a=t[e+2]>>2&3;if(1!=r&&0!=n&&15!=n&&3!=a){var s=t[e+2]>>1&1,o=t[e+3]>>6,l=1e3*fi[14*(3==r?3-i:3==i?3:4)+n-1],u=gi[3*(3==r?0:2==r?1:2)+a],h=3==o?1:2,n=mi[r][i],a=vi[i],r=8*n*a,s=Math.floor(n*l/u+s)*a;return null===ci&&(a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i),ci=a?parseInt(a[1]):0),ci&&ci<=87&&2==i&&224e3<=l&&0==o&&(t[e+3]=128|t[e+3]),{sampleRate:u,channelCount:h,frameLength:s,samplesPerFrame:r}}}function Ei(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])}function Si(t,e){return e+1<t.length&&Ei(t,e)}var Li=((t=Di.prototype).loadWord=function(){var t=this.data,e=this.bytesAvailable,r=t.byteLength-e,i=new Uint8Array(4),e=Math.min(4,e);if(0===e)throw new Error("no bytes available");i.set(t.subarray(r,r+e)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},t.skipBits=function(t){var e;t=Math.min(t,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>t||(t-=this.bitsAvailable,t-=(e=t>>3)<<3,this.bytesAvailable-=e,this.loadWord()),this.word<<=t,this.bitsAvailable-=t},t.readBits=function(t){var e=Math.min(this.bitsAvailable,t),r=this.word>>>32-e;if(32<t&&at.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,0<this.bitsAvailable)this.word<<=e;else{if(!(0<this.bytesAvailable))throw new Error("no bits available");this.loadWord()}return 0<(e=t-e)&&this.bitsAvailable?r<<e|this.readBits(e):r},t.skipLZ=function(){for(var t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},t.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(t){for(var e=8,r=8,i=0;i<t;i++)0!==r&&(r=(e+this.readEG()+256)%256),e=0===r?e:r},t.readSPS=function(){var t,e,r,i=0,n=0,a=0,s=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),h=this.readBoolean.bind(this),d=this.skipBits.bind(this),c=this.skipEG.bind(this),f=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);o();var m=o();if(l(5),d(3),o(),f(),100===m||110===m||122===m||244===m||44===m||83===m||86===m||118===m||128===m){var v=u();if(3===v&&d(1),f(),f(),d(1),h())for(e=3!==v?8:12,r=0;r<e;r++)h()&&g(r<6?16:64)}f();v=u();if(0===v)u();else if(1===v)for(d(1),c(),c(),t=u(),r=0;r<t;r++)c();f(),d(1);v=u(),f=u(),l=l(1);0===l&&d(1),d(1),h()&&(i=u(),n=u(),a=u(),s=u());var p=[1,1];if(h()&&h())switch(o()){case 1:p=[1,1];break;case 2:p=[12,11];break;case 3:p=[10,11];break;case 4:p=[16,11];break;case 5:p=[40,33];break;case 6:p=[24,11];break;case 7:p=[20,11];break;case 8:p=[32,11];break;case 9:p=[80,33];break;case 10:p=[18,11];break;case 11:p=[15,11];break;case 12:p=[64,33];break;case 13:p=[160,99];break;case 14:p=[4,3];break;case 15:p=[3,2];break;case 16:p=[2,1];break;case 255:p=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil(16*(v+1)-2*i-2*n),height:(2-l)*(f+1)*16-(l?2:4)*(a+s),pixelRatio:p}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},Di),Ri=((Un=bi.prototype).decryptBuffer=function(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer)},Un.decryptAacSample=function(e,r,i){var t,n=this,a=e[r].unit;a.length<=16||(t=(t=a.subarray(16,a.length-a.length%16)).buffer.slice(t.byteOffset,t.byteOffset+t.length),this.decryptBuffer(t).then(function(t){t=new Uint8Array(t);a.set(t,16),n.decrypter.isSync()||n.decryptAacSamples(e,r+1,i)}))},Un.decryptAacSamples=function(t,e,r){for(;;e++){if(e>=t.length)return void r();if(!(t[e].unit.length<32||(this.decryptAacSample(t,e,r),this.decrypter.isSync())))return}},Un.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,r=new Int8Array(e),i=0,n=32;n<t.length-16;n+=160,i+=16)r.set(t.subarray(n,n+16),i);return r},Un.getAvcDecryptedUnit=function(t,e){for(var r=new Uint8Array(e),i=0,n=32;n<t.length-16;n+=160,i+=16)t.set(r.subarray(i,i+16),n);return t},Un.decryptAvcSample=function(e,r,i,n,a){var s=this,o=xt(a.data),t=this.getAvcEncryptedData(o);this.decryptBuffer(t.buffer).then(function(t){a.data=s.getAvcDecryptedUnit(o,t),s.decrypter.isSync()||s.decryptAvcSamples(e,r,i+1,n)})},Un.decryptAvcSamples=function(t,e,r,i){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,r=0){if(e>=t.length)return void i();for(var n=t[e].units;!(r>=n.length);r++){var a=n[r];if(!(a.data.length<=48||1!==a.type&&5!==a.type||(this.decryptAvcSample(t,e,r,i,a),this.decrypter.isSync())))return}}},bi),Ai=188,ki=function(){function I(t,e,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=e,this.typeSupported=r}I.probe=function(t){t=I.syncOffset(t);return 0<t&&at.warn("MPEG2-TS detected but first sync word found @ offset "+t),-1!==t},I.syncOffset=function(t){for(var e=t.length,r=Math.min(940,t.length-Ai)+1,i=0;i<r;){for(var n=!1,a=-1,s=0,o=i;o<e;o+=Ai){if(71!==t[o]){if(s)return-1;break}if(s++,-1===a&&0!==(a=o)&&(r=Math.min(a+18612,t.length-Ai)+1),(n=n||0===wi(t,o))&&1<s&&(0===a&&2<s||r<o+Ai))return a}i++}return-1},I.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:St[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?e:void 0}};var t=I.prototype;return t.resetInitSegment=function(t,e,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=I.createTrack("video"),this._audioTrack=I.createTrack("audio",i),this._id3Track=I.createTrack("id3"),this._txtTrack=I.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=r,this._duration=i},t.resetTimeStamp=function(){},t.resetContiguity=function(){var t=this._audioTrack,e=this._avcTrack,r=this._id3Track;t&&(t.pesData=null),e&&(e.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},t.demux=function(t,e,r,i){var n;void 0===r&&(r=!1),void 0===i&&(i=!1),r||(this.sampleAes=null);var a=this._avcTrack,s=this._audioTrack,o=this._id3Track,l=this._txtTrack,u=a.pid,h=a.pesData,d=s.pid,c=o.pid,f=s.pesData,g=o.pesData,m=null,v=this.pmtParsed,p=this._pmtId,y=t.length;if(this.remainderData&&(y=(t=Ct(this.remainderData,t)).length,this.remainderData=null),y<Ai&&!i)return this.remainderData=t,{audioTrack:s,videoTrack:a,id3Track:o,textTrack:l};var T=Math.max(0,I.syncOffset(t));(y-=(y-T)%Ai)<t.byteLength&&!i&&(this.remainderData=new Uint8Array(t.buffer,y,t.buffer.byteLength-y));for(var E,S=0,L=T;L<y;L+=Ai)if(71===t[L]){var R=!!(64&t[L+1]),A=wi(t,L),k=void 0;if(1<(48&t[L+3])>>4){if((k=L+5+t[L+4])===L+Ai)continue}else k=L+4;switch(A){case u:R&&(h&&(n=Ci(h))&&this.parseAVCPES(a,l,n,!1),h={data:[],size:0}),h&&(h.data.push(t.subarray(k,L+Ai)),h.size+=L+Ai-k);break;case d:if(R){if(f&&(n=Ci(f)))switch(s.segmentCodec){case"aac":this.parseAACPES(s,n);break;case"mp3":this.parseMPEGPES(s,n)}f={data:[],size:0}}f&&(f.data.push(t.subarray(k,L+Ai)),f.size+=L+Ai-k);break;case c:R&&(g&&(n=Ci(g))&&this.parseID3PES(o,n),g={data:[],size:0}),g&&(g.data.push(t.subarray(k,L+Ai)),g.size+=L+Ai-k);break;case 0:R&&(k+=t[k]+1),p=this._pmtId=(31&(E=t)[(b=k)+10])<<8|E[b+11];break;case p:R&&(k+=t[k]+1);var b=function(t,e,r,i){var n={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},a=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<a;){var s=wi(t,e);switch(t[e]){case 207:if(!i){at.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===n.audio&&(n.audio=s);break;case 21:-1===n.id3&&(n.id3=s);break;case 219:if(!i){at.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===n.avc&&(n.avc=s);break;case 3:case 4:!0!==r.mpeg&&!0!==r.mp3?at.log("MPEG audio found, not supported in this browser"):-1===n.audio&&(n.audio=s,n.segmentCodec="mp3");break;case 36:at.warn("Unsupported HEVC stream type found")}e+=5+((15&t[e+3])<<8|t[e+4])}return n}(t,k,this.typeSupported,r);0<(u=b.avc)&&(a.pid=u),0<(d=b.audio)&&(s.pid=d,s.segmentCodec=b.segmentCodec),0<(c=b.id3)&&(o.pid=c),null===m||v||(at.warn("MPEG-TS PMT found at "+L+" after unknown PID '"+m+"'. Backtracking to sync byte @"+T+" to parse all TS packets."),m=null,L=T-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:m=A}}else S++;0<S&&(D=new Error("Found "+S+" TS packet/s that do not start with 0x47"),this.observer.emit(rt.ERROR,rt.ERROR,{type:it.MEDIA_ERROR,details:nt.FRAG_PARSING_ERROR,fatal:!1,error:D,reason:D.message})),a.pesData=h,s.pesData=f,o.pesData=g;var D={audioTrack:s,videoTrack:a,id3Track:o,textTrack:l};return i&&this.extractRemainingSamples(D),D},t.flush=function(){var t=this.remainderData;return this.remainderData=null,t=t?this.demux(t,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t},t.extractRemainingSamples=function(t){var e,r=t.audioTrack,i=t.videoTrack,n=t.id3Track,a=t.textTrack,s=i.pesData,o=r.pesData,t=n.pesData;if(s&&(e=Ci(s))?(this.parseAVCPES(i,a,e,!0),i.pesData=null):i.pesData=s,o&&(e=Ci(o))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,e);break;case"mp3":this.parseMPEGPES(r,e)}r.pesData=null}else null!=o&&o.size&&at.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=o;t&&(e=Ci(t))?(this.parseID3PES(n,e),n.pesData=null):n.pesData=t},t.demuxSampleAes=function(t,e,r){r=this.demux(t,r,!0,!this.config.progressive),e=this.sampleAes=new Ri(this.observer,this.config,e);return this.decrypt(r,e)},t.decrypt=function(i,n){return new Promise(function(t){var e=i.audioTrack,r=i.videoTrack;e.samples&&"aac"===e.segmentCodec?n.decryptAacSamples(e.samples,0,function(){r.samples?n.decryptAvcSamples(r.samples,0,0,function(){t(i)}):t(i)}):r.samples&&n.decryptAvcSamples(r.samples,0,0,function(){t(i)})})},t.destroy=function(){this._duration=0},t.parseAVCPES=function(o,l,u,t){var h,d=this,e=this.parseAVCNALu(o,u.data),c=this.avcSample,f=!1;u.data=null,c&&e.length&&!o.audFound&&(_i(c,o),c=this.avcSample=Ii(!1,u.pts,u.dts,"")),e.forEach(function(t){switch(t.type){case 1:h=!0,(c=c||(d.avcSample=Ii(!0,u.pts,u.dts,""))).frame=!0;var e=t.data;f&&4<e.length&&(2!==(r=new Li(e).readSliceType())&&4!==r&&7!==r&&9!==r||(c.key=!0));break;case 5:h=!0,(c=c||(d.avcSample=Ii(!0,u.pts,u.dts,""))).key=!0,c.frame=!0;break;case 6:h=!0,Pt(t.data,1,u.pts,l.samples);break;case 7:if(f=h=!0,!o.sps){var e=t.data,r=new Li(e).readSPS();o.width=r.width,o.height=r.height,o.pixelRatio=r.pixelRatio,o.sps=[e],o.duration=d._duration;for(var i=e.subarray(1,4),n="avc1.",a=0;a<3;a++){var s=i[a].toString(16);s.length<2&&(s="0"+s),n+=s}o.codec=n}break;case 8:h=!0,o.pps||(o.pps=[t.data]);break;case 9:h=!1,o.audFound=!0,c&&_i(c,o),c=d.avcSample=Ii(!1,u.pts,u.dts,"");break;case 12:h=!0;break;default:h=!1,c&&(c.debug+="unknown NAL "+t.type+" ")}c&&h&&c.units.push(t)}),t&&c&&(_i(c,o),this.avcSample=null)},t.getLastNalUnit=function(t){var e,r=this.avcSample;return r&&0!==r.units.length||(r=t[t.length-1]),null!=r&&r.units&&(e=(e=r.units)[e.length-1]),e},t.parseAVCNALu=function(t,e){var r,i,n,a,s,o,l=e.byteLength,u=t.naluState||0,h=u,d=[],c=0,f=-1,g=0;for(-1===u&&(g=31&e[f=0],u=0,c=1);c<l;)r=e[c++],u=u?1!==u?r?1===r?(0<=f?(a={data:e.subarray(f,c-u-1),type:g},d.push(a)):(n=this.getLastNalUnit(t.samples))&&(h&&c<=4-h&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-h)),0<(i=c-u-1))&&((a=new Uint8Array(n.data.byteLength+i)).set(n.data,0),a.set(e.subarray(0,i),n.data.byteLength),n.data=a,n.state=0),c<l?(g=31&e[f=c],0):-1):0:3:r?0:2:r?0:1;return 0<=f&&0<=u&&(o={data:e.subarray(f,l),type:g,state:u},d.push(o)),0!==d.length||(s=this.getLastNalUnit(t.samples))&&((o=new Uint8Array(s.data.byteLength+e.byteLength)).set(s.data,0),o.set(e,s.data.byteLength),s.data=o),t.naluState=u,d},t.parseAACPES=function(t,e){var r,i,n,a,s=0,o=this.aacOverFlow,l=e.data;for(o&&(this.aacOverFlow=null,u=o.missing,n=o.sample.unit.byteLength,-1===u?((a=new Uint8Array(n+l.byteLength)).set(o.sample.unit,0),a.set(l,n),l=a):(h=n-u,o.sample.unit.set(l.subarray(0,u),h),t.samples.push(o.sample),s=o.missing)),r=s,i=l.length;r<i-1&&!ai(l,r);r++);if(r!==s){var u=r<i-1,h=u?"AAC PES did not start with ADTS header,offset:"+r:"No ADTS header found in AAC PES",s=new Error(h);if(at.warn("parsing error: "+h),this.observer.emit(rt.ERROR,rt.ERROR,{type:it.MEDIA_ERROR,details:nt.FRAG_PARSING_ERROR,fatal:!1,levelRetry:u,error:s,reason:h}),!u)return}if(si(t,this.observer,l,r,this.audioCodec),void 0!==e.pts)d=e.pts;else{if(!o)return void at.warn("[tsdemuxer]: AAC PES unknown PTS");var e=oi(t.samplerate),d=o.sample.pts+e}for(var c,f=0;r<i;){if(r+=(c=li(t,l,r,d,f)).length,c.missing){this.aacOverFlow=c;break}for(f++;r<i-1&&!ai(l,r);r++);}},t.parseMPEGPES=function(t,e){var r=e.data,i=r.length,n=0,a=0,s=e.pts;if(void 0!==s)for(;a<i;)if(Si(r,a)){var o=yi(t,r,a,s,n);if(!o)break;a+=o.length,n++}else a++;else at.warn("[tsdemuxer]: MPEG PES unknown PTS")},t.parseID3PES=function(t,e){void 0!==e.pts?(e=et({},e,{type:this._avcTrack?Ee:Te,duration:Number.POSITIVE_INFINITY}),t.samples.push(e)):at.warn("[tsdemuxer]: ID3 PES unknown PTS")},I}();function bi(t,e,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new xr(e,{removePKCS7Padding:!1})}function Di(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}function Ii(t,e,r,i){return{key:t,frame:!1,pts:e,dts:r,units:[],debug:i,length:0}}function wi(t,e){return((31&t[e+1])<<8)+t[e+2]}function Ci(t){var e,r,i,n,a=0,s=t.data;if(!t||0===t.size)return null;for(;s[0].length<19&&1<s.length;){var o=new Uint8Array(s[0].length+s[1].length);o.set(s[0]),o.set(s[1],s[0].length),s[0]=o,s.splice(1,1)}if(1!==((e=s[0])[0]<<16)+(e[1]<<8)+e[2])return null;if((r=(e[4]<<8)+e[5])&&r>t.size-6)return null;var l=e[7];192&l&&(i=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&l?54e5<i-(n=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)&&(at.warn(Math.round((i-n)/9e4)+"s delta between PTS and DTS, align them"),i=n):n=i);var u=(l=e[8])+9;if(t.size<=u)return null;t.size-=u;for(var h=new Uint8Array(t.size),d=0,c=s.length;d<c;d++){var f=(e=s[d]).byteLength;if(u){if(f<u){u-=f;continue}e=e.subarray(u),f-=u,u=0}h.set(e,a),a+=f}return r&&(r-=l+3),{data:h,pts:i,dts:n,len:r}}function _i(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){var r=e.samples,i=r.length;if(!i)return e.dropped++,0;i=r[i-1];t.pts=i.pts,t.dts=i.dts}e.samples.push(t)}t.debug.length&&at.log(t.pts+"/"+t.dts+":"+t.debug)}var Pi=function(n){function t(){return n.apply(this,arguments)||this}l(t,n);var e=t.prototype;return e.resetInitSegment=function(t,e,r,i){n.prototype.resetInitSegment.call(this,t,e,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:i,inputTimeScale:9e4,dropped:0}},t.probe=function(t){if(!t)return!1;for(var e=(lt(t,0)||[]).length,r=t.length;e<r;e++)if(function(t,e){if(e+1<t.length&&Ei(t,e)){var r=Ti(t,e),i=4;null!=r&&r.frameLength&&(i=r.frameLength);i=e+i;return i===t.length||Si(t,i)}}(t,e))return at.log("MPEG Audio sync word found !"),!0;return!1},e.canParse=function(t,e){return Ei(t,e)&&4<=t.length-e},e.appendFrame=function(t,e,r){if(null!==this.basePTS)return yi(t,e,r,this.basePTS,this.frameIndex)},t}(Zr),xi=(Ni.getSilentFrame=function(t,e){return"mp4a.40.2"===t?1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):void 0:1===e?new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]):2===e||3===e?new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]):void 0},Ni),Fi=Math.pow(2,32)-1,Mi=(Oi.init=function(){for(var t in Oi.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})Oi.types.hasOwnProperty(t)&&(Oi.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Oi.HDLR_TYPES={video:e,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);Oi.STTS=Oi.STSC=Oi.STCO=n,Oi.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Oi.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Oi.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Oi.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);e=new Uint8Array([105,115,111,109]),r=new Uint8Array([97,118,99,49]),n=new Uint8Array([0,0,0,1]);Oi.FTYP=Oi.box(Oi.types.ftyp,e,n,e,r),Oi.DINF=Oi.box(Oi.types.dinf,Oi.box(Oi.types.dref,i))},Oi.box=function(t){for(var e=8,r=arguments.length,i=new Array(1<r?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];for(var a=i.length,s=a;a--;)e+=i[a].byteLength;var o=new Uint8Array(e);for(o[0]=e>>24&255,o[1]=e>>16&255,o[2]=e>>8&255,o[3]=255&e,o.set(t,4),a=0,e=8;a<s;a++)o.set(i[a],e),e+=i[a].byteLength;return o},Oi.hdlr=function(t){return Oi.box(Oi.types.hdlr,Oi.HDLR_TYPES[t])},Oi.mdat=function(t){return Oi.box(Oi.types.mdat,t)},Oi.mdhd=function(t,e){e*=t;var r=Math.floor(e/(1+Fi)),e=Math.floor(e%(1+Fi));return Oi.box(Oi.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))},Oi.mdia=function(t){return Oi.box(Oi.types.mdia,Oi.mdhd(t.timescale,t.duration),Oi.hdlr(t.type),Oi.minf(t))},Oi.mfhd=function(t){return Oi.box(Oi.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},Oi.minf=function(t){return"audio"===t.type?Oi.box(Oi.types.minf,Oi.box(Oi.types.smhd,Oi.SMHD),Oi.DINF,Oi.stbl(t)):Oi.box(Oi.types.minf,Oi.box(Oi.types.vmhd,Oi.VMHD),Oi.DINF,Oi.stbl(t))},Oi.moof=function(t,e,r){return Oi.box(Oi.types.moof,Oi.mfhd(t),Oi.traf(r,e))},Oi.moov=function(t){for(var e=t.length,r=[];e--;)r[e]=Oi.trak(t[e]);return Oi.box.apply(null,[Oi.types.moov,Oi.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(Oi.mvex(t)))},Oi.mvex=function(t){for(var e=t.length,r=[];e--;)r[e]=Oi.trex(t[e]);return Oi.box.apply(null,[Oi.types.mvex].concat(r))},Oi.mvhd=function(t,e){e*=t;var r=Math.floor(e/(1+Fi)),e=Math.floor(e%(1+Fi)),e=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,e>>24,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Oi.box(Oi.types.mvhd,e)},Oi.sdtp=function(t){for(var e,r=t.samples||[],i=new Uint8Array(4+r.length),n=0;n<r.length;n++)e=r[n].flags,i[n+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return Oi.box(Oi.types.sdtp,i)},Oi.stbl=function(t){return Oi.box(Oi.types.stbl,Oi.stsd(t),Oi.box(Oi.types.stts,Oi.STTS),Oi.box(Oi.types.stsc,Oi.STSC),Oi.box(Oi.types.stsz,Oi.STSZ),Oi.box(Oi.types.stco,Oi.STCO))},Oi.avc1=function(t){for(var e,r,i=[],n=[],a=0;a<t.sps.length;a++)r=(e=t.sps[a]).byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(e));for(a=0;a<t.pps.length;a++)r=(e=t.pps[a]).byteLength,n.push(r>>>8&255),n.push(255&r),n=n.concat(Array.prototype.slice.call(e));var s=Oi.box(Oi.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(n))),o=t.width,l=t.height,u=t.pixelRatio[0],h=t.pixelRatio[1];return Oi.box(Oi.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,Oi.box(Oi.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Oi.box(Oi.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,h>>24,h>>16&255,h>>8&255,255&h])))},Oi.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},Oi.mp4a=function(t){var e=t.samplerate;return Oi.box(Oi.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]),Oi.box(Oi.types.esds,Oi.esds(t)))},Oi.mp3=function(t){var e=t.samplerate;return Oi.box(Oi.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]))},Oi.stsd=function(t){return"audio"===t.type?"mp3"===t.segmentCodec&&"mp3"===t.codec?Oi.box(Oi.types.stsd,Oi.STSD,Oi.mp3(t)):Oi.box(Oi.types.stsd,Oi.STSD,Oi.mp4a(t)):Oi.box(Oi.types.stsd,Oi.STSD,Oi.avc1(t))},Oi.tkhd=function(t){var e=t.id,r=t.duration*t.timescale,i=t.width,n=t.height,t=Math.floor(r/(1+Fi)),r=Math.floor(r%(1+Fi));return Oi.box(Oi.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,n>>8&255,255&n,0,0]))},Oi.traf=function(t,e){var r=Oi.sdtp(t),i=t.id,n=Math.floor(e/(1+Fi)),e=Math.floor(e%(1+Fi));return Oi.box(Oi.types.traf,Oi.box(Oi.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),Oi.box(Oi.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,e>>24,e>>16&255,e>>8&255,255&e])),Oi.trun(t,r.length+16+20+8+16+8+8),r)},Oi.trak=function(t){return t.duration=t.duration||4294967295,Oi.box(Oi.types.trak,Oi.tkhd(t),Oi.mdia(t))},Oi.trex=function(t){t=t.id;return Oi.box(Oi.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},Oi.trun=function(t,e){var r,i,n,a,s,o=t.samples||[],l=o.length,u=12+16*l,h=new Uint8Array(u);for(e+=8+u,h.set(["video"===t.type?1:0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0),r=0;r<l;r++)i=(s=o[r]).duration,n=s.size,a=s.flags,s=s.cts,h.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,61440&a.degradPrio,15&a.degradPrio,s>>>24&255,s>>>16&255,s>>>8&255,255&s],12+16*r);return Oi.box(Oi.types.trun,h)},Oi.initSegment=function(t){Oi.types||Oi.init();var e=Oi.moov(t),t=new Uint8Array(Oi.FTYP.byteLength+e.byteLength);return t.set(Oi.FTYP),t.set(e,Oi.FTYP.byteLength),t},Oi);function Oi(){}function Ni(){}function Ui(t,e,r,i){void 0===r&&(r=1),void 0===i&&(i=!1);r*=t*e;return i?Math.round(r):r}function Bi(t,e){return void 0===e&&(e=!1),Ui(t,1e3,1/9e4,e)}Mi.types=void 0,Mi.HDLR_TYPES=void 0,Mi.STTS=void 0,Mi.STSC=void 0,Mi.STCO=void 0,Mi.STSZ=void 0,Mi.VMHD=void 0,Mi.SMHD=void 0,Mi.STSD=void 0,Mi.FTYP=void 0,Mi.DINF=void 0;var Gi=null,Ki=null,Tr=((_=Hi.prototype).destroy=function(){},_.resetTimeStamp=function(t){at.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},_.resetNextTimestamp=function(){at.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},_.resetInitSegment=function(){at.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},_.getVideoStartPts=function(t){var i=!1,t=t.reduce(function(t,e){var r=e.pts-t;return r<-4294967296?(i=!0,Vi(t,e.pts)):0<r?t:e.pts},t[0].pts);return i&&at.debug("PTS rollover detected"),t},_.remux=function(t,e,r,i,n,a,s,o){var l,u,h,d,c,f,g,m=n,v=n,p=-1<t.pid,y=-1<e.pid,T=e.samples.length,E=0<t.samples.length,S=s&&0<T||1<T;return(p&&!E||y&&!S)&&!this.ISGenerated&&!s||(this.ISGenerated||(u=this.generateIS(t,e,n,a)),p=this.isVideoContiguous,s=-1,S&&(s=function(t){for(var e=0;e<t.length;e++)if(t[e].key)return e;return-1}(e.samples),!p&&this.config.forceKeyFrameOnDiscontinuity)&&(c=!0,0<s?(at.warn("[mp4-remuxer]: Dropped "+s+" out of "+T+" video samples due to a missing keyframe"),f=this.getVideoStartPts(e.samples),e.samples=e.samples.slice(s),e.dropped+=s,f=v+=(e.samples[0].pts-f)/e.inputTimeScale):-1===s&&(at.warn("[mp4-remuxer]: No keyframe found out of "+T+" video samples"),c=!1)),this.ISGenerated&&(E&&S&&(T=this.getVideoStartPts(e.samples),T=(Vi(t.samples[0].pts,T)-T)/e.inputTimeScale,m+=Math.max(0,T),v+=Math.max(0,-T)),E?(t.samplerate||(at.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),u=this.generateIS(t,e,n,a)),l=this.remuxAudio(t,m,this.isAudioContiguous,a,y||S||o===ue?v:void 0),S&&(g=l?l.endPTS-l.startPTS:0,e.inputTimeScale||(at.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),u=this.generateIS(t,e,n,a)),g=this.remuxVideo(e,v,p,g))):S&&(g=this.remuxVideo(e,v,p,0)),g&&(g.firstKeyFrame=s,g.independent=-1!==s,g.firstKeyFramePTS=f))),this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(d=Yi(r,n,this._initPTS,this._initDTS)),i.samples.length&&(h=Wi(i,n,this._initPTS))),{audio:l,video:g,initSegment:u,independent:c,text:h,id3:d}},_.generateIS=function(t,e,r,i){var n,a,s,o=t.samples,l=e.samples,u=this.typeSupported,h={},d=this._initPTS,c=!d||i,i="audio/mp4";if(c&&(s=a=1/0),t.config&&o.length&&(t.timescale=t.samplerate,"mp3"===t.segmentCodec&&(u.mpeg?(i="audio/mpeg",t.codec=""):u.mp3&&(t.codec="mp3")),h.audio={id:"audio",container:i,codec:t.codec,initSegment:"mp3"===t.segmentCodec&&u.mpeg?new Uint8Array(0):Mi.initSegment([t]),metadata:{channelCount:t.channelCount}},c&&(n=t.inputTimeScale,d&&n===d.timescale?c=!1:s=a=o[0].pts-Math.round(n*r))),e.sps&&e.pps&&l.length&&(e.timescale=e.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:Mi.initSegment([e]),metadata:{width:e.width,height:e.height}},c)&&(n=e.inputTimeScale,d&&n===d.timescale?c=!1:(d=this.getVideoStartPts(l),r=Math.round(n*r),a=Math.min(a,Vi(l[0].dts,d)-r),s=Math.min(s,d-r))),Object.keys(h).length)return this.ISGenerated=!0,c?(this._initPTS={baseTime:s,timescale:n},this._initDTS={baseTime:a,timescale:n}):s=n=void 0,{tracks:h,initPTS:s,timescale:n}},_.remuxVideo=function(t,e,r,i){var n,a=t.inputTimeScale,s=t.samples,o=[],l=s.length,u=this._initPTS,h=this.nextAvcDts,d=8,c=this.videoSampleDuration,f=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,m=!1;r&&null!==h||(h=e*a-(s[0].pts-Vi(s[0].dts,s[0].pts)));for(var v=u.baseTime*a/u.timescale,p=0;p<l;p++){var y=s[p];y.pts=Vi(y.pts-v,h),y.dts=Vi(y.dts-v,h),y.dts<s[0<p?p-1:p].dts&&(m=!0)}m&&s.sort(function(t,e){var r=t.dts-e.dts,e=t.pts-e.pts;return r||e}),n=s[0].dts;var u=(e=s[s.length-1].dts)-n,T=u?Math.round(u/(l-1)):c||t.inputTimeScale/30;r&&(u=(_=n-h)<-1,((r=T<_)||u)&&(r?at.warn("AVC: "+Bi(_,!0)+" ms ("+_+"dts) hole between fragments detected, filling it"):at.warn("AVC: "+Bi(-_,!0)+" ms ("+_+"dts) overlapping between fragments detected"),!u||h>=s[0].pts)&&(n=h,u=s[0].pts-_,s[0].dts=n,s[0].pts=u,at.log("Video: First PTS/DTS adjusted: "+Bi(u,!0)+"/"+Bi(n,!0)+", delta: "+Bi(_,!0)+" ms"))),n=Math.max(0,n);for(var E=0,S=0,L=0;L<l;L++){for(var R=s[L],A=R.units,k=A.length,b=0,D=0;D<k;D++)b+=A[D].data.length;S+=b,E+=k,R.length=b,R.dts=Math.max(R.dts,n),f=Math.min(R.pts,f),g=Math.max(R.pts,g)}e=s[l-1].dts;var I,w=S+4*E+8;try{I=new Uint8Array(w)}catch(t){return void this.observer.emit(rt.ERROR,rt.ERROR,{type:it.MUX_ERROR,details:nt.REMUX_ALLOC_ERROR,fatal:!1,error:t,bytes:w,reason:"fail allocating video mdat "+w})}var C=new DataView(I.buffer);C.setUint32(0,w),I.set(Mi.types.mdat,4);for(var _,P=!1,x=Number.POSITIVE_INFINITY,F=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY,O=Number.NEGATIVE_INFINITY,N=0;N<l;N++){for(var U=s[N],B=U.units,G=0,K=0,H=B.length;K<H;K++){var V=B[K],Y=V.data,V=V.data.byteLength;C.setUint32(d,V),d+=4,I.set(Y,d),d+=V,G+=4+V}var W,j,q=void 0;N<l-1?(c=s[N+1].dts-U.dts,q=s[N+1].pts-U.pts):(W=this.config,X=0<N?U.dts-s[N-1].dts:T,q=0<N?U.pts-s[N-1].pts:T,W.stretchShortVideoTrack&&null!==this.nextAudioPts&&Math.floor(W.maxBufferHole*a)<(j=(i?f+i*a:this.nextAudioPts)-U.pts)?((c=j-X)<0?c=X:P=!0,at.log("[mp4-remuxer]: It is approximately "+j/90+" ms to the next segment; using duration "+c/90+" ms for the last video frame.")):c=X);var X=Math.round(U.pts-U.dts),x=Math.min(x,c),M=Math.max(M,c),F=Math.min(F,q),O=Math.max(O,q);o.push(new qi(U.key,c,G,X))}if(o.length)if(Gi)Gi<70&&((_=o[0].flags).dependsOn=2,_.isNonSync=0);else if(Ki&&O-F<M-x&&T/M<.025&&0===o[0].cts){at.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var z=n,Q=0,$=o.length;Q<$;Q++){var J,Z=z+o[Q].duration,tt=z+o[Q].cts;Q<$-1?(J=Z+o[Q+1].cts,o[Q].duration=J-tt):o[Q].duration=Q?o[Q-1].duration:T,o[Q].cts=0,z=Z}}c=P||!c?T:c,this.nextAvcDts=h=e+c,this.videoSampleDuration=c,this.isVideoContiguous=!0;e={data1:Mi.moof(t.sequenceNumber++,n,et({},t,{samples:o})),data2:I,startPTS:f/a,endPTS:(g+c)/a,startDTS:n/a,endDTS:h/a,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:t.dropped};return t.samples=[],t.dropped=0,e},_.remuxAudio=function(t,e,r,i,n){var a=t.inputTimeScale,s=a/(t.samplerate||a),o="aac"===t.segmentCodec?1024:1152,l=o*s,u=this._initPTS,h="mp3"===t.segmentCodec&&this.typeSupported.mpeg,d=[],c=void 0!==n,f=t.samples,g=h?0:8,m=this.nextAudioPts||-1,v=e*a,p=u.baseTime*a/u.timescale;if(this.isAudioContiguous=r=r||f.length&&0<m&&(i&&Math.abs(v-m)<9e3||Math.abs(Vi(f[0].pts-p,v)-m)<20*l),f.forEach(function(t){t.pts=Vi(t.pts-p,v)}),!r||m<0){if(!(f=f.filter(function(t){return 0<=t.pts})).length)return;m=0===n?0:i&&!c?Math.max(0,v):f[0].pts}if("aac"===t.segmentCodec)for(var y=this.config.maxAudioFramesDrift,T=0,E=m;T<f.length;T++){var S=f[T],L=S.pts,R=L-E,A=Math.abs(1e3*R/a);if(R<=-y*l&&c)0===T&&(at.warn("Audio frame @ "+(L/a).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*R/a)+" ms."),this.nextAudioPts=m=E=L);else if(y*l<=R&&A<1e4&&c){var k=Math.round(R/l);(E=L-k*l)<0&&(k--,E+=l),0===T&&(this.nextAudioPts=m=E),at.warn("[mp4-remuxer]: Injecting "+k+" audio frame @ "+(E/a).toFixed(3)+"s due to "+Math.round(1e3*R/a)+" ms gap.");for(var b=0;b<k;b++){var D=Math.max(E,0),I=xi.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);I||(at.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),I=S.unit.subarray()),f.splice(T,0,{unit:I,pts:D}),E+=l,T++}}S.pts=E,E+=l}for(var w,C=null,_=null,P=0,x=f.length;x--;)P+=f[x].unit.byteLength;for(var F=0,M=f.length;F<M;F++){var O=f[F],N=O.unit,O=O.pts;if(null!==_)d[F-1].duration=Math.round((O-_)/s);else{if(r&&"aac"===t.segmentCodec&&(O=m),C=O,!(0<P))return;P+=g;try{w=new Uint8Array(P)}catch(t){return void this.observer.emit(rt.ERROR,rt.ERROR,{type:it.MUX_ERROR,details:nt.REMUX_ALLOC_ERROR,fatal:!1,error:t,bytes:P,reason:"fail allocating audio mdat "+P})}h||(new DataView(w.buffer).setUint32(0,P),w.set(Mi.types.mdat,4))}w.set(N,g);N=N.byteLength;g+=N,d.push(new qi(!0,o,N,0)),_=O}u=d.length;if(u){n=d[d.length-1];this.nextAudioPts=m=_+s*n.duration;i=C/a,n=m/a,u={data1:h?new Uint8Array(0):Mi.moof(t.sequenceNumber++,C/s,et({},t,{samples:d})),data2:w,startPTS:i,endPTS:n,startDTS:i,endDTS:n,type:"audio",hasAudio:!0,hasVideo:!(t.samples=[]),nb:u};return this.isAudioContiguous=!0,u}},_.remuxEmptyAudio=function(t,e,r,i){var n=t.inputTimeScale,a=n/(t.samplerate||n),s=this.nextAudioPts,o=this._initDTS,o=9e4*o.baseTime/o.timescale,l=(null!==s?s:i.startDTS*n)+o,o=i.endDTS*n+o,u=1024*a,h=Math.ceil((o-l)/u),d=xi.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(at.warn("[mp4-remuxer]: remux empty Audio"),d){for(var c=[],f=0;f<h;f++){var g=l+f*u;c.push({unit:d,pts:g,dts:g})}return t.samples=c,this.remuxAudio(t,e,r,!1)}at.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},Hi);function Hi(t,e,r,i){var n;this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=e,this.typeSupported=r,this.ISGenerated=!1,null===Gi&&(n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i),Gi=n?parseInt(n[1]):0),null===Ki&&(n=navigator.userAgent.match(/Safari\/(\d+)/i),Ki=n?parseInt(n[1]):0)}function Vi(t,e){var r;if(null===e)return t;for(r=e<t?-8589934592:8589934592;4294967296<Math.abs(t-e);)t+=r;return t}function Yi(t,e,r,i){var n=t.samples.length;if(n){for(var a=t.inputTimeScale,s=0;s<n;s++){var o=t.samples[s];o.pts=Vi(o.pts-r.baseTime*a/r.timescale,e*a)/a,o.dts=Vi(o.dts-i.baseTime*a/i.timescale,e*a)/a}var l=t.samples;return t.samples=[],{samples:l}}}function Wi(t,e,r){var i=t.samples.length;if(i){for(var n=t.inputTimeScale,a=0;a<i;a++){var s=t.samples[a];s.pts=Vi(s.pts-9e4*r.baseTime/r.timescale,e*n)/n}t.samples.sort(function(t,e){return t.pts-e.pts});var o=t.samples;return t.samples=[],{samples:o}}}var ji,qi=function(t,e,r,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=r,this.cts=i,this.flags=new Xi(t)},Xi=function(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1},zi=((Wn=Qi.prototype).destroy=function(){},Wn.resetTimeStamp=function(t){this.initPTS=t,this.lastEndTime=null},Wn.resetNextTimestamp=function(){this.lastEndTime=null},Wn.resetInitSegment=function(t,e,r,n){this.audioCodec=e,this.videoCodec=r,this.generateInitSegment(function(t){if(!t||!n)return t;var i=n.keyId;return i&&n.isCommonEncryption&&Dt(t,["moov","trak"]).forEach(function(t){var e=Dt(t,["mdia","minf","stbl","stsd"])[0].subarray(8),t=Dt(e,["enca"]),r=0<t.length;r||(t=Dt(e,["encv"])),t.forEach(function(t){Dt(r?t.subarray(28):t.subarray(78),["sinf"]).forEach(function(t){var e=wt(t);e&&((t=e.subarray(8,24)).some(function(t){return 0!==t})||(at.log("[eme] Patching keyId in 'enc"+(r?"a":"v")+">sinf>>tenc' box: "+yt(t)+" -> "+yt(i)),e.set(i,8)))})})}),t}(t)),this.emitInitSegment=!0},Wn.generateInitSegment=function(t){var e=this.audioCodec,r=this.videoCodec;if(null==t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=It(t),e=e||$i(i.audio,I),r=r||$i(i.video,w),n={};i.audio&&i.video?n.audiovideo={container:"video/mp4",codec:e+","+r,initSegment:t,id:"main"}:i.audio?n.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:i.video?n.video={container:"video/mp4",codec:r,initSegment:t,id:"main"}:at.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n},Wn.remux=function(t,e,r,i,n,a){var s=this.initPTS,o=this.lastEndTime,l={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};G(o)||(o=this.lastEndTime=n||0);var u=e.samples;if(null==u||!u.length)return l;var h={initPTS:void 0,timescale:1},d=this.initData;if(null!=d&&d.length||(this.generateInitSegment(u),d=this.initData),null==d||!d.length)return at.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),l;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);var c,f=function(t,e){for(var r=0,i=0,n=0,a=Dt(t,["moof","traf"]),s=0;s<a.length;s++){var o=a[s],l=Dt(o,["tfhd"])[0],u=e[At(l,4)];if(u){var h=u.default,d=At(l,0)|(null==h?void 0:h.flags),c=null==h?void 0:h.duration;8&d&&(c=At(l,2&d?12:8));for(var f=u.timescale||9e4,g=Dt(o,["trun"]),m=0;m<g.length;m++)!(r=function(t){var e=At(t,0),r=8;1&e&&(r+=4),4&e&&(r+=4);for(var i=0,n=At(t,4),a=0;a<n;a++)256&e&&(i+=At(t,r),r+=4),512&e&&(r+=4),1024&e&&(r+=4),2048&e&&(r+=4);return i}(g[m]))&&c&&(r=c*At(g[m],4)),u.type===w?i+=r/f:u.type===I&&(n+=r/f)}}if(0!==i||0!==n)return i||n;for(var v=0,p=Dt(t,["sidx"]),y=0;y<p.length;y++){var T=function(t){var e=[],r=t[0],i=8,n=At(t,i);i+=4,i+=0===r?8:16,i+=2;var a=t.length+0,s=Rt(t,i);i+=2;for(var o=0;o<s;o++){var l=i,u=At(t,l);l+=4;var h=2147483647&u;if(1==(2147483648&u)>>>31)return at.warn("SIDX has hierarchical references (not supported)"),null;u=At(t,l);l+=4,e.push({referenceSize:h,subsegmentDuration:u,info:{duration:u/n,start:a,end:a+h-1}}),a+=h,i=l+=4}return{earliestPresentationTime:0,timescale:n,version:r,referencesCount:s,references:e}}(p[y]);null!=T&&T.references&&(v+=T.references.reduce(function(t,e){return t+e.info.duration||0},0))}return v}(u,d),e=(c=d,Dt(u,["moof","traf"]).reduce(function(t,e){var i=Dt(e,["tfdt"])[0],n=i[0],e=Dt(e,["tfhd"]).reduce(function(t,e){var r=At(e,4),e=c[r];if(e){r=At(i,4);if(1===n){if(r===Tt)return at.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;r*=1+Tt,r+=At(i,8)}e=r/(e.timescale||9e4);if(isFinite(e)&&(null===t||e<t))return e}return t},null);return null!==e&&isFinite(e)&&(null===t||e<t)?e:t},null)),e=null===e?n:e;(function(t,e,r){if(null===t)return 1;var i=Math.max(f,1),t=e-t.baseTime/t.timescale;return Math.abs(t-r)>i}(s,e,n)||h.timescale!==s.timescale&&a)&&(h.initPTS=e-n,s&&1===s.timescale&&at.warn("Adjusting initPTS by "+(h.initPTS-s.baseTime)),this.initPTS=s={baseTime:h.initPTS,timescale:1});var g,m,a=t?e-s.baseTime/s.timescale:o,t=a+f;g=d,m=s.baseTime/s.timescale,Dt(u,["moof","traf"]).forEach(function(e){Dt(e,["tfhd"]).forEach(function(t){var i,t=At(t,4),t=g[t];t&&(i=t.timescale||9e4,Dt(e,["tfdt"]).forEach(function(t){var e=t[0],r=At(t,4);0===e?(r-=m*i,bt(t,4,r=Math.max(r,0))):(r*=Math.pow(2,32),r+=At(t,8),r-=m*i,r=Math.max(r,0),e=Math.floor(r/(1+Tt)),r=Math.floor(r%(1+Tt)),bt(t,4,e),bt(t,8,r))}))})}),0<f?this.lastEndTime=t:(at.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());e=!!d.audio,o=!!d.video,d="";e&&(d+="audio"),o&&(d+="video");o={data1:u,startPTS:a,startDTS:a,endPTS:t,endDTS:t,type:d,hasAudio:e,hasVideo:o,nb:1,dropped:0};return l.audio="audio"===o.type?o:void 0,l.video="audio"!==o.type?o:void 0,l.initSegment=h,l.id3=Yi(r,n,s,s),i.samples.length&&(l.text=Wi(i,n,s)),l},Qi);function Qi(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}function $i(t,e){t=null==t?void 0:t.codec;return t&&4<t.length?t:"hvc1"===t||"hev1"===t?"hvc1.1.6.L120.90":"av01"===t?"av01.0.04M.08":"avc1"===t||e===w?"avc1.42e01e":"mp4a.40.5"}try{ji=self.performance.now.bind(self.performance)}catch(t){at.debug("Unable to use Performance API on this environment"),ji="undefined"!=typeof self&&self.Date.now}var Ji=[{demux:di,remux:zi},{demux:ki,remux:Tr},{demux:ui,remux:Tr},{demux:Pi,remux:Tr}],Zi=((t=en.prototype).configure=function(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()},t.push=function(t,e,r,i){var n=this,a=r.transmuxing;a.executeStart=ji();var s=new Uint8Array(t),o=this.currentTransmuxState,l=this.transmuxConfig;i&&(this.currentTransmuxState=i);var u=i||o,h=u.contiguous,d=u.discontinuity,c=u.trackSwitch,f=u.accurateTimeOffset,g=u.timeOffset,m=u.initSegmentChange,v=l.audioCodec,t=l.videoCodec,i=l.defaultInitPts,o=l.duration,u=l.initSegmentData,l=(l=null,0<s.byteLength&&null!=e&&null!=e.key&&null!==e.iv&&null!=e.method&&(l=e),l);if(l&&"AES-128"===l.method){var p=this.getDecrypter();if(!p.isSync())return this.decryptionPromise=p.webCryptoDecrypt(s,l.key.buffer,l.iv.buffer).then(function(t){t=n.push(t,null,r);return n.decryptionPromise=null,t}),this.decryptionPromise;var y=p.softwareDecrypt(s,l.key.buffer,l.iv.buffer);if(-1<r.part&&(y=p.flush()),!y)return a.executeEnd=ji(),tn(r);s=new Uint8Array(y)}p=this.needsProbing(d,c);if(p){y=this.configureTransmuxer(s);if(y)return at.warn("[transmuxer] "+y.message),this.observer.emit(rt.ERROR,rt.ERROR,{type:it.MEDIA_ERROR,details:nt.FRAG_PARSING_ERROR,fatal:!1,error:y,reason:y.message}),a.executeEnd=ji(),tn(r)}(d||c||m||p)&&this.resetInitSegment(u,v,t,o,e),(d||m||p)&&this.resetInitialTimestamp(i),h||this.resetContiguity();g=this.transmux(s,l,g,f,r),f=this.currentTransmuxState;return f.contiguous=!0,f.discontinuity=!1,f.trackSwitch=!1,a.executeEnd=ji(),g},t.flush=function(e){var r=this,t=e.transmuxing;t.executeStart=ji();var i=this.decrypter,n=this.currentTransmuxState,a=this.decryptionPromise;if(a)return a.then(function(){return r.flush(e)});var s=[],n=n.timeOffset;!i||(o=i.flush())&&s.push(this.push(o,null,e));var i=this.demuxer,o=this.remuxer;if(!i||!o)return t.executeEnd=ji(),[tn(e)];n=i.flush(n);return rn(n)?n.then(function(t){return r.flushRemux(s,t,e),s}):(this.flushRemux(s,n,e),s)},t.flushRemux=function(t,e,r){var i=e.audioTrack,n=e.videoTrack,a=e.id3Track,s=e.textTrack,o=this.currentTransmuxState,e=o.accurateTimeOffset,o=o.timeOffset;at.log("[transmuxer.ts]: Flushed fragment "+r.sn+(-1<r.part?" p: "+r.part:"")+" of level "+r.level);e=this.remuxer.remux(i,n,a,s,o,e,!0,this.id);t.push({remuxResult:e,chunkMeta:r}),r.transmuxing.executeEnd=ji()},t.resetInitialTimestamp=function(t){var e=this.demuxer,r=this.remuxer;e&&r&&(e.resetTimeStamp(t),r.resetTimeStamp(t))},t.resetContiguity=function(){var t=this.demuxer,e=this.remuxer;t&&e&&(t.resetContiguity(),e.resetNextTimestamp())},t.resetInitSegment=function(t,e,r,i,n){var a=this.demuxer,s=this.remuxer;a&&s&&(a.resetInitSegment(t,e,r,i),s.resetInitSegment(t,e,r,n))},t.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},t.transmux=function(t,e,r,i,n){return e&&"SAMPLE-AES"===e.method?this.transmuxSampleAes(t,e,r,i,n):this.transmuxUnencrypted(t,r,i,n)},t.transmuxUnencrypted=function(t,e,r,i){var n=this.demuxer.demux(t,e,!1,!this.config.progressive),a=n.audioTrack,s=n.videoTrack,t=n.id3Track,n=n.textTrack;return{remuxResult:this.remuxer.remux(a,s,t,n,e,r,!1,this.id),chunkMeta:i}},t.transmuxSampleAes=function(t,e,r,i,n){var a=this;return this.demuxer.demuxSampleAes(t,e,r).then(function(t){return{remuxResult:a.remuxer.remux(t.audioTrack,t.videoTrack,t.id3Track,t.textTrack,r,i,!1,a.id),chunkMeta:n}})},t.configureTransmuxer=function(t){for(var e,r=this.config,i=this.observer,n=this.typeSupported,a=this.vendor,s=0,o=Ji.length;s<o;s++)if(Ji[s].demux.probe(t)){e=Ji[s];break}if(!e)return new Error("Failed to find demuxer by probing fragment data");var l=this.demuxer,u=this.remuxer,h=e.remux,d=e.demux;u&&u instanceof h||(this.remuxer=new h(i,r,n,a)),l&&l instanceof d||(this.demuxer=new d(i,r,n),this.probe=d.probe)},t.needsProbing=function(t,e){return!this.demuxer||!this.remuxer||t||e},t.getDecrypter=function(){return this.decrypter||(this.decrypter=new xr(this.config))},en),tn=function(t){return{remuxResult:{},chunkMeta:t}};function en(t,e,r,i,n){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=r,this.vendor=i,this.id=n}function rn(t){return"then"in t&&t.then instanceof Function}function nn(t,e,r,i,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=r,this.duration=i,this.defaultInitPts=n||null}function an(t,e,r,i,n,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=n,this.initSegmentChange=a}var sn,on,ln={exports:{}};function un(){}function hn(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function dn(t,e,r,i,n){if("function"!=typeof r)throw new TypeError("The listener must be a function");n=new hn(r,i||t,n),e=on?on+e:e;return t._events[e]?t._events[e].fn?t._events[e]=[t._events[e],n]:t._events[e].push(n):(t._events[e]=n,t._eventsCount++),t}function cn(t,e){0==--t._eventsCount?t._events=new un:delete t._events[e]}function fn(){this._events=new un,this._eventsCount=0}Un=ln,sn=Object.prototype.hasOwnProperty,on="~",Object.create&&(un.prototype=Object.create(null),(new un).__proto__||(on=!1)),fn.prototype.eventNames=function(){var t,e,r=[];if(0===this._eventsCount)return r;for(e in t=this._events)sn.call(t,e)&&r.push(on?e.slice(1):e);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},fn.prototype.listeners=function(t){var t=on?on+t:t,e=this._events[t];if(!e)return[];if(e.fn)return[e.fn];for(var r=0,i=e.length,n=new Array(i);r<i;r++)n[r]=e[r].fn;return n},fn.prototype.listenerCount=function(t){t=on?on+t:t,t=this._events[t];return t?t.fn?1:t.length:0},fn.prototype.emit=function(t,e,r,i,n,a){var s=on?on+t:t;if(!this._events[s])return!1;var o,l=this._events[s],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,r),!0;case 4:return l.fn.call(l.context,e,r,i),!0;case 5:return l.fn.call(l.context,e,r,i,n),!0;case 6:return l.fn.call(l.context,e,r,i,n,a),!0}for(c=1,o=new Array(u-1);c<u;c++)o[c-1]=arguments[c];l.fn.apply(l.context,o)}else for(var h,d=l.length,c=0;c<d;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),u){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,e);break;case 3:l[c].fn.call(l[c].context,e,r);break;case 4:l[c].fn.call(l[c].context,e,r,i);break;default:if(!o)for(h=1,o=new Array(u-1);h<u;h++)o[h-1]=arguments[h];l[c].fn.apply(l[c].context,o)}return!0},fn.prototype.on=function(t,e,r){return dn(this,t,e,r,!1)},fn.prototype.once=function(t,e,r){return dn(this,t,e,r,!0)},fn.prototype.removeListener=function(t,e,r,i){t=on?on+t:t;if(!this._events[t])return this;if(!e)return cn(this,t),this;var n=this._events[t];if(n.fn)n.fn!==e||i&&!n.once||r&&n.context!==r||cn(this,t);else{for(var a=0,s=[],o=n.length;a<o;a++)(n[a].fn!==e||i&&!n[a].once||r&&n[a].context!==r)&&s.push(n[a]);s.length?this._events[t]=1===s.length?s[0]:s:cn(this,t)}return this},fn.prototype.removeAllListeners=function(t){return t?(t=on?on+t:t,this._events[t]&&cn(this,t)):(this._events=new un,this._eventsCount=0),this},fn.prototype.off=fn.prototype.removeListener,fn.prototype.addListener=fn.prototype.on,fn.prefixed=on,fn.EventEmitter=fn,Un.exports=fn;var gn,mn,vn,pn=(gn=ln.exports)&&gn.__esModule&&Object.prototype.hasOwnProperty.call(gn,"default")?gn.default:gn;function yn(t,e){if(!((n=e.remuxResult).audio||n.video||n.text||n.id3||n.initSegment))return!1;var r=[],i=e.remuxResult,n=i.audio,i=i.video;return n&&Tn(r,n),i&&Tn(r,i),t.postMessage({event:"transmuxComplete",data:e},r),!0}function Tn(t,e){e.data1&&t.push(e.data1.buffer),e.data2&&t.push(e.data2.buffer)}function En(r,t,e){t.reduce(function(t,e){return yn(r,e)||t},!1)||r.postMessage({event:"transmuxComplete",data:t[0]}),r.postMessage({event:"flush",data:e})}function Sn(t,e){mn.postMessage({event:t,data:e})}function Ln(){for(var t in at)!function(e){at[e]=function(t){Sn("workerLog",{logType:e,message:t})}}(t)}void 0!==Ls&&Ls&&(mn=self,(vn=new pn).on(rt.FRAG_DECRYPTED,Sn),vn.on(rt.ERROR,Sn),mn.addEventListener("message",function(t){var e=t.data;switch(e.cmd){case"init":var r=JSON.parse(e.config);mn.transmuxer=new Zi(vn,e.typeSupported,r,e.vendor,e.id),L(r.debug,e.id),Ln(),Sn("init",null);break;case"configure":mn.transmuxer.configure(e.config);break;case"demux":var i=mn.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);rn(i)?(mn.transmuxer.async=!0,i.then(function(t){yn(mn,t)}).catch(function(t){Sn(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.FRAG_PARSING_ERROR,chunkMeta:e.chunkMeta,fatal:!1,error:t,err:t,reason:"transmuxer-worker push error"})})):(mn.transmuxer.async=!1,yn(mn,i));break;case"flush":var n=e.chunkMeta,i=mn.transmuxer.flush(n);rn(i)||mn.transmuxer.async?(rn(i)||(i=Promise.resolve(i)),i.then(function(t){En(mn,t,n)}).catch(function(t){Sn(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.FRAG_PARSING_ERROR,chunkMeta:e.chunkMeta,fatal:!1,error:t,err:t,reason:"transmuxer-worker flush error"})})):En(mn,i,n)}}));var Rn=Kt()||{isTypeSupported:function(){return!1}},An=((Zr=Mn.prototype).resetWorker=function(){var t,e;this.workerContext&&(t=(e=this.workerContext).worker,(e=e.objectURL)&&self.URL.revokeObjectURL(e),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null)},Zr.destroy=function(){this.workerContext?(this.resetWorker(),this.onwmsg=void 0):(t=this.transmuxer)&&(t.destroy(),this.transmuxer=null);var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},Zr.push=function(t,e,r,i,n,a,s,o,l,u){var h=this;l.transmuxing.start=self.performance.now();var d=this.transmuxer,c=(a||n).start,f=n.decryptdata,g=this.frag,m=!(g&&n.cc===g.cc),v=!(g&&l.level===g.level),p=g?l.sn-g.sn:-1,y=this.part?l.part-this.part.index:-1,T=0==p&&1<l.id&&l.id===(null==g?void 0:g.stats.chunkCount),E=!v&&(1==p||0==p&&(1==y||T&&y<=0)),T=self.performance.now();(v||p||0===n.stats.parsing.start)&&(n.stats.parsing.start=T),!a||!y&&E||(a.stats.parsing.start=T);var g=!(g&&(null==(S=n.initSegment)?void 0:S.url)===(null==(S=g.initSegment)?void 0:S.url)),S=new an(m,E,o,v,c,g);E&&!m&&!g||(at.log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+"\n        discontinuity: "+m+"\n        trackSwitch: "+v+"\n        contiguous: "+E+"\n        accurateTimeOffset: "+o+"\n        timeOffset: "+c+"\n        initSegmentChange: "+g),u=new nn(r,i,e,s,u),this.configureTransmuxer(u)),this.frag=n,this.part=a,this.workerContext?this.workerContext.worker.postMessage({cmd:"demux",data:t,decryptdata:f,chunkMeta:l,state:S},t instanceof ArrayBuffer?[t]:[]):d&&(rn(S=d.push(t,f,l,S))?(d.async=!0,S.then(function(t){h.handleTransmuxComplete(t)}).catch(function(t){h.transmuxerError(t,l,"transmuxer-interface push error")})):(d.async=!1,this.handleTransmuxComplete(S)))},Zr.flush=function(e){var r=this;e.transmuxing.start=self.performance.now();var t,i=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e}):i&&(rn(t=i.flush(e))||i.async?(rn(t)||(t=Promise.resolve(t)),t.then(function(t){r.handleFlushResult(t,e)}).catch(function(t){r.transmuxerError(t,e,"transmuxer-interface flush error")})):this.handleFlushResult(t,e))},Zr.transmuxerError=function(t,e,r){this.hls&&(this.error=t,this.hls.trigger(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.FRAG_PARSING_ERROR,chunkMeta:e,fatal:!1,error:t,err:t,reason:r}))},Zr.handleFlushResult=function(t,e){var r=this;t.forEach(function(t){r.handleTransmuxComplete(t)}),this.onFlush(e)},Zr.onWorkerMessage=function(t){var e=t.data,r=this.hls;switch(e.event){case"init":var i=null==(i=this.workerContext)?void 0:i.objectURL;i&&self.URL.revokeObjectURL(i);break;case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;case"workerLog":at[e.data.logType]&&at[e.data.logType](e.data.message);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,r.trigger(e.event,e.data)}},Zr.configureTransmuxer=function(t){var e=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:t}):e&&e.configure(t)},Zr.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},Mn),kn=((_=Fn.prototype).destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},_.poll=function(t,e){var r=this.config,i=this.media,n=this.stalled;if(null!==i){var a=i.currentTime,s=i.seeking,o=this.seeking&&!s,l=!this.seeking&&s;if(this.seeking=s,a===t){if(l||o)this.stalled=null;else if(!(i.paused&&!s||i.ended||0===i.playbackRate)&&Sr.getBuffered(i).length){t=Sr.bufferInfo(i,a,0),l=0<t.len,o=t.nextStart||0;if(l||o){if(s){l=2<t.len,e=!o||e&&e.start<=a||2<o-a&&!this.fragmentTracker.getPartialFragment(a);if(l||e)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var o=Math.max(o,t.start||0)-a,u=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,h=null!=u&&null!=(h=u.details)&&h.live?2*u.details.targetduration:2,u=this.fragmentTracker.getPartialFragment(a);if(0<o&&(o<=h||u))return void this._trySkipBufferHole(u)}h=self.performance.now();null!==n?(u=h-n,!s&&250<=u&&(this._reportStall(t),!this.media)||(r=Sr.bufferInfo(i,a,r.maxBufferHole),this._tryFixBufferStall(r,u))):this.stalled=h}}}else this.moved=!0,null!==n&&(this.stallReported&&(n=self.performance.now()-n,at.warn("playback not stuck anymore @"+a+", after "+Math.round(n)+"ms"),this.stallReported=!1),this.stalled=null,this.nudgeRetry=0)}},_._tryFixBufferStall=function(t,e){var r=this.config,i=this.fragmentTracker,n=this.media;null!==n&&(n=n.currentTime,(!(i=i.getPartialFragment(n))||!this._trySkipBufferHole(i)&&this.media)&&(t.len>r.maxBufferHole||t.nextStart&&t.nextStart-n<r.maxBufferHole)&&e>1e3*r.highBufferWatchdogPeriod&&(at.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer()))},_._reportStall=function(t){var e=this.hls,r=this.media;!this.stallReported&&r&&(this.stallReported=!0,r=new Error("Playback stalling at @"+r.currentTime+" due to low buffer ("+JSON.stringify(t)+")"),at.warn(r.message),e.trigger(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:t.len}))},_._trySkipBufferHole=function(t){var e=this.config,r=this.hls,i=this.media;if(null===i)return 0;var n=i.currentTime,a=Sr.bufferInfo(i,n,0),s=n<a.start?a.start:a.nextStart;if(s){var o=a.len<=e.maxBufferHole,l=0<a.len&&a.len<1&&i.readyState<3,a=s-n;if(0<a&&(o||l)){if(a>e.maxBufferHole){var u=this.fragmentTracker,a=!1;if(0!==n||(e=u.getAppendedFrag(0,le))&&s<e.end&&(a=!0),!a){var h=t||u.getAppendedFrag(n,le);if(h){for(var d=!1,c=h.end;c<s;){var f=u.getPartialFragment(c);if(!f){d=!0;break}c+=f.duration}if(d)return 0}}}h=Math.max(s+.05,n+.1);return at.warn("skipping hole, adjusting currentTime from "+n+" to "+h),this.moved=!0,this.stalled=null,i.currentTime=h,t&&!t.gap&&(n=new Error("fragment loaded with buffer holes, seeking from "+n+" to "+h),r.trigger(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:n,reason:n.message,frag:t})),h}}return 0},_._tryNudgeBuffer=function(){var t,e,r=this.config,i=this.hls,n=this.media,a=this.nudgeRetry;null!==n&&(t=n.currentTime,this.nudgeRetry++,a<r.nudgeMaxRetry?(e=t+(a+1)*r.nudgeOffset,a=new Error("Nudging 'currentTime' from "+t+" to "+e),at.warn(a.message),n.currentTime=e,i.trigger(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})):(r=new Error("Playhead still not moving while enough data buffered @"+t+" after "+r.nudgeMaxRetry+" nudges"),at.error(r.message),i.trigger(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.BUFFER_STALLED_ERROR,error:r,fatal:!0})))},Fn),bn=function(n){function t(t,e,r){return(r=n.call(this,t,e,r,"[stream-controller]",le)||this).audioCodecSwap=!1,r.gapController=null,r.level=-1,r._forceStartLoad=!1,r.altAudio=!1,r.audioOnly=!1,r.fragPlaying=null,r.onvplaying=null,r.onvseeked=null,r.fragLastKbps=0,r.couldBacktrack=!1,r.backtrackFragment=null,r.audioCodecSwitch=!1,r.videoBuffer=null,r._registerListeners(),r}l(t,n);var e=t.prototype;return e._registerListeners=function(){var t=this.hls;t.on(rt.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(rt.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.on(rt.MANIFEST_PARSED,this.onManifestParsed,this),t.on(rt.LEVEL_LOADING,this.onLevelLoading,this),t.on(rt.LEVEL_LOADED,this.onLevelLoaded,this),t.on(rt.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(rt.ERROR,this.onError,this),t.on(rt.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(rt.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(rt.BUFFER_CREATED,this.onBufferCreated,this),t.on(rt.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(rt.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(rt.FRAG_BUFFERED,this.onFragBuffered,this)},e._unregisterListeners=function(){var t=this.hls;t.off(rt.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(rt.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.off(rt.MANIFEST_PARSED,this.onManifestParsed,this),t.off(rt.LEVEL_LOADED,this.onLevelLoaded,this),t.off(rt.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(rt.ERROR,this.onError,this),t.off(rt.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(rt.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(rt.BUFFER_CREATED,this.onBufferCreated,this),t.off(rt.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(rt.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(rt.FRAG_BUFFERED,this.onFragBuffered,this)},e.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},e.startLoad=function(t){var e,r,i;this.levels?(e=this.lastCurrentTime,r=this.hls,this.stopLoad(),this.setInterval(100),this.level=-1,this.startFragRequested||(-1===(i=r.startLevel)&&(r.config.testBandwidth&&1<this.levels.length?(i=0,this.bitrateTest=!0):i=r.nextAutoLevel),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1),0<e&&-1===t&&(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=Mr,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()):(this._forceStartLoad=!0,this.state=Fr)},e.stopLoad=function(){this._forceStartLoad=!1,n.prototype.stopLoad.call(this)},e.doTick=function(){switch(this.state){case Wr:var t=this.levels,e=this.level,e=null==t||null==(r=t[e])?void 0:r.details;if(e&&(!e.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(e))break;this.state=Mr;break}if(this.hls.nextLoadLevel===this.level)break;this.state=Mr;break;case Ur:var r=self.performance.now(),e=this.retryDate;(!e||e<=r||null!=(r=this.media)&&r.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=Mr)}this.state===Mr&&this.doTickIdle(),this.onTickEnd()},e.onTickEnd=function(){n.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},e.doTickIdle=function(){var t=this.hls,e=this.levelLastLoaded,r=this.levels,i=this.media,n=t.config,a=t.nextLoadLevel;if(null!==e&&(i||!this.startFragRequested&&n.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&null!=r&&r[a]){i=r[a],n=this.getMainFwdBufferInfo();if(null!==n){r=this.getLevelDetails();if(r&&this._streamEnded(n,r)){var s={};return this.altAudio&&(s.type="video"),this.hls.trigger(rt.BUFFER_EOS,s),void(this.state=Hr)}t.loadLevel!==a&&-1===t.manualLevel&&this.log("Adapting to level "+a+" from level "+this.level),this.level=t.nextLoadLevel=a;r=i.details;if(!r||this.state===Wr||r.live&&this.levelLastLoaded!==a)return this.level=a,void(this.state=Wr);var o,l,s=n.len,t=this.getMaxBufferLength(i.maxBitrate);t<=s||(this.backtrackFragment&&this.backtrackFragment.start>n.end&&(this.backtrackFragment=null),a=this.backtrackFragment?this.backtrackFragment.start:n.end,s=this.getNextFragment(a,r),this.couldBacktrack&&!this.fragPrevious&&s&&"initSegment"!==s.sn&&this.fragmentTracker.getState(s)!==ar?(o=(null!=(l=this.backtrackFragment)?l:s).sn-r.startSN,(l=r.fragments[o-1])&&s.cc===l.cc&&(s=l,this.fragmentTracker.removeFragment(l))):this.backtrackFragment&&n.len&&(this.backtrackFragment=null),s&&this.isLoopLoading(s,a)&&(s.gap||(l=((o=this.audioOnly&&!this.altAudio?I:w)==w?this.videoBuffer:this.mediaBuffer)||this.media)&&this.afterBufferFlushed(l,o,le),s=this.getNextFragmentLoopLoading(s,r,n,le,t)),s&&(!s.initSegment||s.initSegment.data||this.bitrateTest||(s=s.initSegment),this.loadFragment(s,i,a)))}}},e.loadFragment=function(t,e,r){var i=this.fragmentTracker.getState(t);this.fragCurrent=t,i===rr||i===nr?"initSegment"===t.sn?this._loadInitSegment(t,e):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,e)):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,t,e,r)):this.clearTrackerIfNeeded(t)},e.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,le)},e.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},e.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},e.nextLevelSwitch=function(){var t=this.levels,e=this.media;if(null!=e&&e.readyState){var r=this.getAppendedFrag(e.currentTime);r&&1<r.start&&this.flushMainBuffer(0,r.start-1);var i=this.getLevelDetails();if(null!=i&&i.live){r=this.getMainFwdBufferInfo();if(!r||r.len<2*i.targetduration)return}n=!e.paused&&t?(n=t[this.hls.nextLoadLevel],(a=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*n.maxBitrate/(1e3*a)+1:0):0;var n,a=this.getBufferedFrag(e.currentTime+n);!a||(e=this.followingBufferedFrag(a))&&(this.abortCurrentFrag(),n=e.maxStartPTS||e.start,e=e.duration,e=Math.max(a.end,n+Math.min(Math.max(e-this.config.maxFragLookUpTolerance,.5*e),.75*e)),this.flushMainBuffer(e,Number.POSITIVE_INFINITY))}},e.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case Or:case Nr:case Ur:case Gr:case Kr:this.state=Mr}this.nextLoadPosition=this.getLoadPosition()},e.flushMainBuffer=function(t,e){n.prototype.flushMainBuffer.call(this,t,e,this.altAudio?"video":null)},e.onMediaAttached=function(t,e){n.prototype.onMediaAttached.call(this,t,e);e=e.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),e.addEventListener("playing",this.onvplaying),e.addEventListener("seeked",this.onvseeked),this.gapController=new kn(this.config,e,this.fragmentTracker,this.hls)},e.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),n.prototype.onMediaDetaching.call(this)},e.onMediaPlaying=function(){this.tick()},e.onMediaSeeked=function(){var t=this.media,t=t?t.currentTime:null;G(t)&&this.log("Media seeked to "+t.toFixed(3));t=this.getMainFwdBufferInfo();null!==t&&0!==t.len?this.tick():this.warn('Main forward buffer length on "seeked" event '+(t?t.len:"empty")+")")},e.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(rt.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1},e.onManifestParsed=function(t,e){var r,i,n,a=!1,s=!1;e.levels.forEach(function(t){(r=t.audioCodec)&&(-1!==r.indexOf("mp4a.40.2")&&(a=!0),-1!==r.indexOf("mp4a.40.5")&&(s=!0))}),this.audioCodecSwitch=a&&s&&!("function"==typeof(null==(n=$r())||null==(i=n.prototype)?void 0:i.changeType)),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1},e.onLevelLoading=function(t,e){var r=this.levels;!r||this.state!==Mr||(!(r=r[e.level]).details||r.details.live&&this.levelLastLoaded!==e.level||this.waitForCdnTuneIn(r.details))&&(this.state=Wr)},e.onLevelLoaded=function(t,e){var r=this.levels,i=e.level,n=e.details,a=n.totalduration;if(r){this.log("Level "+i+" loaded ["+n.startSN+","+n.endSN+"]"+(n.lastPartSn?"[part-"+n.lastPartSn+"-"+n.lastPartIndex+"]":"")+", cc ["+n.startCC+", "+n.endCC+"] duration:"+a);var a=r[i],r=this.fragCurrent;!r||this.state!==Nr&&this.state!==Ur||r.level===e.level&&r.urlId===a.urlId||!r.loader||this.abortCurrentFrag();e=0;if(n.live||null!=(r=a.details)&&r.live){if(n.fragments[0]||(n.deltaUpdateFailed=!0),n.deltaUpdateFailed)return;e=this.alignPlaylists(n,a.details)}if(a.details=n,this.levelLastLoaded=i,this.hls.trigger(rt.LEVEL_UPDATED,{details:n,level:i}),this.state===Wr){if(this.waitForCdnTuneIn(n))return;this.state=Mr}this.startFragRequested?n.live&&this.synchronizeToLiveEdge(n):this.setStartPosition(n,e),this.tick()}else this.warn("Levels were reset while loading level "+i)},e._handleFragmentLoadProgress=function(t){var e=t.frag,r=t.part,i=t.payload,n=this.levels;if(n){var a=n[e.level],s=a.details;if(!s)return this.warn("Dropping fragment "+e.sn+" of level "+e.level+" after level details were reset"),void this.fragmentTracker.removeFragment(e);var o=a.videoCodec,l=s.PTSKnown||!s.live,u=null==(h=e.initSegment)?void 0:h.data,t=this._getAudioCodec(a),n=this.transmuxer=this.transmuxer||new An(this.hls,le,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),h=r?r.index:-1,a=-1!==h,h=new mr(e.level,e.sn,e.stats.chunkCount,i.byteLength,h,a),a=this.initPTS[e.cc];n.push(i,u,t,o,e,r,s.totalduration,l,h,a)}else this.warn("Levels were reset while fragment load was in progress. Fragment "+e.sn+" of level "+e.level+" will not be buffered")},e.onAudioTrackSwitching=function(t,e){var r,i=this.altAudio;e.url||(this.mediaBuffer!==this.media?(this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,(r=this.fragCurrent)&&(this.log("Switching to main audio track, cancel main fragment load"),r.abortRequests(),this.fragmentTracker.removeFragment(r)),this.resetTransmuxer(),this.resetLoadingState()):this.audioOnly&&this.resetTransmuxer(),r=this.hls,i&&(r.trigger(rt.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),r.trigger(rt.AUDIO_TRACK_SWITCHED,e))},e.onAudioTrackSwitched=function(t,e){var r=e.id,e=!!this.hls.audioTracks[r].url;!e||(r=this.videoBuffer)&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r),this.altAudio=e,this.tick()},e.onBufferCreated=function(t,e){var r,i=e.tracks,n=!1;for(r in i){var a,s,o,l=i[r];"main"===l.id?(o=l,"video"===(s=r)&&(a=i[r])&&(this.videoBuffer=a.buffer)):n=!0}n&&o?(this.log("Alternate track found, use "+s+".buffered to schedule main fragment loading"),this.mediaBuffer=o.buffer):this.mediaBuffer=this.media},e.onFragBuffered=function(t,e){var r=e.frag,i=e.part;if(!r||r.type===le){if(this.fragContextChanged(r))return this.warn("Fragment "+r.sn+(i?" p: "+i.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===Kr&&(this.state=Mr));e=(i||r).stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}},e.onError=function(t,e){var r;if(e.fatal)this.state=Vr;else switch(e.details){case nt.FRAG_GAP:case nt.FRAG_PARSING_ERROR:case nt.FRAG_DECRYPT_ERROR:case nt.FRAG_LOAD_ERROR:case nt.FRAG_LOAD_TIMEOUT:case nt.KEY_LOAD_ERROR:case nt.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(le,e);break;case nt.LEVEL_LOAD_ERROR:case nt.LEVEL_LOAD_TIMEOUT:case nt.LEVEL_PARSING_ERROR:e.levelRetry||this.state!==Wr||(null==(r=e.context)?void 0:r.type)!==ae||(this.state=Mr);break;case nt.BUFFER_FULL_ERROR:if(!e.parent||"main"!==e.parent)return;this.reduceLengthAndFlushBuffer(e)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case nt.INTERNAL_EXCEPTION:this.recoverWorkerError(e)}},e.checkBuffer=function(){var t,e=this.media,r=this.gapController;e&&r&&e.readyState&&(!this.loadedmetadata&&Sr.getBuffered(e).length||(t=this.state!==Mr?this.fragCurrent:null,r.poll(this.lastCurrentTime,t)),this.lastCurrentTime=e.currentTime)},e.onFragLoadEmergencyAborted=function(){this.state=Mr,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},e.onBufferFlushed=function(t,e){var r=e.type;(r!==I||this.audioOnly&&!this.altAudio)&&(e=(r===w?this.videoBuffer:this.mediaBuffer)||this.media,this.afterBufferFlushed(e,r,le))},e.onLevelsUpdated=function(t,e){this.levels=e.levels},e.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},e.seekToStartPos=function(){var t,e,r,i=this.media;i&&(t=i.currentTime,0<=(e=this.startPosition)&&t<e&&(i.seeking?this.log("could not seek to "+e+", already seeking at "+t):(0<(r=((r=Sr.getBuffered(i)).length?r.start(0):0)-e)&&(r<this.config.maxBufferHole||r<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+r+" to match buffer start"),e+=r,this.startPosition=e),this.log("seek to target start position "+e+" from current time "+t),i.currentTime=e)))},e._getAudioCodec=function(t){t=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t},e._loadBitrateTestFrag=function(i,n){var a=this;i.bitrateTest=!0,this._doFragLoad(i,n).then(function(t){var e,r=a.hls;t&&!a.fragContextChanged(i)&&(n.fragmentError=0,a.state=Mr,a.startFragRequested=!1,a.bitrateTest=!1,(e=i.stats).parsing.start=e.parsing.end=e.buffering.start=e.buffering.end=self.performance.now(),r.trigger(rt.FRAG_LOADED,t),i.bitrateTest=!1)})},e._handleTransmuxComplete=function(t){var e,r="main",i=this.hls,n=t.remuxResult,a=t.chunkMeta,s=this.getCurrentContext(a);if(s){var o=s.frag,l=s.part,u=s.level,h=n.video,d=n.text,c=n.id3,f=n.initSegment,t=u.details,s=this.altAudio?void 0:n.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=Gr,f&&(null!=f&&f.tracks&&(p=o.initSegment||o,this._bufferInitSegment(u,f.tracks,p,a),i.trigger(rt.FRAG_PARSING_INIT_SEGMENT,{frag:p,id:r,tracks:f.tracks})),g=f.initPTS,p=f.timescale,G(g)&&(this.initPTS[o.cc]={baseTime:g,timescale:p},i.trigger(rt.INIT_PTS_FOUND,{frag:o,id:r,initPTS:g,timescale:p}))),h&&!1!==n.independent){if(t){var f=h.startPTS,g=h.endPTS,m=h.startDTS,v=h.endDTS;if(l)l.elementaryStreams[h.type]={startPTS:f,endPTS:g,startDTS:m,endDTS:v};else if(h.firstKeyFrame&&h.independent&&1===a.id&&(this.couldBacktrack=!0),h.dropped&&h.independent){var p=this.getMainFwdBufferInfo();if((p?p.end:this.getLoadPosition())+this.config.maxBufferHole<(h.firstKeyFramePTS||f)-this.config.maxBufferHole)return void this.backtrack(o);o.setElementaryStreamInfo(h.type,o.start,g,o.start,v,!0)}o.setElementaryStreamInfo(h.type,f,g,m,v),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(h,o,l,a)}}else if(!1===n.independent)return void this.backtrack(o);s&&(m=s.startPTS,v=s.endPTS,h=s.startDTS,n=s.endDTS,l&&(l.elementaryStreams[I]={startPTS:m,endPTS:v,startDTS:h,endDTS:n}),o.setElementaryStreamInfo(I,m,v,h,n),this.bufferFragmentData(s,o,l,a)),t&&null!=c&&null!=(e=c.samples)&&e.length&&(c={id:r,frag:o,details:t,samples:c.samples},i.trigger(rt.FRAG_PARSING_METADATA,c)),t&&d&&(d={id:r,frag:o,details:t,samples:d.samples},i.trigger(rt.FRAG_PARSING_USERDATA,d))}}else this.resetWhenMissingContext(a)},e._bufferInitSegment=function(t,r,i,n){var e,a,s,o,l,u=this;this.state===Gr&&(this.audioOnly=!!r.audio&&!r.video,this.altAudio&&!this.audioOnly&&delete r.audio,e=r.audio,a=r.video,s=r.audiovideo,e&&(o=t.audioCodec,l=navigator.userAgent.toLowerCase(),this.audioCodecSwitch&&(o=o&&(-1!==o.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==e.metadata.channelCount&&-1===l.indexOf("firefox")&&(o="mp4a.40.5")),-1!==l.indexOf("android")&&"audio/mpeg"!==e.container&&(o="mp4a.40.2",this.log("Android: force audio codec to "+o)),t.audioCodec&&t.audioCodec!==o&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+o+'"'),e.levelCodec=o,e.id="main",this.log("Init audio buffer, container:"+e.container+", codecs[selected/level/parsed]=["+(o||"")+"/"+(t.audioCodec||"")+"/"+e.codec+"]")),a&&(a.levelCodec=t.videoCodec,a.id="main",this.log("Init video buffer, container:"+a.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+a.codec+"]")),s&&this.log("Init audiovideo buffer, container:"+s.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+s.codec+"]"),this.hls.trigger(rt.BUFFER_CODECS,r),Object.keys(r).forEach(function(t){var e=r[t].initSegment;null!=e&&e.byteLength&&u.hls.trigger(rt.BUFFER_APPENDING,{type:t,data:e,frag:i,part:null,chunkMeta:n,parent:i.type})}),this.tick())},e.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer||this.media,le)},e.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=Mr},e.checkFragmentChanged=function(){var t,e=this.media,r=null;e&&1<e.readyState&&!1===e.seeking&&(t=e.currentTime,Sr.isBuffered(e,t)?r=this.getAppendedFrag(t):Sr.isBuffered(e,t+.1)&&(r=this.getAppendedFrag(t+.1)),r&&(this.backtrackFragment=null,e=this.fragPlaying,t=r.level,e&&r.sn===e.sn&&e.level===t&&r.urlId===e.urlId||(this.fragPlaying=r,this.hls.trigger(rt.FRAG_CHANGED,{frag:r}),e&&e.level===t||this.hls.trigger(rt.LEVEL_SWITCHED,{level:t}))))},o(t,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var e=t.currentTime,t=this.currentFrag;if(t&&G(e)&&G(t.programDateTime)){t=t.programDateTime+1e3*(e-t.start);return new Date(t)}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),t}(jr),Dn=((Wn=xn.prototype).sample=function(t,e){var r=Math.pow(this.alpha_,t);this.estimate_=e*(1-r)+r*this.estimate_,this.totalWeight_+=t},Wn.getTotalWeight=function(){return this.totalWeight_},Wn.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_},xn),In=((di=Pn.prototype).update=function(t,e){var r=this.slow_,i=this.fast_,n=this.ttfb_;r.halfLife!==t&&(this.slow_=new Dn(t,r.getEstimate(),r.getTotalWeight())),i.halfLife!==e&&(this.fast_=new Dn(e,i.getEstimate(),i.getTotalWeight())),n.halfLife!==t&&(this.ttfb_=new Dn(t,n.getEstimate(),n.getTotalWeight()))},di.sample=function(t,e){t=(t=Math.max(t,this.minDelayMs_))/1e3,e=8*e/t;this.fast_.sample(t,e),this.slow_.sample(t,e)},di.sampleTTFB=function(t){var e=t/1e3,e=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(e,Math.max(t,5))},di.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},di.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},di.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},di.destroy=function(){},Pn),ki=((zi=_n.prototype).registerListeners=function(){var t=this.hls;t.on(rt.FRAG_LOADING,this.onFragLoading,this),t.on(rt.FRAG_LOADED,this.onFragLoaded,this),t.on(rt.FRAG_BUFFERED,this.onFragBuffered,this),t.on(rt.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(rt.LEVEL_LOADED,this.onLevelLoaded,this)},zi.unregisterListeners=function(){var t=this.hls;t.off(rt.FRAG_LOADING,this.onFragLoading,this),t.off(rt.FRAG_LOADED,this.onFragLoaded,this),t.off(rt.FRAG_BUFFERED,this.onFragBuffered,this),t.off(rt.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(rt.LEVEL_LOADED,this.onLevelLoaded,this)},zi.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},zi.onFragLoading=function(t,e){var r=e.frag;this.ignoreFragment(r)||(this.fragCurrent=r,this.partCurrent=null!=(e=e.part)?e:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))},zi.onLevelSwitching=function(t,e){this.clearTimer()},zi.getTimeToLoadFrag=function(t,e,r,i){return t+r/e+(i?this.lastLevelLoadSec:0)},zi.onLevelLoaded=function(t,e){var r=this.hls.config,i=e.stats,n=i.total,i=i.bwEstimate;G(n)&&G(i)&&(this.lastLevelLoadSec=8*n/i),e.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},zi._abandonRulesCheck=function(){var t=this.fragCurrent,e=this.partCurrent,r=this.hls,i=r.autoLevelEnabled,n=r.media;if(t&&n){var a=performance.now(),s=(e||t).stats,o=(e||t).duration,l=a-s.loading.start;if(s.aborted||s.loaded&&s.loaded===s.total||0===t.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(i&&!n.paused&&n.playbackRate&&n.readyState){var u=r.mainForwardBufferInfo;if(null!==u){var h=this.bwEstimator.getEstimateTTFB(),d=Math.abs(n.playbackRate);if(!(l<=Math.max(h,o/(2*d)*1e3))){var c=u.len/d;if(!(2*o/d<=c)){var a=s.loading.first?s.loading.first-s.loading.start:-1,i=s.loaded&&-1<a,n=this.bwEstimator.getEstimate(),f=r.levels,g=r.minAutoLevel,u=f[t.level],d=s.total||Math.max(s.loaded,Math.round(o*u.maxBitrate/8)),u=l-a;u<1&&i&&(u=Math.min(l,8*s.loaded/n));u=i?1e3*s.loaded/u:0,d=u?(d-s.loaded)/u:8*d/n+h/1e3;if(!(d<=c)){for(var m=u?8*u:n,v=Number.POSITIVE_INFINITY,p=t.level-1;g<p;p--){var y=f[p].maxBitrate;if((v=this.getTimeToLoadFrag(h/1e3,m,o*y,!f[p].details))<c)break}d<=v||10*o<v||(r.nextLoadLevel=p,i?this.bwEstimator.sample(l-Math.min(h,a),s.loaded):this.bwEstimator.sampleTTFB(l),this.clearTimer(),at.warn("[abr] Fragment "+t.sn+(e?" part "+e.index:"")+" of level "+t.level+" is loading too slowly;\n      Time to underbuffer: "+c.toFixed(3)+" s\n      Estimated load time for current fragment: "+d.toFixed(3)+" s\n      Estimated load time for down switch fragment: "+v.toFixed(3)+" s\n      TTFB estimate: "+a+"\n      Current BW estimate: "+(G(n)?(n/1024).toFixed(3):"Unknown")+" Kb/s\n      New BW estimate: "+(this.bwEstimator.getEstimate()/1024).toFixed(3)+" Kb/s\n      Aborting and switching to level "+p),t.loader&&(this.fragCurrent=this.partCurrent=null,t.abortRequests()),r.trigger(rt.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:s}))}}}}}}},zi.onFragLoaded=function(t,e){var r,i,n=e.frag,a=e.part,s=(a||n).stats;n.type===le&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),this.ignoreFragment(n)||(this.clearTimer(),this.lastLoadedFragLevel=n.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate&&(i=(a||n).duration,e=((r=this.hls.levels[n.level]).loaded?r.loaded.bytes:0)+s.loaded,i=(r.loaded?r.loaded.duration:0)+i,r.loaded={bytes:e,duration:i},r.realBitrate=Math.round(8*e/i)),n.bitrateTest&&(a={stats:s,frag:n,part:a,id:n.type},this.onFragBuffered(rt.FRAG_BUFFERED,a),n.bitrateTest=!1))},zi.onFragBuffered=function(t,e){var r=e.frag,i=e.part,e=(null!=i&&i.stats.loaded?i:r).stats;e.aborted||this.ignoreFragment(r)||(i=e.parsing.end-e.loading.start-Math.min(e.loading.first-e.loading.start,this.bwEstimator.getEstimateTTFB()),this.bwEstimator.sample(i,e.loaded),e.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0)},zi.ignoreFragment=function(t){return t.type!==le||"initSegment"===t.sn},zi.clearTimer=function(){self.clearInterval(this.timer)},zi.getNextABRAutoLevel=function(){var t=this.fragCurrent,e=this.partCurrent,r=this.hls,i=r.maxAutoLevel,n=r.config,a=r.minAutoLevel,s=r.media,o=e?e.duration:t?t.duration:0,l=s&&0!==s.playbackRate?Math.abs(s.playbackRate):1,u=this.bwEstimator?this.bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,h=r.mainForwardBufferInfo,e=(h?h.len:0)/l,t=this.findBestLevel(u,a,i,e,n.abrBandWidthFactor,n.abrBandWidthUpFactor);if(0<=t)return t;at.trace("[abr] "+(e?"rebuffering expected":"buffer is empty")+", finding optimal quality level");s=o?Math.min(o,n.maxStarvationDelay):n.maxStarvationDelay,r=n.abrBandWidthFactor,h=n.abrBandWidthUpFactor;return e||(l=this.bitrateTestDelay)&&(s=(o?Math.min(o,n.maxLoadingDelay):n.maxLoadingDelay)-l,at.trace("[abr] bitrate test took "+Math.round(1e3*l)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*s)+" ms"),r=h=1),t=this.findBestLevel(u,a,i,e+s,r,h),Math.max(t,0)},zi.findBestLevel=function(t,e,r,i,n,a){for(var s,o=this.fragCurrent,l=this.partCurrent,u=this.lastLoadedFragLevel,h=this.hls.levels,d=h[u],c=!(null==d||null==(s=d.details)||!s.live),f=null==d?void 0:d.codecSet,g=l?l.duration:o?o.duration:0,m=this.bwEstimator.getEstimateTTFB()/1e3,v=e,p=-1,y=r;e<=y;y--){var T=h[y];if(!T||f&&T.codecSet!==f)T&&(v=Math.min(y,v),p=Math.max(y,p));else{-1!==p&&at.trace("[abr] Skipped level(s) "+v+"-"+p+' with CODECS:"'+h[p].attrs.CODECS+'"; not compatible with "'+d.attrs.CODECS+'"');var E=T.details,S=(l?null==E?void 0:E.partTarget:null==E?void 0:E.averagetargetduration)||g,L=y<=u?n*t:a*t,T=h[y].maxBitrate,E=this.getTimeToLoadFrag(m,L,T*S,void 0===E);if(at.trace("[abr] level:"+y+" adjustedbw-bitrate:"+Math.round(L-T)+" avgDuration:"+S.toFixed(1)+" maxFetchDuration:"+i.toFixed(1)+" fetchDuration:"+E.toFixed(1)),T<L&&(0===E||!G(E)||c&&!this.bitrateTestDelay||E<i))return y}}return-1},o(_n,[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this.bwEstimator;if(-1!==t&&!e.canEstimate())return t;var r=this.getNextABRAutoLevel();if(-1!==t){e=this.hls.levels;if(e.length>Math.max(t,r)&&e[t].loadError<=e[r].loadError)return t}return-1!==t&&(r=Math.min(t,r)),r},set:function(t){this._nextAutoLevel=t}}]),_n),wn=((ui=Cn.prototype).push=function(t){this.chunks.push(t),this.dataLength+=t.length},ui.flush=function(){var t=this.chunks,a=this.dataLength;return t.length?(t=1===t.length?t[0]:function(t){for(var e=new Uint8Array(a),r=0,i=0;i<t.length;i++){var n=t[i];e.set(n,r),r+=n.length}return e}(t),this.reset(),t):new Uint8Array(0)},ui.reset=function(){this.chunks.length=0,this.dataLength=0},Cn),Pi=function(o){function t(t,e,r){return(r=o.call(this,t,e,r,"[audio-stream-controller]",ue)||this).videoBuffer=null,r.videoTrackCC=-1,r.waitingVideoCC=-1,r.bufferedTrack=null,r.switchingTrack=null,r.trackId=-1,r.waitingData=null,r.mainDetails=null,r.bufferFlushed=!1,r.cachedTrackLoadedData=null,r._registerListeners(),r}l(t,o);var e=t.prototype;return e.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null},e._registerListeners=function(){var t=this.hls;t.on(rt.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(rt.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.on(rt.LEVEL_LOADED,this.onLevelLoaded,this),t.on(rt.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(rt.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(rt.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(rt.ERROR,this.onError,this),t.on(rt.BUFFER_RESET,this.onBufferReset,this),t.on(rt.BUFFER_CREATED,this.onBufferCreated,this),t.on(rt.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(rt.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(rt.FRAG_BUFFERED,this.onFragBuffered,this)},e._unregisterListeners=function(){var t=this.hls;t.off(rt.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(rt.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.off(rt.LEVEL_LOADED,this.onLevelLoaded,this),t.off(rt.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(rt.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(rt.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(rt.ERROR,this.onError,this),t.off(rt.BUFFER_RESET,this.onBufferReset,this),t.off(rt.BUFFER_CREATED,this.onBufferCreated,this),t.off(rt.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(rt.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(rt.FRAG_BUFFERED,this.onFragBuffered,this)},e.onInitPtsFound=function(t,e){var r=e.frag,i=e.id,n=e.initPTS,e=e.timescale;"main"===i&&(i=r.cc,this.initPTS[r.cc]={baseTime:n,timescale:e},this.log("InitPTS for cc: "+i+" found from main: "+n),this.videoTrackCC=i,this.state===Yr&&this.tick())},e.startLoad=function(t){if(!this.levels)return this.startPosition=t,void(this.state=Fr);var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),0<e&&-1===t?(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e,this.state=Mr):(this.loadedmetadata=!1,this.state=Br),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},e.doTick=function(){switch(this.state){case Mr:this.doTickIdle();break;case Br:var t=this.levels,e=this.trackId,r=null==t||null==(r=t[e])?void 0:r.details;if(r){if(this.waitForCdnTuneIn(r))break;this.state=Yr}break;case Ur:var i=performance.now(),n=this.retryDate;(!n||n<=i||null!=(a=this.media)&&a.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=Mr);break;case Yr:var a,s,r=this.waitingData;r?(n=r.frag,i=r.part,a=r.cache,r=r.complete,void 0!==this.initPTS[n.cc]?(this.waitingData=null,this.waitingVideoCC=-1,this.state=Nr,s={frag:n,part:i,payload:a.flush(),networkDetails:null},this._handleFragmentLoadProgress(s),r&&o.prototype._handleFragmentLoadComplete.call(this,s)):this.videoTrackCC!==this.waitingVideoCC?(this.log("Waiting fragment cc ("+n.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment()):(s=this.getLoadPosition(),qe((s=Sr.bufferInfo(this.mediaBuffer,s,this.config.maxBufferHole)).end,this.config.maxFragLookUpTolerance,n)<0&&(this.log("Waiting fragment cc ("+n.cc+") @ "+n.start+" cancelled because another fragment at "+s.end+" is needed"),this.clearWaitingFragment()))):this.state=Mr}this.onTickEnd()},e.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Mr)},e.resetLoadingState=function(){this.clearWaitingFragment(),o.prototype.resetLoadingState.call(this)},e.onTickEnd=function(){var t=this.media;null!=t&&t.readyState&&(this.lastCurrentTime=t.currentTime)},e.doTickIdle=function(){var t=this.hls,e=this.levels,r=this.media,i=this.trackId,n=t.config;if(null!=e&&e[i]&&(r||!this.startFragRequested&&n.startFragPrefetch)){var a=e[i],s=a.details;if(!s||s.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(s))this.state=Br;else{var o=this.mediaBuffer||this.media;this.bufferFlushed&&o&&(this.bufferFlushed=!1,this.afterBufferFlushed(o,I,ue));var l=this.getFwdBufferInfo(o,ue);if(null!==l){var u=this.bufferedTrack,h=this.switchingTrack;if(!h&&this._streamEnded(l,s))return t.trigger(rt.BUFFER_EOS,{type:"audio"}),void(this.state=Hr);n=this.getFwdBufferInfo(this.videoBuffer||this.media,le),e=l.len,i=this.getMaxBufferLength(null==n?void 0:n.len);if(!(i<=e)||h){o=s.fragments[0].start,t=l.end;h&&r&&(e=this.getLoadPosition(),u&&h.attrs!==u.attrs&&(t=e),s.PTSKnown&&e<o&&(l.end>o||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=o+.05));r=this.getNextFragment(t,s),o=!1;if(r&&this.isLoopLoading(r,t)&&(o=!!r.gap,r=this.getNextFragmentLoopLoading(r,s,l,le,i)),r){i=n&&r.start>n.end+s.targetduration;if(i||(null==n||!n.len)&&l.len){s=this.getAppendedFrag(r.start,le);if(null===s)return;if(o=o||(!!s.gap||!!i&&0===n.len),i&&!o||o&&l.nextStart&&l.nextStart<s.end)return}this.loadFragment(r,a,t)}else this.bufferFlushed=!0}}}}},e.getMaxBufferLength=function(t){var e=o.prototype.getMaxBufferLength.call(this);return t?Math.min(Math.max(e,t),this.config.maxMaxBufferLength):e},e.onMediaDetaching=function(){this.videoBuffer=null,o.prototype.onMediaDetaching.call(this)},e.onAudioTracksUpdated=function(t,e){e=e.audioTracks;this.resetTransmuxer(),this.levels=e.map(function(t){return new Ie(t)})},e.onAudioTrackSwitching=function(t,e){var r=!!e.url;this.trackId=e.id;var i=this.fragCurrent;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.switchingTrack=e,this.state=Mr):(this.switchingTrack=null,this.bufferedTrack=e,this.state=Fr),this.tick()},e.onManifestLoading=function(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1},e.onLevelLoaded=function(t,e){this.mainDetails=e.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(rt.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},e.onAudioTrackLoaded=function(t,e){if(null!=this.mainDetails){var r=this.levels,i=e.details,n=e.id;if(r){this.log("Track "+n+" loaded ["+i.startSN+","+i.endSN+"]"+(i.lastPartSn?"[part-"+i.lastPartSn+"-"+i.lastPartIndex+"]":"")+",duration:"+i.totalduration);var a=r[n],r=0;if(i.live||null!=(s=a.details)&&s.live){var s=this.mainDetails;if(i.fragments[0]||(i.deltaUpdateFailed=!0),i.deltaUpdateFailed||!s)return;r=!a.details&&i.hasProgramDateTime&&s.hasProgramDateTime?(wr(i,s),i.fragments[0].start):this.alignPlaylists(i,a.details)}a.details=i,this.levelLastLoaded=n,this.startFragRequested||!this.mainDetails&&i.live||this.setStartPosition(a.details,r),this.state!==Br||this.waitForCdnTuneIn(i)||(this.state=Mr),this.tick()}else this.warn("Audio tracks were reset while loading level "+n)}else this.cachedTrackLoadedData=e},e._handleFragmentLoadProgress=function(t){var e=t.frag,r=t.part,i=t.payload,n=this.config,a=this.trackId,s=this.levels;if(s){var o=s[a];if(o){var l=o.details;if(!l)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(e.start);var u=n.defaultAudioCodec||o.audioCodec||"mp4a.40.2",h=(h=this.transmuxer)||(this.transmuxer=new An(this.hls,ue,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this))),t=this.initPTS[e.cc],n=null==(s=e.initSegment)?void 0:s.data;void 0!==t?(s=-1!==(o=r?r.index:-1),s=new mr(e.level,e.sn,e.stats.chunkCount,i.byteLength,o,s),h.push(i,n,u,"",e,r,l.totalduration,!1,s,t)):(this.log("Unknown video PTS for cc "+e.cc+", waiting for video PTS before demuxing audio frag "+e.sn+" of ["+l.startSN+" ,"+l.endSN+"],track "+a),(this.waitingData=this.waitingData||{frag:e,part:r,cache:new wn,complete:!1}).cache.push(new Uint8Array(i)),this.waitingVideoCC=this.videoTrackCC,this.state=Yr)}else this.warn("Audio track is undefined on fragment load progress")}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+e.sn+" of level "+e.level+" will not be buffered")},e._handleFragmentLoadComplete=function(t){this.waitingData?this.waitingData.complete=!0:o.prototype._handleFragmentLoadComplete.call(this,t)},e.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},e.onBufferCreated=function(t,e){var r=e.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer||null)},e.onFragBuffered=function(t,e){var r=e.frag,i=e.part;r.type===ue?this.fragContextChanged(r)?this.warn("Fragment "+r.sn+(i?" p: "+i.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false")):("initSegment"!==r.sn&&(this.fragPrevious=r,(e=this.switchingTrack)&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(rt.AUDIO_TRACK_SWITCHED,g({},e)))),this.fragBufferedComplete(r,i)):this.loadedmetadata||r.type!==le||(r=this.videoBuffer||this.media)&&Sr.getBuffered(r).length&&(this.loadedmetadata=!0)},e.onError=function(t,e){var r;if(e.fatal)this.state=Vr;else switch(e.details){case nt.FRAG_GAP:case nt.FRAG_PARSING_ERROR:case nt.FRAG_DECRYPT_ERROR:case nt.FRAG_LOAD_ERROR:case nt.FRAG_LOAD_TIMEOUT:case nt.KEY_LOAD_ERROR:case nt.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ue,e);break;case nt.AUDIO_TRACK_LOAD_ERROR:case nt.AUDIO_TRACK_LOAD_TIMEOUT:case nt.LEVEL_PARSING_ERROR:e.levelRetry||this.state!==Br||(null==(r=e.context)?void 0:r.type)!==se||(this.state=Mr);break;case nt.BUFFER_FULL_ERROR:if(!e.parent||"audio"!==e.parent)return;this.reduceLengthAndFlushBuffer(e)&&(this.bufferedTrack=null,o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case nt.INTERNAL_EXCEPTION:this.recoverWorkerError(e)}},e.onBufferFlushed=function(t,e){e.type===I&&(this.bufferFlushed=!0,this.state===Hr&&(this.state=Mr))},e._handleTransmuxComplete=function(t){var e,r,i,n,a,s,o,l,u=this.hls,h=t.remuxResult,d=t.chunkMeta,c=this.getCurrentContext(d);c?(r=c.frag,i=c.part,n=c.level.details,a=h.audio,l=h.text,o=h.id3,t=h.initSegment,!this.fragContextChanged(r)&&n?(this.state=Gr,this.switchingTrack&&a&&this.completeAudioSwitch(this.switchingTrack),null!=t&&t.tracks&&(s=r.initSegment||r,this._bufferInitSegment(t.tracks,s,d),u.trigger(rt.FRAG_PARSING_INIT_SEGMENT,{frag:s,id:"audio",tracks:t.tracks})),a&&(c=a.startPTS,h=a.endPTS,s=a.startDTS,t=a.endDTS,i&&(i.elementaryStreams[I]={startPTS:c,endPTS:h,startDTS:s,endDTS:t}),r.setElementaryStreamInfo(I,c,h,s,t),this.bufferFragmentData(a,r,i,d)),null!=o&&null!=(e=o.samples)&&e.length&&(o=et({id:"audio",frag:r,details:n},o),u.trigger(rt.FRAG_PARSING_METADATA,o)),l&&(l=et({id:"audio",frag:r,details:n},l),u.trigger(rt.FRAG_PARSING_USERDATA,l))):this.fragmentTracker.removeFragment(r)):this.resetWhenMissingContext(d)},e._bufferInitSegment=function(t,e,r){var i;this.state===Gr&&(t.video&&delete t.video,(i=t.audio)&&(i.levelCodec=i.codec,i.id="audio",this.log("Init audio buffer, container:"+i.container+", codecs[parsed]=["+i.codec+"]"),this.hls.trigger(rt.BUFFER_CODECS,t),null!=(i=i.initSegment)&&i.byteLength&&(i={type:"audio",frag:e,part:null,chunkMeta:r,parent:e.type,data:i},this.hls.trigger(rt.BUFFER_APPENDING,i)),this.tick()))},e.loadFragment=function(t,e,r){var i=this.fragmentTracker.getState(t);this.fragCurrent=t,this.switchingTrack||i===rr||i===nr?"initSegment"===t.sn?this._loadInitSegment(t,e):null!=(i=e.details)&&i.live&&!this.initPTS[t.cc]?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=Yr):(this.startFragRequested=!0,o.prototype.loadFragment.call(this,t,e,r)):this.clearTrackerIfNeeded(t)},e.completeAudioSwitch=function(t){var e=this.hls,r=this.media,i=this.bufferedTrack,n=null==i?void 0:i.attrs,i=t.attrs;r&&n&&(n.CHANNELS!==i.CHANNELS||n.NAME!==i.NAME||n.LANGUAGE!==i.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(rt.AUDIO_TRACK_SWITCHED,g({},t))},t}(jr),Tr=function(a){function t(t){return(t=a.call(this,t,"[audio-track-controller]")||this).tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.currentTrack=null,t.selectDefaultTrack=!0,t.registerListeners(),t}l(t,a);var e=t.prototype;return e.registerListeners=function(){var t=this.hls;t.on(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.on(rt.MANIFEST_PARSED,this.onManifestParsed,this),t.on(rt.LEVEL_LOADING,this.onLevelLoading,this),t.on(rt.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(rt.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(rt.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t.off(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.off(rt.MANIFEST_PARSED,this.onManifestParsed,this),t.off(rt.LEVEL_LOADING,this.onLevelLoading,this),t.off(rt.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(rt.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(rt.ERROR,this.onError,this)},e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,a.prototype.destroy.call(this)},e.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},e.onManifestParsed=function(t,e){this.tracks=e.audioTracks||[]},e.onAudioTrackLoaded=function(t,e){var r,i=e.id,n=e.groupId,a=e.details,s=this.tracksInGroup[i];s&&s.groupId===n?(r=s.details,s.details=e.details,this.log("audio-track "+i+' "'+s.name+'" lang:'+s.lang+" group:"+n+" loaded ["+a.startSN+"-"+a.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,e,r)):this.warn("Track with id:"+i+" and group:"+n+" not found in active group "+s.groupId)},e.onLevelLoading=function(t,e){this.switchLevel(e.level)},e.onLevelSwitching=function(t,e){this.switchLevel(e.level)},e.switchLevel=function(t){var e,r=this.hls.levels[t];null!=r&&r.audioGroupIds&&(e=r.audioGroupIds[r.urlId],this.groupId!==e?(this.groupId=e||null,t=this.tracks.filter(function(t){return!e||t.groupId===e}),this.selectDefaultTrack&&!t.some(function(t){return t.default})&&(this.selectDefaultTrack=!1),r={audioTracks:this.tracksInGroup=t},this.log("Updating audio tracks, "+t.length+" track(s) found in group:"+e),this.hls.trigger(rt.AUDIO_TRACKS_UPDATED,r),this.selectInitialTrack()):this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId))},e.onError=function(t,e){!e.fatal&&e.context&&e.context.type===se&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(e))},e.setAudioTrack=function(t){var e,r,i,n=this.tracksInGroup;t<0||t>=n.length?this.warn("Invalid id passed to audio-track controller"):(this.clearTimer(),i=this.currentTrack,n[this.trackId],r=(e=n[t]).groupId,n=e.name,this.log("Switching to audio-track "+t+' "'+n+'" lang:'+e.lang+" group:"+r),this.trackId=t,this.currentTrack=e,this.selectDefaultTrack=!1,this.hls.trigger(rt.AUDIO_TRACK_SWITCHING,g({},e)),e.details&&!e.details.live||(i=this.switchParams(e.url,null==i?void 0:i.details),this.loadPlaylist(i)))},e.selectInitialTrack=function(){var t=this.tracksInGroup,e=this.findTrackId(this.currentTrack)|this.findTrackId(null);-1!=e?this.setAudioTrack(e):(t=new Error("No track found for running audio group-ID: "+this.groupId+" track count: "+t.length),this.warn(t.message),this.hls.trigger(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t}))},e.findTrackId=function(t){for(var e=this.tracksInGroup,r=0;r<e.length;r++){var i=e[r];if(!this.selectDefaultTrack||i.default){if(!t||void 0!==t.attrs["STABLE-RENDITION-ID"]&&t.attrs["STABLE-RENDITION-ID"]===i.attrs["STABLE-RENDITION-ID"])return i.id;if(t.name===i.name&&t.lang===i.lang)return i.id}}return-1},e.loadPlaylist=function(t){a.prototype.loadPlaylist.call(this);var e=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(e)){var r=e.id,i=e.groupId,n=e.url;if(t)try{n=t.addDirectives(n)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("loading audio-track playlist "+r+' "'+e.name+'" lang:'+e.lang+" group:"+i),this.clearTimer(),this.hls.trigger(rt.AUDIO_TRACK_LOADING,{url:n,id:r,groupId:i,deliveryDirectives:t||null})}},o(t,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}]),t}(Qe);function Cn(){this.chunks=[],this.dataLength=0}function _n(t){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0;t=(this.hls=t).config;this.bwEstimator=new In(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}function Pn(t,e,r,i){void 0===i&&(i=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Dn(t),this.fast_=new Dn(e),this.defaultTTFB_=i,this.ttfb_=new Dn(t)}function xn(t,e,r){void 0===e&&(e=0),void 0===r&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=r}function Fn(t,e,r,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=r,this.hls=i}function Mn(t,e,r,i){var n=this;this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var a=t.config;this.hls=t,this.id=e,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;i=function(t,e){(e=e||{}).frag=n.frag,e.id=n.id,t===rt.ERROR&&(n.error=e.error),n.hls.trigger(t,e)};this.observer=new pn,this.observer.on(rt.FRAG_DECRYPTED,i),this.observer.on(rt.ERROR,i);var s,o={mp4:Rn.isTypeSupported("video/mp4"),mpeg:Rn.isTypeSupported("audio/mpeg"),mp3:Rn.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(!this.useWorker||"undefined"==typeof Worker||(a.workerPath,0))this.transmuxer=new Zi(this.observer,o,a,l,e);else try{a.workerPath?(at.log("loading Web Worker "+a.workerPath+' for "'+e+'"'),this.workerContext=(s=a.workerPath,s=new self.URL(s,self.location.href).href,{worker:new self.Worker(s),scriptURL:s})):(at.log('injecting Web Worker for "'+e+'"'),this.workerContext=(u=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+Ss.toString()+")(true);"],{type:"text/javascript"}),u=self.URL.createObjectURL(u),{worker:new self.Worker(u),objectURL:u})),this.onwmsg=function(t){return n.onWorkerMessage(t)};var u=this.workerContext.worker;u.addEventListener("message",this.onwmsg),u.onerror=function(t){t=new Error(t.message+"  ("+t.filename+":"+t.lineno+")");a.enableWorker=!1,at.warn('Error in "'+e+'" Web Worker, fallback to inline'),n.hls.trigger(rt.ERROR,{type:it.OTHER_ERROR,details:nt.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})},u.postMessage({cmd:"init",typeSupported:o,vendor:l,id:e,config:JSON.stringify(a)})}catch(t){at.warn('Error setting up "'+e+'" Web Worker, fallback to inline',t),this.resetWorker(),this.error=null,this.transmuxer=new Zi(this.observer,o,a,l,e)}}function On(t,e){if(t.length===e.length){for(var r=0;r<t.length;r++)if(!function(e,r){var t=e["STABLE-RENDITION-ID"];return t?t===r["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(function(t){return e[t]!==r[t]})}(t[r].attrs,e[r].attrs))return;return 1}}var t=function(i){function t(t,e,r){return(r=i.call(this,t,e,r,"[subtitle-stream-controller]",he)||this).levels=[],r.currentTrackId=-1,r.tracksBuffered=[],r.mainDetails=null,r._registerListeners(),r}l(t,i);var e=t.prototype;return e.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},e._registerListeners=function(){var t=this.hls;t.on(rt.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(rt.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.on(rt.LEVEL_LOADED,this.onLevelLoaded,this),t.on(rt.ERROR,this.onError,this),t.on(rt.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(rt.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(rt.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(rt.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(rt.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(rt.FRAG_BUFFERED,this.onFragBuffered,this)},e._unregisterListeners=function(){var t=this.hls;t.off(rt.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(rt.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.off(rt.LEVEL_LOADED,this.onLevelLoaded,this),t.off(rt.ERROR,this.onError,this),t.off(rt.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(rt.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(rt.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(rt.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(rt.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(rt.FRAG_BUFFERED,this.onFragBuffered,this)},e.startLoad=function(t){this.stopLoad(),this.state=Mr,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},e.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},e.onMediaDetaching=function(){this.tracksBuffered=[],i.prototype.onMediaDetaching.call(this)},e.onLevelLoaded=function(t,e){this.mainDetails=e.details},e.onSubtitleFragProcessed=function(t,e){var r=e.frag,e=e.success;if(this.fragPrevious=r,this.state=Mr,e){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var n,a=r.start,s=0;s<i.length;s++)if(a>=i[s].start&&a<=i[s].end){n=i[s];break}e=r.start+r.duration;n?n.end=e:(n={start:a,end:e},i.push(n)),this.fragmentTracker.fragBuffered(r)}}},e.onBufferFlushing=function(t,e){var r,i,n,a=e.startOffset,s=e.endOffset;0===a&&s!==Number.POSITIVE_INFINITY&&(r=this.currentTrackId,(i=this.levels).length&&i[r]&&i[r].details&&((n=s-i[r].details.targetduration)<=0||(e.endOffsetSubtitles=Math.max(0,n),this.tracksBuffered.forEach(function(t){for(var e=0;e<t.length;)if(t[e].end<=n)t.shift();else{if(!(t[e].start<n))break;t[e].start=n,e++}}),this.fragmentTracker.removeFragmentsInRange(a,n,he))))},e.onFragBuffered=function(t,e){this.loadedmetadata||e.frag.type!==le||null!=(e=this.media)&&e.buffered.length&&(this.loadedmetadata=!0)},e.onError=function(t,e){e=e.frag;(null==e?void 0:e.type)===he&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Fr&&(this.state=Mr))},e.onSubtitleTracksUpdated=function(t,e){var r=this,e=e.subtitleTracks;On(this.levels,e)?this.levels=e.map(function(t){return new Ie(t)}):(this.tracksBuffered=[],this.levels=e.map(function(t){t=new Ie(t);return r.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,he),this.fragPrevious=null,this.mediaBuffer=null)},e.onSubtitleTrackSwitch=function(t,e){this.currentTrackId=e.id,this.levels.length&&-1!==this.currentTrackId?(null!=(e=this.levels[this.currentTrackId])&&e.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,e&&this.setInterval(500)):this.clearInterval()},e.onSubtitleTrackLoaded=function(t,e){var r=e.details,i=e.id,n=this.currentTrackId,a=this.levels;if(a.length){e=a[n];if(!(i>=a.length||i!==n)&&e){this.mediaBuffer=this.mediaBufferTimeRanges;a=0;if(r.live||null!=(s=e.details)&&s.live){n=this.mainDetails;if(r.deltaUpdateFailed||!n)return;var s=n.fragments[0];e.details?0===(a=this.alignPlaylists(r,e.details))&&s&&Ne(r,a=s.start):r.hasProgramDateTime&&n.hasProgramDateTime?(wr(r,n),a=r.fragments[0].start):s&&Ne(r,a=s.start)}e.details=r,this.levelLastLoaded=i,this.startFragRequested||!this.mainDetails&&r.live||this.setStartPosition(e.details,a),this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===Mr&&(je(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),e.details=void 0))}}},e._handleFragmentLoadComplete=function(t){var r,e=this,i=t.frag,n=t.payload,t=i.decryptdata,a=this.hls;!this.fragContextChanged(i)&&n&&0<n.byteLength&&t&&t.key&&t.iv&&"AES-128"===t.method&&(r=performance.now(),this.decrypter.decrypt(new Uint8Array(n),t.key.buffer,t.iv.buffer).catch(function(t){throw a.trigger(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:i}),t}).then(function(t){var e=performance.now();a.trigger(rt.FRAG_DECRYPTED,{frag:i,payload:t,stats:{tstart:r,tdecrypt:e}})}).catch(function(t){e.warn(t.name+": "+t.message),e.state=Mr}))},e.doTick=function(){var t,e,r,i,n,a,s,o;this.media?this.state===Mr&&(e=this.currentTrackId,t=(i=this.levels)[e],i.length&&t&&t.details&&(a=(s=t.details).targetduration,o=this.config,n=this.getLoadPosition(),e=(r=Sr.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],n-a,o.maxBufferHole)).end,i=r.len,n=this.getFwdBufferInfo(this.media,le),i>this.getMaxBufferLength(null==n?void 0:n.len)+a||(i=(r=s.fragments).length,n=s.edge,a=null,s=this.fragPrevious,e<n?(o=o.maxFragLookUpTolerance,!(a=je(s,r,Math.max(r[0].start,e),o))&&s&&s.start<r[0].start&&(a=r[0])):a=r[i-1],a&&(a=this.mapToInitFragWhenRequired(a),this.fragmentTracker.getState(a)===rr&&this.loadFragment(a,t,e))))):this.state=Mr},e.getMaxBufferLength=function(t){var e=i.prototype.getMaxBufferLength.call(this);return t?Math.max(e,t):e},e.loadFragment=function(t,e,r){"initSegment"===(this.fragCurrent=t).sn?this._loadInitSegment(t,e):(this.startFragRequested=!0,i.prototype.loadFragment.call(this,t,e,r))},o(t,[{key:"mediaBufferTimeRanges",get:function(){return new Nn(this.tracksBuffered[this.currentTrackId]||[])}}]),t}(jr),Nn=function(i){this.buffered=void 0;function e(t,e,r){if((e>>>=0)>r-1)throw new DOMException("Failed to execute '"+t+"' on 'TimeRanges': The index provided ("+e+") is greater than the maximum bound ("+r+")");return i[e][t]}this.buffered={get length(){return i.length},end:function(t){return e("end",t,i.length)},start:function(t){return e("start",t,i.length)}}},Un=function(a){function t(t){var e;return(e=a.call(this,t,"[subtitle-track-controller]")||this).media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.registerListeners(),e}l(t,a);var e=t.prototype;return e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,a.prototype.destroy.call(this)},e.registerListeners=function(){var t=this.hls;t.on(rt.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(rt.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.on(rt.MANIFEST_PARSED,this.onManifestParsed,this),t.on(rt.LEVEL_LOADING,this.onLevelLoading,this),t.on(rt.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(rt.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(rt.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t.off(rt.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(rt.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.off(rt.MANIFEST_PARSED,this.onManifestParsed,this),t.off(rt.LEVEL_LOADING,this.onLevelLoading,this),t.off(rt.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(rt.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(rt.ERROR,this.onError,this)},e.onMediaAttached=function(t,e){this.media=e.media,this.media&&(-1<this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},e.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},e.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),-1<this.trackId&&(this.queuedDefaultTrack=this.trackId),Bn(this.media.textTracks).forEach(function(t){pe(t)}),this.subtitleTrack=-1,this.media=null)},e.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},e.onManifestParsed=function(t,e){this.tracks=e.subtitleTracks},e.onSubtitleTrackLoaded=function(t,e){var r=e.id,i=e.details,n=this.trackId,a=this.tracksInGroup[n];a?(n=a.details,a.details=e.details,this.log("subtitle track "+r+" loaded ["+i.startSN+"-"+i.endSN+"]"),r===this.trackId&&this.playlistLoaded(r,e,n)):this.warn("Invalid subtitle track id "+r)},e.onLevelLoading=function(t,e){this.switchLevel(e.level)},e.onLevelSwitching=function(t,e){this.switchLevel(e.level)},e.switchLevel=function(t){var e,r,i,n=this.hls.levels[t];null!=n&&n.textGroupIds&&(e=n.textGroupIds[n.urlId],r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,this.groupId!==e?(i=this.tracks.filter(function(t){return!e||t.groupId===e}),this.tracksInGroup=i,t=this.findTrackId(null==r?void 0:r.name)||this.findTrackId(),this.groupId=e||null,n={subtitleTracks:i},this.log("Updating subtitle tracks, "+i.length+' track(s) found in "'+e+'" group-id'),this.hls.trigger(rt.SUBTITLE_TRACKS_UPDATED,n),-1!==t&&this.setSubtitleTrack(t,r)):this.shouldReloadPlaylist(r)&&this.setSubtitleTrack(this.trackId,r))},e.findTrackId=function(t){for(var e=this.tracksInGroup,r=0;r<e.length;r++){var i=e[r];if((!this.selectDefaultTrack||i.default)&&(!t||t===i.name))return i.id}return-1},e.onError=function(t,e){!e.fatal&&e.context&&e.context.type===oe&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.checkRetry(e)},e.loadPlaylist=function(t){a.prototype.loadPlaylist.call(this);var e=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(e)){var r=e.id,i=e.groupId,n=e.url;if(t)try{n=t.addDirectives(n)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Loading subtitle playlist for id "+r),this.hls.trigger(rt.SUBTITLE_TRACK_LOADING,{url:n,id:r,groupId:i,deliveryDirectives:t||null})}},e.toggleTrackModes=function(t){var e,r=this,i=this.media,n=this.trackId;i&&(i=(e=Bn(i.textTracks)).filter(function(t){return t.groupId===r.groupId}),-1===t?[].slice.call(e).forEach(function(t){t.mode="disabled"}):(n=i[n])&&(n.mode="disabled"),(t=i[t])&&(t.mode=this.subtitleDisplay?"showing":"hidden"))},e.setSubtitleTrack=function(t,e){var r,i,n,a,s,o=this.tracksInGroup;this.media?(this.trackId!==t&&this.toggleTrackModes(t),this.trackId===t&&(-1===t||null!=(a=o[t])&&a.details)||t<-1||t>=o.length||(this.clearTimer(),r=o[t],this.log("Switching to subtitle-track "+t+(r?' "'+r.name+'" lang:'+r.lang+" group:"+r.groupId:"")),this.trackId=t,r?(i=r.id,n=void 0===(s=r.groupId)?"":s,a=r.name,o=r.type,s=r.url,this.hls.trigger(rt.SUBTITLE_TRACK_SWITCH,{id:i,groupId:n,name:a,type:o,url:s}),e=this.switchParams(r.url,null==e?void 0:e.details),this.loadPlaylist(e)):this.hls.trigger(rt.SUBTITLE_TRACK_SWITCH,{id:t}))):this.queuedDefaultTrack=t},e.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,e=Bn(this.media.textTracks),r=0;r<e.length;r++)if("hidden"===e[r].mode)t=r;else if("showing"===e[r].mode){t=r;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},o(t,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(t){this._subtitleDisplay=t,-1<this.trackId&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,e)}}]),t}(Qe);function Bn(t){for(var e=[],r=0;r<t.length;r++){var i=t[r];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||e.push(t[r])}return e}function Gn(t){var e=t;return jn.hasOwnProperty(t)&&(e=jn[t]),String.fromCharCode(e)}function Kn(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].toString(16));return e}var Hn=((Zr=ga.prototype).append=function(t,e){var r=this.queues[e];r.push(t),1===r.length&&this.buffers[e]&&this.executeNext(e)},Zr.insertAbort=function(t,e){this.queues[e].unshift(t),this.executeNext(e)},Zr.appendBlocker=function(t){var e,r=new Promise(function(t){e=t}),i={execute:e,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(i,t),r},Zr.executeNext=function(t){var e=this.buffers,r=this.queues,i=e[t],r=r[t];if(r.length){var n=r[0];try{n.execute()}catch(e){at.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),n.onError(e),null!=i&&i.updating||(r.shift(),this.executeNext(t))}}},Zr.shiftAndExecuteNext=function(t){this.queues[t].shift(),this.executeNext(t)},Zr.current=function(t){return this.queues[t][0]},ga),Vn=Kt(),Yn=/([ha]vc.)(?:\.[^.,]+)+/,Wn=((_=fa.prototype).hasSourceTypes=function(){return 0<this.getSourceBufferTypes().length||0<Object.keys(this.pendingTracks).length},_.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},_.registerListeners=function(){var t=this.hls;t.on(rt.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(rt.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.on(rt.MANIFEST_PARSED,this.onManifestParsed,this),t.on(rt.BUFFER_RESET,this.onBufferReset,this),t.on(rt.BUFFER_APPENDING,this.onBufferAppending,this),t.on(rt.BUFFER_CODECS,this.onBufferCodecs,this),t.on(rt.BUFFER_EOS,this.onBufferEos,this),t.on(rt.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(rt.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(rt.FRAG_PARSED,this.onFragParsed,this),t.on(rt.FRAG_CHANGED,this.onFragChanged,this)},_.unregisterListeners=function(){var t=this.hls;t.off(rt.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(rt.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.off(rt.MANIFEST_PARSED,this.onManifestParsed,this),t.off(rt.BUFFER_RESET,this.onBufferReset,this),t.off(rt.BUFFER_APPENDING,this.onBufferAppending,this),t.off(rt.BUFFER_CODECS,this.onBufferCodecs,this),t.off(rt.BUFFER_EOS,this.onBufferEos,this),t.off(rt.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(rt.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(rt.FRAG_PARSED,this.onFragParsed,this),t.off(rt.FRAG_CHANGED,this.onFragChanged,this)},_._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new Hn(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},_.onManifestLoading=function(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null},_.onManifestParsed=function(t,e){var r=2;(!e.audio||e.video)&&e.altAudio||(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,at.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},_.onMediaAttaching=function(t,e){var r=this.media=e.media;r&&Vn&&((e=this.mediaSource=new Vn).addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(e),this._objectUrl=r.src,r.addEventListener("emptied",this._onMediaEmptied))},_.onMediaDetaching=function(){var t=this.media,e=this.mediaSource,r=this._objectUrl;if(e){if(at.log("[buffer-controller]: media source detaching"),"open"===e.readyState)try{e.endOfStream()}catch(t){at.warn("[buffer-controller]: onMediaDetaching: "+t.message+" while calling endOfStream")}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(t.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),t.src===r?(t.removeAttribute("src"),t.load()):at.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(rt.MEDIA_DETACHED,void 0)},_.onBufferReset=function(){var r=this;this.getSourceBufferTypes().forEach(function(e){var t=r.sourceBuffer[e];try{t&&(r.removeBufferListeners(e),r.mediaSource&&r.mediaSource.removeSourceBuffer(t),r.sourceBuffer[e]=void 0)}catch(t){at.warn("[buffer-controller]: Failed to reset the "+e+" buffer",t)}}),this._initSourceBuffer()},_.onBufferCodecs=function(t,h){var d=this,c=this.getSourceBufferTypes().length;Object.keys(h).forEach(function(t){var e,r,i,n,a,s,o,l,u;c?(e=d.tracks[t])&&"function"==typeof e.buffer.changeType&&(r=(u=h[t]).id,i=u.codec,n=u.levelCodec,a=u.container,s=u.metadata,(o=(e.levelCodec||e.codec).replace(Yn,"$1"))!==(l=(n||i).replace(Yn,"$1"))&&(u=a+";codecs="+(n||i),d.appendChangeType(t,u),at.log("[buffer-controller]: switching codec "+o+" to "+l),d.tracks[t]={buffer:e.buffer,codec:i,container:a,levelCodec:n,metadata:s,id:r})):d.pendingTracks[t]=h[t]}),c||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},_.appendChangeType=function(e,r){var i=this,n=this.operationQueue,t={execute:function(){var t=i.sourceBuffer[e];t&&(at.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+r),t.changeType(r)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){at.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",t)}};n.append(t,e)},_.onBufferAppending=function(t,e){var n=this,r=this.hls,i=this.operationQueue,a=this.tracks,s=e.data,o=e.type,l=e.frag,u=e.part,h=e.chunkMeta,d=h.buffering[o],e=self.performance.now();d.start=e;var c=l.stats.buffering,f=u?u.stats.buffering:null;0===c.start&&(c.start=e),f&&0===f.start&&(f.start=e);var a=a.audio,g=!1;"audio"===o&&"audio/mpeg"===(null==a?void 0:a.container)&&(g=!this.lastMpegAudioChunk||1===h.id||this.lastMpegAudioChunk.sn!==h.sn,this.lastMpegAudioChunk=h);var m=l.start,a={execute:function(){var t,e;d.executeStart=self.performance.now(),g&&(t=n.sourceBuffer[o])&&(e=m-t.timestampOffset,.1<=Math.abs(e)&&(at.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+m+" (delta: "+e+") sn: "+l.sn+")"),t.timestampOffset=m)),n.appendExecutor(s,o)},onStart:function(){},onComplete:function(){var t=self.performance.now();d.executeEnd=d.end=t,0===c.first&&(c.first=t),f&&0===f.first&&(f.first=t);var e,r=n.sourceBuffer,i={};for(e in r)i[e]=Sr.getBuffered(r[e]);n.appendError=0,n.hls.trigger(rt.BUFFER_APPENDED,{type:o,frag:l,part:u,chunkMeta:h,parent:l.type,timeRanges:i})},onError:function(t){at.error("[buffer-controller]: Error encountered while trying to append to the "+o+" SourceBuffer",t);var e={type:it.MEDIA_ERROR,parent:l.type,details:nt.BUFFER_APPEND_ERROR,frag:l,part:u,chunkMeta:h,error:t,err:t,fatal:!1};t.code===DOMException.QUOTA_EXCEEDED_ERR?e.details=nt.BUFFER_FULL_ERROR:(n.appendError++,e.details=nt.BUFFER_APPEND_ERROR,n.appendError>r.config.appendErrorMaxRetry&&(at.error("[buffer-controller]: Failed "+r.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),e.fatal=!0)),r.trigger(rt.ERROR,e)}};i.append(a,o)},_.onBufferFlushing=function(t,r){function e(e){return{execute:i.removeExecutor.bind(i,e,r.startOffset,r.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(rt.BUFFER_FLUSHED,{type:e})},onError:function(t){at.warn("[buffer-controller]: Failed to remove from "+e+" SourceBuffer",t)}}}var i=this,n=this.operationQueue;r.type?n.append(e(r.type),r.type):this.getSourceBufferTypes().forEach(function(t){n.append(e(t),t)})},_.onFragParsed=function(t,e){var r=this,i=e.frag,n=e.part,a=[],e=(n||i).elementaryStreams;e[C]?a.push("audiovideo"):(e[I]&&a.push("audio"),e[w]&&a.push("video")),0===a.length&&at.warn("Fragments must have at least one ElementaryStreamType set. type: "+i.type+" level: "+i.level+" sn: "+i.sn),this.blockBuffers(function(){var t=self.performance.now();i.stats.buffering.end=t,n&&(n.stats.buffering.end=t);t=(n||i).stats;r.hls.trigger(rt.FRAG_BUFFERED,{frag:i,part:n,stats:t,id:i.type})},a)},_.onFragChanged=function(t,e){this.flushBackBuffer()},_.onBufferEos=function(t,i){var n=this;this.getSourceBufferTypes().reduce(function(t,e){var r=n.sourceBuffer[e];return!r||i.type&&i.type!==e||(r.ending=!0,r.ended||(r.ended=!0,at.log("[buffer-controller]: "+e+" sourceBuffer now EOS"))),t&&!(r&&!r.ended)},!0)&&(at.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){n.getSourceBufferTypes().forEach(function(t){t=n.sourceBuffer[t];t&&(t.ending=!1)});var t=n.mediaSource;t&&"open"===t.readyState?(at.log("[buffer-controller]: Calling mediaSource.endOfStream()"),t.endOfStream()):t&&at.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+t.readyState)}))},_.onLevelUpdated=function(t,e){e=e.details;e.fragments.length&&(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},_.flushBackBuffer=function(){var t,i,n,e,a,s=this.hls,o=this.details,r=this.media,l=this.sourceBuffer;!r||null===o||(t=this.getSourceBufferTypes()).length&&(e=o.live&&null!==s.config.liveBackBufferLength?s.config.liveBackBufferLength:s.config.backBufferLength,!G(e)||e<0||(i=r.currentTime,n=o.levelTargetDuration,e=Math.max(e,n),a=Math.floor(i/n)*n-e,t.forEach(function(t){var e=l[t];if(e){var r=Sr.getBuffered(e);if(0<r.length&&a>r.start(0)){if(s.trigger(rt.BACK_BUFFER_REACHED,{bufferEnd:a}),o.live)s.trigger(rt.LIVE_BACK_BUFFER_REACHED,{bufferEnd:a});else if(e.ended&&r.end(r.length-1)-i<2*n)return void at.info("[buffer-controller]: Cannot flush "+t+" back buffer while SourceBuffer is in ended state");s.trigger(rt.BUFFER_FLUSHING,{startOffset:0,endOffset:a,type:t})}}})))},_.updateMediaElementDuration=function(){var t,e,r,i,n,a;this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState&&(t=this.details,e=this.hls,a=this.media,r=this.mediaSource,i=t.fragments[0].start+t.totalduration,n=a.duration,a=G(r.duration)?r.duration:0,t.live&&e.config.liveDurationInfinity?(at.log("[buffer-controller]: Media Source duration is set to Infinity"),r.duration=1/0,this.updateSeekableRange(t)):(a<i&&n<i||!G(n))&&(at.log("[buffer-controller]: Updating Media Source duration to "+i.toFixed(3)),r.duration=i))},_.updateSeekableRange=function(t){var e=this.mediaSource,r=t.fragments;r.length&&t.live&&null!=e&&e.setLiveSeekableRange&&(r=Math.max(0,r[0].start),t=Math.max(r,r+t.totalduration),e.setLiveSeekableRange(r,t))},_.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.operationQueue,r=this.pendingTracks,i=Object.keys(r).length;(i&&!t||2===i)&&(this.createSourceBuffers(r),this.pendingTracks={},(r=this.getSourceBufferTypes()).length?(this.hls.trigger(rt.BUFFER_CREATED,{tracks:this.tracks}),r.forEach(function(t){e.executeNext(t)})):(r=new Error("could not create source buffer for media codec(s)"),this.hls.trigger(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:r,reason:r.message})))},_.createSourceBuffers=function(t){var e,r=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(e in t)if(!r[e]){var n=t[e];if(!n)throw Error("source buffer exists for track "+e+", however track does not");var a=n.levelCodec||n.codec,s=n.container+";codecs="+a;at.log("[buffer-controller]: creating sourceBuffer("+s+")");try{var o=r[e]=i.addSourceBuffer(s),l=e;this.addBufferListener(l,"updatestart",this._onSBUpdateStart),this.addBufferListener(l,"updateend",this._onSBUpdateEnd),this.addBufferListener(l,"error",this._onSBUpdateError),this.tracks[e]={buffer:o,codec:a,container:n.container,levelCodec:n.levelCodec,metadata:n.metadata,id:n.id}}catch(t){at.error("[buffer-controller]: error while trying to add sourceBuffer: "+t.message),this.hls.trigger(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,mimeType:s})}}},_._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},_._onSBUpdateEnd=function(t){var e=this.operationQueue;e.current(t).onComplete(),e.shiftAndExecuteNext(t)},_._onSBUpdateError=function(t,e){var r=new Error(t+" SourceBuffer error");at.error("[buffer-controller]: "+r,e),this.hls.trigger(rt.ERROR,{type:it.MEDIA_ERROR,details:nt.BUFFER_APPENDING_ERROR,error:r,fatal:!1});t=this.operationQueue.current(t);t&&t.onError(e)},_.removeExecutor=function(t,e,r){var i=this.media,n=this.mediaSource,a=this.operationQueue,s=this.sourceBuffer[t];if(!i||!n||!s)return at.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void a.shiftAndExecuteNext(t);i=G(i.duration)?i.duration:1/0,n=G(n.duration)?n.duration:1/0,e=Math.max(0,e),n=Math.min(r,i,n);e<n&&!s.ending?(s.ended=!1,at.log("[buffer-controller]: Removing ["+e+","+n+"] from the "+t+" SourceBuffer"),s.remove(e,n)):a.shiftAndExecuteNext(t)},_.appendExecutor=function(t,e){var r=this.operationQueue,i=this.sourceBuffer[e];if(!i)return at.warn("[buffer-controller]: Attempting to append to the "+e+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(e);i.ended=!1,i.appendBuffer(t)},_.blockBuffers=function(t,e){var r=this;if(void 0===e&&(e=this.getSourceBufferTypes()),!e.length)return at.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(t);var i=this.operationQueue,n=e.map(function(t){return i.appendBlocker(t)});Promise.all(n).then(function(){t(),e.forEach(function(t){var e=r.sourceBuffer[t];null!=e&&e.updating||i.shiftAndExecuteNext(t)})})},_.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},_.addBufferListener=function(t,e,r){var i=this.sourceBuffer[t];i&&(r=r.bind(this,t),this.listeners[t].push({event:e,listener:r}),i.addEventListener(e,r))},_.removeBufferListeners=function(t){var e=this.sourceBuffer[t];e&&this.listeners[t].forEach(function(t){e.removeEventListener(t.event,t.listener)})},fa),jn={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},qn=100,Xn={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},zn={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Qn={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},$n={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Jn=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Zn=(ca.prototype.log=function(t,e){this.verboseLevel>=t&&(e="function"==typeof e?e():e,at.log(this.time+" ["+t+"] "+e))},ca),ta=((di=da.prototype).reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},di.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],r=0;r<e.length;r++){var i=e[r];t.hasOwnProperty(i)&&(this[i]=t[i])}},di.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},di.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},di.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},di.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},da),ea=((zi=ha.prototype).reset=function(){this.uchar=" ",this.penState.reset()},zi.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},zi.setPenState=function(t){this.penState.copy(t)},zi.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},zi.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},zi.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},ha),ra=((ui=ua.prototype).equals=function(t){for(var e=!0,r=0;r<qn;r++)if(!this.chars[r].equals(t.chars[r])){e=!1;break}return e},ui.copy=function(t){for(var e=0;e<qn;e++)this.chars[e].copy(t.chars[e])},ui.isEmpty=function(){for(var t=!0,e=0;e<qn;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},ui.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>qn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=qn)},ui.moveCursor=function(t){var e=this.pos+t;if(1<t)for(var r=this.pos+1;r<e+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(e)},ui.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},ui.insertChar=function(t){var e=this;144<=t&&this.backSpace();var r=Gn(t);this.pos>=qn?this.logger.log(0,function(){return"Cannot insert "+t.toString(16)+" ("+r+") at position "+e.pos+". Skipping it!"}):(this.chars[this.pos].setChar(r,this.currPenState),this.moveCursor(1))},ui.clearFromPos=function(t){for(var e=t;e<qn;e++)this.chars[e].reset()},ui.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},ui.clearToEndOfRow=function(){this.clearFromPos(this.pos)},ui.getTextString=function(){for(var t=[],e=!0,r=0;r<qn;r++){var i=this.chars[r].uchar;" "!==i&&(e=!1),t.push(i)}return e?"":t.join("")},ui.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},ua),ia=((jr=la.prototype).reset=function(){for(var t=0;t<15;t++)this.rows[t].clear();this.currRow=14},jr.equals=function(t){for(var e=!0,r=0;r<15;r++)if(!this.rows[r].equals(t.rows[r])){e=!1;break}return e},jr.copy=function(t){for(var e=0;e<15;e++)this.rows[e].copy(t.rows[e])},jr.isEmpty=function(){for(var t=!0,e=0;e<15;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},jr.backSpace=function(){this.rows[this.currRow].backSpace()},jr.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},jr.insertChar=function(t){this.rows[this.currRow].insertChar(t)},jr.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},jr.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},jr.setCursor=function(t){this.logger.log(2,"setCursor: "+t),this.rows[this.currRow].setCursor(t)},jr.setPAC=function(t){this.logger.log(2,function(){return"pacData = "+JSON.stringify(t)});var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var r=0;r<15;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var a=n.rows[i].cueStartTime,s=this.logger.time;if(a&&null!==s&&a<s)for(var o=0;o<this.nrRollUpRows;o++)this.rows[e-this.nrRollUpRows+o+1].copy(n.rows[i+o])}}this.currRow=e;s=this.rows[this.currRow];null!==t.indent&&(l=t.indent,l=Math.max(l-1,0),s.setCursor(t.indent),t.color=s.chars[l].penState.foreground);var l={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(l)},jr.setBkgData=function(t){this.logger.log(2,function(){return"bkgData = "+JSON.stringify(t)}),this.backSpace(),this.setPen(t),this.insertChar(32)},jr.setRollUpRows=function(t){this.nrRollUpRows=t},jr.rollUp=function(){var t,e=this;null!==this.nrRollUpRows?(this.logger.log(1,function(){return e.getDisplayText()}),t=this.currRow+1-this.nrRollUpRows,(t=this.rows.splice(t,1)[0]).clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")):this.logger.log(3,"roll_up but nrRollUpRows not set yet")},jr.getDisplayText=function(t){t=t||!1;for(var e,r=[],i="",n=0;n<15;n++){var a=this.rows[n].getTextString();a&&(e=n+1,t?r.push("Row "+e+": '"+a+"'"):r.push(a.trim()))}return 0<r.length&&(i=t?"["+r.join(" | ")+"]":r.join("\n")),i},jr.getTextAndFormat=function(){return this.rows},la),na=((Qe=oa.prototype).reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},Qe.getHandler=function(){return this.outputFilter},Qe.setHandler=function(t){this.outputFilter=t},Qe.setPAC=function(t){this.writeScreen.setPAC(t)},Qe.setBkgData=function(t){this.writeScreen.setBkgData(t)},Qe.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(2,function(){return"MODE="+t}),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},Qe.insertChars=function(t){for(var e=this,r=0;r<t.length;r++)this.writeScreen.insertChar(t[r]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,function(){return i+": "+e.writeScreen.getDisplayText(!0)}),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,function(){return"DISPLAYED: "+e.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},Qe.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},Qe.ccBS=function(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},Qe.ccAOF=function(){},Qe.ccAON=function(){},Qe.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},Qe.ccRU=function(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},Qe.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},Qe.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},Qe.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},Qe.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},Qe.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},Qe.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},Qe.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},Qe.ccEOC=function(){var t,e=this;this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode&&(t=this.displayedMemory,this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,function(){return"DISP: "+e.displayedMemory.getDisplayText()})),this.outputDataUpdate(!0)},Qe.ccTO=function(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},Qe.ccMIDROW=function(t){var e={flash:!1};e.underline=t%2==1,e.italics=46<=t,e.italics?e.foreground="white":(t=Math.floor(t/2)-16,e.foreground=["white","green","blue","cyan","red","yellow","magenta"][t]),this.logger.log(2,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},Qe.outputDataUpdate=function(t){void 0===t&&(t=!1);var e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},Qe.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},oa),aa=((Zr=sa.prototype).getHandler=function(t){return this.channels[t].getHandler()},Zr.setHandler=function(t,e){this.channels[t].setHandler(e)},Zr.addData=function(t,e){var r,i=!1;this.logger.time=t;for(var n=0;n<e.length;n+=2){var a,s=127&e[n],o=127&e[n+1];0==s&&0==o||(this.logger.log(3,"["+Kn([e[n],e[n+1]])+"] -> ("+Kn([s,o])+")"),(r=this.parseCmd(s,o))||(r=this.parseMidrow(s,o)),!(r=(r=r||this.parsePAC(s,o))||this.parseBackgroundAttributes(s,o))&&(i=this.parseChars(s,o))&&((a=this.currentChannel)&&0<a?this.channels[a].insertChars(i):this.logger.log(2,"No channel found yet. TEXT-MODE?")),r||i||this.logger.log(2,"Couldn't parse cleaned data "+Kn([s,o])+" orig: "+Kn([e[n],e[n+1]])))}},Zr.parseCmd=function(t,e){var r=this.cmdHistory;if(!((20===t||28===t||21===t||29===t)&&32<=e&&e<=47||(23===t||31===t)&&33<=e&&e<=35))return!1;if(va(t,e,r))return ma(null,null,r),this.logger.log(3,"Repeated command ("+Kn([t,e])+") is dropped"),!0;var i=20===t||21===t||23===t?1:2,n=this.channels[i];return 20===t||21===t||28===t||29===t?32===e?n.ccRCL():33===e?n.ccBS():34===e?n.ccAOF():35===e?n.ccAON():36===e?n.ccDER():37===e?n.ccRU(2):38===e?n.ccRU(3):39===e?n.ccRU(4):40===e?n.ccFON():41===e?n.ccRDC():42===e?n.ccTR():43===e?n.ccRTD():44===e?n.ccEDM():45===e?n.ccCR():46===e?n.ccENM():47===e&&n.ccEOC():n.ccTO(e-32),ma(t,e,r),this.currentChannel=i,!0},Zr.parseMidrow=function(t,e){var r=0;if((17===t||25===t)&&32<=e&&e<=47){if((r=17===t?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;r=this.channels[r];return!!r&&(r.ccMIDROW(e),this.logger.log(3,"MIDROW ("+Kn([t,e])+")"),!0)}return!1},Zr.parsePAC=function(t,e){var r=this.cmdHistory;if(!((17<=t&&t<=23||25<=t&&t<=31)&&64<=e&&e<=127||(16===t||24===t)&&64<=e&&e<=95))return!1;if(va(t,e,r))return ma(null,null,r),!0;var i=t<=23?1:2,n=(64<=e&&e<=95?1==i?Xn:Qn:1==i?zn:$n)[t],a=this.channels[i];return!!a&&(a.setPAC(this.interpretPAC(n,e)),ma(t,e,r),this.currentChannel=i,!0)},Zr.interpretPAC=function(t,e){t={color:null,italics:!1,indent:null,underline:!1,row:t},e=95<e?e-96:e-64;return t.underline=1==(1&e),e<=13?t.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(e/2)]:e<=15?(t.italics=!0,t.color="white"):t.indent=4*Math.floor((e-16)/2),t},Zr.parseChars=function(t,e){var r,i,n=null,a=null;return 17<=(a=25<=t?(r=2,t-8):(r=1,t))&&a<=19?(i=17===a?e+80:18===a?e+112:e+144,this.logger.log(2,"Special char '"+Gn(i)+"' in channel "+r),n=[i]):32<=t&&t<=127&&(n=0===e?[t]:[t,e]),n&&(i=Kn(n),this.logger.log(3,"Char codes =  "+i.join(",")),ma(t,e,this.cmdHistory)),n},Zr.parseBackgroundAttributes=function(t,e){if(!((16===t||24===t)&&32<=e&&e<=47||(23===t||31===t)&&45<=e&&e<=47))return!1;var r={};16===t||24===t?(i=Math.floor((e-32)/2),r.background=Jn[i],e%2==1&&(r.background=r.background+"_semi")):45===e?r.background="transparent":(r.foreground="black",47===e&&(r.underline=!0));var i=t<=23?1:2;return this.channels[i].setBkgData(r),ma(t,e,this.cmdHistory),!0},Zr.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var e=this.channels[t];e&&e.reset()}this.cmdHistory={a:null,b:null}},Zr.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++){var r=this.channels[e];r&&r.cueSplitAtTime(t)}},sa);function sa(t,e,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var i=new Zn;this.channels=[null,new na(t,e,i),new na(t+1,r,i)],this.cmdHistory={a:null,b:null},this.logger=i}function oa(t,e,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new ia(r),this.nonDisplayedMemory=new ia(r),this.lastOutputScreen=new ia(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}function la(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<15;e++)this.rows.push(new ra(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}function ua(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<qn;e++)this.chars.push(new ea);this.logger=t,this.pos=0,this.currPenState=new ta}function ha(t,e,r,i,n,a){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new ta(e,r,i,n,a)}function da(t,e,r,i,n){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=r||!1,this.background=i||"black",this.flash=n||!1}function ca(){this.time=null,this.verboseLevel=0}function fa(t){var r=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=r.media,e=r.mediaSource;at.log("[buffer-controller]: Media source opened"),t&&(t.removeEventListener("emptied",r._onMediaEmptied),r.updateMediaElementDuration(),r.hls.trigger(rt.MEDIA_ATTACHED,{media:t})),e&&e.removeEventListener("sourceopen",r._onMediaSourceOpen),r.checkPendingTracks()},this._onMediaSourceClose=function(){at.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){at.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var t=r.media,e=r._objectUrl;t&&t.src!==e&&at.error("Media element src was set while attaching MediaSource ("+e+" > "+t.src+")")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}function ga(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}function ma(t,e,r){r.a=t,r.b=e}function va(t,e,r){return r.a===t&&r.b===e}var pa=((_=Sa.prototype).dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},_.newCue=function(t,e,r){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},_.reset=function(){this.cueRanges=[],this.startTime=null},Sa),ya=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var T=["","lr","rl"],e=["start","middle","end","left","right"];function E(t,e){if("string"!=typeof e)return!1;if(!Array.isArray(t))return!1;e=e.toLowerCase();return!!~t.indexOf(e)&&e}function S(t){return E(e,t)}function L(t){for(var e=arguments.length,r=new Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];for(var n=1;n<arguments.length;n++){var a,s=arguments[n];for(a in s)t[a]=s[a]}return t}function t(t,e,r){var i=this,n={enumerable:!0};i.hasBeenReset=!1;var a="",s=!1,o=t,l=e,u=r,h=null,d="",c=!0,f="auto",g="start",m=50,v="middle",p=50,y="middle";Object.defineProperty(i,"id",L({},n,{get:function(){return a},set:function(t){a=""+t}})),Object.defineProperty(i,"pauseOnExit",L({},n,{get:function(){return s},set:function(t){s=!!t}})),Object.defineProperty(i,"startTime",L({},n,{get:function(){return o},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");o=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"endTime",L({},n,{get:function(){return l},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");l=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"text",L({},n,{get:function(){return u},set:function(t){u=""+t,this.hasBeenReset=!0}})),Object.defineProperty(i,"region",L({},n,{get:function(){return h},set:function(t){h=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"vertical",L({},n,{get:function(){return d},set:function(t){t=E(T,t);if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"snapToLines",L({},n,{get:function(){return c},set:function(t){c=!!t,this.hasBeenReset=!0}})),Object.defineProperty(i,"line",L({},n,{get:function(){return f},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");f=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"lineAlign",L({},n,{get:function(){return g},set:function(t){t=S(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");g=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"position",L({},n,{get:function(){return m},set:function(t){if(t<0||100<t)throw new Error("Position must be between 0 and 100.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"positionAlign",L({},n,{get:function(){return v},set:function(t){t=S(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"size",L({},n,{get:function(){return p},set:function(t){if(t<0||100<t)throw new Error("Size must be between 0 and 100.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"align",L({},n,{get:function(){return y},set:function(t){t=S(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),i.displayState=void 0}return t.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},t}(),Ta=(Ea.prototype.decode=function(t,e){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))},Ea);function Ea(){}function Sa(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}function La(t){function e(t,e,r,i){return 3600*(0|t)+60*(0|e)+(0|r)+parseFloat(i||0)}t=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?59<parseFloat(t[2])?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}var Ra=((di=Aa.prototype).set=function(t,e){this.get(t)||""===e||(this.values[t]=e)},di.get=function(t,e,r){return r?this.has(t)?this.values[t]:e[r]:this.has(t)?this.values[t]:e},di.has=function(t){return t in this.values},di.alt=function(t,e,r){for(var i=0;i<r.length;++i)if(e===r[i]){this.set(t,e);break}},di.integer=function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},di.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){e=parseFloat(e);if(0<=e&&e<=100)return this.set(t,e),!0}return!1},Aa);function Aa(){this.values=Object.create(null)}function ka(t,e,r,i){var n,a,s=i?t.split(i):[t];for(n in s)"string"!=typeof s[n]||2===(a=s[n].split(r)).length&&e(a[0],a[1])}var ba=new ya(0,0,""),Da="middle"===ba.align?"middle":"center";function Ia(t){return t.replace(/<br(?: \/)?>/gi,"\n")}function wa(t,e,r){return void 0===r&&(r=0),t.slice(r,r+e.length)===e}var Ca=((zi=xa.prototype).parse=function(t){var i=this;function e(){for(var t=0,e=Ia(e=i.buffer);t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var r=e.slice(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,i.buffer=e.slice(t),r}t&&(i.buffer+=i.decoder.decode(t,{stream:!0}));try{var r="";if("INITIAL"===i.state){if(!/\r\n|\n/.test(i.buffer))return this;var n=(r=e()).match(/^()?WEBVTT([ \t].*)?$/);if(null==n||!n[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var a=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(a?a=!1:r=e(),i.state){case"HEADER":/:/.test(r)?ka(r,function(t,e){},/:/):r||(i.state="ID");continue;case"NOTE":r||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){i.state="NOTE";break}if(!r)continue;if(i.cue=new ya(0,0,""),i.state="CUE",-1===r.indexOf("--\x3e")){i.cue.id=r;continue}case"CUE":if(!i.cue){i.state="BADCUE";continue}try{!function(e,t,n){var r,a,i=e;function s(){var t=La(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function o(){e=e.replace(/^\s+/,"")}if(o(),t.startTime=s(),o(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.slice(3),o(),t.endTime=s(),o(),r=e,t=t,a=new Ra,ka(r,function(t,e){var r;switch(t){case"region":for(var i=n.length-1;0<=i;i--)if(n[i].id===e){a.set(t,n[i].region);break}break;case"vertical":a.alt(t,e,["rl","lr"]);break;case"line":r=e.split(","),a.integer(t,r[0]),a.percent(t,r[0])&&a.set("snapToLines",!1),a.alt(t,r[0],["auto"]),2===r.length&&a.alt("lineAlign",r[1],["start",Da,"end"]);break;case"position":r=e.split(","),a.percent(t,r[0]),2===r.length&&a.alt("positionAlign",r[1],["start",Da,"end","line-left","line-right","auto"]);break;case"size":a.percent(t,e);break;case"align":a.alt(t,e,["start",Da,"end","left","right"])}},/:/,/\s/),t.region=a.get("region",null),t.vertical=a.get("vertical",""),"auto"===(r=a.get("line","auto"))&&-1===ba.line&&(r=-1),t.line=r,t.lineAlign=a.get("lineAlign","start"),t.snapToLines=a.get("snapToLines",!0),t.size=a.get("size",100),t.align=a.get("align",Da),"auto"===(r=a.get("position","auto"))&&50===ba.position&&(r="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=r}(r,i.cue,i.regionList)}catch(t){i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":var s=-1!==r.indexOf("--\x3e");if(!r||s&&(a=!0)){i.oncue&&i.cue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}if(null===i.cue)continue;i.cue.text&&(i.cue.text+="\n"),i.cue.text+=r;continue;case"BADCUE":r||(i.state="ID")}}}catch(t){"CUETEXT"===i.state&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state="INITIAL"===i.state?"BADWEBVTT":"BADCUE"}return this},zi.flush=function(){var e=this;try{if(!e.cue&&"HEADER"!==e.state||(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},xa),_a=/\r\n|\n\r|\n|\r/g,Pa=function(t){for(var e=5381,r=t.length;r;)e=33*e^t.charCodeAt(--r);return(e>>>0).toString()};function xa(){this.state="INITIAL",this.buffer="",this.decoder=new Ta,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}function Fa(t,e,r){return Pa(t.toString())+Pa(e.toString())+Pa(r)}function Ma(t,e,n,a,s,r,i){var o,l=new Ca,u=pt(new Uint8Array(t)).trim().replace(_a,"\n").split("\n"),h=[],d=(t=e.baseTime,void 0===(e=e.timescale)&&(e=1),Ui(t,9e4,1/e)),c="00:00.000",f=0,g=0,m=!0;l.oncue=function(t){var e=n[a],r=n.ccOffset,i=(f-d)/9e4;null!=e&&e.new&&(void 0!==g?r=n.ccOffset=e.start:function(t,e){var r=t[a],i=t[r.prevCC];if(!i||!i.new&&r.new)return t.ccOffset=t.presentationOffset=r.start,r.new=!1;for(;null!=i&&i.new;)t.ccOffset+=r.start-i.start,r.new=!1,i=t[(r=i).prevCC];t.presentationOffset=e}(n,i)),i&&(r=i-n.presentationOffset);i=t.endTime-t.startTime,r=Vi(9e4*(t.startTime+r-g),9e4*s)/9e4;t.startTime=Math.max(r,0),t.endTime=Math.max(r+i,0);i=t.text.trim();t.text=decodeURIComponent(encodeURIComponent(i)),t.id||(t.id=Fa(t.startTime,t.endTime,i)),0<t.endTime&&h.push(t)},l.onparsingerror=function(t){o=t},l.onflush=function(){o?i(o):r(h)},u.forEach(function(t){if(m){if(wa(t,"X-TIMESTAMP-MAP=")){m=!1,t.slice(16).split(",").forEach(function(t){wa(t,"LOCAL:")?c=t.slice(6):wa(t,"MPEGTS:")&&(f=parseInt(t.slice(7)))});try{g=function(t){var e=parseInt(t.slice(-3)),r=parseInt(t.slice(-6,-4)),i=parseInt(t.slice(-9,-7)),n=9<t.length?parseInt(t.substring(0,t.indexOf(":"))):0;if(!(G(e)&&G(r)&&G(i)&&G(n)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t);return e+=1e3*r,(e+=6e4*i)+36e5*n}(c)/1e3}catch(t){o=t}return}""===t&&(m=!1)}l.parse(t+"\n")}),l.flush()}var Oa="stpp.ttml.im1t",Na=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Ua=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Ba={left:"start",center:"center",right:"end",start:"start",end:"end"};function Ga(t,e,r,i){var n=Dt(new Uint8Array(t),["mdat"]);if(0!==n.length){var a,s=n.map(function(t){return pt(t)}),o=(n=e.baseTime,void 0===(e=e.timescale)&&(e=1),void 0===a&&(a=!1),Ui(n,1,1/e,a));try{s.forEach(function(t){return r(function(t,u){var r=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");var i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},h=Object.keys(i).reduce(function(t,e){return t[e]=r.getAttribute("ttp:"+e)||i[e],t},{}),d="preserve"!==r.getAttribute("xml:space"),c=Ha(Ka(r,"styling","style")),f=Ha(Ka(r,"layout","region")),t=Ka(r,"body","[begin]");return[].map.call(t,function(t){var e=function i(t,n){return[].slice.call(t.childNodes).reduce(function(t,e,r){return"br"===e.nodeName&&r?t+"\n":null!=(r=e.childNodes)&&r.length?i(e,n):n?t+e.textContent.trim().replace(/\s+/g," "):t+e.textContent},"")}(t,d);if(!e||!t.hasAttribute("begin"))return null;var r=Wa(t.getAttribute("begin"),h),i=Wa(t.getAttribute("dur"),h),n=Wa(t.getAttribute("end"),h);if(null===r)throw Ya(t);if(null===n){if(null===i)throw Ya(t);n=r+i}r=new ya(r-u,n-u,e);r.id=Fa(r.startTime,r.endTime,r.text);var a,s,o,l,t=(a=f[t.getAttribute("region")],s=c[t.getAttribute("style")],n=c,o="http://www.w3.org/ns/ttml#styling",(e=(l=null)!=a&&a.hasAttribute("style")?a.getAttribute("style"):null)&&n.hasOwnProperty(e)&&(l=n[e]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(t,e){var r=Va(s,o,e)||Va(a,o,e)||Va(l,o,e);return r&&(t[e]=r),t},{})),n=t.textAlign;return n&&((e=Ba[n])&&(r.lineAlign=e),r.align=n),et(r,t),r}).filter(function(t){return null!==t})}(t,o))})}catch(t){i(t)}}else i(new Error("Could not parse IMSC1 mdat"))}function Ka(t,e,r){e=t.getElementsByTagName(e)[0];return e?[].slice.call(e.querySelectorAll(r)):[]}function Ha(t){return t.reduce(function(t,e){var r=e.getAttribute("xml:id");return r&&(t[r]=e),t},{})}function Va(t,e,r){return t&&t.hasAttributeNS(e,r)?t.getAttributeNS(e,r):null}function Ya(t){return new Error("Could not parse ttml timestamp "+t)}function Wa(i,t){if(!i)return null;var e,r,n,a=La(i);return null===a&&(Na.test(i)?(e=t,r=Na.exec(i),n=(0|r[4])+(0|r[5])/e.subFrameRate,a=3600*(0|r[1])+60*(0|r[2])+(0|r[3])+n/e.frameRate):Ua.test(i)&&(a=function(t){var e=Ua.exec(i),r=Number(e[1]);switch(e[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/t.frameRate;case"t":return r/t.tickRate}return r}(t))),a}(ui=ja.prototype).destroy=function(){var t=this.hls;t.off(rt.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(rt.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.off(rt.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(rt.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(rt.FRAG_LOADING,this.onFragLoading,this),t.off(rt.FRAG_LOADED,this.onFragLoaded,this),t.off(rt.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(rt.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(rt.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(rt.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(rt.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},ui.addCues=function(t,e,r,i,n){for(var a,s,o,l=!1,u=n.length;u--;){var h=n[u],d=(a=h[0],s=h[1],d=e,Math.min(s,r)-Math.max(a,d));if(0<=d&&(h[0]=Math.min(h[0],e),h[1]=Math.max(h[1],r),l=!0,.5<d/(r-e)))return}l||n.push([e,r]),this.config.renderTextTracksNatively?(o=this.captionsTracks[t],this.Cues.newCue(o,e,r,i)):(i=this.Cues.newCue(null,e,r,i),this.hls.trigger(rt.CUES_PARSED,{type:"captions",cues:i,track:t}))},ui.onInitPtsFound=function(t,e){var r=this,i=e.frag,n=e.id,a=e.initPTS,s=e.timescale,e=this.unparsedVttFrags;"main"===n&&(this.initPTS[i.cc]={baseTime:a,timescale:s}),e.length&&(this.unparsedVttFrags=[],e.forEach(function(t){r.onFragLoaded(rt.FRAG_LOADED,t)}))},ui.getExistingTrack=function(t){var e=this.media;if(e)for(var r=0;r<e.textTracks.length;r++){var i=e.textTracks[r];if(i[t])return i}return null},ui.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},ui.createNativeTrack=function(t){var e,r,i,n,a;this.captionsTracks[t]||(a=this.captionsProperties,e=this.captionsTracks,r=this.media,i=(n=a[t]).label,a=n.languageCode,(n=this.getExistingTrack(t))?(e[t]=n,pe(e[t]),me(e[t],r)):(a=this.createTextTrack("captions",i,a))&&(a[t]=!0,e[t]=a))},ui.createNonNativeTrack=function(t){var e;this.nonNativeCaptionsTracks[t]||(e=this.captionsProperties[t])&&(e={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media},this.nonNativeCaptionsTracks[t]=e,this.hls.trigger(rt.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[e]}))},ui.createTextTrack=function(t,e,r){var i=this.media;if(i)return i.addTextTrack(t,e,r)},ui.onMediaAttaching=function(t,e){this.media=e.media,this._cleanTracks()},ui.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){pe(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},ui.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},ui._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var r=0;r<e.length;r++)pe(e[r])}},ui.onSubtitleTracksUpdated=function(t,e){var o,l=this,r=e.subtitleTracks||[],e=r.some(function(t){return t.textCodec===Oa});(this.config.enableWebVTT||e&&this.config.enableIMSC1)&&(On(this.tracks,r)?this.tracks=r:(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively?(o=this.media?this.media.textTracks:null,this.tracks.forEach(function(t,e){var r,i,n;if(o&&e<o.length){for(var a=null,s=0;s<o.length;s++)if(i=o[s],n=t,!!i&&i.label===n.name&&!(i.textTrack1||i.textTrack2)){a=o[s];break}a&&(r=a)}r?pe(r):(e=l._captionsOrSubtitlesFromCharacteristics(t),(r=l.createTextTrack(e,t.name,t.lang))&&(r.mode="disabled")),r&&(r.groupId=t.groupId,l.textTracks.push(r))})):this.tracks.length&&(r=this.tracks.map(function(t){return{label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}}),this.hls.trigger(rt.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:r}))))},ui._captionsOrSubtitlesFromCharacteristics=function(t){if(t.attrs.CHARACTERISTICS){var e=/transcribes-spoken-dialog/gi.test(t.attrs.CHARACTERISTICS),t=/describes-music-and-sound/gi.test(t.attrs.CHARACTERISTICS);if(e&&t)return"captions"}return"subtitles"},ui.onManifestLoaded=function(t,e){var r=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(t){var e=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);e&&(e="textTrack"+e[1],(e=r.captionsProperties[e])&&(e.label=t.name,t.lang&&(e.languageCode=t.lang),e.media=t))})},ui.closedCaptionsForLevel=function(t){t=this.hls.levels[t.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]},ui.onFragLoading=function(t,e){var r,i,n=this.cea608Parser1,a=this.cea608Parser2,s=this.lastSn,o=this.lastPartIndex;this.enabled&&n&&a&&e.frag.type===le&&(r=e.frag.sn,i=null!=(i=null==e||null==(i=e.part)?void 0:i.index)?i:-1,r===s+1||r===s&&i===o+1||(n.reset(),a.reset()),this.lastSn=r,this.lastPartIndex=i)},ui.onFragLoaded=function(t,e){var r=e.frag,i=e.payload,n=this.initPTS,a=this.unparsedVttFrags;if(r.type===he)if(i.byteLength){if(!n[r.cc])return a.push(e),void(n.length&&this.hls.trigger(rt.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")}));n=r.decryptdata,e="stats"in e;null!=n&&n.encrypted&&!e||(n=this.tracks[r.level],(e=this.vttCCs)[r.cc]||(e[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),n&&n.textCodec===Oa?this._parseIMSC1(r,i):this._parseVTTs(r,i,e))}else this.hls.trigger(rt.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},ui._parseIMSC1=function(e,t){var r=this,i=this.hls;Ga(t,this.initPTS[e.cc],function(t){r._appendCues(t,e.level),i.trigger(rt.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){at.log("Failed to parse IMSC1: "+t),i.trigger(rt.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})},ui._parseVTTs=function(e,r,t){var i,n=this,a=this.hls;Ma(null!=(i=e.initSegment)&&i.data?Ct(e.initSegment.data,new Uint8Array(r)):r,this.initPTS[e.cc],t,e.cc,e.start,function(t){n._appendCues(t,e.level),a.trigger(rt.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){n._fallbackToIMSC1(e,r),at.log("Failed to parse VTT cue: "+t),a.trigger(rt.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})},ui._fallbackToIMSC1=function(t,e){var r=this,i=this.tracks[t.level];i.textCodec||Ga(e,this.initPTS[t.cc],function(){i.textCodec=Oa,r._parseIMSC1(t,e)},function(){i.textCodec="wvtt"})},ui._appendCues=function(t,e){var r,i,n=this.hls;this.config.renderTextTracksNatively?(r=this.textTracks[e])&&"disabled"!==r.mode&&t.forEach(function(t){return ve(r,t)}):(i=this.tracks[e])&&(e=i.default?"default":"subtitles"+e,n.trigger(rt.CUES_PARSED,{type:"subtitles",cues:t,track:e}))},ui.onFragDecrypted=function(t,e){var r=e.frag;r.type===he&&(this.initPTS[r.cc]?this.onFragLoaded(rt.FRAG_LOADED,e):this.unparsedVttFrags.push(e))},ui.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},ui.onFragParsingUserdata=function(t,e){var r=this.cea608Parser1,i=this.cea608Parser2;if(this.enabled&&r&&i){var n=e.frag,a=e.samples;if(n.type!==le||"NONE"!==this.closedCaptionsForLevel(n))for(var s=0;s<a.length;s++){var o=a[s].bytes;o&&(o=this.extractCea608Data(o),r.addData(a[s].pts,o[0]),i.addData(a[s].pts,o[1]))}}},ui.onBufferFlushing=function(t,e){var r,i,n=e.startOffset,a=e.endOffset,s=e.endOffsetSubtitles,o=e.type,e=this.media;!e||e.currentTime<a||(o&&"video"!==o||(r=this.captionsTracks,Object.keys(r).forEach(function(t){return ye(r[t],n,a)})),this.config.renderTextTracksNatively&&0===n&&void 0!==s&&(i=this.textTracks,Object.keys(i).forEach(function(t){return ye(i[t],n,s)})))},ui.extractCea608Data=function(t){for(var e=[[],[]],r=31&t[0],i=2,n=0;n<r;n++){var a=t[i++],s=127&t[i++],o=127&t[i++];0==s&&0==o||0==(4&a)||(0!=(a=3&a)&&1!=a||(e[a].push(s),e[a].push(o)))}return e},jr=ja;function ja(t){var e,r,i,n;this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions&&(e=new pa(this,"textTrack1"),r=new pa(this,"textTrack2"),i=new pa(this,"textTrack3"),n=new pa(this,"textTrack4"),this.cea608Parser1=new aa(1,e,r),this.cea608Parser2=new aa(3,i,n)),t.on(rt.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(rt.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.on(rt.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(rt.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(rt.FRAG_LOADING,this.onFragLoading,this),t.on(rt.FRAG_LOADED,this.onFragLoaded,this),t.on(rt.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(rt.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(rt.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(rt.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(rt.BUFFER_FLUSHING,this.onBufferFlushing,this)}var Zr=((Qe=Qa.prototype).setStreamController=function(t){this.streamController=t},Qe.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},Qe.registerListeners=function(){var t=this.hls;t.on(rt.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(rt.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(rt.MANIFEST_PARSED,this.onManifestParsed,this),t.on(rt.BUFFER_CODECS,this.onBufferCodecs,this),t.on(rt.MEDIA_DETACHING,this.onMediaDetaching,this)},Qe.unregisterListener=function(){var t=this.hls;t.off(rt.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(rt.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(rt.MANIFEST_PARSED,this.onManifestParsed,this),t.off(rt.BUFFER_CODECS,this.onBufferCodecs,this),t.off(rt.MEDIA_DETACHING,this.onMediaDetaching,this)},Qe.onFpsDropLevelCapping=function(t,e){e=this.hls.levels[e.droppedLevel];this.isLevelAllowed(e)&&this.restrictedLevels.push({bitrate:e.bitrate,height:e.height,width:e.width})},Qe.onMediaAttaching=function(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null},Qe.onManifestParsed=function(t,e){var r=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,r.config.capLevelToPlayerSize&&e.video&&this.startCapping()},Qe.onBufferCodecs=function(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},Qe.onMediaDetaching=function(){this.stopCapping()},Qe.detectPlayerSize=function(){var t,e;this.media&&0<this.mediaHeight&&0<this.mediaWidth&&((t=this.hls.levels).length&&((e=this.hls).autoLevelCapping=this.getMaxLevel(t.length-1),e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping))},Qe.getMaxLevel=function(r){var i=this,t=this.hls.levels;if(!t.length)return-1;t=t.filter(function(t,e){return i.isLevelAllowed(t)&&e<=r});return this.clientRect=null,Qa.getMaxLevelByMediaSize(t,this.mediaWidth,this.mediaHeight)},Qe.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},Qe.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},Qe.getDimensions=function(){if(this.clientRect)return this.clientRect;var t,e=this.media,r={width:0,height:0};return e&&(t=e.getBoundingClientRect(),r.width=t.width,r.height=t.height,r.width||r.height||(r.width=t.right-t.left||e.width||0,r.height=t.bottom-t.top||e.height||0)),this.clientRect=r},Qe.isLevelAllowed=function(e){return!this.restrictedLevels.some(function(t){return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height})},Qa.getMaxLevelByMediaSize=function(t,e,r){if(null==t||!t.length)return-1;for(var i,n=t.length-1,a=0;a<t.length;a+=1){var s=t[a];if((s.width>=e||s.height>=r)&&(!(i=t[a+1])||s.width!==i.width||s.height!==i.height)){n=a;break}}return n},o(Qa,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch(t){}return t}}]),Qa),di=((_=za.prototype).setStreamController=function(t){this.streamController=t},_.registerListeners=function(){this.hls.on(rt.MEDIA_ATTACHING,this.onMediaAttaching,this)},_.unregisterListeners=function(){this.hls.off(rt.MEDIA_ATTACHING,this.onMediaAttaching,this)},_.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},_.onMediaAttaching=function(t,e){var r=this.hls.config;r.capLevelOnFPSDrop&&(e=e.media instanceof self.HTMLVideoElement?e.media:null,(this.media=e)&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod))},_.checkFPS=function(t,e,r){var i,n,a,s,o=performance.now();e&&(this.lastTime&&(a=o-this.lastTime,i=r-this.lastDroppedFrames,s=e-this.lastDecodedFrames,n=1e3*i/a,(a=this.hls).trigger(rt.FPS_DROP,{currentDropped:i,currentDecoded:s,totalDroppedFrames:r}),0<n&&i>a.config.fpsDroppedMonitoringThreshold*s&&(s=a.currentLevel,at.warn("drop FPS ratio greater than max allowed value for currentLevel: "+s),0<s&&(-1===a.autoLevelCapping||a.autoLevelCapping>=s)&&(--s,a.trigger(rt.FPS_DROP_LEVEL_CAPPING,{level:s,droppedLevel:a.currentLevel}),a.autoLevelCapping=s,this.streamController.nextLevelSwitch()))),this.lastTime=o,this.lastDroppedFrames=r,this.lastDecodedFrames=e)},_.checkFPSInterval=function(){var t,e=this.media;e&&(this.isVideoPlaybackQualityAvailable?(t=e.getVideoPlaybackQuality(),this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)):this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount))},za),qa="[eme]",ui=((zi=Xa.prototype).destroy=function(){this.unregisterListeners(),this.onMediaDetached();var t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null},zi.registerListeners=function(){this.hls.on(rt.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(rt.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(rt.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(rt.MANIFEST_LOADED,this.onManifestLoaded,this)},zi.unregisterListeners=function(){this.hls.off(rt.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(rt.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(rt.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(rt.MANIFEST_LOADED,this.onManifestLoaded,this)},zi.getLicenseServerUrl=function(t){var e=this.config,r=e.drmSystems,e=e.widevineLicenseUrl,r=r[t];if(r)return r.licenseUrl;if(t===U.WIDEVINE&&e)return e;throw new Error('no license server URL configured for key-system "'+t+'"')},zi.getServerCertificateUrl=function(t){var e=this.config.drmSystems[t];if(e)return e.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+t+'"]')},zi.attemptKeySystemAccess=function(t){function e(t,e,r){return!!t&&r.indexOf(t)===e}var s=this,r=this.hls.levels,o=r.map(function(t){return t.audioCodec}).filter(e),l=r.map(function(t){return t.videoCodec}).filter(e);return o.length+l.length===0&&l.push("avc1.42e01e"),new Promise(function(n,a){!function e(r){var i=r.shift();s.getMediaKeysPromise(i,o,l).then(function(t){return n({keySystem:i,mediaKeys:t})}).catch(function(t){r.length?e(r):a(t instanceof Ja?t:new Ja({type:it.KEY_SYSTEM_ERROR,details:nt.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})}(t)})},zi.requestMediaKeySystemAccess=function(t,e){var r=this.config.requestMediaKeySystemAccessFunc;if("function"==typeof r)return r(t,e);r="Configured requestMediaKeySystemAccess is not a function "+r;return null===Z&&"http:"===self.location.protocol&&(r="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(r))},zi.getMediaKeysPromise=function(i,t,e){var n=this,t=function(t,e,r,i){var n,a;switch(t){case U.FAIRPLAY:n=["cenc","sinf"];break;case U.WIDEVINE:case U.PLAYREADY:n=["cenc"];break;case U.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+t)}return r=r,[{initDataTypes:n,persistentState:(a=i).persistentState||"not-allowed",distinctiveIdentifier:a.distinctiveIdentifier||"not-allowed",sessionTypes:a.sessionTypes||[a.sessionType||"temporary"],audioCapabilities:e.map(function(t){return{contentType:'audio/mp4; codecs="'+t+'"',robustness:a.audioRobustness||"",encryptionScheme:a.audioEncryptionScheme||null}}),videoCapabilities:r.map(function(t){return{contentType:'video/mp4; codecs="'+t+'"',robustness:a.videoRobustness||"",encryptionScheme:a.videoEncryptionScheme||null}})}]}(i,t,e,this.config.drmSystemOptions),r=this.keySystemAccessPromises[i],e=null==r?void 0:r.keySystemAccess;if(e)return e.then(function(){return r.mediaKeys});this.log('Requesting encrypted media "'+i+'" key-system access with config: '+JSON.stringify(t)),e=this.requestMediaKeySystemAccess(i,t);var a=this.keySystemAccessPromises[i]={keySystemAccess:e};return e.catch(function(t){n.log('Failed to obtain access to key-system "'+i+'": '+t)}),e.then(function(t){n.log('Access for key-system "'+t.keySystem+'" obtained');var r=n.fetchServerCertificate(i);return n.log('Create media-keys for "'+i+'"'),a.mediaKeys=t.createMediaKeys().then(function(e){return n.log('Media-keys created for "'+i+'"'),r.then(function(t){return t?n.setMediaKeysServerCertificate(e,i,t):e})}),a.mediaKeys.catch(function(t){n.error('Failed to create media-keys for "'+i+'"}: '+t)}),a.mediaKeys})},zi.createMediaKeySessionContext=function(t){var e=t.decryptdata,r=t.keySystem,i=t.mediaKeys;this.log('Creating key-system session "'+r+'" keyId: '+yt(e.keyId||[]));t=i.createSession(),t={decryptdata:e,keySystem:r,mediaKeys:i,mediaKeysSession:t,keyStatus:"status-pending"};return this.mediaKeySessions.push(t),t},zi.renewKeySession=function(t){var e,r,i=t.decryptdata;i.pssh?(e=this.createMediaKeySessionContext(t),r=this.getKeyIdString(i),this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(e,"cenc",i.pssh,"expired")):this.warn("Could not renew expired session. Missing pssh initData."),this.removeSession(t)},zi.getKeyIdString=function(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(null===t.keyId)throw new Error("keyId is null");return yt(t.keyId)},zi.updateKeySession=function(t,e){var r=t.mediaKeysSession;return this.log('Updating key-session "'+r.sessionId+'" for keyID '+yt((null==(t=t.decryptdata)?void 0:t.keyId)||[])+"\n      } (data length: "+(e&&e.byteLength)+")"),r.update(e)},zi.selectKeySystemFormat=function(t){var e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+t.sn+" "+t.type+": "+t.level+") key formats "+e.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise},zi.getKeyFormatPromise=function(n){var a=this;return new Promise(function(r,i){var e=J(a.config),t=n.map(z).filter(function(t){return!!t&&-1!==e.indexOf(t)});return a.getKeySystemSelectionPromise(t).then(function(t){var e=t.keySystem,t=$(e);t?r(t):i(new Error('Unable to find format for key-system "'+e+'"'))}).catch(i)})},zi.loadKey=function(i){var n=this,a=i.keyInfo.decryptdata,t=this.getKeyIdString(a),s="(keyId: "+t+' format: "'+a.keyFormat+'" method: '+a.method+" uri: "+a.uri+")";this.log("Starting session for key "+s);var e=this.keyIdToKeySessionPromise[t];return e||(e=this.keyIdToKeySessionPromise[t]=this.getKeySystemForKeyPromise(a).then(function(t){var e=t.keySystem,r=t.mediaKeys;return n.throwIfDestroyed(),n.log("Handle encrypted media sn: "+i.frag.sn+" "+i.frag.type+": "+i.frag.level+" using key "+s),n.attemptSetMediaKeys(e,r).then(function(){n.throwIfDestroyed();var t=n.createMediaKeySessionContext({keySystem:e,mediaKeys:r,decryptdata:a});return n.generateRequestWithPreferredKeySession(t,"cenc",a.pssh,"playlist-key")})})).catch(function(t){return n.handleError(t)}),e},zi.throwIfDestroyed=function(t){if(!this.hls)throw new Error("invalid state")},zi.handleError=function(t){this.hls&&(this.error(t.message),t instanceof Ja?this.hls.trigger(rt.ERROR,t.data):this.hls.trigger(rt.ERROR,{type:it.KEY_SYSTEM_ERROR,details:nt.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))},zi.getKeySystemForKeyPromise=function(t){var e=this.getKeyIdString(t),e=this.keyIdToKeySessionPromise[e];if(e)return e;t=z(t.keyFormat),t=t?[t]:J(this.config);return this.attemptKeySystemAccess(t)},zi.getKeySystemSelectionPromise=function(t){if(t.length||(t=J(this.config)),0===t.length)throw new Ja({type:it.KEY_SYSTEM_ERROR,details:nt.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(t)},zi._onMediaEncrypted=function(t){var n,e,a=this,s=t.initDataType,o=t.initData;if(this.debug('"'+t.type+'" event: init data type: "'+s+'"'),null!==o){if("sinf"===s&&this.config.drmSystems[U.FAIRPLAY]){var r=Lt(new Uint8Array(o));try{var i=O(JSON.parse(r).sinf),i=wt(new Uint8Array(i));if(!i)return;n=i.subarray(8,24),e=U.FAIRPLAY}catch(t){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var l=function(t){if(!(t instanceof ArrayBuffer)||t.byteLength<32)return null;var e={version:0,systemId:"",kids:null,data:null},r=new DataView(t),i=r.getUint32(0);if(t.byteLength!==i&&44<i)return null;if(1886614376!==r.getUint32(4))return null;if(e.version=r.getUint32(8)>>>24,1<e.version)return null;e.systemId=yt(new Uint8Array(t,12,16));var n=r.getUint32(28);if(0===e.version){if(i-32<n)return null;e.data=new Uint8Array(t,32,n)}else if(1===e.version){e.kids=[];for(var a=0;a<n;a++)e.kids.push(new Uint8Array(t,32+16*a,16))}return e}(o);if(null===l)return;0===l.version&&l.systemId===Q&&l.data&&(n=l.data.subarray(8,24)),e=function(){if(l.systemId===Q)return U.WIDEVINE}()}if(e&&n){for(var u=yt(n),h=this.keyIdToKeySessionPromise,d=this.mediaKeySessions,c=h[u],f=0;f<d.length;f++){var g=function(){var t=d[f],e=t.decryptdata;if(e.pssh||!e.keyId)return"continue";var r=yt(e.keyId);return u===r||-1!==e.uri.replace(/-/g,"").indexOf(u)?(c=h[r],delete h[r],e.pssh=new Uint8Array(o),e.keyId=n,c=h[u]=c.then(function(){return a.generateRequestWithPreferredKeySession(t,s,o,"encrypted-event-key-match")}),"break"):void 0}();if("continue"!==g&&"break"===g)break}(c=c||(h[u]=this.getKeySystemSelectionPromise([e]).then(function(t){var e=t.keySystem,r=t.mediaKeys;a.throwIfDestroyed();var i=new Mt("ISO-23001-7",u,null!=(t=$(e))?t:"");return i.pssh=new Uint8Array(o),i.keyId=n,a.attemptSetMediaKeys(e,r).then(function(){a.throwIfDestroyed();var t=a.createMediaKeySessionContext({decryptdata:i,keySystem:e,mediaKeys:r});return a.generateRequestWithPreferredKeySession(t,s,o,"encrypted-event-no-match")})}))).catch(function(t){return a.handleError(t)})}}},zi._onWaitingForKey=function(t){this.log('"'+t.type+'" event')},zi.attemptSetMediaKeys=function(t,e){var r=this,i=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+t+'"');var n=Promise.all(i).then(function(){if(!r.media)throw new Error("Attempted to set mediaKeys without media element attached");return r.media.setMediaKeys(e)});return this.setMediaKeysQueue.push(n),n.then(function(){r.log('Media-keys set for "'+t+'"'),i.push(n),r.setMediaKeysQueue=r.setMediaKeysQueue.filter(function(t){return-1===i.indexOf(t)})})},zi.generateRequestWithPreferredKeySession=function(i,t,e,r){var n,a,s=this,o=null==(n=this.config.drmSystems)||null==(a=n[i.keySystem])?void 0:a.generateRequest;if(o)try{var l=o.call(this.hls,t,e,i);if(!l)throw new Error("Invalid response from configured generateRequest filter");t=l.initDataType,e=i.decryptdata.pssh=l.initData?new Uint8Array(l.initData):null}catch(i){if(this.warn(i.message),null!=(a=this.hls)&&a.config.debug)throw i}if(null===e)return this.log('Skipping key-session request for "'+r+'" (no initData)'),Promise.resolve(i);var u=this.getKeyIdString(i.decryptdata);this.log('Generating key-session request for "'+r+'": '+u+" (init data type: "+t+" length: "+(e?e.byteLength:null)+")");var h=new pn;i.mediaKeysSession.onmessage=function(t){var e,r=i.mediaKeysSession;r?(e=t.messageType,t=t.message,s.log('"'+e+'" message event for session "'+r.sessionId+'" message size: '+t.byteLength),"license-request"===e||"license-renewal"===e?s.renewLicense(i,t).catch(function(t){s.handleError(t),h.emit("error",t)}):"license-release"===e?i.keySystem===U.FAIRPLAY&&(s.updateKeySession(i,N("acknowledged")),s.removeSession(i)):s.warn('unhandled media key message type "'+e+'"')):h.emit("error",new Error("invalid state"))},i.mediaKeysSession.onkeystatuseschange=function(t){var e;i.mediaKeysSession?(s.onKeyStatusChange(i),e=i.keyStatus,h.emit("keyStatus",e),"expired"===e&&(s.warn(i.keySystem+" expired for key "+u),s.renewKeySession(i))):h.emit("error",new Error("invalid state"))};var d=new Promise(function(e,r){h.on("error",r),h.on("keyStatus",function(t){t.startsWith("usable")?e():"output-restricted"===t?r(new Ja({type:it.KEY_SYSTEM_ERROR,details:nt.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===t?r(new Ja({type:it.KEY_SYSTEM_ERROR,details:nt.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+t+'"')):"expired"===t?r(new Error("key expired while generating request")):s.warn('unhandled key status change "'+t+'"')})});return i.mediaKeysSession.generateRequest(t,e).then(function(){var t;s.log('Request generated for key-session "'+(null==(t=i.mediaKeysSession)?void 0:t.sessionId)+'" keyId: '+u)}).catch(function(t){throw new Ja({type:it.KEY_SYSTEM_ERROR,details:nt.KEY_SYSTEM_NO_SESSION,error:t,fatal:!1},"Error generating key-session request: "+t)}).then(function(){return d}).catch(function(t){throw h.removeAllListeners(),s.removeSession(i),t}).then(function(){return h.removeAllListeners(),i})},zi.onKeyStatusChange=function(r){var i=this;r.mediaKeysSession.keyStatuses.forEach(function(t,e){i.log('key status change "'+t+'" for keyStatuses keyId: '+yt("buffer"in e?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e))+" session keyId: "+yt(new Uint8Array(r.decryptdata.keyId||[]))+" uri: "+r.decryptdata.uri),r.keyStatus=t})},zi.fetchServerCertificate=function(o){var r=this.config,i=new r.loader(r),l=this.getServerCertificateUrl(o);return l?(this.log('Fetching serverCertificate for "'+o+'"'),new Promise(function(n,a){var s={responseType:"arraybuffer",url:l},t=r.certLoadPolicy.default,e={loadPolicy:t,timeout:t.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},t={onSuccess:function(t,e,r,i){n(t.data)},onError:function(t,e,r,i){a(new Ja({type:it.KEY_SYSTEM_ERROR,details:nt.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:g({url:s.url,data:void 0},t)},'"'+o+'" certificate request failed ('+l+"). Status: "+t.code+" ("+t.text+")"))},onTimeout:function(t,e,r){a(new Ja({type:it.KEY_SYSTEM_ERROR,details:nt.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:{url:s.url,data:void 0}},'"'+o+'" certificate request timed out ('+l+")"))},onAbort:function(t,e,r){a(new Error("aborted"))}};i.load(s,e,t)})):Promise.resolve()},zi.setMediaKeysServerCertificate=function(i,n,a){var s=this;return new Promise(function(e,r){i.setServerCertificate(a).then(function(t){s.log("setServerCertificate "+(t?"success":"not supported by CDM")+" ("+(null==a?void 0:a.byteLength)+') on "'+n+'"'),e(i)}).catch(function(t){r(new Ja({type:it.KEY_SYSTEM_ERROR,details:nt.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:t,fatal:!0},t.message))})})},zi.renewLicense=function(e,t){var r=this;return this.requestLicense(e,new Uint8Array(t)).then(function(t){return r.updateKeySession(e,new Uint8Array(t)).catch(function(t){throw new Ja({type:it.KEY_SYSTEM_ERROR,details:nt.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:t,fatal:!0},t.message)})})},zi.setupLicenseXHR=function(e,r,i,n){var a=this,s=this.config.licenseXhrSetup;return s?Promise.resolve().then(function(){if(!i.decryptdata)throw new Error("Key removed");return s.call(a.hls,e,r,i,n)}).catch(function(t){if(!i.decryptdata)throw t;return e.open("POST",r,!0),s.call(a.hls,e,r,i,n)}).then(function(t){return e.readyState||e.open("POST",r,!0),{xhr:e,licenseChallenge:t||n}}):(e.open("POST",r,!0),Promise.resolve({xhr:e,licenseChallenge:n}))},zi.requestLicense=function(o,l){var u=this,h=this.config.keyLoadPolicy.default;return new Promise(function(i,n){var a=u.getLicenseServerUrl(o.keySystem);u.log("Sending license request to URL: "+a);var s=new XMLHttpRequest;s.responseType="arraybuffer",s.onreadystatechange=function(){if(!u.hls||!o.mediaKeysSession)return n(new Error("invalid state"));if(4===s.readyState)if(200===s.status){u._requestLicenseFailureCount=0;var t=s.response;u.log("License received "+(t instanceof ArrayBuffer?t.byteLength:t));var e=u.config.licenseResponseCallback;if(e)try{t=e.call(u.hls,s,a,o)}catch(t){u.error(t)}i(t)}else{var r=h.errorRetry,r=r?r.maxNumRetry:0;u._requestLicenseFailureCount++,u._requestLicenseFailureCount>r||400<=s.status&&s.status<500?n(new Ja({type:it.KEY_SYSTEM_ERROR,details:nt.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:s,response:{url:a,data:void 0,code:s.status,text:s.statusText}},"License Request XHR failed ("+a+"). Status: "+s.status+" ("+s.statusText+")")):(r=r-u._requestLicenseFailureCount+1,u.warn("Retrying license request, "+r+" attempts left"),u.requestLicense(o,l).then(i,n))}},o.licenseXhr&&o.licenseXhr.readyState!==XMLHttpRequest.DONE&&o.licenseXhr.abort(),o.licenseXhr=s,u.setupLicenseXHR(s,a,o,l).then(function(t){var e=t.xhr,t=t.licenseChallenge;e.send(t)})})},zi.onMediaAttached=function(t,e){this.config.emeEnabled&&(e=e.media,(this.media=e).addEventListener("encrypted",this.onMediaEncrypted),e.addEventListener("waitingforkey",this.onWaitingForKey))},zi.onMediaDetached=function(){var e=this,r=this.media,t=this.mediaKeySessions;r&&(r.removeEventListener("encrypted",this.onMediaEncrypted),r.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Mt.clearKeyUriToKeyIdMap();var i=t.length;Xa.CDMCleanupPromise=Promise.all(t.map(function(t){return e.removeSession(t)}).concat(null==r?void 0:r.setMediaKeys(null).catch(function(t){e.log("Could not clear media keys: "+t+". media.src: "+(null==r?void 0:r.src))}))).then(function(){i&&(e.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(function(t){e.log("Could not close sessions and clear media keys: "+t+". media.src: "+(null==r?void 0:r.src))})},zi.onManifestLoading=function(){this.keyFormatPromise=null},zi.onManifestLoaded=function(t,e){e=e.sessionKeys;e&&this.config.emeEnabled&&!this.keyFormatPromise&&(e=e.reduce(function(t,e){return-1===t.indexOf(e.keyFormat)&&t.push(e.keyFormat),t},[]),this.log("Selecting key-system from session-keys "+e.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(e))},zi.removeSession=function(t){var e=this,r=t.mediaKeysSession,i=t.licenseXhr;if(r){this.log("Remove licenses and keys and close session "+r.sessionId),r.onmessage=null,r.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;t=this.mediaKeySessions.indexOf(t);return-1<t&&this.mediaKeySessions.splice(t,1),r.remove().catch(function(t){e.log("Could not remove session: "+t)}).then(function(){return r.close()}).catch(function(t){e.log("Could not close session: "+t)})}},Xa);function Xa(t){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=Xa.CDMCleanupPromise?[Xa.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=at.debug.bind(at,qa),this.log=at.log.bind(at,qa),this.warn=at.warn.bind(at,qa),this.error=at.error.bind(at,qa),this.hls=t,this.config=t.config,this.registerListeners()}function za(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}function Qa(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}ui.CDMCleanupPromise=void 0;var $a,Ja=(l(as,$a=u(Error)),as),Za="m",ts="a",es="v",rs="av",_=((Qe=ns.prototype).registerListeners=function(){var t=this.hls;t.on(rt.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(rt.MEDIA_DETACHED,this.onMediaDetached,this),t.on(rt.BUFFER_CREATED,this.onBufferCreated,this)},Qe.unregisterListeners=function(){var t=this.hls;t.off(rt.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(rt.MEDIA_DETACHED,this.onMediaDetached,this),t.off(rt.BUFFER_CREATED,this.onBufferCreated,this)},Qe.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},Qe.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},Qe.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},Qe.onBufferCreated=function(t,e){var r;this.audioBuffer=null==(r=e.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(e=e.tracks.video)?void 0:e.buffer},Qe.createData=function(){var t;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(t=this.media)?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},Qe.apply=function(t,e){void 0===e&&(e={}),et(e,this.createData());var r="i"===e.ot||e.ot===es||e.ot===rs;this.starved&&r&&(e.bs=!0,e.su=!0,this.starved=!1),null==e.su&&(e.su=this.buffering),this.useHeaders?(r=ns.toHeaders(e),Object.keys(r).length&&(t.headers||(t.headers={}),et(t.headers,r))):(e=ns.toQuery(e))&&(t.url=ns.appendQueryToUri(t.url,e))},Qe.getObjectType=function(t){var e=t.type;return"subtitle"===e?"tt":"initSegment"===t.sn?"i":"audio"===e?ts:"main"===e?this.hls.audioTracks.length?es:rs:void 0},Qe.getTopBandwidth=function(t){for(var e=0,r=this.hls,i=d(t===ts?r.audioTracks:(t=-1<(t=r.maxAutoLevel)?t+1:r.levels.length,r.levels.slice(0,t)));!(n=i()).done;){var n=n.value;n.bitrate>e&&(e=n.bitrate)}return 0<e?e:NaN},Qe.getBufferLength=function(t){var e=this.hls.media,t=t===ts?this.audioBuffer:this.videoBuffer;return t&&e?1e3*Sr.bufferInfo(t,e.currentTime,this.config.maxBufferHole).len:NaN},Qe.createPlaylistLoader=function(){var t=this.config.pLoader,i=this.applyPlaylistData,e=t||this.config.loader;return(t=r.prototype).destroy=function(){this.loader.destroy()},t.abort=function(){this.loader.abort()},t.load=function(t,e,r){i(t),this.loader.load(t,e,r)},o(r,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),r;function r(t){this.loader=void 0,this.loader=new e(t)}},Qe.createFragmentLoader=function(){var t=this.config.fLoader,i=this.applyFragmentData,e=t||this.config.loader;return(t=r.prototype).destroy=function(){this.loader.destroy()},t.abort=function(){this.loader.abort()},t.load=function(t,e,r){i(t),this.loader.load(t,e,r)},o(r,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),r;function r(t){this.loader=void 0,this.loader=new e(t)}},ns.uuid=function(){var t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)},ns.serialize=function(t){for(var e,r=[],i=function(t){return Math.round(t)},n=function(t){return 100*i(t/100)},a={br:i,d:i,bl:n,dl:n,mtp:n,nor:function(t){return encodeURIComponent(t)},rtp:n,tb:i},s=d(Object.keys(t||{}).sort());!(o=s()).done;){var o,l,u=o.value,h=t[u];e=h,Number.isNaN(e)||null==e||""===e||!1===e||"v"===u&&1===h||"pr"==u&&1===h||((l=a[u])&&(h=l(h)),o=typeof h,l=void 0,l="ot"===u||"sf"===u||"st"===u?u+"="+h:"boolean"==o?u:"number"==o?u+"="+h:u+"="+JSON.stringify(h),r.push(l))}return r.join(",")},ns.toHeaders=function(t){for(var e={},r=["Object","Request","Session","Status"],i=[{},{},{},{}],n={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},a=0,s=Object.keys(t);a<s.length;a++){var o=s[a];i[null!=n[o]?n[o]:1][o]=t[o]}for(var l=0;l<i.length;l++){var u=ns.serialize(i[l]);u&&(e["CMCD-"+r[l]]=u)}return e},ns.toQuery=function(t){return"CMCD="+encodeURIComponent(ns.serialize(t))},ns.appendQueryToUri=function(t,e){if(!e)return t;var r=t.includes("?")?"&":"?";return t+r+e},ns),Qe=((zi=is.prototype).registerListeners=function(){var t=this.hls;t.on(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.on(rt.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(rt.MANIFEST_PARSED,this.onManifestParsed,this),t.on(rt.ERROR,this.onError,this)},zi.unregisterListeners=function(){var t=this.hls;t&&(t.off(rt.MANIFEST_LOADING,this.onManifestLoading,this),t.off(rt.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(rt.MANIFEST_PARSED,this.onManifestParsed,this),t.off(rt.ERROR,this.onError,this))},zi.startLoad=function(){var t;this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri&&(this.updated?(t=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0),this.scheduleRefresh(this.uri,t)):this.loadSteeringManifest(this.uri))},zi.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)},zi.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},zi.removeLevel=function(e){var t=this.levels;t&&(this.levels=t.filter(function(t){return t!==e}))},zi.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},zi.onManifestLoaded=function(t,e){e=e.contentSteering;null!==e&&(this.pathwayId=e.pathwayId,this.uri=e.uri,this.started&&this.startLoad())},zi.onManifestParsed=function(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks},zi.onError=function(t,e){var r,i=e.errorAction;2===(null==i?void 0:i.action)&&1===i.flags&&(r=this.pathwayPriority,e=this.pathwayId,this.penalizedPathways[e]||(this.penalizedPathways[e]=performance.now()),!r&&this.levels&&(r=this.levels.reduce(function(t,e){return-1===t.indexOf(e.pathwayId)&&t.push(e.pathwayId),t},[])),r&&1<r.length&&(this.updatePathwayPriority(r),i.resolved=this.pathwayId!==e))},zi.filterParsedLevels=function(t){this.levels=t;var e,r=this.getLevelsForPathway(this.pathwayId);return 0===r.length&&(e=t[0].pathwayId,this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+e+'"'),r=this.getLevelsForPathway(e),this.pathwayId=e),r.length!==t.length?(this.log("Found "+r.length+"/"+t.length+' levels in Pathway "'+this.pathwayId+'"'),r):t},zi.getLevelsForPathway=function(e){return null===this.levels?[]:this.levels.filter(function(t){return e===t.pathwayId})},zi.updatePathwayPriority=function(t){this.pathwayPriority=t;var e=this.penalizedPathways,r=performance.now();Object.keys(e).forEach(function(t){3e5<r-e[t]&&delete e[t]});for(var i=0;i<t.length;i++){var n=t[i];if(!e[n]){if(n===this.pathwayId)return;var a=this.hls.nextLoadLevel,s=this.hls.levels[a];if(0<(o=this.getLevelsForPathway(n)).length){this.log('Setting Pathway to "'+n+'"'),this.pathwayId=n,this.hls.trigger(rt.LEVELS_UPDATED,{levels:o});var o=this.hls.levels[a];s&&o&&this.levels&&(o.attrs["STABLE-VARIANT-ID"]!==s.attrs["STABLE-VARIANT-ID"]&&o.bitrate!==s.bitrate&&this.log("Unstable Pathways change from bitrate "+s.bitrate+" to "+o.bitrate),this.hls.nextLoadLevel=a);break}}}},zi.clonePathways=function(t){var s,o,r=this,i=this.levels;i&&(s={},o={},t.forEach(function(t){var n=t.ID,e=t["BASE-ID"],a=t["URI-REPLACEMENT"];i.some(function(t){return t.pathwayId===n})||(e=r.getLevelsForPathway(e).map(function(t){var e=et({},t);e.details=void 0,e.url=os(t.uri,t.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a);var r=new K(t.attrs);r["PATHWAY-ID"]=n;var i=r.AUDIO&&r.AUDIO+"_clone_"+n,t=r.SUBTITLES&&r.SUBTITLES+"_clone_"+n;i&&(s[r.AUDIO]=i,r.AUDIO=i),t&&(o[r.SUBTITLES]=t,r.SUBTITLES=t),e.attrs=r;e=new Ie(e);return tr(e,"audio",i),tr(e,"text",t),e}),i.push.apply(i,e),ss(r.audioTracks,s,a,n),ss(r.subtitleTracks,o,a,n))}))},zi.loadSteeringManifest=function(t){var l,u=this,e=this.hls.config,r=e.loader;this.loader&&this.loader.destroy(),this.loader=new r(e);try{l=new self.URL(t)}catch(l){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: "+t)}"data:"!==l.protocol&&(i=0|(this.hls.bandwidthEstimate||e.abrEwmaDefaultEstimate),l.searchParams.set("_HLS_pathway",this.pathwayId),l.searchParams.set("_HLS_throughput",""+i));var r={responseType:"json",url:l.href},i=e.steeringManifestLoadPolicy.default,e=i.errorRetry||i.timeoutRetry||{},i={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:e.maxNumRetry||0,retryDelay:e.retryDelayMs||0,maxRetryDelay:e.maxRetryDelayMs||0},e={onSuccess:function(t,e,r,i){u.log('Loaded steering manifest: "'+l+'"');var n=t.data;if(1===n.VERSION){u.updated=performance.now(),u.timeToLoad=n.TTL;var a=n["RELOAD-URI"],s=n["PATHWAY-CLONES"],o=n["PATHWAY-PRIORITY"];if(a)try{u.uri=new self.URL(a,l).href}catch(t){return u.enabled=!1,void u.log("Failed to parse Steering Manifest RELOAD-URI: "+a)}u.scheduleRefresh(u.uri||r.url),s&&u.clonePathways(s),o&&u.updatePathwayPriority(o)}else u.log("Steering VERSION "+n.VERSION+" not supported!")},onError:function(t,e,r,i){if(u.log("Error loading steering manifest: "+t.code+" "+t.text+" ("+e.url+")"),u.stopLoad(),410===t.code)return u.enabled=!1,void u.log("Steering manifest "+e.url+" no longer available");var n=1e3*u.timeToLoad;429!==t.code?u.scheduleRefresh(u.uri||e.url,n):("function"!=typeof(null==(t=u.loader)?void 0:t.getResponseHeader)||(t=t.getResponseHeader("Retry-After"))&&(n=1e3*parseFloat(t)),u.log("Steering manifest "+e.url+" rate limited"))},onTimeout:function(t,e,r){u.log("Timeout loading steering manifest ("+e.url+")"),u.scheduleRefresh(u.uri||e.url)}};this.log("Requesting steering manifest: "+l),this.loader.load(r,i,e)},zi.scheduleRefresh=function(t,e){var r=this;void 0===e&&(e=1e3*this.timeToLoad),self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(function(){r.loadSteeringManifest(t)},e)},is);function is(t){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.log=at.log.bind(at,"[content-steering]:"),this.registerListeners()}function ns(t){var n=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){n.initialized&&(n.starved=!0),n.buffering=!0},this.onPlaying=function(){n.initialized||(n.initialized=!0),n.buffering=!1},this.applyPlaylistData=function(t){try{n.apply(t,{ot:Za,su:!n.initialized})}catch(t){at.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=function(t){try{var e=t.frag,r=n.hls.levels[e.level],i=n.getObjectType(e),e={d:1e3*e.duration,ot:i};i!==es&&i!==ts&&i!=rs||(e.br=r.bitrate/1e3,e.tb=n.getTopBandwidth(i)/1e3,e.bl=n.getBufferLength(i)),n.apply(t,e)}catch(t){at.warn("Could not generate segment CMCD data.",t)}},this.hls=t;var e=this.config=t.config,t=e.cmcd;null!=t&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=t.sessionId||ns.uuid(),this.cid=t.contentId,this.useHeaders=!0===t.useHeaders,this.registerListeners())}function as(t,e){var r;return(r=$a.call(this,e)||this).data=void 0,t.error||(t.error=new Error(e)),(r.data=t).err=t.error,r}function ss(e,i,n,a){e&&Object.keys(i).forEach(function(r){var t=e.filter(function(t){return t.groupId===r}).map(function(t){var e=et({},t);return e.details=void 0,e.attrs=new K(e.attrs),e.url=e.attrs.URI=os(t.url,t.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),e.groupId=e.attrs["GROUP-ID"]=i[r],e.attrs["PATHWAY-ID"]=a,e});e.push.apply(e,t)})}function os(t,e,r,i){var n,a=i.HOST,s=i.PARAMS,r=i[r];e&&(n=null==r?void 0:r[e])&&(t=n);var o=new self.URL(t);return a&&!n&&(o.host=a),s&&Object.keys(s).sort().forEach(function(t){t&&o.searchParams.set(t,s[t])}),o.href}var ls=/^age:\s*[\d.]+\s*$/im,us=((zi=fs.prototype).destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},zi.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))},zi.abort=function(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},zi.load=function(t,e,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=r,this.loadInternal()},zi.loadInternal=function(){var e,r,i,n=this,t=this.config,a=this.context;t&&(e=this.loader=new self.XMLHttpRequest,(r=this.stats).loading.first=0,r.loaded=0,(i=this.xhrSetup)?Promise.resolve().then(function(){if(!n.stats.aborted)return i(e,a.url)}).catch(function(t){return e.open("GET",a.url,!0),i(e,a.url)}).then(function(){n.stats.aborted||n.openAndSendXhr(e,a,t)}).catch(function(t){n.callbacks.onError({code:e.status,text:t.message},a,e,r)}):this.openAndSendXhr(e,a,t))},zi.openAndSendXhr=function(t,e,r){t.readyState||t.open("GET",e.url,!0);var i=this.context.headers,n=r.loadPolicy,a=n.maxTimeToFirstByteMs,n=n.maxLoadTimeMs;if(i)for(var s in i)t.setRequestHeader(s,i[s]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),r.timeout=a&&G(a)?a:n,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),t.send()},zi.readystatechange=function(){var t,e,r,i,n=this.context,a=this.loader,s=this.stats;n&&a&&(r=a.readyState,i=this.config,!s.aborted&&2<=r&&(0===s.loading.first&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),4===r)&&(self.clearTimeout(this.requestTimeout),a.onreadystatechange=null,a.onprogress=null,t=a.status,e="text"!==a.responseType,200<=t&&t<300&&(e&&a.response||null!==a.responseText)?(s.loading.end=Math.max(self.performance.now(),s.loading.first),r=e?a.response:a.responseText,e="arraybuffer"===a.responseType?r.byteLength:r.length,s.loaded=s.total=e,s.bwEstimate=8e3*s.total/(s.loading.end-s.loading.first),this.callbacks&&((e=this.callbacks.onProgress)&&e(s,n,r,a),this.callbacks&&(r={url:a.responseURL,data:r,code:t},this.callbacks.onSuccess(r,s,n,a)))):Ye(i=i.loadPolicy.errorRetry,s.retry,!1,t)?this.retry(i):(at.error(t+" while loading "+n.url),this.callbacks.onError({code:t,text:a.statusText},n,a,s))))},zi.loadtimeout=function(){var t=null==(t=this.config)?void 0:t.loadPolicy.timeoutRetry;Ye(t,this.stats.retry,!0)?this.retry(t):(at.warn("timeout while loading "+this.context.url),(t=this.callbacks)&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader)))},zi.retry=function(t){var e=this.context,r=this.stats;this.retryDelay=He(t,r.retry),r.retry++,at.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+e.url+", retrying "+r.retry+"/"+t.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},zi.loadprogress=function(t){var e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)},zi.getCacheAge=function(){var t,e=null;return this.loader&&ls.test(this.loader.getAllResponseHeaders())&&(e=(t=this.loader.getResponseHeader("age"))?parseFloat(t):null),e},zi.getResponseHeader=function(t){return this.loader&&new RegExp("^"+t+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null},fs),hs=/(\d+)-(\d+)\/(\d+)/,ds=((zi=cs.prototype).destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},zi.abortInternal=function(){var t=this.response;null!=t&&t.ok||(this.stats.aborted=!0,this.controller.abort())},zi.abort=function(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},zi.load=function(i,n,a){var s=this,o=this.stats;if(o.loading.start)throw new Error("Loader can only be used once.");o.loading.start=self.performance.now();var t=function(t,e){e={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(et({},t.headers))};return t.rangeEnd&&e.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),e}(i,this.controller.signal),l=a.onProgress,u="arraybuffer"===i.responseType,h=u?"byteLength":"length",e=n.loadPolicy,r=e.maxTimeToFirstByteMs,d=e.maxLoadTimeMs;this.context=i,this.config=n,this.callbacks=a,this.request=this.fetchSetup(i,t),self.clearTimeout(this.requestTimeout),n.timeout=r&&G(r)?r:d,this.requestTimeout=self.setTimeout(function(){s.abortInternal(),a.onTimeout(o,i,s.response)},n.timeout),self.fetch(this.request).then(function(t){s.response=s.loader=t;var e=Math.max(self.performance.now(),o.loading.start);if(self.clearTimeout(s.requestTimeout),n.timeout=d,s.requestTimeout=self.setTimeout(function(){s.abortInternal(),a.onTimeout(o,i,s.response)},d-(e-o.loading.start)),t.ok)return o.loading.first=e,o.total=function(t){var e=t.get("Content-Range");if(e){var r=function(){var t=hs.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}();if(G(r))return r}t=t.get("Content-Length");if(t)return parseInt(t)}(t.headers)||o.total,l&&G(n.highWaterMark)?s.loadProgressively(t,o,i,n.highWaterMark,l):u?t.arrayBuffer():"json"===i.responseType?t.json():t.text();var r=t.status,e=t.statusText;throw new vs(e||"fetch, bad network response",r,t)}).then(function(t){var e=s.response;self.clearTimeout(s.requestTimeout),o.loading.end=Math.max(self.performance.now(),o.loading.first);var r=t[h];r&&(o.loaded=o.total=r);r={url:e.url,data:t,code:e.status};l&&!G(n.highWaterMark)&&l(o,i,t,e),a.onSuccess(r,o,i,e)}).catch(function(t){var e,r;self.clearTimeout(s.requestTimeout),o.aborted||(e=t&&t.code||0,r=t?t.message:null,a.onError({code:e,text:r},i,t?t.details:null,o))})},zi.getCacheAge=function(){var t,e=null;return this.response&&(e=(t=this.response.headers.get("age"))?parseFloat(t):null),e},zi.getResponseHeader=function(t){return this.response?this.response.headers.get(t):null},zi.loadProgressively=function(i,n,a,s,o){void 0===s&&(s=0);var l=new wn,t=i.body.getReader();return function r(){return t.read().then(function(t){if(t.done)return l.dataLength&&o(n,a,l.flush(),i),Promise.resolve(new ArrayBuffer(0));var e=t.value,t=e.length;return n.loaded+=t,t<s||l.dataLength?(l.push(e),l.dataLength>=s&&o(n,a,l.flush(),i)):o(n,a,e,i),r()}).catch(function(){return Promise.reject()})}()},cs);function cs(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||gs,this.controller=new self.AbortController,this.stats=new b}function fs(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new b,this.retryDelay=0}function gs(t,e){return new self.Request(t.url,e)}var ms,vs=(l(Ts,ms=u(Error)),Ts),ps=/\s/,ys=g(g({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:us,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ki,bufferController:Wn,capLevelController:Zr,errorController:ze,fpsController:di,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Z,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:{newCue:function(e,t,r,i){for(var n,a,s,o,l=[],u=self.VTTCue||self.TextTrackCue,h=0;h<i.rows.length;h++)if(a=!0,s=0,o="",!(n=i.rows[h]).isEmpty()){for(var d,c=0;c<n.chars.length;c++)ps.test(n.chars[c].uchar)&&a?s++:(o+=n.chars[c].uchar,a=!1);(n.cueStartTime=t)===r&&(r+=1e-4),16<=s?s--:s++;var f=Ia(o.trim()),g=Fa(t,r,f);null!=e&&null!=(d=e.cues)&&d.getCueById(g)||((f=new u(t,r,f)).id=g,f.line=h+1,f.align="left",f.position=10+Math.min(80,10*Math.floor(8*s/32)),l.push(f))}return e&&l.length&&(l.sort(function(t,e){return"auto"===t.line||"auto"===e.line?0:8<t.line&&8<e.line?e.line-t.line:t.line-e.line}),l.forEach(function(t){return ve(e,t)})),l}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:t,subtitleTrackController:Un,timelineController:jr,audioStreamController:Pi,audioTrackController:Tr,emeController:ui,cmcdController:_,contentSteeringController:Qe});function Ts(t,e,r){return(t=ms.call(this,t)||this).code=void 0,t.details=void 0,t.code=e,t.details=r,t}function Es(r){return r&&"object"==typeof r?Array.isArray(r)?r.map(Es):Object.keys(r).reduce(function(t,e){return t[e]=Es(r[e]),t},{}):r}Qe=function(){function f(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new pn,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,L(t.debug||!1,"Hls instance");var e=this.config=function(t,l){if((l.liveSyncDurationCount||l.liveMaxLatencyDurationCount)&&(l.liveSyncDuration||l.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==l.liveMaxLatencyDurationCount&&(void 0===l.liveSyncDurationCount||l.liveMaxLatencyDurationCount<=l.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==l.liveMaxLatencyDuration&&(void 0===l.liveSyncDuration||l.liveMaxLatencyDuration<=l.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var u=Es(t),e=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(function(n){var a=("level"===n?"playlist":n)+"LoadPolicy",s=void 0===l[a],o=[];e.forEach(function(t){var e=n+"Loading"+t,r=l[e];if(void 0!==r&&s){o.push(e);var i=u[a].default;switch(l[a]={default:i},t){case"TimeOut":i.maxLoadTimeMs=r,i.maxTimeToFirstByteMs=r;break;case"MaxRetry":i.errorRetry.maxNumRetry=r,i.timeoutRetry.maxNumRetry=r;break;case"RetryDelay":i.errorRetry.retryDelayMs=r,i.timeoutRetry.retryDelayMs=r;break;case"MaxRetryTimeout":i.errorRetry.maxRetryDelayMs=r,i.timeoutRetry.maxRetryDelayMs=r}}}),o.length&&at.warn('hls.js config: "'+o.join('", "')+'" setting(s) are deprecated, use "'+a+'": '+JSON.stringify(l[a]))}),g(g({},u),l)}(f.DefaultConfig,t);this.userConfig=t,this._autoLevelCapping=-1,e.progressive&&((d=(c=e).loader)!==ds&&d!==us?(at.log("[config]: Custom loader detected, cannot enable progressive streaming"),c.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),1}catch(t){}}()&&(c.loader=ds,c.progressive=!0,c.enableSoftwareAES=!0,at.log("[config]: Progressive streaming enabled, using FetchLoader")));var r=e.abrController,i=e.bufferController,n=e.capLevelController,a=e.errorController,s=e.fpsController,o=new a(this),l=this.abrController=new r(this),u=this.bufferController=new i(this),h=this.capLevelController=new n(this),t=new s(this),d=new fe(this),c=new Ae(this),a=e.contentSteeringController,r=a?new a(this):null,i=this.levelController=new $e(this,r),n=new sr(this),s=new yr(this.config),a=this.streamController=new bn(this,n,s);h.setStreamController(a),t.setStreamController(a);a=[d,i,a];r&&a.splice(1,0,r),this.networkControllers=a;t=[l,u,h,t,c,n];this.audioTrackController=this.createController(e.audioTrackController,a);c=e.audioStreamController;c&&a.push(new c(this,n,s)),this.subtitleTrackController=this.createController(e.subtitleTrackController,a);c=e.subtitleStreamController;c&&a.push(new c(this,n,s)),this.createController(e.timelineController,t),s.emeController=this.emeController=this.createController(e.emeController,t),this.cmcdController=this.createController(e.cmcdController,t),this.latencyController=this.createController(ke,t),this.coreComponents=t,a.push(o);a=o.onErrorOut;"function"==typeof a&&this.on(rt.ERROR,a,o)}f.isSupported=function(){var t=Kt();if(!t)return!1;var e=$r(),t=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),e=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!t&&!!e};var t=f.prototype;return t.createController=function(t,e){if(t){t=new t(this);return e&&e.push(t),t}return null},t.on=function(t,e,r){void 0===r&&(r=this),this._emitter.on(t,e,r)},t.once=function(t,e,r){void 0===r&&(r=this),this._emitter.once(t,e,r)},t.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},t.off=function(t,e,r,i){void 0===r&&(r=this),this._emitter.off(t,e,r,i)},t.listeners=function(t){return this._emitter.listeners(t)},t.emit=function(t,e,r){return this._emitter.emit(t,e,r)},t.trigger=function(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(e){at.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.trigger(rt.ERROR,{type:it.OTHER_ERROR,details:nt.INTERNAL_EXCEPTION,fatal:!1,event:t,error:e})}return!1},t.listenerCount=function(t){return this._emitter.listenerCount(t)},t.destroy=function(){at.log("destroy"),this.trigger(rt.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(t){return t.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(t){return t.destroy()}),this.coreComponents.length=0;var t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null},t.attachMedia=function(t){at.log("attachMedia"),this._media=t,this.trigger(rt.MEDIA_ATTACHING,{media:t})},t.detachMedia=function(){at.log("detachMedia"),this.trigger(rt.MEDIA_DETACHING,void 0),this._media=null},t.loadSource=function(t){this.stopLoad();var e=this.media,r=this.url,i=this.url=y.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});at.log("loadSource:"+i),e&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(rt.MANIFEST_LOADING,{url:t})},t.startLoad=function(e){void 0===e&&(e=-1),at.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},t.stopLoad=function(){at.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},t.swapAudioCodec=function(){at.log("swapAudioCodec"),this.streamController.swapAudioCodec()},t.recoverMediaError=function(){at.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},t.removeLevel=function(t,e){void 0===e&&(e=0),this.levelController.removeLevel(t,e)},o(f,[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){at.log("set currentLevel:"+t),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){at.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){at.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){at.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){at.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){t=!!t;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(at.log("set autoLevelCapping:"+t),this._autoLevelCapping=t)}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"ttfbEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(t){-1<be.indexOf(t)&&(this._maxHdcpLevel=t)}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,e=this.config.minAutoBitrate;if(!t)return 0;for(var r=t.length,i=0;i<r;i++)if(t[i].maxBitrate>=e)return i;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,e=this.autoLevelCapping,r=this.maxHdcpLevel,e=-1===e&&t&&t.length?t.length-1:e;if(r)for(var i=e;i--;){var n=t[i].attrs["HDCP-LEVEL"];if(n&&n<=r)return i}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.4.5"}},{key:"Events",get:function(){return rt}},{key:"ErrorTypes",get:function(){return it}},{key:"ErrorDetails",get:function(){return nt}},{key:"DefaultConfig",get:function(){return f.defaultConfig||ys},set:function(t){f.defaultConfig=t}}]),f}();return Qe.defaultConfig=void 0,Qe};"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Hls=e()}(!1);
