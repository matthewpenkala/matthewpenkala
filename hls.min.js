!function r(R){var a=this,n=function(){"use strict";function B(a,e){var t=Object.keys(a),n;return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(a),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),t.push.apply(t,n)),t}function j(a){for(var e=1,i;e<arguments.length;e++)i=null==arguments[e]?{}:arguments[e],e%2?B(Object(i),!0).forEach(function(n){var o,s;o=a,n=i[s=n],(s=d(s))in o?Object.defineProperty(o,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[s]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):B(Object(i)).forEach(function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(i,e))});return a}function g(a,t){for(var e=0,n;e<t.length;e++)n=t[e],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,d(n.key),n)}function qt(a,t,e){return t&&g(a.prototype,t),e&&g(a,e),Object.defineProperty(a,"prototype",{writable:!1}),a}function qa(){return(qa=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var n=arguments[t],i;for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(a[i]=n[i])}return a}).apply(this,arguments)}function Za(a,t){a.prototype=Object.create(t.prototype),o(a.prototype.constructor=a,t)}function e(a){return(e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(a)}function o(a,t){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,t){return a.__proto__=t,a})(a,t)}function i(){return(i=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(e){}}}()?Reflect.construct.bind():function(a,t,e){var r=[null];return r.push.apply(r,t),r=new(Function.bind.apply(a,r)),(e&&o(r,e.prototype),r)}).apply(null,arguments)}function l(a){var n="function"==typeof Map?new Map:void 0;return(l=function(a){function t(){return i(a,arguments,e(this).constructor)}if(null===a||-1===Function.toString.call(a).indexOf("[native code]"))return a;if("function"!=typeof a)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(a))return n.get(a);n.set(a,t)}return t.prototype=Object.create(a.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),o(t,a)})(a)}function hi(a,t){(null==t||t>a.length)&&(t=a.length);for(var n=0,d=Array(t);n<t;n++)d[n]=a[n];return d}function ed(a,n){var e="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(e)return(e=e.call(a)).next.bind(e);if(Array.isArray(a)||(e=function(a){if(a){if("string"==typeof a)return hi(a,void 0);var t=Object.prototype.toString.call(a).slice(8,-1);return"Object"===t&&a.constructor&&(t=a.constructor.name),"Map"===t||"Set"===t?Array.from(a):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?hi(a,void 0):void 0}}(a))||n&&a&&"number"==typeof a.length){e&&(a=e);var d=0;return function(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e){return e=function(a){if("object"!=typeof a||null===a)return a;var r=a[Symbol.toPrimitive];if(void 0===r)return a+"";if(a=r.call(a,"string"),"object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}(e),"symbol"==typeof e?e:e+""}function td(a,t){if(self.console&&!0===a||"object"==typeof a){!function(a){for(var r=arguments.length,t=Array(1<r?r-1:0),e=1;e<r;e++)t[e-1]=arguments[e];t.forEach(function(r){var n;E[r]=a[r]?a[r].bind(a):(n=r,(r=self.console[n])?r.bind(self.console,"["+n+"] >"):y)})}(a,"debug","log","info","warn","error");try{E.log("Debug logs enabled for \""+t+"\" in hls.js version 1.4.5")}catch(e){E=T}}else E=T}function c(a){for(var r in"string"==typeof a&&(a=c.parseAttrList(a)),a)a.hasOwnProperty(r)&&("X-"===r.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(r)),this[r]=a[r])}function h(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}function L(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}function k(a,d,e,o,i){return(e=Mi.call(this,e)||this).fragOffset=0,e.duration=0,e.gap=!1,e.independent=!1,e.relurl=void 0,e.fragment=void 0,e.index=void 0,e.stats=new h,e.duration=a.decimalFloatingPoint("DURATION"),e.gap=a.bool("GAP"),e.independent=a.bool("INDEPENDENT"),e.relurl=a.enumeratedString("URI"),e.fragment=d,e.index=o,a=a.enumeratedString("BYTERANGE"),(a&&e.setByteRange(a,i),i&&(e.fragOffset=i.fragOffset+i.duration),e)}function b(a){var t;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((t={}).audio=null,t.video=null,t.audiovideo=null,t),this.baseurl=a}function x(a,n){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,n){var d=n.attr,i;for(i in d)if(Object.prototype.hasOwnProperty.call(a,i)&&a[i]!==d[i]){nt.warn("DATERANGE tag attribute: \""+i+"\" does not match for tags with ID: \""+a.ID+"\""),this._badValueForSameId=i;break}a=qa(new hd({}),d,a)}this.attr=a,this._startDate=new Date(a["START-DATE"]),"END-DATE"in this.attr&&(n=new Date(this.attr["END-DATE"]),yd(n.getTime())&&(this._endDate=n))}function P(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})}function F(e){return Uint8Array.from(unescape(encodeURIComponent(e)),function(e){return e.charCodeAt(0)})}function O(e){return"com.apple.streamingkeydelivery"===e?W.FAIRPLAY:"com.microsoft.playready"===e?W.PLAYREADY:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===e?W.WIDEVINE:"org.w3.clearkey"===e?W.CLEARKEY:void 0}function M(e){return e===W.FAIRPLAY?"com.apple.streamingkeydelivery":e===W.PLAYREADY?"com.microsoft.playready":e===W.WIDEVINE?"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":e===W.CLEARKEY?"org.w3.clearkey":void 0}function N(a){var n=a.drmSystems,e=a.widevineLicenseUrl,a=n?[W.FAIRPLAY,W.WIDEVINE,W.PLAYREADY,W.CLEARKEY].filter(function(e){return!!n[e]}):[];return!a[W.WIDEVINE]&&e&&a.push(W.WIDEVINE),a}function z(a,t,e){return Uint8Array.prototype.slice?a.slice(t,e):new Uint8Array(Array.prototype.slice.call(a,t,e))}function $(a,t){return t+10<=a.length&&73===a[t]&&68===a[t+1]&&51===a[t+2]&&255>a[t+3]&&255>a[t+4]&&128>a[t+6]&&128>a[t+7]&&128>a[t+8]&&128>a[t+9]}function J(a,t){return t+10<=a.length&&51===a[t]&&68===a[t+1]&&73===a[t+2]&&255>a[t+3]&&255>a[t+4]&&128>a[t+6]&&128>a[t+7]&&128>a[t+8]&&128>a[t+9]}function tt(a,t){for(var n=t,r=0;$(a,t);)r+=10,r+=Z(a,t+6),J(a,t+10)&&(r+=10),t+=r;if(0<r)return a.subarray(n,n+r)}function ot(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function st(d){for(var t=0,l=[],i;$(d,t);){for(var u=Z(d,t+6),n=(t+=10)+u;t+8<n;){var a=(a=d.subarray(t),c=i=void 0,i=String.fromCharCode(a[0],a[1],a[2],a[3]),c=Z(a,4),{type:i,size:c,data:a.subarray(10,10+c)}),c=ct(a);c&&l.push(c),t+=a.size+10}J(d,t)&&(t+=10)}return l}function lt(a){for(var t="",n=0,d;n<a.length;n++)d=a[n].toString(16),2>d.length&&(d="0"+d),t+=d;return t}function ut(e){return String.fromCharCode.apply(null,e)}function yt(a,t){return t=a[t]<<8|a[t+1],0>t?65536+t:t}function ht(a,t){return t=Lt(a,t),0>t?4294967296+t:t}function Lt(a,t){return a[t]<<24|a[t+1]<<16|a[t+2]<<8|a[t+3]}function Rt(a,t,e){a[t]=e>>24,a[t+1]=255&e>>16,a[t+2]=255&e>>8,a[t+3]=255&e}function At(d,t){var e=[];if(!t.length)return e;for(var r=d.byteLength,i=0;i<r;){var o=ht(d,i),l=1<o?i+o:r;ut(d.subarray(i+4,i+8))===t[0]&&(1===t.length?e.push(d.subarray(i+8,l)):(o=At(d.subarray(i+8,l),t.slice(1))).length&&Tt.apply(e,o)),i=l}return e}function kt(d){for(var u=[],t=At(d,["moov","trak"]),e=0;e<t.length;e++){var r=t[e],c=At(r,["tkhd"])[0],f,g,m;c&&(f=ht(c,0===c[0]?12:20),(m=At(r,["mdia","mdhd"])[0])&&(g=ht(m,0===m[0]?12:20),(c=At(r,["mdia","hdlr"])[0])&&(m=ut(c.subarray(8,12)),(c={soun:"audio",vide:"video"}[m])&&(m=void 0,(r=At(r,["mdia","minf","stbl","stsd"])[0])&&(m=ut(r.subarray(12,16))),u[f]={timescale:g,type:c},u[c]={timescale:g,id:f,codec:m}))))}return At(d,["moov","mvex","trex"]).forEach(function(a){var t=ht(a,4),t=u[t];t&&(t.default={duration:ht(a,12),flags:ht(a,20)})}),u}function Dt(a){var t=At(a,["schm"])[0];return t&&(t=ut(t.subarray(4,8)),"cbcs"===t||"cenc"===t)?At(a,["schi","tenc"])[0]:(nt.error("[eme] missing 'schm' box"),null)}function It(a,t){var e=new Uint8Array(a.length+t.length);return e.set(a),e.set(t,a.length),e}function bt(a,n){var e=[],t=n.samples,i=n.timescale,d=n.id,o=!1;return At(t,["moof"]).map(function(r){var s=r.byteOffset-8;At(r,["traf"]).map(function(l){var r=At(l,["tfdt"]).map(function(a){var t=a[0],e=ht(a,4);return 1===t&&(e*=Math.pow(2,32),e+=ht(a,8)),e/i})[0];return void 0!==r&&(a=r),At(l,["tfhd"]).map(function(u){var c=ht(u,4),f=16777215&ht(u,0),h=0,S=0,r=8;c===d&&(0!=(1&f)&&(r+=8),0!=(2&f)&&(r+=4),0!=(8&f)&&(h=ht(u,r),r+=4),0!=(16&f)&&(S=ht(u,r),r+=4),0!=(32&f)&&(r+=4),"video"===n.type&&(o=function(a){if(!a)return!1;var t=a.indexOf("."),t=0>t?a:a.substring(0,t);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}(n.codec)),At(l,["trun"]).map(function(d){var l=d[0],T=16777215&ht(d,0),r=0,E=0,L=0,R=0,A=ht(d,4),f=8;0!=(1&T)&&(r=ht(d,f),f+=4),0!=(4&T)&&(f+=4);for(var k=r+s,D=0;D<A;D++){if(0!=(256&T)?(E=ht(d,f),f+=4):E=h,0!=(512&T)?(L=ht(d,f),f+=4):L=S,0!=(1024&T)&&(f+=4),0!=(2048&T)&&(R=(0===l?ht:Lt)(d,f),f+=4),"video"===n.type)for(var I=0,b;I<L;)b=ht(t,k),function(a,r){return a?(a=63&r>>1,39==a||40==a):6==(31&r)}(o,t[k+=4])&&Ct(t.subarray(k,k+b),o?2:1,a+R/i,e),k+=b,I+=b+4;a+=E/i}}))})})}),e}function Ct(R,t,e,r){var i=_t(R),n=0;n+=t;for(var A=0,k=0,D=!1,I=0;n<i.length;){for(A=0;!(n>=i.length)&&(A+=I=i[n++],255===I););for(k=0;!(n>=i.length)&&(k+=I=i[n++],255===I););var b=i.length-n;if(!D&&4===A&&n<i.length){if(D=!0,181===i[n++]){var h=yt(i,n);if(n+=2,49===h){var C=ht(i,n);if(n+=4,1195456820===C){var _=i[n++];if(3===_){var h=i[n++],C=64&h,f=C?2+3*(31&h):0,g=new Uint8Array(f);if(C){g[0]=h;for(var m=1;m<f;m++)g[m]=i[n++]}r.push({type:_,payloadType:A,pts:e,bytes:g})}}}}}else if(5===A&&k<b){if(D=!0,16<k){for(var x=[],p=0,P;16>p;p++)P=i[n++].toString(16),x.push(1==P.length?"0"+P:P),3!=p&&5!==p&&7!==p&&9!==p||x.push("-");for(var F=k-16,E=new Uint8Array(F),S=0;S<F;S++)E[S]=i[n++];r.push({payloadType:A,pts:e,uuid:x.join(""),userData:vt(E),userDataBytes:E})}}else if(k<b)n+=k;else if(b<k)break}}function _t(d){for(var t=d.byteLength,e=[],r=1;r<t-2;)0===d[r]&&0===d[r+1]&&3===d[r+2]?(e.push(r+2),r+=2):r++;if(0===e.length)return d;for(var o=t-e.length,n=new Uint8Array(o),a=0,r=0;r<o;a++,r++)a===e[0]&&(a++,e.shift()),n[r]=d[a];return n}function xt(e){return Mt.test(e)}function Pt(d,t,e){if(null!==d.variableList||d.hasVariableRefs)for(var r=e.length;r--;){var o=e[r],n=t[o];n&&(t[o]=wt(d,n))}}function wt(a,e){if(null!==a.variableList||a.hasVariableRefs){var i=a.variableList;return e.replace(Mt,function(n){var t=n.substring(2,n.length-1),e=null==i?void 0:i[t];return void 0===e?(a.playlistParsingError||(a.playlistParsingError=new Error("Missing preceding EXT-X-DEFINE tag for Variable Reference: \""+t+"\"")),n):e})}return e}function Nt(d,t,e){var r=d.variableList,o,l;if(r||(d.variableList=r={}),"QUERYPARAM"in t){o=t.QUERYPARAM;try{var u=new self.URL(e).searchParams;if(!u.has(o))throw new Error("\""+o+"\" does not match any query parameter in URI: \""+e+"\"");l=u.get(o)}catch(t){d.playlistParsingError||(d.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+t.message))}}else o=t.NAME,l=t.VALUE;o in r?d.playlistParsingError||(d.playlistParsingError=new Error("EXT-X-DEFINE duplicate Variable Name declarations: \""+o+"\"")):r[o]=l||""}function Bt(){if("undefined"!=typeof self)return self.MediaSource||self.WebKitMediaSource}function Ut(a,r){return null!=(a=null==Ht?void 0:Ht.isTypeSupported((r||"video")+"/mp4;codecs=\""+a+"\""))&&a}function Gt(){}function Kt(d,o,l){var u=new hd(d);Pt(l,u,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);var i=null==(a=u.METHOD)?"":a,n=u.URI,d=u.hexadecimalInteger("IV"),l=u.KEYFORMATVERSIONS,a=null==(a=u.KEYFORMAT)?"identity":a;return n&&u.IV&&!d&&nt.error("Invalid IV: "+u.IV),o=n?zt.resolve(n,o):"",l=(l||"1").split("/").map(Number).filter(Number.isFinite),new Td(i,o,a,l,d)}function Yt(e){return e=new hd(e).decimalFloatingPoint("TIME-OFFSET"),yd(e)?e:null}function Zt(a,t,n){t=t[n],t&&(a[n]=t)}function te(a,t){a.rawProgramDateTime?a.programDateTime=Date.parse(a.rawProgramDateTime):null!=t&&t.programDateTime&&(a.programDateTime=t.endProgramDateTime),yd(a.programDateTime)||(a.programDateTime=null,a.rawProgramDateTime=null)}function ee(a,t,e,r){a.relurl=t.URI,t.BYTERANGE&&a.setByteRange(t.BYTERANGE),a.level=e,a.sn="initSegment",r&&(a.levelkeys=r),a.initSegment=null}function re(a,n,e){a.levelkeys=n,e=e.encryptedFragments,e.length&&e[e.length-1].levelkeys===n||!Object.keys(n).some(function(e){return n[e].isCommonEncryption})||e.push(a)}function ie(e){switch(e.type){case"audioTrack":return"audio";case"subtitleTrack":return"subtitle";default:return"main";}}function de(a,r){return a=a.url,void 0!==a&&0!==a.indexOf("data:")||(a=r.url),a}function ce(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}function ge(a,t){var e;try{e=new Event("addtrack")}catch(a){(e=document.createEvent("Event")).initEvent("addtrack",!1,!1)}e.track=a,t.dispatchEvent(e)}function me(a,t){var e=a.mode;if("disabled"===e&&(a.mode="hidden"),a.cues&&!a.cues.getCueById(t.id))try{if(a.addCue(t),!a.cues.getCueById(t.id))throw new Error("addCue is failed for: "+t)}catch(e){nt.debug("[texttrack-utils]: "+e);var n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,a.addCue(n)}"disabled"===e&&(a.mode=e)}function ve(a){var t=a.mode;if("disabled"===t&&(a.mode="hidden"),a.cues)for(var e=a.cues.length;e--;)a.removeCue(a.cues[e]);"disabled"===t&&(a.mode=t)}function pe(d,t,e,r){var i=d.mode;if("disabled"===i&&(d.mode="hidden"),d.cues&&0<d.cues.length)for(var n=function(d,t,e){var r=[],i=function(d,t){if(t<d[0].startTime)return 0;var e=d.length-1;if(t>d[e].endTime)return-1;for(var r=0,o=e,s;r<=o;)if(s=Math.floor((o+r)/2),t<d[s].startTime)o=s-1;else{if(!(t>d[s].startTime&&r<e))return s;r=s+1}return d[r].startTime-t<t-d[o].startTime?r:o}(d,t);if(-1<i)for(var n=i,l=d.length,s;n<l;n++)if(s=d[n],s.startTime>=t&&s.endTime<=e)r.push(s);else if(s.startTime>e)return r;return r}(d.cues,t,e),a=0;a<n.length;a++)r&&!r(n[a])||d.removeCue(n[a]);"disabled"===i&&(d.mode=i)}function ye(){if("undefined"!=typeof self)return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function Se(a,t){return a.getTime()/1e3-t}function Re(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter(function(e){return e}).join(",").replace(/\.[^.,]+/g,"")}function we(a,t,e){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=a,this.part=t,this.skip=e}function Ce(a){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=a,this.config=a.config,this.registerListeners()}function _e(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}function Pe(a,t){var e=t.startPTS,n;yd(e)?(n=0,(e=t.sn>a.sn?(n=e-a.start,a):(n=a.start-e,t)).duration!==n&&(e.duration=n)):t.sn>a.sn?a.cc===t.cc&&a.minEndPTS?t.start=a.start+(a.minEndPTS-a.start):t.start=a.start+a.duration:t.start=Math.max(a.start-t.duration,0)}function xe(f,t,e,g,m,p){0>=g-e&&(nt.warn("Fragment should have a positive duration",t),g=e+t.duration,p=m+t.duration);var y=e,T=g,E=t.startPTS,u=t.endPTS,S;yd(E)&&(S=Math.abs(E-e),t.deltaPTS=yd(t.deltaPTS)?Math.max(S,t.deltaPTS):S,y=Math.max(e,E),e=Math.min(e,E),m=Math.min(m,t.startDTS),T=Math.min(g,u),g=Math.max(g,u),p=Math.max(p,t.endDTS)),u=e-t.start,0!==t.start&&(t.start=e),t.duration=g-t.start,t.startPTS=e,t.maxStartPTS=y,t.startDTS=m,t.endPTS=g,t.minEndPTS=T,t.endDTS=p;var p=t.sn,L;if(!f||p<f.startSN||p>f.endSN)return 0;var p=p-f.startSN,R=f.fragments;for(R[p]=t,L=p;0<L;L--)Pe(R[L],R[L-1]);for(L=p;L<R.length-1;L++)Pe(R[L],R[L+1]);return f.fragmentHint&&Pe(R[R.length-1],f.fragmentHint),f.PTSKnown=f.alignedSliding=!0,u}function Fe(m,t){for(var d=null,p=m.fragments,e=p.length-1,y;0<=e;e--)if(y=p[e].initSegment,y){d=y;break}m.fragmentHint&&delete m.fragmentHint.endPTS;var T=0,E,S,L;if(function(c,f){for(var e=f.skippedSegments,r=Math.max(c.startSN,f.startSN)-f.startSN,i=(c.fragmentHint?1:0)+(e?f.endSN:Math.min(c.endSN,f.endSN))-f.startSN,n=f.startSN-c.startSN,a=f.fragmentHint?f.fragments.concat(f.fragmentHint):f.fragments,s=c.fragmentHint?c.fragments.concat(c.fragmentHint):c.fragments,o=r;o<=i;o++){var g=s[n+o],m=a[o];e&&!m&&o<e&&(m=f.fragments[o]=g),g&&m&&(m=m,(g=g).relurl&&(T=g.cc-m.cc),yd(g.startPTS)&&yd(g.endPTS)&&(m.start=m.startPTS=g.startPTS,m.startDTS=g.startDTS,m.maxStartPTS=g.maxStartPTS,m.endPTS=g.endPTS,m.endDTS=g.endDTS,m.minEndPTS=g.minEndPTS,m.duration=g.endPTS-g.startPTS,m.duration&&(E=m),t.PTSKnown=t.alignedSliding=!0),m.elementaryStreams=g.elementaryStreams,m.loader=g.loader,m.stats=g.stats,m.urlId=g.urlId,g.initSegment&&(m.initSegment=g.initSegment,d=g.initSegment))}}(m,t),d&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach(function(e){e.initSegment&&e.initSegment.relurl!==(null==d?void 0:d.relurl)||(e.initSegment=d)}),t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some(function(e){return!e}),t.deltaUpdateFailed){nt.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var R=t.skippedSegments;R--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=(A=m.dateRanges,S=t.dateRanges,k=t.recentlyRemovedDateranges,L=qa({},A),k&&k.forEach(function(e){delete L[e]}),Object.keys(S).forEach(function(a){var t=new K(S[a].attr,L[a]);t.isValid?L[a]=t:nt.warn("Ignoring invalid Playlist Delta Update DATERANGE tag: \""+JSON.stringify(S[a].attr)+"\"")}),L));var v=t.fragments;if(T){nt.warn("discontinuity sliding from playlist, take drift into account");for(var o=0;o<v.length;o++)v[o].cc+=T}t.skippedSegments&&(t.startCC=t.fragments[0].cc),function(d,t){if(d&&t)for(var e=0,o=0,l=d.length;o<=l;o++){var n=d[o],u=t[o+e];n&&u&&n.index===u.index&&n.fragment.sn===u.fragment.sn?(n=n,(u=u).elementaryStreams=n.elementaryStreams,u.stats=n.stats):e--}}(m.partList,t.partList),E?xe(t,E,E.startPTS,E.endPTS,E.startDTS,E.endDTS):Me(m,t),v.length&&(t.totalduration=t.edge-v[0].start),t.driftStartTime=m.driftStartTime,t.driftStart=m.driftStart;var A=t.advancedDateTime,k;t.advanced&&A?(k=t.edge,t.driftStart||(t.driftStartTime=A,t.driftStart=k),t.driftEndTime=A,t.driftEnd=k):(t.driftEndTime=m.driftEndTime,t.driftEnd=m.driftEnd,t.advancedDateTime=m.advancedDateTime)}function Me(a,n){var e=n.startSN+n.skippedSegments-a.startSN,a=a.fragments;0>e||e>=a.length||Oe(n,a[e].start)}function Oe(a,t){if(t){for(var e=a.fragments,r=a.skippedSegments;r<e.length;r++)e[r].start+=t;a.fragmentHint&&(a.fragmentHint.start+=t)}}function Ne(a,n,e){return null!=a&&a.details?Ue(null==(a=a.details)?void 0:a.partList,n,e):null}function Ue(a,t,e){if(a)for(var r=a.length,d;r--;)if(d=a[r],d.index===e&&d.fragment.sn===t)return d;return null}function Be(e){switch(e.details){case it.FRAG_LOAD_TIMEOUT:case it.KEY_LOAD_TIMEOUT:case it.LEVEL_LOAD_TIMEOUT:case it.MANIFEST_LOAD_TIMEOUT:return!0;}return!1}function Ge(a,t){return t=Be(t),a.default[(t?"timeout":"error")+"Retry"]}function Ke(a,t){return t="linear"===a.backoff?1:Math.pow(2,t),Math.min(t*a.retryDelayMs,a.maxRetryDelayMs)}function He(e){return j(j({},e),{errorRetry:null,timeoutRetry:null})}function Ve(a,t,e,r){return a&&t<a.maxNumRetry&&(0===r&&!1===navigator.onLine||r&&(400>r||499<r)||e)}function Ye(a,t,e,d){void 0===e&&(e=0),void 0===d&&(d=0);var o=null;return(a?o=t[a.sn-t[0].sn+1]||null:0===e&&0===t[0].start&&(o=t[0]),o&&0===je(e,d,o))?o:(d=Ie(t,je.bind(null,e,d)),!d||d===a&&o?o:d)}function je(a,n,i){return(void 0===a&&(a=0),void 0===n&&(n=0),i.start<=a&&i.start+i.duration>a)?0:(n=Math.min(n,i.duration+(i.deltaPTS||0)),i.start+i.duration-n<=a?1:i.start-n>a&&i.start?-1:0)}function qe(a,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=nt.log.bind(nt,t+":"),this.warn=nt.warn.bind(nt,t+":"),this.hls=a}function Je(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=nt.log.bind(nt,"[info]:"),this.warn=nt.warn.bind(nt,"[warning]:"),this.error=nt.error.bind(nt,"[error]:"),this.registerListeners()}function Ze(a,t,e){e&&("audio"===t?(a.audioGroupIds||(a.audioGroupIds=[]),a.audioGroupIds[a.url.length-1]=e):"text"==t&&(a.textGroupIds||(a.textGroupIds=[]),a.textGroupIds[a.url.length-1]=e))}function $t(e){var a={};e.forEach(function(r){var t=r.groupId||"";r.id=a[t]=a[t]||0,a[t]++})}function Jt(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}function er(a){var r;return a.buffered&&(a.body.gap||(null==(r=a.range.video)?void 0:r.partial)||(null==(r=a.range.audio)?void 0:r.partial)||(null==(a=a.range.audiovideo)?void 0:a.partial))}function tr(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn}function or(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}function lr(d,t){void 0===t&&(t=null);var o=t||d,l={frag:d,part:t,responseType:"arraybuffer",url:o.url,headers:{},rangeStart:0,rangeEnd:0},n=o.byteRangeStartOffset,a=o.byteRangeEndOffset,s;return yd(n)&&yd(a)&&(t=n,o=a,"initSegment"===d.sn&&"AES-128"===(null==(s=d.decryptdata)?void 0:s.method)&&((s=a-n)%16&&(o=a+(16-s%16)),0!==n&&(l.resetIV=!0,t=n-16)),l.rangeStart=t,l.rangeEnd=o),l}function ur(a,t){var e=new Error("GAP "+(a.gap?"tag":"attribute")+" found"),e={type:rt.MEDIA_ERROR,details:it.FRAG_GAP,fatal:!1,frag:a,error:e,networkDetails:null};return t&&(e.part=t),(t||a).stats.aborted=!0,new dr(e)}function cr(d,t,e,r,o,s){void 0===r&&(r=0),void 0===o&&(o=-1),void 0===s&&(s=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=d,this.sn=t,this.id=e,this.size=r,this.part=o,this.partial=s}function fr(){}function gr(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}function mr(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}function Lr(a){var t;return(t=_d.call(this,a.error.message)||this).data=void 0,t.data=a,t}function Rr(d,t){for(var e=null,o=0,s=d.length,n;o<s;o++)if(n=d[o],n&&n.cc===t){e=n;break}return e}function Ar(a,t){a&&(t=a.start+t,a.start=a.startPTS=t,a.endPTS=t+a.duration)}function kr(a,t){for(var e=t.fragments,r=0,d=e.length;r<d;r++)Ar(e[r],a);t.fragmentHint&&Ar(t.fragmentHint,a),t.alignedSliding=!0}function Dr(a,t){var d,o,s;a.hasProgramDateTime&&t.hasProgramDateTime&&(s=a.fragments,o=t.fragments,s.length&&o.length&&(t=Rr(s,(d=o[Math.round(o.length/2)-1]).cc)||s[Math.round(s.length/2)-1],o=d.programDateTime,s=t.programDateTime,null!==o&&null!==s&&kr((s-o)/1e3-(t.start-d.start),a)))}function Ir(a,t){if(t=(void 0===t?{}:t).removePKCS7Padding,t=void 0===t||t,(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=a.enableSoftwareAES,this.removePKCS7Padding=t))try{var n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch(e){}null===this.subtle&&(this.useSoftware=!0)}function br(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}function wr(a,t){this.subtle=void 0,this.key=void 0,this.subtle=a,this.key=t}function qr(a,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=a,this.aesIV=t}function zr(){return self.SourceBuffer||self.WebKitSourceBuffer}function Xr(a,r){return void 0===a&&(a=""),void 0===r&&(r=9e4),{type:a,id:-1,pid:-1,inputTimeScale:r,sequenceNumber:-1,samples:[],dropped:0}}function Qr(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}function $r(a,t){return 255===a[t]&&240==(246&a[t+1])}function Jr(a,t){return 1&a[t+1]?7:9}function ei(a,t){return(3&a[t+3])<<11|a[t+4]<<3|(224&a[t+5])>>>5}function ri(a,t){return t+1<a.length&&$r(a,t)}function ai(a,t,e,r,i){a.samplerate||(i=function(d,t,e,r){var c=navigator.userAgent.toLowerCase(),s=r,o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],l=1+((192&t[e+2])>>>6),f=(60&t[e+2])>>>2,g,m;return o.length-1<f?void d.trigger(G.ERROR,{type:rt.MEDIA_ERROR,details:it.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+f}):(g=(1&t[e+2])<<2,g|=(192&t[e+3])>>>6,nt.log("manifest codec:"+r+", ADTS type:"+l+", samplingIndex:"+f),r=/firefox/i.test(c)?6<=f?(l=5,m=[,,,,],f-3):(l=2,m=[,,],f):-1===c.indexOf("android")?(l=5,m=[,,,,],r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&6<=f?f-3:((r&&-1!==r.indexOf("mp4a.40.2")&&(6<=f&&1==g||/vivaldi/i.test(c))||!r&&1==g)&&(l=2,m=[,,]),f)):(l=2,m=[,,],f),m[0]=l<<3,m[0]|=(14&f)>>1,m[1]|=(1&f)<<7,m[1]|=g<<3,5===l&&(m[1]|=(14&r)>>1,m[2]=(1&r)<<7,m[2]|=8,m[3]=0),{config:m,samplerate:o[f],channelCount:g,codec:"mp4a.40."+l,manifestCodec:s})}(t,e,r,i))&&(a.config=i.config,a.samplerate=i.samplerate,a.channelCount=i.channelCount,a.codec=i.codec,a.manifestCodec=i.manifestCodec,nt.log("parsed codec:"+a.codec+", rate:"+i.samplerate+", channels:"+i.channelCount))}function ni(e){return 9216e4/e}function ii(d,l,r,t,i){var u=t+i*ni(d.samplerate),t=function(){var a=Jr(l,r);if(r+a<=l.length){var t=ei(l,r)-a;if(0<t)return{headerLength:a,frameLength:t}}}(),s;if(t){var c=t.frameLength,i=t.headerLength,t=i+c,c=Math.max(0,r+t-l.length);return c?(s=new Uint8Array(t-i)).set(l.subarray(r+i,l.length),0):s=l.subarray(r+i,r+t),i={unit:s,pts:u},(c||d.samples.push(i),{sample:i,length:t,missing:c})}return c=l.length-r,(s=new Uint8Array(c)).set(l.subarray(r,l.length),0),{sample:{unit:s,pts:u},length:c,missing:-1}}function oi(a,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}function si(d,t,e,r,i){if(!(e+24>t.length)){var o=li(t,e);if(o&&e+o.frameLength<=t.length)return i=r+i*(9e4*o.samplesPerFrame/o.sampleRate),i={unit:t.subarray(e,e+o.frameLength),pts:i,dts:i},(d.config=[],d.channelCount=o.channelCount,d.samplerate=o.sampleRate,d.samples.push(i),{sample:i,length:o.frameLength,missing:0})}}function li(d,t){var e=3&d[t+1]>>3,c=3&d[t+1]>>1,i=15&d[t+2]>>4,f=3&d[t+2]>>2;if(1!=e&&0!=i&&15!=i&&3!=f){var g=1&d[t+2]>>1,m=d[t+3]>>6,o=1e3*kd[14*(3==e?3-c:3==c?3:4)+i-1],l=fi[3*(3==e?0:2==e?1:2)+f],u=3==m?1:2,i=gi[e][c],f=mi[c],e=8*i*f,g=Math.floor(i*o/l+g)*f;return null===Ad&&(f=(navigator.userAgent||"").match(/Chrome\/(\d+)/i),Ad=f?parseInt(f[1]):0),Ad&&87>=Ad&&2==c&&224e3<=o&&0==m&&(d[t+3]=128|d[t+3]),{sampleRate:l,channelCount:u,frameLength:g,samplesPerFrame:e}}}function pi(a,t){return 255===a[t]&&224==(224&a[t+1])&&0!=(6&a[t+1])}function yi(a,t){return t+1<a.length&&pi(a,t)}function Ti(a,t,e){this.keyData=void 0,this.decrypter=void 0,this.keyData=e,this.decrypter=new Pr(t,{removePKCS7Padding:!1})}function Ei(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}function Si(a,t,e,r){return{key:a,frame:!1,pts:t,dts:e,units:[],debug:r,length:0}}function Di(a,t){return((31&a[t+1])<<8)+a[t+2]}function Ii(g){var t=0,m=g.data,s,p,y,T;if(!g||0===g.size)return null;for(;19>m[0].length&&1<m.length;){var E=new Uint8Array(m[0].length+m[1].length);E.set(m[0]),E.set(m[1],m[0].length),m[0]=E,m.splice(1,1)}if(1!==((s=m[0])[0]<<16)+(s[1]<<8)+s[2])return null;if((p=(s[4]<<8)+s[5])&&p>g.size-6)return null;var o=s[7];192&o&&(y=536870912*(14&s[9])+4194304*(255&s[10])+16384*(254&s[11])+128*(255&s[12])+(254&s[13])/2,64&o?54e5<y-(T=536870912*(14&s[14])+4194304*(255&s[15])+16384*(254&s[16])+128*(255&s[17])+(254&s[18])/2)&&(nt.warn(Math.round((y-T)/9e4)+"s delta between PTS and DTS, align them"),y=T):T=y);var S=(o=s[8])+9;if(g.size<=S)return null;g.size-=S;for(var L=new Uint8Array(g.size),h=0,R=m.length,c;h<R;h++){if(c=(s=m[h]).byteLength,S){if(c<S){S-=c;continue}s=s.subarray(S),c-=S,S=0}L.set(s,t),t+=c}return p&&(p-=o+3),{data:L,pts:y,dts:T,len:p}}function bi(a,t){if(a.units.length&&a.frame){if(void 0===a.pts){var e=t.samples,r=e.length;if(!r)return t.dropped++,0;r=e[r-1],a.pts=r.pts,a.dts=r.dts}t.samples.push(a)}a.debug.length&&nt.log(a.pts+"/"+a.dts+":"+a.debug)}function Ci(){}function _i(){}function Oi(a,t,e,n){return void 0===e&&(e=1),void 0===n&&(n=!1),e*=a*t,n?Math.round(e):e}function wi(a,t){return void 0===t&&(t=!1),Oi(a,1e3,1/9e4,t)}function Ni(a,t,e){var r;this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=a,this.config=t,this.typeSupported=e,this.ISGenerated=!1,null===xd&&(r=(navigator.userAgent||"").match(/Chrome\/(\d+)/i),xd=r?parseInt(r[1]):0),null===Pd&&(r=navigator.userAgent.match(/Safari\/(\d+)/i),Pd=r?parseInt(r[1]):0)}function Bi(a,n){var e;if(null===n)return a;for(e=n<a?-8589934592:8589934592;4294967296<Math.abs(a-n);)a+=e;return a}function Ui(d,t,e,r){var i=d.samples.length;if(i){for(var n=d.inputTimeScale,a=0,u;a<i;a++)u=d.samples[a],u.pts=Bi(u.pts-e.baseTime*n/e.timescale,t*n)/n,u.dts=Bi(u.dts-r.baseTime*n/r.timescale,t*n)/n;var c=d.samples;return d.samples=[],{samples:c}}}function Hi(d,t,e){var r=d.samples.length;if(r){for(var i=d.inputTimeScale,n=0,l;n<r;n++)l=d.samples[n],l.pts=Bi(l.pts-9e4*e.baseTime/e.timescale,t*i)/i;d.samples.sort(function(a,t){return a.pts-t.pts});var u=d.samples;return d.samples=[],{samples:u}}}function Vi(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}function Yi(a,r){return a=null==a?void 0:a.codec,a&&4<a.length?a:"hvc1"===a||"hev1"===a?"hvc1.1.6.L120.90":"av01"===a?"av01.0.04M.08":"avc1"===a||"video"===r?"avc1.42e01e":"mp4a.40.5"}function Wi(a,t,e,r,i){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=a,this.typeSupported=t,this.config=e,this.vendor=r,this.id=i}function en(e){return"then"in e&&e.then instanceof Function}function rn(a,t,e,r,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=a,this.videoCodec=t,this.initSegmentData=e,this.duration=r,this.defaultInitPts=i||null}function nn(d,t,e,r,i,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=d,this.contiguous=t,this.accurateTimeOffset=e,this.trackSwitch=r,this.timeOffset=i,this.initSegmentChange=n}function an(){}function un(a,t,e){this.fn=a,this.context=t,this.once=e||!1}function hn(a,t,d,r,i){if("function"!=typeof d)throw new TypeError("The listener must be a function");return i=new un(d,r||a,i),t=Md?Md+t:t,(a._events[t]?a._events[t].fn?a._events[t]=[a._events[t],i]:a._events[t].push(i):(a._events[t]=i,a._eventsCount++),a)}function dn(a,t){0==--a._eventsCount?a._events=new an:delete a._events[t]}function cn(){this._events=new an,this._eventsCount=0}function fn(a,t){if(!((d=t.remuxResult).audio||d.video||d.text||d.id3||d.initSegment))return!1;var e=[],r=t.remuxResult,d=r.audio,r=r.video;return d&&yn(e,d),r&&yn(e,r),a.postMessage({event:"transmuxComplete",data:t},e),!0}function yn(a,t){t.data1&&a.push(t.data1.buffer),t.data2&&a.push(t.data2.buffer)}function Tn(a,r,t){r.reduce(function(r,t){return fn(a,t)||r},!1)||a.postMessage({event:"transmuxComplete",data:r[0]}),a.postMessage({event:"flush",data:t})}function En(a,t){Bd.postMessage({event:a,data:t})}function Sn(){for(var e in nt)!function(a){nt[a]=function(e){En("workerLog",{logType:a,message:e})}}(e)}function Ln(){this.chunks=[],this.dataLength=0}function Cn(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,e=(this.hls=e).config,this.bwEstimator=new Dn(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate),this.registerListeners()}function _n(a,t,e,r){void 0===r&&(r=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=e,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new bn(a),this.fast_=new bn(t),this.defaultTTFB_=r,this.ttfb_=new bn(a)}function Pn(a,t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=a,this.alpha_=a?Math.exp(Math.log(.5)/a):0,this.estimate_=t,this.totalWeight_=n}function xn(a,t,e,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=a,this.media=t,this.fragmentTracker=e,this.hls=r}function Fn(d,c,e,t){var f=this;this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var n=d.config;this.hls=d,this.id=c,this.useWorker=!!n.enableWorker,this.onTransmuxComplete=e,this.onFlush=t,t=function(a,t){(t=t||{}).frag=f.frag,t.id=f.id,a===G.ERROR&&(f.error=t.error),f.hls.trigger(a,t)},this.observer=new Nd,this.observer.on(G.FRAG_DECRYPTED,t),this.observer.on(G.ERROR,t);var a={mp4:Gd.isTypeSupported("video/mp4"),mpeg:Gd.isTypeSupported("audio/mpeg"),mp3:Gd.isTypeSupported("audio/mp4; codecs=\"mp3\"")},o=navigator.vendor,l;if(!this.useWorker||"undefined"==typeof Worker||(n.workerPath,0))this.transmuxer=new Ji(this.observer,a,n,o,c);else try{n.workerPath?(nt.log("loading Web Worker "+n.workerPath+" for \""+c+"\""),this.workerContext=(l=n.workerPath,l=new self.URL(l,self.location.href).href,{worker:new self.Worker(l),scriptURL:l})):(nt.log("injecting Web Worker for \""+c+"\""),this.workerContext=(g=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+r.toString()+")(true);"],{type:"text/javascript"}),g=self.URL.createObjectURL(g),{worker:new self.Worker(g),objectURL:g})),this.onwmsg=function(e){return f.onWorkerMessage(e)};var g=this.workerContext.worker;g.addEventListener("message",this.onwmsg),g.onerror=function(e){e=new Error(e.message+"  ("+e.filename+":"+e.lineno+")"),n.enableWorker=!1,nt.warn("Error in \""+c+"\" Web Worker, fallback to inline"),f.hls.trigger(G.ERROR,{type:rt.OTHER_ERROR,details:it.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:e})},g.postMessage({cmd:"init",typeSupported:a,vendor:o,id:c,config:JSON.stringify(n)})}catch(e){nt.warn("Error setting up \""+c+"\" Web Worker, fallback to inline",e),this.resetWorker(),this.error=null,this.transmuxer=new Ji(this.observer,a,n,o,c)}}function Mn(a,t){if(a.length===t.length){for(var e=0;e<a.length;e++)if(!function(a,e){var r=a["STABLE-RENDITION-ID"];return r?r===e["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(function(r){return a[r]!==e[r]})}(a[e].attrs,t[e].attrs))return;return 1}}function On(a){for(var t=[],e=0,n;e<a.length;e++)n=a[e],("subtitles"===n.kind||"captions"===n.kind)&&n.label&&t.push(a[e]);return t}function Bn(a){var t=a;return Hd.hasOwnProperty(a)&&(t=Hd[a]),String.fromCharCode(t)}function Gn(a){for(var t=[],e=0;e<a.length;e++)t.push(a[e].toString(16));return t}function Kn(a,t,e){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new Jn;this.channels=[null,new ia(a,t,r),new ia(a+1,e,r)],this.cmdHistory={a:null,b:null},this.logger=r}function sa(a,t,e){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=a,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new ra(e),this.nonDisplayedMemory=new ra(e),this.lastOutputScreen=new ra(e),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=e}function oa(a){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;15>t;t++)this.rows.push(new ea(a));this.logger=a,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}function la(a){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;100>t;t++)this.chars.push(new ta);this.logger=a,this.pos=0,this.currPenState=new Zn}function ua(d,t,e,r,i,n){this.uchar=void 0,this.penState=void 0,this.uchar=d||" ",this.penState=new Zn(t,e,r,i,n)}function ha(a,t,e,r,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=a||"white",this.underline=t||!1,this.italics=e||!1,this.background=r||"black",this.flash=i||!1}function da(){this.time=null,this.verboseLevel=0}function ca(e){var a=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var r=a.media,t=a.mediaSource;nt.log("[buffer-controller]: Media source opened"),r&&(r.removeEventListener("emptied",a._onMediaEmptied),a.updateMediaElementDuration(),a.hls.trigger(G.MEDIA_ATTACHED,{media:r})),t&&t.removeEventListener("sourceopen",a._onMediaSourceOpen),a.checkPendingTracks()},this._onMediaSourceClose=function(){nt.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){nt.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var r=a.media,t=a._objectUrl;r&&r.src!==t&&nt.error("Media element src was set while attaching MediaSource ("+t+" > "+r.src+")")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}function fa(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}function ga(a,t,e){e.a=a,e.b=t}function ma(a,t,e){return e.a===a&&e.b===t}function va(){}function Ea(a,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=a,this.trackName=t}function Sa(a){function r(a,t,e,r){return 3600*(0|a)+60*(0|t)+(0|e)+parseFloat(r||0)}return a=a.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/),a?59<parseFloat(a[2])?r(a[2],a[3],0,a[4]):r(a[1],a[2],a[3],a[4]):null}function La(){this.values=Object.create(null)}function Aa(d,t,e,r){var i=r?d.split(r):[d],o,s;for(o in i)"string"!=typeof i[o]||2===(s=i[o].split(e)).length&&t(s[0],s[1])}function ka(e){return e.replace(/<br(?: \/)?>/gi,"\n")}function Ia(a,t,e){return void 0===e&&(e=0),a.slice(e,e+t.length)===t}function wa(){this.state="INITIAL",this.buffer="",this.decoder=new ya,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}function xa(a,t,e){return _a(a.toString())+_a(t.toString())+_a(e)}function Fa(p,y,T,n,a,s,r){var i=new Da,l=vt(new Uint8Array(p)).trim().replace(Ca,"\n").split("\n"),u=[],h=(p=y.baseTime,void 0===(y=y.timescale)&&(y=1),Oi(p,9e4,1/y)),d="00:00.000",E=0,S=0,L=!0,R;i.oncue=function(d){var t=T[n],e=T.ccOffset,o=(E-h)/9e4;null!=t&&t.new&&(void 0===S?function(a,t){var e=a[n],d=a[e.prevCC];if(!d||!d.new&&e.new)return a.ccOffset=a.presentationOffset=e.start,e.new=!1;for(;null!=d&&d.new;)a.ccOffset+=e.start-d.start,e.new=!1,d=a[(e=d).prevCC];a.presentationOffset=t}(T,o):e=T.ccOffset=t.start),o&&(e=o-T.presentationOffset),o=d.endTime-d.startTime,e=Bi(9e4*(d.startTime+e-S),9e4*a)/9e4,d.startTime=Math.max(e,0),d.endTime=Math.max(e+o,0),o=d.text.trim(),d.text=decodeURIComponent(encodeURIComponent(o)),d.id||(d.id=xa(d.startTime,d.endTime,o)),0<d.endTime&&u.push(d)},i.onparsingerror=function(e){R=e},i.onflush=function(){R?r(R):s(u)},l.forEach(function(e){if(L){if(Ia(e,"X-TIMESTAMP-MAP=")){L=!1,e.slice(16).split(",").forEach(function(e){Ia(e,"LOCAL:")?d=e.slice(6):Ia(e,"MPEGTS:")&&(E=parseInt(e.slice(7)))});try{S=function(a){var t=parseInt(a.slice(-3)),d=parseInt(a.slice(-6,-4)),r=parseInt(a.slice(-9,-7)),i=9<a.length?parseInt(a.substring(0,a.indexOf(":"))):0;if(!(yd(t)&&yd(d)&&yd(r)&&yd(i)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+a);return t+=1e3*d,(t+=6e4*r)+36e5*i}(d)/1e3}catch(e){R=e}return}""===e&&(L=!1)}i.parse(e+"\n")}),i.flush()}function Ma(d,t,l,r){var i=At(new Uint8Array(d),["mdat"]);if(0!==i.length){var u=i.map(function(e){return vt(e)}),s=(i=t.baseTime,void 0===(t=t.timescale)&&(t=1),void 0===o&&(o=!1),Oi(i,1,1/t,o)),o;try{u.forEach(function(e){return l(function(e,g){var a=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!a)throw new Error("Invalid ttml");var r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},u=Object.keys(r).reduce(function(n,t){return n[t]=a.getAttribute("ttp:"+t)||r[t],n},{}),m="preserve"!==a.getAttribute("xml:space"),d=Ka(Ga(a,"styling","style")),c=Ka(Ga(a,"layout","region")),e=Ga(a,"body","[begin]");return[].map.call(e,function(f){var p=function a(e,i){return[].slice.call(e.childNodes).reduce(function(n,t,e){return"br"===t.nodeName&&e?n+"\n":null!=(e=t.childNodes)&&e.length?a(t,i):i?n+t.textContent.trim().replace(/\s+/g," "):n+t.textContent},"")}(f,m);if(!p||!f.hasAttribute("begin"))return null;var y=Ya(f.getAttribute("begin"),u),h=Ya(f.getAttribute("dur"),u),i=Ya(f.getAttribute("end"),u);if(null===y)throw Va(f);if(null===i){if(null===h)throw Va(f);i=y+h}y=new pa(y-g,i-g,p),y.id=xa(y.startTime,y.endTime,y.text);var f=(T=c[f.getAttribute("region")],E=d[f.getAttribute("style")],i=d,S="http://www.w3.org/ns/ttml#styling",(p=(L=null)!=T&&T.hasAttribute("style")?T.getAttribute("style"):null)&&i.hasOwnProperty(p)&&(L=i[p]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(a,t){var e=Ha(E,S,t)||Ha(T,S,t)||Ha(L,S,t);return e&&(a[t]=e),a},{})),i=f.textAlign,T,E,S,L;return i&&((p=Ua[i])&&(y.lineAlign=p),y.align=i),qa(y,f),y}).filter(function(e){return null!==e})}(e,s))})}catch(e){r(e)}}else r(new Error("Could not parse IMSC1 mdat"))}function Ga(a,t,n){return t=a.getElementsByTagName(t)[0],t?[].slice.call(t.querySelectorAll(n)):[]}function Ka(e){return e.reduce(function(a,t){var e=t.getAttribute("xml:id");return e&&(a[e]=t),a},{})}function Ha(a,t,e){return a&&a.hasAttributeNS(t,e)?a.getAttributeNS(t,e):null}function Va(e){return new Error("Could not parse ttml timestamp "+e)}function Ya(d,i){if(!d)return null;var t=Sa(d),o,s,l;return null===t&&(Oa.test(d)?(o=i,s=Oa.exec(d),l=(0|s[4])+(0|s[5])/o.subFrameRate,t=3600*(0|s[1])+60*(0|s[2])+(0|s[3])+l/o.frameRate):Na.test(d)&&(t=function(a){var t=Na.exec(d),e=+t[1];switch(t[2]){case"h":return 3600*e;case"m":return 60*e;case"ms":return 1e3*e;case"f":return e/a.frameRate;case"t":return e/a.tickRate;}return e}(i))),t}function Wa(a){var t,d,o,s;this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=a,this.config=a.config,this.Cues=a.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions&&(t=new aa(this,"textTrack1"),d=new aa(this,"textTrack2"),o=new aa(this,"textTrack3"),s=new aa(this,"textTrack4"),this.cea608Parser1=new na(1,t,d),this.cea608Parser2=new na(3,o,s)),a.on(G.MEDIA_ATTACHING,this.onMediaAttaching,this),a.on(G.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(G.MANIFEST_LOADING,this.onManifestLoading,this),a.on(G.MANIFEST_LOADED,this.onManifestLoaded,this),a.on(G.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.on(G.FRAG_LOADING,this.onFragLoading,this),a.on(G.FRAG_LOADED,this.onFragLoaded,this),a.on(G.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),a.on(G.FRAG_DECRYPTED,this.onFragDecrypted,this),a.on(G.INIT_PTS_FOUND,this.onInitPtsFound,this),a.on(G.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),a.on(G.BUFFER_FLUSHING,this.onBufferFlushing,this)}function ja(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=ja.CDMCleanupPromise?[ja.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=nt.debug.bind(nt,"[eme]"),this.log=nt.log.bind(nt,"[eme]"),this.warn=nt.warn.bind(nt,"[eme]"),this.error=nt.error.bind(nt,"[eme]"),this.hls=e,this.config=e.config,this.registerListeners()}function Xa(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}function za(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}function Qa(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=nt.log.bind(nt,"[content-steering]:"),this.registerListeners()}function Qi(a){var d=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){d.initialized&&(d.starved=!0),d.buffering=!0},this.onPlaying=function(){d.initialized||(d.initialized=!0),d.buffering=!1},this.applyPlaylistData=function(e){try{d.apply(e,{ot:"m",su:!d.initialized})}catch(e){nt.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=function(a){try{var t=a.frag,n=d.hls.levels[t.level],r=d.getObjectType(t),t={d:1e3*t.duration,ot:r};"v"!==r&&"a"!==r&&"av"!=r||(t.br=n.bitrate/1e3,t.tb=d.getTopBandwidth(r)/1e3,t.bl=d.getBufferLength(r)),d.apply(a,t)}catch(e){nt.warn("Could not generate segment CMCD data.",e)}},this.hls=a;var r=this.config=a.config,a=r.cmcd;null!=a&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=a.sessionId||Qi.uuid(),this.cid=a.contentId,this.useHeaders=!0===a.useHeaders,this.registerListeners())}function $i(a,t){var e;return(e=qd.call(this,t)||this).data=void 0,a.error||(a.error=new Error(t)),(e.data=a).err=a.error,e}function ad(d,o,i,n){d&&Object.keys(o).forEach(function(a){var e=d.filter(function(e){return e.groupId===a}).map(function(r){var t=qa({},r);return t.details=void 0,t.attrs=new hd(t.attrs),t.url=t.attrs.URI=rd(r.url,r.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",i),t.groupId=t.attrs["GROUP-ID"]=o[a],t.attrs["PATHWAY-ID"]=n,t});d.push.apply(d,e)})}function rd(d,l,e,u){var i=u.HOST,a=u.PARAMS,e=u[e],s;l&&(s=null==e?void 0:e[l])&&(d=s);var c=new self.URL(d);return i&&!s&&(c.host=i),a&&Object.keys(a).sort().forEach(function(e){e&&c.searchParams.set(e,a[e])}),c.href}function nd(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||dd,this.controller=new self.AbortController,this.stats=new h}function id(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new h,this.retryDelay=0}function dd(a,t){return new self.Request(a.url,t)}function od(a,n,e){return(a=zd.call(this,a)||this).code=void 0,a.details=void 0,a.code=n,a.details=e,a}function sd(a){return a&&"object"==typeof a?Array.isArray(a)?a.map(sd):Object.keys(a).reduce(function(r,t){return r[t]=sd(a[t]),r},{}):a}var ld={exports:{}},ud,cd,fd,gd,md;ud=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,cd=/^(?=([^\/?#]*))\1([^]*)$/,fd=/(?:\/|^)\.(?=\/)/g,gd=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g;var pd=ld.exports=md={buildAbsoluteURL:function(a,d,o){if(o=o||{},a=a.trim(),!(d=d.trim())){if(!o.alwaysNormalize)return a;var s=md.parseURL(a);if(!s)throw new Error("Error trying to parse base URL.");return s.path=md.normalizePath(s.path),md.buildURLFromParts(s)}if(s=md.parseURL(d),!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return o.alwaysNormalize?(s.path=md.normalizePath(s.path),md.buildURLFromParts(s)):d;if(d=md.parseURL(a),!d)throw new Error("Error trying to parse base URL.");!d.netLoc&&d.path&&"/"!==d.path[0]&&(l=cd.exec(d.path),d.netLoc=l[1],d.path=l[2]),d.netLoc&&!d.path&&(d.path="/");var a={scheme:d.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment},l;return s.netLoc||(a.netLoc=d.netLoc,"/"===s.path[0])||(s.path?(l=(l=d.path).substring(0,l.lastIndexOf("/")+1)+s.path,a.path=md.normalizePath(l)):(a.path=d.path,s.params||(a.params=d.params,s.query||(a.query=d.query)))),null===a.path&&(a.path=o.alwaysNormalize?md.normalizePath(s.path):s.path),md.buildURLFromParts(a)},parseURL:function(e){return e=ud.exec(e),e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(fd,"");e.length!==(e=e.replace(gd,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},yd=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},G=((Nn={}).MEDIA_ATTACHING="hlsMediaAttaching",Nn.MEDIA_ATTACHED="hlsMediaAttached",Nn.MEDIA_DETACHING="hlsMediaDetaching",Nn.MEDIA_DETACHED="hlsMediaDetached",Nn.BUFFER_RESET="hlsBufferReset",Nn.BUFFER_CODECS="hlsBufferCodecs",Nn.BUFFER_CREATED="hlsBufferCreated",Nn.BUFFER_APPENDING="hlsBufferAppending",Nn.BUFFER_APPENDED="hlsBufferAppended",Nn.BUFFER_EOS="hlsBufferEos",Nn.BUFFER_FLUSHING="hlsBufferFlushing",Nn.BUFFER_FLUSHED="hlsBufferFlushed",Nn.MANIFEST_LOADING="hlsManifestLoading",Nn.MANIFEST_LOADED="hlsManifestLoaded",Nn.MANIFEST_PARSED="hlsManifestParsed",Nn.LEVEL_SWITCHING="hlsLevelSwitching",Nn.LEVEL_SWITCHED="hlsLevelSwitched",Nn.LEVEL_LOADING="hlsLevelLoading",Nn.LEVEL_LOADED="hlsLevelLoaded",Nn.LEVEL_UPDATED="hlsLevelUpdated",Nn.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",Nn.LEVELS_UPDATED="hlsLevelsUpdated",Nn.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",Nn.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",Nn.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",Nn.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",Nn.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",Nn.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",Nn.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",Nn.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",Nn.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",Nn.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",Nn.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",Nn.CUES_PARSED="hlsCuesParsed",Nn.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",Nn.INIT_PTS_FOUND="hlsInitPtsFound",Nn.FRAG_LOADING="hlsFragLoading",Nn.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",Nn.FRAG_LOADED="hlsFragLoaded",Nn.FRAG_DECRYPTED="hlsFragDecrypted",Nn.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",Nn.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",Nn.FRAG_PARSING_METADATA="hlsFragParsingMetadata",Nn.FRAG_PARSED="hlsFragParsed",Nn.FRAG_BUFFERED="hlsFragBuffered",Nn.FRAG_CHANGED="hlsFragChanged",Nn.FPS_DROP="hlsFpsDrop",Nn.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",Nn.ERROR="hlsError",Nn.DESTROYING="hlsDestroying",Nn.KEY_LOADING="hlsKeyLoading",Nn.KEY_LOADED="hlsKeyLoaded",Nn.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",Nn.BACK_BUFFER_REACHED="hlsBackBufferReached",Nn),rt=((Ai={}).NETWORK_ERROR="networkError",Ai.MEDIA_ERROR="mediaError",Ai.KEY_SYSTEM_ERROR="keySystemError",Ai.MUX_ERROR="muxError",Ai.OTHER_ERROR="otherError",Ai),it=((yr={}).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",yr.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",yr.KEY_SYSTEM_NO_SESSION="keySystemNoSession",yr.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",yr.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",yr.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",yr.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",yr.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",yr.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",yr.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",yr.MANIFEST_LOAD_ERROR="manifestLoadError",yr.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",yr.MANIFEST_PARSING_ERROR="manifestParsingError",yr.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",yr.LEVEL_EMPTY_ERROR="levelEmptyError",yr.LEVEL_LOAD_ERROR="levelLoadError",yr.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",yr.LEVEL_PARSING_ERROR="levelParsingError",yr.LEVEL_SWITCH_ERROR="levelSwitchError",yr.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",yr.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",yr.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",yr.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",yr.FRAG_LOAD_ERROR="fragLoadError",yr.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",yr.FRAG_DECRYPT_ERROR="fragDecryptError",yr.FRAG_PARSING_ERROR="fragParsingError",yr.FRAG_GAP="fragGap",yr.REMUX_ALLOC_ERROR="remuxAllocError",yr.KEY_LOAD_ERROR="keyLoadError",yr.KEY_LOAD_TIMEOUT="keyLoadTimeOut",yr.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",yr.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",yr.BUFFER_APPEND_ERROR="bufferAppendError",yr.BUFFER_APPENDING_ERROR="bufferAppendingError",yr.BUFFER_STALLED_ERROR="bufferStalledError",yr.BUFFER_FULL_ERROR="bufferFullError",yr.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",yr.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",yr.INTERNAL_EXCEPTION="internalException",yr.INTERNAL_ABORTED="aborted",yr.UNKNOWN="unknown",yr),y=function(){},T={trace:y,debug:y,log:y,warn:y,info:y,error:y},E=T,nt=E,at=/(.+?)=(".*?"|.*?)(?:,|$)/g,hd=((Dd=c.prototype).decimalInteger=function(e){return e=parseInt(this[e],10),e>Number.MAX_SAFE_INTEGER?1/0:e},Dd.hexadecimalInteger=function(a){if(this[a]){for(var t=(1&(t=(this[a]||"0x").slice(2)).length?"0":"")+t,n=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(2*r,2*r+2),16);return n}return null},Dd.hexadecimalIntegerAsNumber=function(e){return e=parseInt(this[e],16),e>Number.MAX_SAFE_INTEGER?1/0:e},Dd.decimalFloatingPoint=function(e){return parseFloat(this[e])},Dd.optionalFloat=function(a,r){return a=this[a],a?parseFloat(a):r},Dd.enumeratedString=function(e){return this[e]},Dd.bool=function(e){return"YES"===this[e]},Dd.decimalResolution=function(e){if(e=/^(\d+)x(\d+)$/.exec(this[e]),null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},c.parseAttrList=function(a){var t={},r;for(at.lastIndex=0;null!==(r=at.exec(a));){var n=r[2];0===n.indexOf("\"")&&n.lastIndexOf("\"")===n.length-1&&(n=n.slice(1,-1)),t[r[1].trim()]=n}return t},c),K=(qt(x,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var e=this.duration;return null===e?null:new Date(this._startDate.getTime()+1e3*e)}},{key:"duration",get:function(){if("DURATION"in this.attr){var e=this.attr.decimalFloatingPoint("DURATION");if(yd(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&yd(this.startDate.getTime())&&(null===this.duration||0<=this.duration)&&(!this.endOnNext||!!this.class)}}]),x),A="audio",I="video",w="audiovideo",C=(b.prototype.setByteRange=function(a,n){var e=a.split("@",2),a=[];a[0]=1===e.length?n?n.byteRangeEndOffset:0:parseInt(e[1]),a[1]=parseInt(e[0])+a[0],this._byteRange=a},qt(b,[{key:"byteRange",get:function(){return this._byteRange||[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=pd.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),b),H=function(a){function r(r,t){return(t=a.call(this,t)||this)._decryptdata=null,t.rawProgramDateTime=null,t.programDateTime=null,t.tagList=[],t.duration=0,t.sn=0,t.levelkeys=void 0,t.type=void 0,t.loader=null,t.keyLoader=null,t.level=-1,t.cc=0,t.startPTS=void 0,t.endPTS=void 0,t.startDTS=void 0,t.endDTS=void 0,t.start=0,t.deltaPTS=void 0,t.maxStartPTS=void 0,t.minEndPTS=void 0,t.stats=new h,t.urlId=0,t.data=void 0,t.bitrateTest=!1,t.title=null,t.initSegment=null,t.endList=void 0,t.gap=void 0,t.type=r,t}Za(r,a);var t=r.prototype;return t.setKeyFormat=function(e){this.levelkeys&&(!(e=this.levelkeys[e])||this._decryptdata||(this._decryptdata=e.getDecryptData(this.sn)))},t.abortRequests=function(){var e;null==(e=this.loader)||e.abort(),null==(e=this.keyLoader)||e.abort()},t.setElementaryStreamInfo=function(d,t,e,r,i,n){void 0===n&&(n=!1);var l=this.elementaryStreams,s=l[d];s?(s.startPTS=Math.min(s.startPTS,t),s.endPTS=Math.max(s.endPTS,e),s.startDTS=Math.min(s.startDTS,r),s.endDTS=Math.max(s.endDTS,i)):l[d]={startPTS:t,endPTS:e,startDTS:r,endDTS:i,partial:n}},t.clearElementaryStreamInfo=function(){var e=this.elementaryStreams;e[A]=null,e[I]=null,e[w]=null},qt(r,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else if(e=Object.keys(this.levelkeys),1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!yd(this.programDateTime))return null;var e=yd(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){if(null!=(t=this._decryptdata)&&t.encrypted)return!0;if(this.levelkeys){var a=Object.keys(this.levelkeys),t=a.length;if(1<t||1===t&&this.levelkeys[a[0]].encrypted)return!0}return!1}}]),r}(C),V=(Za(k,Mi=C),qt(k,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),k),Y=(L.prototype.reloaded=function(a){if(!a)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-a.lastPartSn,e=this.lastPartIndex-a.lastPartIndex;this.updated=this.endSN!==a.endSN||!!e||!!t,this.advanced=this.endSN>a.endSN||0<t||0==t&&0<e,this.misses=this.updated||this.advanced?Math.floor(.6*a.misses):a.misses+1,this.availabilityDelay=a.availabilityDelay},qt(L,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&yd(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;return 0<e?1e3*(this.driftEnd-this.driftStart)/e:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),L),W={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},U="com.microsoft.playready",q="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",X="edef8ba979d64acea3c827dcd51d21ed",Q="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null,Z=function(a,t){var e=0,e=(127&a[t])<<21;return e|=(127&a[t+1])<<14,(e|=(127&a[t+2])<<7)|127&a[t+3]},ct=function(e){return("PRIV"===e.type?ft:"W"===e.type[0]?mt:gt)(e)},ft=function(a){if(!(2>a.size)){var t=vt(a.data,!0),e=new Uint8Array(a.data.subarray(t.length+1));return{key:a.type,info:t,data:e.buffer}}},gt=function(a){if(!(2>a.size)){if("TXXX"===a.type){var t=1,n=vt(a.data.subarray(1),!0);return t+=n.length+1,t=vt(a.data.subarray(t)),{key:a.type,info:n,data:t}}return t=vt(a.data.subarray(1)),{key:a.type,data:t}}},mt=function(a){if("WXXX"===a.type){if(2>a.size)return;var t=1,n=vt(a.data.subarray(1),!0);return t+=n.length+1,t=vt(a.data.subarray(t)),{key:a.type,info:n,data:t}}return t=vt(a.data),{key:a.type,data:t}},vt=function(d,t){void 0===t&&(t=!1);var c=(bd||void 0===self.TextDecoder||(bd=new self.TextDecoder("utf-8")),bd);if(c){var f=c.decode(d);return t?(c=f.indexOf("\0"),-1===c?f:f.substring(0,c)):f.replace(/\0/g,"")}for(var i=d.length,o="",g=0,m,p,y;g<i;){if(0===(m=d[g++])&&t)return o;if(0!==m&&3!==m)switch(m>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(m);break;case 12:case 13:p=d[g++],o+=String.fromCharCode((31&m)<<6|63&p);break;case 14:p=d[g++],y=d[g++],o+=String.fromCharCode((15&m)<<12|(63&p)<<6|(63&y)<<0);}}return o},pt=Math.pow(2,32)-1,Tt=[].push,Et={video:1,audio:2,id3:3,text:4},St={},Td=function(){function a(a,t,e,r,d){void 0===r&&(r=[1]),void 0===d&&(d=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=a,this.uri=t,this.keyFormat=e,this.keyFormatVersions=r,this.iv=d,this.encrypted=!!a&&"NONE"!==a,this.isCommonEncryption=this.encrypted&&"AES-128"!==a}a.clearKeyUriToKeyIdMap=function(){St={}};var e=a.prototype;return e.isSupported=function(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case"com.apple.streamingkeydelivery":case q:case U:case"org.w3.clearkey":return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method);}}return!1},e.getDecryptData=function(d){function u(a,t,e){var r=a[t];a[t]=a[e],a[e]=r}if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof d&&("AES-128"!==this.method||this.iv||nt.warn("missing IV for initialization segment with method=\""+this.method+"\" - compliance issue"),d=0);var l=function(a){for(var t=new Uint8Array(16),e=12;16>e;e++)t[e]=255&a>>8*(15-e);return t}(d);return new a(this.method,this.uri,"identity",this.keyFormatVersions,l)}var c=(f=this.uri,n=f.split(":"),d=null,"data"!==n[0]||2!==n.length||2===(f=(l=n[1].split(";"))[l.length-1].split(",")).length&&(n="base64"===f[0],f=f[1],d=n?(l.splice(-1,1),P(f)):(l=F(f).subarray(0,16),(f=new Uint8Array(16)).set(l,16-l.length),f)),d),n,f;if(c)switch(this.keyFormat){case q:22<=(this.pssh=c).length&&(this.keyId=c.subarray(c.length-22,c.length-6));break;case U:var g=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function(d,t,e){if(16!==d.byteLength)throw new RangeError("Invalid system id");var r,u,c;if(t){r=1,u=new Uint8Array(16*t.length);for(var f=0,g;f<t.length;f++){if(g=t[f],16!==g.byteLength)throw new RangeError("Invalid key");u.set(g,16*f)}}else r=0,u=new Uint8Array;0<r?(c=new Uint8Array(4),0<t.length&&new DataView(c.buffer).setUint32(0,t.length,!1)):c=new Uint8Array;var m=new Uint8Array(4);return e&&0<e.byteLength&&new DataView(m.buffer).setUint32(0,e.byteLength,!1),function(d){for(var t=arguments.length,e=Array(1<t?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];for(var l=e.length,n=8,u=l;u--;)n+=e[u].byteLength;var c=new Uint8Array(n);for(c[0]=255&n>>24,c[1]=255&n>>16,c[2]=255&n>>8,c[3]=255&n,c.set(d,4),u=0,n=8;u<l;u++)c.set(e[u],n),n+=e[u].byteLength;return c}([112,115,115,104],new Uint8Array([r,0,0,0]),d,c,u,m,e||new Uint8Array)}(g,null,c),g=new Uint16Array(c.buffer,c.byteOffset,c.byteLength/2),g=String.fromCharCode.apply(null,Array.from(g)),g=g.substring(g.indexOf("<"),g.length),g=new DOMParser().parseFromString(g,"text/xml").getElementsByTagName("KID")[0],!g||(g=g.childNodes[0]?g.childNodes[0].nodeValue:g.getAttribute("VALUE"))&&(p=P(g).subarray(0,16),u(m=p,0,3),u(m,1,2),u(m,4,5),u(m,6,7),this.keyId=p);break;default:var m=c.subarray(0,16),p;16!==m.length&&((p=new Uint8Array(16)).set(m,16-m.length),m=p),this.keyId=m;}return this.keyId&&16===this.keyId.byteLength||((f=St[this.uri])||(d=Object.keys(St).length%Number.MAX_SAFE_INTEGER,f=new Uint8Array(16),new DataView(f.buffer,12,4).setUint32(0,d),St[this.uri]=f),this.keyId=f),this},a}(),Mt=/\{\$([a-zA-Z0-9-_]+)\}/g,Ot={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},Ht=Bt(),Vt=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Wt=/#EXT-X-MEDIA:(.*)/g,jt=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Xt=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),zt=(Gt.findGroup=function(a,t){for(var e=0,n;e<a.length;e++)if(n=a[e],n.id===t)return n},Gt.convertAVC1ToAVCOTI=function(a){var t=a.split(".");if(2<t.length){var e=t.shift()+".";return(e+=parseInt(t.shift()).toString(16))+("000"+parseInt(t.shift()).toString(16)).slice(-4)}return a},Gt.resolve=function(a,t){return pd.buildAbsoluteURL(t,a,{alwaysNormalize:!0})},Gt.isMediaPlaylist=function(e){return /^#EXT(?:INF|-X-TARGETDURATION):/m.test(e)},Gt.parseMasterPlaylist=function(f,t){var e={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:xt(f)},i=[],n;for(Vt.lastIndex=0;null!=(n=Vt.exec(f));)if(n[1]){var g=new hd(n[1]);Pt(e,g,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);var m=wt(e,n[2]),p={attrs:g,bitrate:g.decimalInteger("AVERAGE-BANDWIDTH")||g.decimalInteger("BANDWIDTH"),name:g.NAME,url:Gt.resolve(m,t)},m=g.decimalResolution("RESOLUTION");m&&(p.width=m.width,p.height=m.height),function(a,d){["video","audio","text"].forEach(function(n){var r=a.filter(function(a){return!!(t=Ot[n])&&!0===t[a.slice(0,4)];var t}),e;r.length&&(e=r.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}),d[n+"Codec"]=(0<e.length?e:r)[0],a=a.filter(function(e){return-1===r.indexOf(e)}))}),d.unknownCodecs=a}((g.CODECS||"").split(/[ ,]+/).filter(function(e){return e}),p),p.videoCodec&&-1!==p.videoCodec.indexOf("avc1")&&(p.videoCodec=Gt.convertAVC1ToAVCOTI(p.videoCodec)),null!=(g=p.unknownCodecs)&&g.length||i.push(p),e.levels.push(p)}else if(n[3]){var p=n[3],y=n[4];switch(p){case"SESSION-DATA":var l=new hd(y);Pt(e,l,["DATA-ID","LANGUAGE","VALUE","URI"]);var T=l["DATA-ID"];T&&(null===e.sessionData&&(e.sessionData={}),e.sessionData[T]=l);break;case"SESSION-KEY":l=Kt(y,t,e),l.encrypted&&l.isSupported()?(null===e.sessionKeys&&(e.sessionKeys=[]),e.sessionKeys.push(l)):nt.warn("[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: \""+y+"\"");break;case"DEFINE":var h=new hd(y);Pt(e,h,["NAME","VALUE","QUERYPARAM"]),Nt(e,h,t);break;case"CONTENT-STEERING":h=new hd(y),Pt(e,h,["SERVER-URI","PATHWAY-ID"]),e.contentSteering={uri:Gt.resolve(h["SERVER-URI"],t),pathwayId:h["PATHWAY-ID"]||"."};break;case"START":e.startTimeOffset=Yt(y);}}var E=0<i.length&&i.length<e.levels.length;return e.levels=E?i:e.levels,0===e.levels.length&&(e.playlistParsingError=new Error("no levels found in manifest")),e},Gt.parseMasterPlaylistMedia=function(d,t,e){var r={},i=e.levels,n={AUDIO:i.map(function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}}),SUBTITLES:i.map(function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}}),"CLOSED-CAPTIONS":[]},a=0;for(Wt.lastIndex=0;null!==(g=Wt.exec(d));){var c=new hd(g[1]),f=c.TYPE,g,m;f&&(m=n[f],g=r[f]||[],r[f]=g,Pt(e,c,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]),c={attrs:c,bitrate:0,id:a++,groupId:c["GROUP-ID"]||"",instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE||"",type:f,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:c.LANGUAGE,url:c.URI?Gt.resolve(c.URI,t):""},null!=m&&m.length&&(Zt(c,m=Gt.findGroup(m,c.groupId)||m[0],"audioCodec"),Zt(c,m,"textCodec")),g.push(c))}return r},Gt.parseLevelPlaylist=function(G,t,e,r,i,n){var a=new Y(t),u=a.fragments,h=null,W=0,q=0,z=0,X=0,j=null,Q=new H(r,t),Z=-1,$=!1,J,ae,ne;for(jt.lastIndex=0,a.m3u8=G,a.hasVariableRefs=xt(G);null!==(J=jt.exec(G));){$&&($=!1,(Q=new H(r,t)).start=z,Q.sn=W,Q.cc=X,Q.level=e,h&&(Q.initSegment=h,Q.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null));var ie=J[1];if(ie){Q.duration=parseFloat(ie);var E=(" "+J[2]).slice(1);Q.title=E||null,Q.tagList.push(E?["INF",ie,E]:["INF",ie])}else if(J[3])yd(Q.duration)&&(Q.start=z,ne&&re(Q,ne,a),Q.sn=W,Q.level=e,Q.cc=X,Q.urlId=i,u.push(Q),S=(" "+J[3]).slice(1),Q.relurl=wt(a,S),te(Q,j),z+=(j=Q).duration,W++,$=!(q=0));else if(J[4]){var S=(" "+J[4]).slice(1);j?Q.setByteRange(S,j):Q.setByteRange(S)}else if(J[5])Q.rawProgramDateTime=(" "+J[5]).slice(1),Q.tagList.push(["PROGRAM-DATE-TIME",Q.rawProgramDateTime]),-1===Z&&(Z=u.length);else if(J=J[0].match(Xt)){for(ae=1;ae<J.length&&void 0===J[ae];ae++);var de=(" "+J[ae]).slice(1),R=(" "+J[ae+1]).slice(1),A=J[ae+2]?(" "+J[ae+2]).slice(1):"";switch(de){case"PLAYLIST-TYPE":a.type=R.toUpperCase();break;case"MEDIA-SEQUENCE":W=a.startSN=parseInt(R);break;case"SKIP":var k=new hd(R);Pt(a,k,["RECENTLY-REMOVED-DATERANGES"]);var oe=k.decimalInteger("SKIPPED-SEGMENTS");if(yd(oe)){for(var se=a.skippedSegments=oe;se--;)u.unshift(null);W+=oe}var oe=k.enumeratedString("RECENTLY-REMOVED-DATERANGES");oe&&(a.recentlyRemovedDateranges=oe.split("\t"));break;case"TARGETDURATION":a.targetduration=Math.max(parseInt(R),1);break;case"VERSION":a.version=parseInt(R);break;case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(R||A)&&Q.tagList.push(A?[R,A]:[R]);break;case"DISCONTINUITY":X++,Q.tagList.push(["DIS"]);break;case"GAP":Q.gap=!0,Q.tagList.push([de]);break;case"BITRATE":Q.tagList.push([de,R]);break;case"DATERANGE":var le=new hd(R);Pt(a,le,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Pt(a,le,le.clientAttrs);var ue=new K(le,a.dateRanges[le.ID]);ue.isValid||a.skippedSegments?a.dateRanges[ue.id]=ue:nt.warn("Ignoring invalid DATERANGE tag: \""+R+"\""),Q.tagList.push(["EXT-X-DATERANGE",R]);break;case"DEFINE":var ce=new hd(R);Pt(a,ce,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in ce?(k=a,oe=n,le=void 0,le=(ue=ce).IMPORT,oe&&le in oe?((ue=k.variableList)||(k.variableList=ue={}),ue[le]=oe[le]):k.playlistParsingError||(k.playlistParsingError=new Error("EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: \""+le+"\""))):Nt(a,ce,t);break;case"DISCONTINUITY-SEQUENCE":X=parseInt(R);break;case"KEY":if(ce=Kt(R,t,a),ce.isSupported()){if("NONE"===ce.method){ne=void 0;break}(ne=ne||{})[ce.keyFormat]&&(ne=qa({},ne)),ne[ce.keyFormat]=ce}else nt.warn("[Keys] Ignoring invalid EXT-X-KEY tag: \""+R+"\"");break;case"START":a.startTimeOffset=Yt(R);break;case"MAP":var fe=new hd(R);Pt(a,fe,["BYTERANGE","URI"]),Q.duration?(ee(pe=new H(r,t),fe,e,ne),h=pe,(Q.initSegment=h).rawProgramDateTime&&!Q.rawProgramDateTime&&(Q.rawProgramDateTime=h.rawProgramDateTime)):(ee(Q,fe,e,ne),h=Q,$=!0);break;case"SERVER-CONTROL":var ge=new hd(R);a.canBlockReload=ge.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=ge.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=0<a.canSkipUntil&&ge.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=ge.optionalFloat("PART-HOLD-BACK",0),a.holdBack=ge.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var me=new hd(R);a.partTarget=me.decimalFloatingPoint("PART-TARGET");break;case"PART":var pe=(pe=a.partList)||(a.partList=[]),fe=0<q?pe[pe.length-1]:void 0,ge=q++,me=new hd(R);Pt(a,me,["BYTERANGE","URI"]),fe=new V(me,Q,t,ge,fe),pe.push(fe),Q.duration+=fe.duration;break;case"PRELOAD-HINT":var ye=new hd(R);Pt(a,ye,["URI"]),a.preloadHint=ye;break;case"RENDITION-REPORT":ye=new hd(R),Pt(a,ye,["URI"]),a.renditionReports=a.renditionReports||[],a.renditionReports.push(ye);break;default:nt.warn("line parsed but not handled: "+J);}}else nt.warn("No matches on slow regex match for level playlist!")}j&&!j.relurl?(u.pop(),z-=j.duration,a.partList&&(a.fragmentHint=j)):a.partList&&(te(Q,j),Q.cc=X,a.fragmentHint=Q,ne&&re(Q,ne,a));var he=u.length,Te=u[0],U=u[he-1];return 0<(z+=a.skippedSegments*a.targetduration)&&he&&U?(a.averagetargetduration=z/he,he=U.sn,a.endSN="initSegment"===he?0:he,a.live||(U.endList=!0),Te&&(a.startCC=Te.cc)):(a.endSN=0,a.startCC=0),a.fragmentHint&&(z+=a.fragmentHint.duration),a.totalduration=z,a.endCC=X,0<Z&&function(a){for(var t=a[Z],n=Z,d;n--;){if(d=a[n],!d)return;d.programDateTime=t.programDateTime-1e3*d.duration,t=d}}(u),a},Gt),Qt="manifest",ne="level",ae="audioTrack",se="subtitleTrack",oe="main",le="audio",ue="subtitle",he=((Wr=ce.prototype).startLoad=function(){},Wr.stopLoad=function(){this.destroyInternalLoaders()},Wr.registerListeners=function(){var e=this.hls;e.on(G.MANIFEST_LOADING,this.onManifestLoading,this),e.on(G.LEVEL_LOADING,this.onLevelLoading,this),e.on(G.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(G.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},Wr.unregisterListeners=function(){var e=this.hls;e.off(G.MANIFEST_LOADING,this.onManifestLoading,this),e.off(G.LEVEL_LOADING,this.onLevelLoading,this),e.off(G.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(G.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},Wr.createInternalLoader=function(a){var t=this.hls.config,n=t.pLoader,r=t.loader,t=new(n||r)(t);return this.loaders[a.type]=t},Wr.getInternalLoader=function(e){return this.loaders[e.type]},Wr.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},Wr.destroyInternalLoaders=function(){for(var a in this.loaders){var t=this.loaders[a];t&&t.destroy(),this.resetInternalLoader(a)}},Wr.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},Wr.onManifestLoading=function(a,t){t=t.url,this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Qt,url:t,deliveryDirectives:null})},Wr.onLevelLoading=function(a,t){var d=t.id,r=t.level,i=t.url,t=t.deliveryDirectives;this.load({id:d,level:r,responseType:"text",type:ne,url:i,deliveryDirectives:t})},Wr.onAudioTrackLoading=function(a,t){var d=t.id,r=t.groupId,i=t.url,t=t.deliveryDirectives;this.load({id:d,groupId:r,level:null,responseType:"text",type:ae,url:i,deliveryDirectives:t})},Wr.onSubtitleTrackLoading=function(a,t){var d=t.id,r=t.groupId,i=t.url,t=t.deliveryDirectives;this.load({id:d,groupId:r,level:null,responseType:"text",type:se,url:i,deliveryDirectives:t})},Wr.load=function(d){var o=this,t=this.hls.config,s=this.getInternalLoader(d),l;if(s){var u=s.context;if(u&&u.url===d.url)return void nt.trace("[playlist-loader]: playlist request ongoing");nt.log("[playlist-loader]: aborting previous loader for type: "+d.type),s.abort()}u=d.type===Qt?t.manifestLoadPolicy.default:qa({},t.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(d),null!=(t=d.deliveryDirectives)&&t.part&&(d.type===ne&&null!==d.level?l=this.hls.levels[d.level].details:d.type===ae&&null!==d.id?l=this.hls.audioTracks[d.id].details:d.type===se&&null!==d.id&&(l=this.hls.subtitleTracks[d.id].details),l)&&(t=l.partTarget,l=l.targetduration,t&&l&&(c=1e3*Math.max(3*t,.8*l),u=qa({},u,{maxTimeToFirstByteMs:Math.min(c,u.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(c,u.maxTimeToFirstByteMs)})));var c=u.errorRetry||u.timeoutRetry||{},u={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},c={onSuccess:function(d,t,e,r){var i=o.getInternalLoader(e);o.resetInternalLoader(e.type);var n=d.data;0===n.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),zt.isMediaPlaylist(n)?o.handleTrackOrLevelPlaylist(d,t,e,r||null,i):o.handleMasterPlaylist(d,t,e,r)):o.handleManifestParsingError(d,e,new Error("no EXTM3U delimiter"),r||null,t)},onError:function(a,t,e,r){o.handleNetworkError(t,e,!1,a,r)},onTimeout:function(a,t,e){o.handleNetworkError(t,e,!0,void 0,a)}};s.load(d,u,c)},Wr.handleMasterPlaylist=function(f,g,e,m){var i=this.hls,u=f.data,p=de(f,e),d=zt.parseMasterPlaylist(u,p),y,T,E,S,L;d.playlistParsingError?this.handleManifestParsingError(f,e,d.playlistParsingError,m,g):(y=d.contentSteering,T=d.levels,E=d.sessionData,S=d.sessionKeys,L=d.startTimeOffset,f=d.variableList,this.variableList=f,d=void 0===(u=(e=zt.parseMasterPlaylistMedia(u,p,d)).AUDIO)?[]:u,u=e.SUBTITLES,e=e["CLOSED-CAPTIONS"],d.length&&(d.some(function(e){return!e.url})||!T[0].audioCodec||T[0].attrs.AUDIO||(nt.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),d.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new hd({}),bitrate:0,url:""}))),i.trigger(G.MANIFEST_LOADED,{levels:T,audioTracks:d,subtitles:u,captions:e,contentSteering:y,url:p,stats:g,networkDetails:m,sessionData:E,sessionKeys:S,startTimeOffset:L,variableList:f}))},Wr.handleTrackOrLevelPlaylist=function(d,t,e,r,i){var n=this.hls,a=e.id,c=e.level,f=e.type,g=de(d,e),u=yd(a)?a:0,a=yd(c)?c:u,c=ie(e),u=zt.parseLevelPlaylist(d.data,g,a,c,u,this.variableList);f===Qt&&(f={attrs:new hd({}),bitrate:0,details:u,name:"",url:g},n.trigger(G.MANIFEST_LOADED,{levels:[f],audioTracks:[],url:g,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})),t.parsing.end=performance.now(),e.levelDetails=u,this.handlePlaylistLoaded(u,d,t,e,r,i)},Wr.handleManifestParsingError=function(a,t,e,r,i){this.hls.trigger(G.ERROR,{type:rt.NETWORK_ERROR,details:it.MANIFEST_PARSING_ERROR,fatal:t.type===Qt,url:a.url,err:e,error:e,reason:e.message,response:a,context:t,networkDetails:r,stats:i})},Wr.handleNetworkError=function(d,u,e,c,i){void 0===e&&(e=!1);var f="A network "+(e?"timeout":"error"+(c?" (status "+c.code+")":""))+" occurred while loading "+d.type;d.type===ne?f+=": "+d.level+" id: "+d.id:d.type!==ae&&d.type!==se||(f+=" id: "+d.id+" group-id: \""+d.groupId+"\"");var g=new Error(f);nt.warn("[playlist-loader]: "+f);var s=it.UNKNOWN,m=!1,f=this.getInternalLoader(d);switch(d.type){case Qt:s=e?it.MANIFEST_LOAD_TIMEOUT:it.MANIFEST_LOAD_ERROR,m=!0;break;case ne:s=e?it.LEVEL_LOAD_TIMEOUT:it.LEVEL_LOAD_ERROR,m=!1;break;case ae:s=e?it.AUDIO_TRACK_LOAD_TIMEOUT:it.AUDIO_TRACK_LOAD_ERROR,m=!1;break;case se:s=e?it.SUBTITLE_TRACK_LOAD_TIMEOUT:it.SUBTITLE_LOAD_ERROR,m=!1;}f&&this.resetInternalLoader(d.type),i={type:rt.NETWORK_ERROR,details:s,fatal:m,url:d.url,loader:f,context:d,error:g,networkDetails:u,stats:i},c&&(d=(null==u?void 0:u.url)||d.url,i.response=j({url:d,data:void 0},c)),this.hls.trigger(G.ERROR,i)},Wr.handlePlaylistLoaded=function(m,t,e,r,i,n){var a=this.hls,s=r.type,p=r.level,y=r.id,u=r.groupId,h=r.deliveryDirectives,d=de(t,r),c=ie(r),f="number"==typeof r.level&&c===oe?p:void 0;if(!m.fragments.length)s=new Error("No Segments found in Playlist"),a.trigger(G.ERROR,{type:rt.NETWORK_ERROR,details:it.LEVEL_EMPTY_ERROR,fatal:!1,url:d,error:s,reason:s.message,response:t,context:r,level:f,parent:c,networkDetails:i,stats:e});else if(m.targetduration||(m.playlistParsingError=new Error("Missing Target Duration")),p=m.playlistParsingError,p)a.trigger(G.ERROR,{type:rt.NETWORK_ERROR,details:it.LEVEL_PARSING_ERROR,fatal:!1,url:d,error:p,reason:p.message,response:t,context:r,level:f,parent:c,networkDetails:i,stats:e});else switch(m.live&&n&&(n.getCacheAge&&(m.ageHeader=n.getCacheAge()||0),n.getCacheAge&&!isNaN(m.ageHeader)||(m.ageHeader=0)),s){case Qt:case ne:a.trigger(G.LEVEL_LOADED,{details:m,level:f||0,id:y||0,stats:e,networkDetails:i,deliveryDirectives:h});break;case ae:a.trigger(G.AUDIO_TRACK_LOADED,{details:m,id:y||0,groupId:u||"",stats:e,networkDetails:i,deliveryDirectives:h});break;case se:a.trigger(G.SUBTITLE_TRACK_LOADED,{details:m,id:y||0,groupId:u||"",stats:e,networkDetails:i,deliveryDirectives:h});}},ce),fe="org.id3",Te="https://aomedia.org/emsg/ID3",Ee=function(){var e=ye();try{new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}(),Le=((Yn=_e.prototype).destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},Yn._registerListeners=function(){var e=this.hls;e.on(G.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(G.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(G.MANIFEST_LOADING,this.onManifestLoading,this),e.on(G.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(G.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(G.LEVEL_UPDATED,this.onLevelUpdated,this)},Yn._unregisterListeners=function(){var e=this.hls;e.off(G.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(G.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(G.MANIFEST_LOADING,this.onManifestLoading,this),e.off(G.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(G.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(G.LEVEL_UPDATED,this.onLevelUpdated,this)},Yn.onMediaAttached=function(a,t){this.media=t.media},Yn.onMediaDetaching=function(){this.id3Track&&(ve(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},Yn.onManifestLoading=function(){this.dateRangeCuesAppended={}},Yn.createTrack=function(e){return e=this.getID3Track(e.textTracks),e.mode="hidden",e},Yn.getID3Track=function(a){if(this.media){for(var t=0,n;t<a.length;t++)if(n=a[t],"metadata"===n.kind&&"id3"===n.label)return ge(n,this.media),n;return this.media.addTextTrack("metadata","id3")}},Yn.onFragParsingMetadata=function(m,t){if(this.media){var e=this.hls.config,r=e.enableEmsgMetadataCues,i=e.enableID3MetadataCues;if(r||i){var n=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var a=ye(),s=0,p;s<n.length;s++)if(p=n[s].type,(p!==Te||r)&&i){var y=st(n[s].data);if(y){var u=n[s].pts,h=u+n[s].duration;Ee<h&&(h=Ee),0>=h-u&&(h=u+.25);for(var T=0;T<y.length;T++){var E=y[T],g;ot(E)||(this.updateId3CueEnds(u,p),(g=new a(u,h,"")).value=E,p&&(g.type=p),this.id3Track.addCue(g))}}}}}},Yn.updateId3CueEnds=function(d,t){var e=null==(i=this.id3Track)?void 0:i.cues,i;if(e)for(var o=e.length,s;o--;)s=e[o],s.type===t&&s.startTime<d&&s.endTime===Ee&&(s.endTime=d)},Yn.onBufferFlushing=function(d,t){var l=t.startOffset,n=t.endOffset,a=t.type,s=this.id3Track,t=this.hls,o,u;t&&(t=t.config,o=t.enableEmsgMetadataCues,u=t.enableID3MetadataCues,s&&(o||u)&&pe(s,l,n,"audio"===a?function(e){return e.type===fe&&u}:"video"===a?function(e){return e.type===Te&&o}:function(e){return e.type===fe&&u||e.type===Te&&o}))},Yn.onLevelUpdated=function(a,t){var o=this,t=t.details;if(this.media&&t.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var g=this.dateRangeCuesAppended,d=this.id3Track,m=t.dateRanges,S=Object.keys(m);if(d)for(var r=Object.keys(g).filter(function(e){return!S.includes(e)}),i=r.length;i--;)!function(){var a=r[i];Object.keys(g[a].cues).forEach(function(e){d.removeCue(g[a].cues[e])}),delete g[a]}();if(t=t.fragments[t.fragments.length-1],0!==S.length&&yd(null==t?void 0:t.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var p=t.programDateTime/1e3-t.start,y=ye(),T=0;T<S.length;T++)!function(){var E=S[T],L=m[E],t=g[E],e=(null==t?void 0:t.cues)||{},r=(null==t?void 0:t.durationKnown)||!1,i=Se(L.startDate,p),a=Ee,R=L.endDate;R?(a=Se(R,p),r=!0):!L.endOnNext||r||(R=S.reduce(function(a,t){var e=m[t];return e.class===L.class&&e.id!==t&&e.startDate>L.startDate&&a.push(e),a},[]).sort(function(a,t){return a.startDate.getTime()-t.startDate.getTime()})[0])&&(a=Se(R.startDate,p),r=!0);for(var v=Object.keys(L.attr),u=0,A;u<v.length;u++){var k=v[u],f,D;"ID"!==k&&"CLASS"!==k&&"START-DATE"!==k&&"DURATION"!==k&&"END-DATE"!==k&&"END-ON-NEXT"!==k&&((D=e[k])?r&&!t.durationKnown&&(D.endTime=a):(f=L.attr[k],D=new y(i,a,""),"SCTE35-OUT"!==(A=k)&&"SCTE35-IN"!==A||(f=Uint8Array.from(f.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),D.value={key:k,data:f},D.type="com.apple.quicktime.HLS",D.id=E,o.id3Track.addCue(D),e[k]=D))}g[E]={cues:e,dateRange:L,durationKnown:r}}()}}},_e),Ae=((Ld=Ce.prototype).destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},Ld.registerListeners=function(){this.hls.on(G.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(G.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(G.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(G.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(G.ERROR,this.onError,this)},Ld.unregisterListeners=function(){this.hls.off(G.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(G.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(G.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(G.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(G.ERROR,this.onError,this)},Ld.onMediaAttached=function(a,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},Ld.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},Ld.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},Ld.onLevelUpdated=function(a,t){t=t.details,(this.levelDetails=t).advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},Ld.onError=function(a,t){t.details===it.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(t=this.levelDetails)&&t.live&&nt.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},Ld.timeupdate=function(){var a=this.media,i=this.levelDetails,n,d,o;a&&i&&(this.currentTime=a.currentTime,null!==(o=this.computeLatency())&&(this._latency=o,n=(d=this.config).lowLatencyMode,d=d.maxLiveSyncPlaybackRate,!n||1===d||null!==(n=this.targetLatency)&&(n=(o-=n)<Math.min(this.maxLatency,n+i.targetduration),i.live&&n&&.05<o&&1<this.forwardBufferLength?(d=Math.min(2,Math.max(1,d)),o=Math.round(20*(2/(1+Math.exp(-.75*o-this.edgeStalled))))/20,a.playbackRate=Math.min(d,Math.max(1,o))):1!==a.playbackRate&&0!==a.playbackRate&&(a.playbackRate=1))))},Ld.estimateLiveEdge=function(){var e=this.levelDetails;return null===e?null:e.edge+e.age},Ld.computeLatency=function(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime},qt(Ce,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var a=this.config,t=this.levelDetails;return void 0===a.liveMaxLatencyDuration?t?a.liveMaxLatencyDurationCount*t.targetduration:0:a.liveMaxLatencyDuration}},{key:"targetLatency",get:function(){var d=this.levelDetails;if(null===d)return null;var o=d.holdBack,l=d.partHoldBack,r=d.targetduration,i=this.config,u=i.liveSyncDuration,a=i.liveSyncDurationCount,d=i.lowLatencyMode,i=this.hls.userConfig,o=d&&l||o;return(i.liveSyncDuration||i.liveSyncDurationCount||0===o)&&(o=void 0===u?a*r:u),o+Math.min(+this.stallCount,r)}},{key:"liveSyncPosition",get:function(){var a=this.estimateLiveEdge(),n=this.targetLatency,d=this.levelDetails;if(null===a||null===n||null===d)return null;var o=d.edge,a=a-n-this.edgeStalled,n=o-d.totalduration,d=o-(this.config.lowLatencyMode&&d.partTarget||d.targetduration);return Math.min(Math.max(n,a),d)}},{key:"drift",get:function(){var e=this.levelDetails;return null===e?1:e.drift}},{key:"edgeStalled",get:function(){var a=this.levelDetails;if(null===a)return 0;var t=3*(this.config.lowLatencyMode&&a.partTarget||a.targetduration);return Math.max(a.age-t,0)}},{key:"forwardBufferLength",get:function(){var a=this.media,t=this.levelDetails;if(!a||!t)return 0;var e=a.buffered.length;return(e?a.buffered.end(e-1):t.edge)-this.currentTime}}]),Ce),ke=["NONE","TYPE-0","TYPE-1",null],be=(we.prototype.addDirectives=function(e){return e=new self.URL(e),void 0!==this.msn&&e.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href},we),De=(Re.prototype.addFallback=function(e){this.url.push(e.url),this._attrs.push(e.attrs)},qt(Re,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"attrs",get:function(){return this._attrs[this._urlId]}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(e){e%=this.url.length,this._urlId!==e&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=e)}},{key:"audioGroupId",get:function(){var e;return null==(e=this.audioGroupIds)?void 0:e[this.urlId]}},{key:"textGroupId",get:function(){var e;return null==(e=this.textGroupIds)?void 0:e[this.urlId]}}]),Re),Ie=function(d,t){for(var e=0,o=d.length-1,l,u,c;e<=o;)if(c=t(u=d[l=0|(e+o)/2]),0<c)e=1+l;else{if(!(0>c))return u;o=l-1}return null},We=((ti=Je.prototype).registerListeners=function(){var e=this.hls;e.on(G.ERROR,this.onError,this),e.on(G.MANIFEST_LOADING,this.onManifestLoading,this),e.on(G.LEVEL_UPDATED,this.onLevelUpdated,this)},ti.unregisterListeners=function(){var e=this.hls;e&&(e.off(G.ERROR,this.onError,this),e.off(G.ERROR,this.onErrorOut,this),e.off(G.MANIFEST_LOADING,this.onManifestLoading,this),e.off(G.LEVEL_UPDATED,this.onLevelUpdated,this))},ti.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},ti.startLoad=function(){this.playlistError=0},ti.stopLoad=function(){},ti.getVariantLevelIndex=function(e){return(null==e?void 0:e.type)===oe?e.level:this.hls.loadLevel},ti.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},ti.onLevelUpdated=function(){this.playlistError=0},ti.onError=function(d,t){if(!t.fatal){var e=this.hls,r=t.context;switch(t.details){case it.FRAG_LOAD_ERROR:case it.FRAG_LOAD_TIMEOUT:case it.KEY_LOAD_ERROR:case it.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case it.FRAG_GAP:case it.FRAG_PARSING_ERROR:case it.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=2);case it.LEVEL_EMPTY_ERROR:case it.LEVEL_PARSING_ERROR:var i=t.parent===oe?t.level:e.loadLevel,u,c;return void(t.details===it.LEVEL_EMPTY_ERROR&&null!=(u=t.context)&&null!=(c=u.levelDetails)&&c.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,i)));case it.LEVEL_LOAD_ERROR:case it.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==r?void 0:r.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level)));case it.AUDIO_TRACK_LOAD_ERROR:case it.AUDIO_TRACK_LOAD_TIMEOUT:case it.SUBTITLE_LOAD_ERROR:case it.SUBTITLE_TRACK_LOAD_TIMEOUT:return r&&(i=e.levels[e.loadLevel],i&&(r.type===ae&&r.groupId===i.audioGroupId||r.type===se&&r.groupId===i.textGroupId))?(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e.loadLevel),t.errorAction.action=2,void(t.errorAction.flags=1)):void 0;case it.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var f=e.levels[e.loadLevel],f=null==f?void 0:f.attrs["HDCP-LEVEL"];return void(f&&(t.errorAction={action:2,flags:2,hdcpLevel:f}));case it.BUFFER_ADD_CODEC_ERROR:case it.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null==(f=t.level)?e.loadLevel:f));case it.INTERNAL_EXCEPTION:case it.BUFFER_APPENDING_ERROR:case it.BUFFER_APPEND_ERROR:case it.BUFFER_FULL_ERROR:case it.LEVEL_SWITCH_ERROR:case it.BUFFER_STALLED_ERROR:case it.BUFFER_SEEK_OVER_HOLE:case it.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:0,flags:0});}if(t.type===rt.KEY_SYSTEM_ERROR){var g=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,g))}}},ti.getPlaylistRetryOrSwitchAction=function(a,t){var d=Ge(this.hls.config.playlistLoadPolicy,a),r=this.playlistError++,i=null==(i=a.response)?void 0:i.code;return Ve(d,r,Be(a),i)?{action:5,flags:0,retryConfig:d,retryCount:r}:(t=this.getLevelSwitchAction(a,t),d&&(t.retryConfig=d,t.retryCount=r),t)},ti.getFragRetryOrSwitchAction=function(d){var t=this.hls,o=this.getVariantLevelIndex(d.frag),s=t.levels[o],l=t.config,u=l.fragLoadPolicy,l=l.keyLoadPolicy,u=Ge(d.details.startsWith("key")?l:u,d),t=t.levels.reduce(function(a,t){return a+t.fragmentError},0);return s&&(d.details!==it.FRAG_GAP&&s.fragmentError++,s=null==(s=d.response)?void 0:s.code,Ve(u,t,Be(d),s))?{action:5,flags:0,retryConfig:u,retryCount:t}:(o=this.getLevelSwitchAction(d,o),u&&(o.retryConfig=u,o.retryCount=t),o)},ti.getLevelSwitchAction=function(f,t){var g=this.hls;null==t&&(t=g.loadLevel);var r=this.hls.levels[t];if(r&&(r.loadError++,g.autoLevelEnabled)){for(var i=-1,m=g.levels,a=null==(t=f.frag)?void 0:t.type,t=null==(t=f.context)?{}:t,s=t.type,o=t.groupId,l=m.length,p;l--;)if(p=(l+g.loadLevel)%m.length,p!==g.loadLevel&&0===m[p].loadError){var y=m[p];if(f.details===it.FRAG_GAP&&f.frag){var d=m[p].details;if(d&&(d=Ye(f.frag,d.fragments,f.frag.start),null!=d&&d.gap))continue}else{if(s===ae&&o===y.audioGroupId||s===se&&o===y.textGroupId)continue;if(a===le&&r.audioGroupId===y.audioGroupId||a===ue&&r.textGroupId===y.textGroupId)continue}i=p;break}if(-1<i&&g.loadLevel!==i)return f.levelRetry=!0,{action:2,flags:this.playlistError=0,nextAutoLevel:i}}return{action:2,flags:1}},ti.onErrorOut=function(a,t){var e;switch(null==(e=t.errorAction)?void 0:e.action){case 0:break;case 2:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===it.FRAG_GAP||(t.fatal=!0);}t.fatal&&this.hls.stopLoad()},ti.sendAlternateToPenaltyBox=function(d){var t=this.hls,e=d.errorAction;if(e){var r=e.flags,i=e.hdcpLevel,n=e.nextAutoLevel;0===r?this.switchLevel(d,n):1===r?e.resolved||(e.resolved=this.redundantFailover(d)):2===r?(i&&(t.maxHdcpLevel=ke[ke.indexOf(i)-1],e.resolved=!0),this.warn("Restricting playback to HDCP-LEVEL of \""+t.maxHdcpLevel+"\" or lower")):void 0,e.resolved||this.switchLevel(d,n)}},ti.switchLevel=function(a,t){void 0!==t&&a.errorAction&&(this.warn("switching to level "+t+" after "+a.details),this.hls.nextAutoLevel=t,a.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)},ti.redundantFailover=function(d){var r=this,i=this.hls,n=this.penalizedRenditions,a=d.parent===oe?d.level:i.loadLevel,s=i.levels[a],o=s.url.length,l=(d.frag||s).urlId;s.urlId!==l||d.frag&&!s.details||this.penalizeRendition(s,d);for(var u=1,e;u<o;u++)if(e=function(){var c=(l+u)%o,e=n[c];if(!e||function(a,d,e){if(3e5<performance.now()-a.lastErrorPerfMs)return 1;var r=a.details;if(d.details===it.FRAG_GAP&&r&&d.frag){var i=d.frag.start,i=Ye(null,r.fragments,i);if(i&&!i.gap)return 1}return e&&a.errors.length<e.errors.length&&(a=a.errors[a.errors.length-1],r&&a.frag&&d.frag&&Math.abs(a.frag.start-d.frag.start)>3*r.targetduration)?1:void 0}(e,d,n[l]))return r.warn("Switching to Redundant Stream "+(1+c)+"/"+o+": \""+s.url[c]+"\" after "+d.details),r.playlistError=0,i.levels.forEach(function(e){e.urlId=c}),i.nextLoadLevel=a,{v:!0}}(),"object"==typeof e)return e.v;return!1},ti.penalizeRendition=function(a,t){var e=this.penalizedRenditions,r=e[a.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};r.lastErrorPerfMs=performance.now(),r.errors.push(t),r.details=a.details,e[a.urlId]=r},Je),ze=((Xi=qe.prototype).destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},Xi.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},Xi.startLoad=function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()},Xi.stopLoad=function(){this.canLoad=!1,this.clearTimer()},Xi.switchParams=function(d,t){var e=null==t?void 0:t.renditionReports;if(e){for(var r=-1,c=0;c<e.length;c++){var f=e[c],a=void 0;try{a=new self.URL(f.URI,t.url).href}catch(e){nt.warn("Could not construct new URL for Rendition Report: "+e),a=f.URI||""}if(a===d){r=c;break}a===d.substring(0,a.length)&&(r=c)}if(-1!==r){var g=e[r],m=parseInt(g["LAST-MSN"])||(null==t?void 0:t.lastPartSn),l=parseInt(g["LAST-PART"])||(null==t?void 0:t.lastPartIndex);return this.hls.config.lowLatencyMode&&(g=Math.min(t.age-t.partTarget,t.targetduration),0<=l&&g>t.partTarget&&(l+=1)),new be(m,0<=l?l:void 0,"")}}},Xi.loadPlaylist=function(){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())},Xi.shouldLoadPlaylist=function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)},Xi.shouldReloadPlaylist=function(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)},Xi.playlistLoaded=function(m,t,e){var p=this,i=t.details,n=t.stats,a=self.performance.now(),y=n.loading.first?Math.max(0,a-n.loading.first):0;if(i.advancedDateTime=Date.now()-y,!(i.live||null!=e&&e.live))this.clearTimer();else if(i.reloaded(e),e&&this.log("live playlist "+m+" "+(i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:"MISSED")),e&&0<i.fragments.length&&Fe(e,i),this.canLoad&&i.live){var T,E,S;if(i.canBlockReload&&i.endSN&&i.advanced){var L=this.hls.config.lowLatencyMode,d=i.lastPartSn,c=i.endSN,R=i.lastPartIndex,y=d===c;if(-1===R?E=c+1:(E=y?c+1:d,S=y?L?0:R:R+1),R=i.age,c=R+i.ageHeader,c=Math.min(c-i.partTarget,1.5*i.targetduration),(0<c&&(e&&c>e.tuneInGoal?(this.warn("CDN Tune-in goal increased from: "+e.tuneInGoal+" to: "+c+" with playlist age: "+i.age),c=0):(E+=e=Math.floor(c/i.targetduration),void 0!==S&&(S+=Math.round(c%i.targetduration/i.partTarget)),this.log("CDN Tune-in age: "+i.ageHeader+"s last advanced "+R.toFixed(2)+"s goal: "+c+" skip sn "+e+" to part "+S)),i.tuneInGoal=c),T=this.getDeliveryDirectives(i,t.deliveryDirectives,E,S),L||!y))return void this.loadPlaylist(T)}else i.canBlockReload&&(T=this.getDeliveryDirectives(i,t.deliveryDirectives,E,S));S=this.hls.mainForwardBufferInfo,S=S?S.end-S.len:0,S=function(a){void 0===a&&(a=1/0);var n=1e3*i.targetduration,d;return i.updated?(d=i.fragments).length&&a<4*n&&(d=1e3*d[d.length-1].duration)<n&&(n=d):n/=2,Math.round(n)}(1e3*(i.edge-S)),i.updated&&a>this.requestScheduled+S&&(this.requestScheduled=n.loading.start),void 0!==E&&i.canBlockReload?this.requestScheduled=n.loading.first+S-(1e3*i.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+S<a?this.requestScheduled=a:0>=this.requestScheduled-a&&(this.requestScheduled+=S),a=this.requestScheduled-a,a=Math.max(0,a),this.log("reload live playlist "+m+" in "+Math.round(a)+" ms"),this.timer=self.setTimeout(function(){return p.loadPlaylist(T)},a)}},Xi.getDeliveryDirectives=function(d,t,e,o){var l=(u=d.canSkipUntil,l=d.canSkipDateRanges,c=d.endSN,u&&(void 0===e?0:e-c)<u?l?"v2":"YES":""),u,l,c;return null!=t&&t.skip&&d.deltaUpdateFailed&&(e=t.msn,o=t.part,l=""),new be(e,o,l)},Xi.checkRetry=function(d){var t=this,r=d.details,i=Be(d),n=d.errorAction,a=n||{},u=a.action,c=a.retryCount,c=void 0===c?0:c,a=a.retryConfig,u=!!n&&!!a&&(5===u||!n.resolved&&2===u),f;if(u){if(this.requestScheduled=-1,c>=a.maxNumRetry)return!1;i&&null!=(f=d.context)&&f.deliveryDirectives?(this.warn("Retrying playlist loading "+(c+1)+"/"+a.maxNumRetry+" after \""+r+"\" without delivery-directives"),this.loadPlaylist()):(f=Ke(a,c),this.timer=self.setTimeout(function(){return t.loadPlaylist()},f),this.warn("Retrying playlist loading "+(c+1)+"/"+a.maxNumRetry+" after \""+r+"\" in "+f+"ms")),d.levelRetry=!0,n.resolved=!0}return u},qe),Ed=function(d){function a(a,r){return(a=d.call(this,a,"[level-controller]")||this)._levels=[],a._firstLevel=-1,a._startLevel=void 0,a.currentLevel=null,a.currentLevelIndex=-1,a.manualLevelIndex=-1,a.steering=void 0,a.onParsedComplete=void 0,a.steering=r,a._registerListeners(),a}Za(a,d);var t=a.prototype;return t._registerListeners=function(){var e=this.hls;e.on(G.MANIFEST_LOADING,this.onManifestLoading,this),e.on(G.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(G.LEVEL_LOADED,this.onLevelLoaded,this),e.on(G.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(G.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(G.FRAG_LOADED,this.onFragLoaded,this),e.on(G.ERROR,this.onError,this)},t._unregisterListeners=function(){var e=this.hls;e.off(G.MANIFEST_LOADING,this.onManifestLoading,this),e.off(G.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(G.LEVEL_LOADED,this.onLevelLoaded,this),e.off(G.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(G.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(G.FRAG_LOADED,this.onFragLoaded,this),e.off(G.ERROR,this.onError,this)},t.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),d.prototype.destroy.call(this)},t.startLoad=function(){this._levels.forEach(function(e){e.loadError=0,e.fragmentError=0}),d.prototype.startLoad.call(this)},t.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]},t.onManifestLoading=function(){this.resetLevels()},t.onManifestLoaded=function(a,t){var d=[],l={},u;t.levels.forEach(function(o){var t=o.attrs;-1===(null==(a=o.audioCodec)?void 0:a.indexOf("mp4a.40.34"))||(Cd=Cd||/chrome|firefox/i.test(navigator.userAgent))&&(o.audioCodec=void 0);var c=t.AUDIO,r=t.CODECS,f=t["FRAME-RATE"],n=t["PATHWAY-ID"],a=t.RESOLUTION,t=t.SUBTITLES,r=(n||".")+"-"+o.bitrate+"-"+a+"-"+f+"-"+r;(u=l[r])?u.addFallback(o):(u=new De(o),l[r]=u,d.push(u)),Ze(u,"audio",c),Ze(u,"text",t)}),this.filterAndSortMediaOptions(d,t)},t.filterAndSortMediaOptions=function(f,g){var e=this,r=[],m=[],p=!1,y=!1,T=!1,E=f.filter(function(a){var d=a.audioCodec,e=a.videoCodec,r=a.width,i=a.height,a=a.unknownCodecs;return p=p||r&&i,y=y||!!e,T=T||!!d,!(null!=a&&a.length)&&(!d||Ut(d,"audio"))&&(!e||Ut(e,"video"))});if((p||y)&&T&&(E=E.filter(function(a){var n=a.videoCodec,e=a.width,a=a.height;return!!n||e&&a})),0!==E.length){g.audioTracks&&$t(r=g.audioTracks.filter(function(e){return!e.audioCodec||Ut(e.audioCodec,"audio")})),g.subtitles&&$t(m=g.subtitles);var S=E.slice(0);E.sort(function(a,t){return a.attrs["HDCP-LEVEL"]===t.attrs["HDCP-LEVEL"]?a.bitrate===t.bitrate?a.attrs["FRAME-RATE"]===t.attrs["FRAME-RATE"]?a.attrs.SCORE===t.attrs.SCORE?p&&a.height!==t.height?a.height-t.height:0:a.attrs.decimalFloatingPoint("SCORE")-t.attrs.decimalFloatingPoint("SCORE"):a.attrs.decimalFloatingPoint("FRAME-RATE")-t.attrs.decimalFloatingPoint("FRAME-RATE"):a.bitrate-t.bitrate:(a.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1});var u=S[0];if(this.steering&&(E=this.steering.filterParsedLevels(E)).length!==S.length)for(var L=0;L<S.length;L++)if(S[L].pathwayId===E[0].pathwayId){u=S[L];break}this._levels=E;for(var R=0;R<E.length;R++)if(E[R]===u){this._firstLevel=R,this.log("manifest loaded, "+E.length+" level(s) found, first bitrate: "+u.bitrate);break}f=T&&!y,r={levels:E,audioTracks:r,subtitleTracks:m,sessionData:g.sessionData,sessionKeys:g.sessionKeys,firstLevel:this._firstLevel,stats:g.stats,audio:T,video:y,altAudio:!f&&r.some(function(e){return!!e.url})},this.hls.trigger(G.MANIFEST_PARSED,r),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else Promise.resolve().then(function(){var a;e.hls&&(a=new Error("no level with compatible codecs found in manifest"),e.hls.trigger(G.ERROR,{type:rt.MEDIA_ERROR,details:it.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:g.url,error:a,reason:a.message}))})},t.onError=function(a,t){!t.fatal&&t.context&&t.context.type===ne&&t.context.level===this.level&&this.checkRetry(t)},t.onFragLoaded=function(a,t){t=t.frag,void 0===t||t.type!==oe||void 0!==(t=this._levels[t.level])&&(t.loadError=0)},t.onLevelLoaded=function(d,t){var o=t.level,i=t.details,n=this._levels[o],a;return n?void(o===this.currentLevelIndex?(0===n.fragmentError&&(n.loadError=0),this.playlistLoaded(o,t,n.details)):null!=(t=t.deliveryDirectives)&&t.skip&&(i.deltaUpdateFailed=!0)):(this.warn("Invalid level index "+o),void(null!=(a=t.deliveryDirectives)&&a.skip&&(i.deltaUpdateFailed=!0)))},t.onAudioTrackSwitched=function(d,t){var e=this.currentLevel;if(e){var r=this.hls.audioTracks[t.id].groupId;if(e.audioGroupIds&&e.audioGroupId!==r){for(var i=-1,o=0;o<e.audioGroupIds.length;o++)if(e.audioGroupIds[o]===r){i=o;break}-1!==i&&i!==e.urlId&&(e.urlId=i,this.canLoad&&this.startLoad())}}},t.loadPlaylist=function(o){d.prototype.loadPlaylist.call(this);var t=this.currentLevelIndex,e=this.currentLevel;if(e&&this.shouldLoadPlaylist(e)){var r=e.urlId,i=e.uri;if(o)try{i=o.addDirectives(i)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}var s=e.attrs["PATHWAY-ID"];this.log("Loading level index "+t+(void 0===(null==o?void 0:o.msn)?"":" at sn "+o.msn+" part "+o.part)+" with"+(s?" Pathway "+s:"")+" URI "+(r+1)+"/"+e.url.length+" "+i),this.clearTimer(),this.hls.trigger(G.LEVEL_LOADING,{url:i,level:t,id:r,deliveryDirectives:o||null})}},t.removeLevel=function(d,r){function i(a,t){return t!==r}var n=this,e=this._levels.filter(function(a,t){return t!==d||(1<a.url.length&&void 0!==r?(a.url=a.url.filter(i),a.audioGroupIds&&(a.audioGroupIds=a.audioGroupIds.filter(i)),a.textGroupIds&&(a.textGroupIds=a.textGroupIds.filter(i)),!(a.urlId=0)):(n.steering&&n.steering.removeLevel(a),!1))});this.hls.trigger(G.LEVELS_UPDATED,{levels:e})},t.onLevelsUpdated=function(a,t){t=t.levels,t.forEach(function(a,r){a=a.details,null!=a&&a.fragments&&a.fragments.forEach(function(e){e.level=r})}),this._levels=t},qt(a,[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(d){var o=this._levels;if(0!==o.length){if(0>d||d>=o.length){var s=new Error("invalid level idx"),l=0>d;if(this.hls.trigger(G.ERROR,{type:rt.OTHER_ERROR,details:it.LEVEL_SWITCH_ERROR,level:d,fatal:l,error:s,reason:s.message}),l)return;d=Math.min(d,o.length-1)}var u=this.currentLevelIndex,n=this.currentLevel,s=n?n.attrs["PATHWAY-ID"]:void 0,l=o[d],o=l.attrs["PATHWAY-ID"];this.currentLevelIndex=d,this.currentLevel=l,u===d&&l.details&&n&&s===o||(this.log("Switching to level "+d+(o?" with Pathway "+o:"")+" from level "+u+(s?" with Pathway "+s:"")),delete(d=qa({},l,{level:d,maxBitrate:l.maxBitrate,attrs:l.attrs,uri:l.uri,urlId:l.urlId}))._attrs,delete d._urlId,this.hls.trigger(G.LEVEL_SWITCHING,d),(d=l.details)&&!d.live||(n=this.switchParams(l.uri,null==n?void 0:n.details),this.loadPlaylist(n)))}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0!==this._startLevel)return this._startLevel;var e=this.hls.config.startLevel;return void 0===e?this._firstLevel:e},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1===this.manualLevelIndex?this.hls.nextAutoLevel:this.manualLevelIndex},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),a}(ze),$e="NOT_LOADED",rr="APPENDING",ir="PARTIAL",nr="OK",ar=((vd=Jt.prototype)._registerListeners=function(){var e=this.hls;e.on(G.BUFFER_APPENDED,this.onBufferAppended,this),e.on(G.FRAG_BUFFERED,this.onFragBuffered,this),e.on(G.FRAG_LOADED,this.onFragLoaded,this)},vd._unregisterListeners=function(){var e=this.hls;e.off(G.BUFFER_APPENDED,this.onBufferAppended,this),e.off(G.FRAG_BUFFERED,this.onFragBuffered,this),e.off(G.FRAG_LOADED,this.onFragLoaded,this)},vd.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},vd.getAppendedFrag=function(d,t){var e=this.activePartLists[t];if(e)for(var r=e.length,o,s;r--&&(o=e[r],!!o);)if(s=o.end,o.start<=d&&null!==s&&d<=s)return o;return this.getBufferedFrag(d,t)},vd.getBufferedFrag=function(d,t){for(var e=this.fragments,r=Object.keys(e),i=r.length,o;i--;)if(o=e[r[i]],(null==o?void 0:o.body.type)===t&&o.buffered&&(o=o.body,o.start<=d&&d<=o.end))return o;return null},vd.detectEvictedFragments=function(d,r,i,e){var n=this;this.timeRanges&&(this.timeRanges[d]=r);var a=(null==e?void 0:e.fragment.sn)||-1;Object.keys(this.fragments).forEach(function(o){var s=n.fragments[o];!s||a>=s.body.sn||(s.buffered||s.loaded?(o=s.range[d])&&o.time.some(function(e){return e=!n.isTimeBuffered(e.startPTS,e.endPTS,r),e&&n.removeFragment(s.body),e}):s.body.type===i&&n.removeFragment(s.body))})},vd.detectPartialFragments=function(e){var d=this,a=this.timeRanges,s=e.frag,o=e.part,l,u;a&&"initSegment"!==s.sn&&(e=tr(s),(l=this.fragments[e])&&(u=!s.relurl,Object.keys(a).forEach(function(n){var t=s.elementaryStreams[n],i;t&&(i=a[n],t=u||!0===t.partial,l.range[n]=d.getBufferedTimes(s,o,t,i))}),l.loaded=null,Object.keys(l.range).length?(l.buffered=!0,l.body.endList&&(this.endListFragments[l.body.type]=l),er(l)||this.removeParts(s.sn-1,s.type)):this.removeFragment(l.body)))},vd.removeParts=function(a,e){var t=this.activePartLists[e];t&&(this.activePartLists[e]=t.filter(function(e){return e.fragment.sn>=a}))},vd.fragBuffered=function(a,t){var e=tr(a),r=this.fragments[e];!r&&t&&(r=this.fragments[e]={body:a,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},a.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)},vd.getBufferedTimes=function(c,t,e,r){for(var i={time:[],partial:e},n=c.start,a=c.end,s=c.minEndPTS||a,o=c.maxStartPTS||n,l=0;l<r.length;l++){var f=r.start(l)-this.bufferPadding,g=r.end(l)+this.bufferPadding;if(f<=o&&s<=g){i.time.push({startPTS:Math.max(n,r.start(l)),endPTS:Math.min(a,r.end(l))});break}if(n<g&&f<a)i.partial=!0,i.time.push({startPTS:Math.max(n,r.start(l)),endPTS:Math.min(a,r.end(l))});else if(a<=f)break}return i},vd.getPartialFragment=function(d){var e=null,l=0,u=this.bufferPadding,s=this.fragments,o,c;return Object.keys(s).forEach(function(a){a=s[a],a&&er(a)&&(o=a.body.start-u,c=a.body.end+u,o<=d&&d<=c&&(c=Math.min(d-o,c-d),l<=c&&(e=a.body,l=c)))}),e},vd.isEndListAppended=function(e){return e=this.endListFragments[e],void 0!==e&&(e.buffered||er(e))},vd.getState=function(e){return e=tr(e),e=this.fragments[e],e?e.buffered?er(e)?ir:nr:rr:$e},vd.isTimeBuffered=function(d,t,e){for(var r=0,o,s;r<e.length;r++){if(o=e.start(r)-this.bufferPadding,s=e.end(r)+this.bufferPadding,o<=d&&t<=s)return!0;if(t<=o)return!1}return!1},vd.onFragLoaded=function(a,t){var n=t.frag,r=t.part;"initSegment"===n.sn||n.bitrateTest||(r=r?null:t,t=tr(n),this.fragments[t]={body:n,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)})},vd.onBufferAppended=function(d,t){var o=this,e=t.frag,i=t.part,a=t.timeRanges,s;"initSegment"!==e.sn&&(s=e.type,i&&((e=this.activePartLists[s])||(this.activePartLists[s]=e=[]),e.push(i)),this.timeRanges=a,Object.keys(a).forEach(function(r){var t=a[r];o.detectEvictedFragments(r,t,s,i)}))},vd.onFragBuffered=function(a,t){this.detectPartialFragments(t)},vd.hasFragment=function(e){return e=tr(e),!!this.fragments[e]},vd.hasParts=function(e){return null!=(e=this.activePartLists[e])&&e.length},vd.removeFragmentsInRange=function(d,r,i,n,a){var s=this;n&&!this.hasGaps||Object.keys(this.fragments).forEach(function(o){var l=s.fragments[o];l&&((o=l.body).type!==i||n&&!o.gap||o.start<r&&o.end>d&&(l.buffered||a)&&s.removeFragment(o))})},vd.removeFragment=function(a){var t=tr(a);a.stats.loaded=0,a.clearElementaryStreamInfo();var e=this.activePartLists[a.type],n;e&&(n=a.sn,this.activePartLists[a.type]=e.filter(function(e){return e.fragment.sn!==n})),delete this.fragments[t],a.endList&&delete this.endListFragments[a.type]},vd.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1},Jt),sr=Math.pow(2,17),hr=((ld=or.prototype).destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},ld.abort=function(){this.loader&&this.loader.abort()},ld.load=function(f,a){var o=this,n=f.url;if(!n)return Promise.reject(new dr({type:rt.NETWORK_ERROR,details:it.FRAG_LOAD_ERROR,fatal:!1,frag:f,error:new Error("Fragment does not have a "+(n?"part list":"url")),networkDetails:null}));this.abort();var l=this.config,r=l.fLoader,d=l.loader;return new Promise(function(u,c){var g,m,p,y;o.loader&&o.loader.destroy(),f.gap?c(ur(f)):(g=o.loader=f.loader=new(r||d)(l),m=lr(f),p=He(l.fragLoadPolicy.default),y={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===f.sn?1/0:sr},f.stats=g.stats,g.load(m,y,{onSuccess:function(a,n,e,r){o.resetLoader(f,g),a=a.data,e.resetIV&&f.decryptdata&&(f.decryptdata.iv=new Uint8Array(a.slice(0,16)),a=a.slice(16)),u({frag:f,part:null,payload:a,networkDetails:r})},onError:function(a,t,e,r){o.resetLoader(f,g),c(new dr({type:rt.NETWORK_ERROR,details:it.FRAG_LOAD_ERROR,fatal:!1,frag:f,response:j({url:n,data:void 0},a),error:new Error("HTTP Error "+a.code+" "+a.text),networkDetails:e,stats:r}))},onAbort:function(a,t,e){o.resetLoader(f,g),c(new dr({type:rt.NETWORK_ERROR,details:it.INTERNAL_ABORTED,fatal:!1,frag:f,error:new Error("Aborted"),networkDetails:e,stats:a}))},onTimeout:function(a,t,e){o.resetLoader(f,g),c(new dr({type:rt.NETWORK_ERROR,details:it.FRAG_LOAD_TIMEOUT,fatal:!1,frag:f,error:new Error("Timeout after "+y.timeout+"ms"),networkDetails:e,stats:a}))},onProgress:function(n,t,e,r){a&&a({frag:f,part:null,payload:e,networkDetails:r})}}))})},ld.loadPart=function(f,l,a){var u=this;this.abort();var d=this.config,e=d.fLoader,r=d.loader;return new Promise(function(c,n){var g,m,p,y;u.loader&&u.loader.destroy(),f.gap||l.gap?n(ur(f,l)):(g=u.loader=f.loader=new(e||r)(d),m=lr(f,l),p=He(d.fragLoadPolicy.default),y={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:sr},l.stats=g.stats,g.load(m,y,{onSuccess:function(n,t,e,r){u.resetLoader(f,g),u.updateStatsFromPart(f,l),r={frag:f,part:l,payload:n.data,networkDetails:r},a(r),c(r)},onError:function(a,t,e,r){u.resetLoader(f,g),n(new dr({type:rt.NETWORK_ERROR,details:it.FRAG_LOAD_ERROR,fatal:!1,frag:f,part:l,response:j({url:m.url,data:void 0},a),error:new Error("HTTP Error "+a.code+" "+a.text),networkDetails:e,stats:r}))},onAbort:function(a,t,e){f.stats.aborted=l.stats.aborted,u.resetLoader(f,g),n(new dr({type:rt.NETWORK_ERROR,details:it.INTERNAL_ABORTED,fatal:!1,frag:f,part:l,error:new Error("Aborted"),networkDetails:e,stats:a}))},onTimeout:function(a,t,e){u.resetLoader(f,g),n(new dr({type:rt.NETWORK_ERROR,details:it.FRAG_LOAD_TIMEOUT,fatal:!1,frag:f,part:l,error:new Error("Timeout after "+y.timeout+"ms"),networkDetails:e,stats:a}))}}))})},ld.updateStatsFromPart=function(a,t){var d=a.stats,o=t.stats,s=o.total;d.loaded+=o.loaded,s?(t=((t=Math.round(a.duration/t.duration))-(t=Math.min(Math.round(d.loaded/s),t)))*Math.round(d.loaded/t),d.total=d.loaded+t):d.total=Math.max(d.loaded,d.total),d=d.loading,o=o.loading,d.start?d.first+=o.first-o.start:(d.start=o.start,d.first=o.first),d.end=o.end},ld.resetLoader=function(a,t){a.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},or),dr=(Za(Lr,_d=l(Error)),Lr),pr=((Nn=mr.prototype).abort=function(a){for(var t in this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[t].loader;if(e){if(a&&a!==e.context.frag.type)return;e.abort()}}},Nn.detach=function(){for(var a in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[a];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[a]}},Nn.destroy=function(){for(var a in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[a].loader;t&&t.destroy()}this.keyUriToKeyInfo={}},Nn.createKeyLoadError=function(a,t,d,r,i){return void 0===t&&(t=it.KEY_LOAD_ERROR),new dr({type:rt.NETWORK_ERROR,details:t,fatal:!1,frag:a,response:i,error:d,networkDetails:r})},Nn.loadClear=function(e,t){var r=this;if(this.emeController&&this.config.emeEnabled)for(var i=e.sn,n=e.cc,a=0;a<t.length&&"break"!==function(){var d=t[a];if(n<=d.cc&&("initSegment"===i||"initSegment"===d.sn||i<d.sn))return r.emeController.selectKeySystemFormat(d).then(function(e){d.setKeyFormat(e)}),"break"}();a++);},Nn.load=function(a){var e=this;return!a.decryptdata&&a.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(a).then(function(r){return e.loadInternal(a,r)}):this.loadInternal(a)},Nn.loadInternal=function(a,e){e&&a.setKeyFormat(e);var d=a.decryptdata;if(!d){var r=new Error(e?"Expected frag.decryptdata to be defined after setting format "+e:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(a,it.KEY_LOAD_ERROR,r))}if(e=d.uri,!e)return Promise.reject(this.createKeyLoadError(a,it.KEY_LOAD_ERROR,new Error("Invalid key URI: \""+e+"\"")));var o=this.keyUriToKeyInfo[e];if(null!=o&&o.decryptdata.key)return d.key=o.decryptdata.key,Promise.resolve({frag:a,keyInfo:o});if(null!=o&&o.keyLoadPromise)switch(null==(r=o.mediaKeySessionContext)?void 0:r.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(function(e){return d.key=e.keyInfo.decryptdata.key,{frag:a,keyInfo:o}});}switch(o=this.keyUriToKeyInfo[e]={decryptdata:d,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},d.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===d.keyFormat?this.loadKeyHTTP(o,a):this.loadKeyEME(o,a);case"AES-128":return this.loadKeyHTTP(o,a);default:return Promise.reject(this.createKeyLoadError(a,it.KEY_LOAD_ERROR,new Error("Key supplied with unsupported METHOD: \""+d.method+"\"")));}},Nn.loadKeyEME=function(a,e){var n={frag:e,keyInfo:a};return this.emeController&&this.config.emeEnabled&&(e=this.emeController.loadKey(n),e)?(a.keyLoadPromise=e.then(function(e){return a.mediaKeySessionContext=e,n})).catch(function(e){throw a.keyLoadPromise=null,e}):Promise.resolve(n)},Nn.loadKeyHTTP=function(d,c){var f=this,a=this.config,r=new a.loader(a);return c.keyLoader=d.loader=r,d.keyLoadPromise=new Promise(function(l,s){var i={keyInfo:d,frag:c,responseType:"arraybuffer",url:d.decryptdata.uri},n=a.keyLoadPolicy.default,o={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},n={onSuccess:function(d,t,e,o){var i=e.frag,n=e.keyInfo,e=e.url;return i.decryptdata&&n===f.keyUriToKeyInfo[e]?void(n.decryptdata.key=i.decryptdata.key=new Uint8Array(d.data),i.keyLoader=null,n.loader=null,l({frag:i,keyInfo:n})):s(f.createKeyLoadError(i,it.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),o))},onError:function(a,t,e){f.resetLoader(t),s(f.createKeyLoadError(c,it.KEY_LOAD_ERROR,new Error("HTTP Error "+a.code+" loading key "+a.text),e,j({url:i.url,data:void 0},a)))},onTimeout:function(a,t,e){f.resetLoader(t),s(f.createKeyLoadError(c,it.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),e))},onAbort:function(a,t,e){f.resetLoader(t),s(f.createKeyLoadError(c,it.INTERNAL_ABORTED,new Error("key loading aborted"),e))}};r.load(i,o,n)})},Nn.resetLoader=function(a){var n=a.frag,e=a.keyInfo,r=a.url,a=e.loader;n.keyLoader===a&&(n.keyLoader=null,e.loader=null),delete this.keyUriToKeyInfo[r],a&&a.destroy()},mr),yr=((Ai=gr.prototype).destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},Ai.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},Ai.onHandlerDestroyed=function(){},Ai.hasInterval=function(){return!!this._tickInterval},Ai.hasNextTick=function(){return!!this._tickTimer},Ai.setInterval=function(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)},Ai.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),!(this._tickInterval=null))},Ai.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),!(this._tickTimer=null))},Ai.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&this.tickImmediate(),this._tickCallCount=0)},Ai.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},Ai.doTick=function(){},gr),Sd={length:0,start:function(){return 0},end:function(){return 0}},Er=(fr.isBuffered=function(a,t){try{if(a)for(var e=fr.getBuffered(a),r=0;r<e.length;r++)if(t>=e.start(r)&&t<=e.end(r))return!0}catch(e){}return!1},fr.bufferInfo=function(d,t,e){try{if(d){for(var r=fr.getBuffered(d),i=[],n=0;n<r.length;n++)i.push({start:r.start(n),end:r.end(n)});return this.bufferedInfo(i,t,e)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},fr.bufferedInfo=function(g,t,m){t=Math.max(0,t),g.sort(function(a,t){return a.start-t.start||t.end-a.end});var r=[];if(m)for(var p=0;p<g.length;p++){var y=r.length,s;y?(s=r[y-1].end,g[p].start-s<m?g[p].end>s&&(r[y-1].end=g[p].end):r.push(g[p])):r.push(g[p])}else r=g;for(var T=0,E=t,S=t,L=0,R;L<r.length;L++){var v=r[L].start,c=r[L].end;if(v<=t+m&&t<c)E=v,T=(S=c)-t;else if(t+m<v){R=v;break}}return{len:T,start:E||0,end:S||0,nextStart:R}},fr.getBuffered=function(e){try{return e.buffered}catch(e){return nt.log("failed to get media.buffered",e),Sd}},fr),Sr=(qr.prototype.decrypt=function(a,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,a)},qr),Cr=(wr.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},wr),_r=((Dd=br.prototype).uint8ArrayToUint32Array_=function(a){for(var t=new DataView(a),e=new Uint32Array(4),r=0;4>r;r++)e[r]=t.getUint32(4*r);return e},Dd.initTable=function(){for(var E=this.sBox,t=this.invSBox,e=this.subMix,S=e[0],i=e[1],n=e[2],a=e[3],e=this.invSubMix,s=e[0],o=e[1],l=e[2],u=e[3],h=new Uint32Array(256),d=0,L=0,R=0,R=0;256>R;R++)h[R]=128>R?R<<1:283^R<<1;for(R=0;256>R;R++){var A=99^((A=L^L<<1^L<<2^L<<3^L<<4)>>>8^255&A),k=h[t[E[d]=A]=d],v=h[k],p=h[v],y=257*h[A]^16843008*A;S[d]=y<<24|y>>>8,i[d]=y<<16|y>>>16,n[d]=y<<8|y>>>24,a[d]=y,y=16843009*p^65537*v^257*k^16843008*d,s[A]=y<<24|y>>>8,o[A]=y<<16|y>>>16,l[A]=y<<8|y>>>24,u[A]=y,d?(d=k^h[h[h[p^k]]],L^=h[h[L]]):d=L=1}},Dd.expandKey=function(y){for(var T=this.uint8ArrayToUint32Array_(y),e=!0,E=0;E<T.length&&e;)e=T[E]===this.key[E],E++;if(!e){this.key=T;var S=this.keySize=T.length;if(4!==S&&6!==S&&8!==S)throw new Error("Invalid aes key size="+S);for(var n=this.ksRows=4*(S+6+1),l=this.keySchedule=new Uint32Array(n),u=this.invKeySchedule=new Uint32Array(n),h=this.sBox,d=this.rcon,y=this.invSubMix,c=y[0],f=y[1],g=y[2],m=y[3],L=0,R,v,A;L<n;L++)L<S?v=l[L]=T[L]:(A=v,0==L%S?(A=h[(A=A<<8|A>>>24)>>>24]<<24|h[255&A>>>16]<<16|h[255&A>>>8]<<8|h[255&A],A^=d[0|L/S]<<24):6<S&&4==L%S&&(A=h[A>>>24]<<24|h[255&A>>>16]<<16|h[255&A>>>8]<<8|h[255&A]),l[L]=v=(l[L-S]^A)>>>0);for(R=0;R<n;R++)L=n-R,A=3&R?l[L]:l[L-4],u[R]=4>R||4>=L?A:c[h[A>>>24]]^f[h[255&A>>>16]]^g[h[255&A>>>8]]^m[h[255&A]],u[R]>>>=0}},Dd.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},Dd.decrypt=function(x,t,P){for(var F=this.keySize+6,p=this.invKeySchedule,y=this.invSBox,T=this.invSubMix,E=T[0],S=T[1],L=T[2],R=T[3],P=this.uint8ArrayToUint32Array_(P),A=P[0],O=P[1],M=P[2],N=P[3],B=new Int32Array(x),w=new Int32Array(B.length),C=this.networkToHostOrderSwap,_,U,G,K,H,V,Y,W,q,z,X,j,Q,Z;t<B.length;){for(q=C(B[t]),z=C(B[t+1]),X=C(B[t+2]),j=C(B[t+3]),H=q^p[0],V=j^p[1],Y=X^p[2],W=z^p[3],Q=4,Z=1;Z<F;Z++)_=E[H>>>24]^S[255&V>>16]^L[255&Y>>8]^R[255&W]^p[Q],U=E[V>>>24]^S[255&Y>>16]^L[255&W>>8]^R[255&H]^p[Q+1],G=E[Y>>>24]^S[255&W>>16]^L[255&H>>8]^R[255&V]^p[Q+2],K=E[W>>>24]^S[255&H>>16]^L[255&V>>8]^R[255&Y]^p[Q+3],H=_,V=U,Y=G,W=K,Q+=4;_=y[H>>>24]<<24^y[255&V>>16]<<16^y[255&Y>>8]<<8^y[255&W]^p[Q],U=y[V>>>24]<<24^y[255&Y>>16]<<16^y[255&W>>8]<<8^y[255&H]^p[Q+1],G=y[Y>>>24]<<24^y[255&W>>16]<<16^y[255&H>>8]<<8^y[255&V]^p[Q+2],K=y[W>>>24]<<24^y[255&H>>16]<<16^y[255&V>>8]<<8^y[255&Y]^p[Q+3],w[t]=C(_^A),w[t+1]=C(K^O),w[t+2]=C(G^M),w[t+3]=C(U^N),A=q,O=z,M=X,N=j,t+=4}return w.buffer},br),Pr=((C=Ir.prototype).destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},C.isSync=function(){return this.useSoftware},C.flush=function(){var a=this.currentResult,n=this.remainderData;if(!a||n)return this.reset(),null;var d=new Uint8Array(a),i;return this.reset(),this.removePKCS7Padding?(a=(n=(i=d).byteLength)&&new DataView(i.buffer).getUint8(n-1))?z(i,0,n-a):i:d},C.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},C.decrypt=function(d,i,n){var a=this;return this.useSoftware?new Promise(function(o,t){a.softwareDecrypt(new Uint8Array(d),i,n);var e=a.flush();e?o(e.buffer):t(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(d),i,n)},C.softwareDecrypt=function(d,o,e){var s=this.currentIV,l=this.currentResult,n=this.remainderData;return(this.logOnce("JS AES decrypt"),n&&(d=It(n,d),this.remainderData=null),d=this.getValidChunk(d),!d.length)?null:(s&&(e=s),s=this.softwareDecrypter,(s=s||(this.softwareDecrypter=new _r)).expandKey(o),(this.currentResult=s.decrypt(d.buffer,0,e),this.currentIV=z(d,-16).buffer,l||null))},C.webCryptoDecrypt=function(d,e,r){var i=this,n=this.subtle;return this.key===e&&this.fastAesKey||(this.key=e,this.fastAesKey=new Cr(n,e)),this.fastAesKey.expandKey().then(function(e){return n?(i.logOnce("WebCrypto AES decrypt"),new Sr(n,new Uint8Array(r)).decrypt(d.buffer,e)):Promise.reject(new Error("web crypto not initialized"))}).catch(function(a){return nt.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+a.name+": "+a.message),i.onWebCryptoError(d,e,r)})},C.onWebCryptoError=function(a,t,e){if(this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(a,t,e),e=this.flush(),e)return e.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},C.getValidChunk=function(a){var t=a,n=a.length-a.length%16;return n!==a.length&&(t=z(a,0,n),this.remainderData=z(a,n)),t},C.logOnce=function(e){this.logEnabled&&(nt.log("[decrypter]: "+e),this.logEnabled=!1)},Ir),xr="STOPPED",Fr="IDLE",Mr="KEY_LOADING",Or="FRAG_LOADING",Nr="FRAG_LOADING_WAITING_RETRY",Ur="WAITING_TRACK",Br="PARSING",Gr="PARSED",Kr="ENDED",Hr="ERROR",Vr="WAITING_INIT_PTS",Yr="WAITING_LEVEL",Wr=function(d){function a(o,t,e,r,i){var n;return(n=d.call(this)||this).hls=void 0,n.fragPrevious=null,n.fragCurrent=null,n.fragmentTracker=void 0,n.transmuxer=null,n._state=xr,n.playlistType=void 0,n.media=null,n.mediaBuffer=null,n.config=void 0,n.bitrateTest=!1,n.lastCurrentTime=0,n.nextLoadPosition=0,n.startPosition=0,n.startTimeOffset=null,n.loadedmetadata=!1,n.retryDate=0,n.levels=null,n.fragmentLoader=void 0,n.keyLoader=void 0,n.levelLastLoaded=null,n.startFragRequested=!1,n.decrypter=void 0,n.initPTS=[],n.onvseeking=null,n.onvended=null,n.logPrefix="",n.log=void 0,n.warn=void 0,n.playlistType=i,n.logPrefix=r,n.log=nt.log.bind(nt,r+":"),n.warn=nt.warn.bind(nt,r+":"),n.hls=o,n.fragmentLoader=new hr(o.config),n.keyLoader=e,n.fragmentTracker=t,n.config=o.config,n.decrypter=new Pr(o.config),o.on(G.MANIFEST_LOADED,n.onManifestLoaded,function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n}Za(a,d);var t=a.prototype;return t.doTick=function(){this.onTickEnd()},t.onTickEnd=function(){},t.startLoad=function(){},t.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=xr},t._streamEnded=function(a,r){return!r.live&&!a.nextStart&&a.end&&this.media&&((a=r.partList,null!=a&&a.length)?(a=a[a.length-1],Er.isBuffered(this.media,a.start+a.duration/2)):(r=r.fragments[r.fragments.length-1].type,this.fragmentTracker.isEndListAppended(r)))},t.getLevelDetails=function(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levels[this.levelLastLoaded])?void 0:e.details},t.onMediaAttached=function(a,t){t=this.media=this.mediaBuffer=t.media,this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended),t=this.config,this.levels&&t.autoStartLoad&&this.state===xr&&this.startLoad(t.startPosition)},t.onMediaDetaching=function(){var e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},t.onMediaSeeking=function(){var d=this.config,o=this.fragCurrent,e=this.media,r=this.mediaBuffer,s=this.state,l=e?e.currentTime:0,r=Er.bufferInfo(r||e,l,d.maxBufferHole);this.log("media seeking to "+(yd(l)?l.toFixed(3):l)+", state: "+s),this.state===Kr?this.resetLoadingState():o&&(s=d.maxFragLookUpTolerance,d=o.start-s,s=o.start+o.duration+s,(!r.len||s<r.start||d>r.end)&&(s=s<l,(l<d||s)&&(s&&o.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null))),e&&(this.fragmentTracker.removeFragmentsInRange(l,1/0,this.playlistType,!0),this.lastCurrentTime=l),this.loadedmetadata||r.len||(this.nextLoadPosition=this.startPosition=l),this.tickImmediate()},t.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},t.onManifestLoaded=function(a,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]},t.onHandlerDestroying=function(){this.stopLoad(),d.prototype.onHandlerDestroying.call(this)},t.onHandlerDestroyed=function(){this.state=xr,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,d.prototype.onHandlerDestroyed.call(this)},t.loadFragment=function(a,t,e){this._loadFragForPlayback(a,t,e)},t._loadFragForPlayback=function(a,r,t){var n=this;this._doFragLoad(a,r,t,function(e){return n.fragContextChanged(a)?(n.warn("Fragment "+a.sn+(e.part?" p: "+e.part.index:"")+" of level "+a.level+" was dropped during download."),void n.fragmentTracker.removeFragment(a)):(a.stats.chunkCount++,void n._handleFragmentLoadProgress(e))}).then(function(r){var t;r&&(t=n.state,n.fragContextChanged(a)?t!==Or&&(n.fragCurrent||t!==Br)||(n.fragmentTracker.removeFragment(a),n.state=Fr):("payload"in r&&(n.log("Loaded fragment "+a.sn+" of level "+a.level),n.hls.trigger(G.FRAG_LOADED,r)),n._handleFragmentLoadComplete(r)))}).catch(function(e){n.state!==xr&&n.state!==Hr&&(n.warn(e),n.resetFragmentLoading(a))})},t.clearTrackerIfNeeded=function(a){var t=this.fragmentTracker,r;t.getState(a)===rr?(r=a.type,r=this.getFwdBufferInfo(this.mediaBuffer,r),r=Math.max(a.duration,r?r.len:this.config.maxBufferLength),this.reduceMaxBufferLength(r)&&t.removeFragment(a)):0===(null==(r=this.mediaBuffer)?void 0:r.buffered.length)?t.removeAllFragments():t.hasParts(a.type)&&(t.detectPartialFragments({frag:a,part:null,stats:a.stats,id:a.type}),t.getState(a)===ir&&t.removeFragment(a))},t.flushMainBuffer=function(a,t,e){void 0===e&&(e=null),a-t&&(e={startOffset:a,endOffset:t,type:e},this.hls.trigger(G.BUFFER_FLUSHING,e))},t._loadInitSegment=function(d,a){var o=this;this._doFragLoad(d,a).then(function(e){if(!e||o.fragContextChanged(d)||!o.levels)throw new Error("init load aborted");return e}).then(function(a){var r=o.hls,i=a.payload,t=d.decryptdata;if(i&&0<i.byteLength&&t&&t.key&&t.iv&&"AES-128"===t.method){var s=self.performance.now();return o.decrypter.decrypt(new Uint8Array(i),t.key.buffer,t.iv.buffer).catch(function(e){throw r.trigger(G.ERROR,{type:rt.MEDIA_ERROR,details:it.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:d}),e}).then(function(n){var t=self.performance.now();return r.trigger(G.FRAG_DECRYPTED,{frag:d,payload:n,stats:{tstart:s,tdecrypt:t}}),a.payload=n,a})}return a}).then(function(n){var t=o.fragCurrent,e=o.hls;if(!o.levels)throw new Error("init load aborted, missing levels");var r=d.stats;o.state=Fr,a.fragmentError=0,d.data=new Uint8Array(n.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),n.frag===t&&e.trigger(G.FRAG_BUFFERED,{stats:r,frag:t,part:null,id:d.type}),o.tick()}).catch(function(e){o.state!==xr&&o.state!==Hr&&(o.warn(e),o.resetFragmentLoading(d))})},t.fragContextChanged=function(a){var t=this.fragCurrent;return!a||!t||a.level!==t.level||a.sn!==t.sn||a.urlId!==t.urlId},t.fragBufferedComplete=function(a,t){var n=this.mediaBuffer||this.media;this.log("Buffered "+a.type+" sn: "+a.sn+(t?" part: "+t.index:"")+" of "+(this.playlistType===oe?"level":"track")+" "+a.level+" (frag:["+(null==(t=a.startPTS)?NaN:t).toFixed(3)+"-"+(null==(t=a.endPTS)?NaN:t).toFixed(3)+"] > buffer:"+(n?function(a){for(var t="",n=a.length,r=0;r<n;r++)t+="["+a.start(r).toFixed(3)+"-"+a.end(r).toFixed(3)+"]";return t}(Er.getBuffered(n)):"(detached)")+")"),this.state=Fr,n&&(!this.loadedmetadata&&a.type==oe&&n.buffered.length&&(null==(n=this.fragCurrent)?void 0:n.sn)===(null==(n=this.fragPrevious)?void 0:n.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},t.seekToStartPos=function(){},t._handleFragmentLoadComplete=function(a){var n=this.transmuxer,i,d;n&&(i=a.frag,d=a.part,a=!(a=a.partsLoaded)||0===a.length||a.some(function(e){return!e}),a=new cr(i.level,i.sn,i.stats.chunkCount+1,0,d?d.index:-1,!a),n.flush(a))},t._handleFragmentLoadProgress=function(){},t._doFragLoad=function(d,c,r,f){var i=this;void 0===r&&(r=null);var n=null==c?void 0:c.details;if(!this.levels||!n)throw new Error("frag load aborted, missing level"+(n?"":" detail")+"s");var a=null;if(!d.encrypted||null!=(o=d.decryptdata)&&o.key?!d.encrypted&&n.encryptedFragments.length&&this.keyLoader.loadClear(d,n.encryptedFragments):(this.log("Loading key for "+d.sn+" of ["+n.startSN+"-"+n.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+d.level),this.state=Mr,this.fragCurrent=d,a=this.keyLoader.load(d).then(function(e){if(!i.fragContextChanged(e.frag))return i.hls.trigger(G.KEY_LOADED,e),i.state===Mr&&(i.state=Fr),e}),this.hls.trigger(G.KEY_LOADING,{frag:d}),null===this.fragCurrent&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),r=Math.max(d.start,r||0),this.config.lowLatencyMode&&"initSegment"!==d.sn){var g=n.partList;if(g&&f){r>d.end&&n.fragmentHint&&(d=n.fragmentHint);var o=this.getNextPart(g,d,r);if(-1<o){var m=g[o];return this.log("Loading part sn: "+d.sn+" p: "+m.index+" cc: "+d.cc+" of playlist ["+n.startSN+"-"+n.endSN+"] parts [0-"+o+"-"+(g.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+d.level+", target: "+parseFloat(r.toFixed(3))),this.nextLoadPosition=m.start+m.duration,this.state=Or,o=a?a.then(function(e){return!e||i.fragContextChanged(e.frag)?null:i.doFragPartsLoad(d,m,c,f)}).catch(function(e){return i.handleFragLoadError(e)}):this.doFragPartsLoad(d,m,c,f).catch(function(e){return i.handleFragLoadError(e)}),this.hls.trigger(G.FRAG_LOADING,{frag:d,part:m,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):o}if(!d.url||this.loadedEndOfParts(g,r))return Promise.resolve(null)}}this.log("Loading fragment "+d.sn+" cc: "+d.cc+" "+(n?"of ["+n.startSN+"-"+n.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+d.level+", target: "+parseFloat(r.toFixed(3))),yd(d.sn)&&!this.bitrateTest&&(this.nextLoadPosition=d.start+d.duration),this.state=Or;var u=this.config.progressive,a=u&&a?a.then(function(e){return!e||i.fragContextChanged(null==e?void 0:e.frag)?null:i.fragmentLoader.load(d,f)}).catch(function(e){return i.handleFragLoadError(e)}):Promise.all([this.fragmentLoader.load(d,u?f:void 0),a]).then(function(e){return e=e[0],!u&&e&&f&&f(e),e}).catch(function(e){return i.handleFragLoadError(e)});return this.hls.trigger(G.FRAG_LOADING,{frag:d,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):a},t.doFragPartsLoad=function(d,i,o,e){var l=this;return new Promise(function(u,n){var c=[],a=null==(t=o.details)?void 0:t.partList,t;!function s(r){l.fragmentLoader.loadPart(d,r,e).then(function(n){var i=(c[r.index]=n).part;return l.hls.trigger(G.FRAG_LOADED,n),n=Ne(o,d.sn,r.index+1)||Ue(a,d.sn,r.index+1),n?void s(n):u({frag:d,part:i,partsLoaded:c})}).catch(n)}(i)})},t.handleFragLoadError=function(a){var t;return"data"in a?(t=a.data,a.data&&t.details===it.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(G.ERROR,t)):this.hls.trigger(G.ERROR,{type:rt.OTHER_ERROR,details:it.INTERNAL_EXCEPTION,err:a,error:a,fatal:!0}),null},t._handleTransmuxerFlush=function(a){var t=this.getCurrentContext(a),d,o,s;t&&this.state===Br?(d=t.frag,o=t.part,s=t.level,t=self.performance.now(),d.stats.parsing.end=t,o&&(o.stats.parsing.end=t),this.updateLevelTiming(d,o,s,a.partial)):this.fragCurrent||this.state===xr||this.state===Hr||(this.state=Fr)},t.getCurrentContext=function(d){var o=this.levels,s=this.fragCurrent,e=d.level,r=d.sn,d=d.part;if(null==o||!o[e])return this.warn("Levels object was unset while buffering fragment "+r+" of level "+e+". The current chunk will not be buffered."),null;var n=o[e],e=-1<d?Ne(n,r,d):null,d=e?e.fragment:function(){if(null==n||!n.details)return null;var a=n.details,t=a.fragments[r-a.startSN];return t||((t=a.fragmentHint)&&t.sn===r?t:r<a.startSN&&s&&s.sn===r?s:null)}();return d?(s&&s!==d&&(d.stats=s.stats),{frag:d,part:e,level:n}):null},t.bufferFragmentData=function(d,t,e,r){var i,o,l;d&&this.state===Br&&(i=d.data1,o=d.data2,(l=i)&&o&&(l=It(i,o)),null!=l&&l.length&&(l={type:d.type,frag:t,part:e,chunkMeta:r,parent:t.type,data:l},this.hls.trigger(G.BUFFER_APPENDING,l),d.dropped&&d.independent&&!e&&this.flushBufferGap(t)))},t.flushBufferGap=function(a){var t=this.media,n,d;t&&(Er.isBuffered(t,t.currentTime)?(d=t.currentTime,n=Er.bufferInfo(t,d,0),t=a.duration,t=Math.min(2*this.config.maxFragLookUpTolerance,.25*t),d=Math.max(Math.min(a.start-t,n.end-t),d+t),a.start-d>t&&this.flushMainBuffer(d,a.start)):this.flushMainBuffer(0,a.start))},t.getFwdBufferInfo=function(a,t){var e=this.getLoadPosition();return yd(e)?this.getFwdBufferInfoAtPos(a,e,t):null},t.getFwdBufferInfoAtPos=function(a,t,e){var d=this.config.maxBufferHole,i=Er.bufferInfo(a,t,d);return 0===i.len&&void 0!==i.nextStart&&(e=this.fragmentTracker.getBufferedFrag(t,e),e&&i.nextStart<e.end)?Er.bufferInfo(a,t,Math.max(i.nextStart,d)):i},t.getMaxBufferLength=function(a){var r=this.config,a=a?Math.max(8*r.maxBufferSize/a,r.maxBufferLength):r.maxBufferLength;return Math.min(a,r.maxMaxBufferLength)},t.reduceMaxBufferLength=function(a){var r=this.config,a=a||r.maxBufferLength;return r.maxMaxBufferLength>=a&&(r.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+r.maxMaxBufferLength+"s"),!0)},t.getAppendedFrag=function(e){return e=this.fragmentTracker.getAppendedFrag(e,oe),e&&"fragment"in e?e.fragment:e},t.getNextFragment=function(d,t){var e=t.fragments,r=e.length;if(!r)return null;var i=this.config,l=e[0].start,s;if(t.live){var u=i.initialLiveManifestSize;if(r<u)return this.warn("Not enough fragments to start playback (have: "+r+", need: "+u+")"),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(s=this.getInitialLiveFragment(t,e),this.startPosition=s?this.hls.liveSyncPosition||s.start:d)}else d<=l&&(s=e[0]);return s||(i=i.lowLatencyMode?t.partEnd:t.fragmentEnd,s=this.getFragmentAtPosition(d,i,t)),this.mapToInitFragWhenRequired(s)},t.isLoopLoading=function(a,t){var e=this.fragmentTracker.getState(a);return(e===nr||e===ir&&!!a.gap)&&this.nextLoadPosition>t},t.getNextFragmentLoopLoading=function(d,o,s,r,i){var n=d.gap,o=this.getNextFragment(this.nextLoadPosition,o);return null===o?o:(d=o,n&&d&&!d.gap&&s.nextStart)&&(n=this.getFwdBufferInfoAtPos(this.mediaBuffer||this.media,s.nextStart,r),null!==n&&s.len+n.len>=i)?(this.log("buffer full after gaps in \""+r+"\" playlist starting at sn: "+d.sn),null):d},t.mapToInitFragWhenRequired=function(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment},t.getNextPart=function(d,t,e){for(var r=-1,c=!1,f=!0,g=0,m=d.length;g<m;g++){var o=d[g],f=f&&!o.independent;if(-1<r&&e<o.start)break;var l=o.loaded;l?r=-1:(c||o.independent||f)&&o.fragment===t&&(r=g),c=l}return r},t.loadedEndOfParts=function(a,r){return a=a[a.length-1],a&&r>a.start&&a.loaded},t.getInitialLiveFragment=function(d,t){var o=this.fragPrevious,n=null,s,l;return o?(d.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+o.programDateTime),n=function(d,t,e){if(null===t||!Array.isArray(d)||!d.length||!yd(t))return null;if(t<(d[0].programDateTime||0))return null;if(t>=(d[d.length-1].endProgramDateTime||0))return null;e=e||0;for(var l=0,u,c,f,g;l<d.length;++l)if(g=d[l],u=t,c=e,f=g,c=1e3*Math.min(c,f.duration+(f.deltaPTS||0)),(f.endProgramDateTime||0)-c>u)return g;return null}(t,o.endProgramDateTime,this.config.maxFragLookUpTolerance)),n||((s=o.sn+1)>=d.startSN&&s<=d.endSN&&(s=t[s-d.startSN],o.cc===s.cc&&(n=s,this.log("Live playlist, switching playlist, load frag with next SN: "+n.sn))),n||(l=o.cc,(n=Ie(t,function(e){return e.cc<l?1:e.cc>l?-1:0}))&&this.log("Live playlist, switching playlist, load frag with same CC: "+n.sn)))):null!==(t=this.hls.liveSyncPosition)&&(n=this.getFragmentAtPosition(t,this.bitrateTest?d.fragmentEnd:d.edge,d)),n},t.getFragmentAtPosition=function(d,c,e){var f=this.config,g=this.fragPrevious,m=e.fragments,p=e.endSN,y=e.fragmentHint,o=f.maxFragLookUpTolerance,h=e.partList,f=!!(f.lowLatencyMode&&null!=h&&h.length&&y);return f&&y&&!this.bitrateTest&&(m=m.concat(y),p=y.sn),(d=d<c?Ye(g,m,d,c-o<d?0:o):m[m.length-1])&&(o=d.sn-e.startSN,((e=this.fragmentTracker.getState(d))===nr||e===ir&&d.gap)&&(g=d),g&&d.sn===g.sn&&(!f||h[0].fragment.sn>d.sn)&&g&&d.level===g.level&&(o=m[1+o],d=d.sn<p&&this.fragmentTracker.getState(o)!==nr?o:null)),d},t.synchronizeToLiveEdge=function(d){var o=this.config,a=this.media,s,l,u,c;a&&(s=this.hls.liveSyncPosition,l=a.currentTime,c=d.fragments[0].start,u=d.edge,c=l>=c-o.maxFragLookUpTolerance&&l<=u,null!==s&&a.duration>s&&(l<s||!c)&&(d=void 0===o.liveMaxLatencyDuration?o.liveMaxLatencyDurationCount*d.targetduration:o.liveMaxLatencyDuration,(!c&&4>a.readyState||l<u-d)&&(this.loadedmetadata||(this.nextLoadPosition=s),a.readyState&&(this.warn("Playback: "+l.toFixed(3)+" is located too far from the end of live sliding playlist: "+u+", reset currentTime to : "+s.toFixed(3)),a.currentTime=s))))},t.alignPlaylists=function(c,t){var e=this.levels,f=this.levelLastLoaded,g=this.fragPrevious,n=null===f?null:e[f],m=c.fragments.length;if(!m)return this.warn("No fragments in live playlist"),0;var s=c.fragments[0].start,u=!t,p=c.alignedSliding&&yd(s),y,T;return!u&&(p||s)?s:(y=g,e=c,(f=n)&&(u=y,T=e,(p=f).details&&(T.endCC>T.startCC||u&&u.cc<T.startCC)&&(p=function(a){var r=a.fragments,a=T.fragments;if(a.length&&r.length){if(a=Rr(r,a[0].cc),a&&(!a||a.startPTS))return a;nt.log("No frag in previous level to align on")}else nt.log("No fragments to align")}(p.details))&&yd(p.start)&&(nt.log("Adjusting PTS using last level due to CC increase within current level "+T.url),kr(p.start,T)),!e.alignedSliding&&f.details&&(n=e,(y=f.details).fragments.length&&n.hasProgramDateTime&&y.hasProgramDateTime&&(u=y.fragments[0].programDateTime,(y=((p=n.fragments[0].programDateTime)-u)/1e3+y.fragments[0].start)&&yd(y)&&(nt.log("Adjusting PTS using programDateTime delta "+(p-u)+"ms, sliding:"+y.toFixed(3)+" "+n.url+" "),kr(y,n)))),e.alignedSliding||!f.details||e.skippedSegments||Me(f.details,e)),e=c.fragments[0].start,(this.log("Live playlist sliding: "+e.toFixed(2)+" start-sn: "+(t?t.startSN:"na")+"->"+c.startSN+" prev-sn: "+(g?g.sn:"na")+" fragments: "+m),e))},t.waitForCdnTuneIn=function(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)},t.setStartPosition=function(a,t){var e=this.startPosition,d,o;e<t&&(e=-1),-1!==e&&-1!==this.lastCurrentTime||(null!==(o=((d=null!==this.startTimeOffset)?this:a).startTimeOffset)&&yd(o)?(e=t+o,0>o&&(e+=a.totalduration),e=Math.min(Math.max(t,e),t+a.totalduration),this.log("Start time offset "+o+" found in "+(d?"multivariant":"media")+" playlist, adjust startPosition to "+e),this.startPosition=e):a.live?e=this.hls.liveSyncPosition||t:this.startPosition=e=0,this.lastCurrentTime=e),this.nextLoadPosition=e},t.getLoadPosition=function(){var a=this.media,t=0;return this.loadedmetadata&&a?t=a.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t},t.handleFragLoadAborted=function(a,t){this.transmuxer&&"initSegment"!==a.sn&&a.stats.aborted&&(this.warn("Fragment "+a.sn+(t?" part "+t.index:"")+" of level "+a.level+" was aborted"),this.resetFragmentLoading(a))},t.resetFragmentLoading=function(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===Nr)||(this.state=Fr)},t.onFragmentOrKeyLoadError=function(d,t){!t.chunkMeta||t.frag||(c=this.getCurrentContext(t.chunkMeta))&&(t.frag=c.frag);var e=t.frag,o,l,u,c,f;e&&e.type===d&&this.levels&&(this.fragContextChanged(e)?this.warn("Frag load error must match current frag to retry "+e.url+" > "+(null==(u=this.fragCurrent)?void 0:u.url)):((o=t.details===it.FRAG_GAP)&&this.fragmentTracker.fragBuffered(e,!0),u=void 0===(c=(f=(l=t.errorAction)||{}).retryCount)?0:c,c=f.retryConfig,l&&5===f.action&&c?(this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),f=Ke(c,u),this.warn("Fragment "+e.sn+" of "+d+" "+e.level+" errored with "+t.details+", retrying loading "+(u+1)+"/"+c.maxNumRetry+" in "+f+"ms"),l.resolved=!0,this.retryDate=self.performance.now()+f,this.state=Nr):c&&l?(this.resetFragmentErrors(d),u<c.maxNumRetry?o||(l.resolved=!0):nt.warn(t.details+" reached or exceeded max retry ("+u+")")):this.state=Hr,this.tickImmediate()))},t.reduceLengthAndFlushBuffer=function(a){if(this.state!==Br&&this.state!==Gr)return!1;var t=a.parent,e=this.getFwdBufferInfo(this.mediaBuffer,t),r=e&&.5<e.len;return r&&this.reduceMaxBufferLength(e.len),r=!r,(r&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+t+" buffer"),a.frag&&(this.fragmentTracker.removeFragment(a.frag),this.nextLoadPosition=a.frag.start),this.resetLoadingState(),r)},t.resetFragmentErrors=function(e){e===le&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==xr&&(this.state=Fr)},t.afterBufferFlushed=function(a,n,e){a&&(a=Er.getBuffered(a),this.fragmentTracker.detectEvictedFragments(n,a,e),this.state===Kr&&this.resetLoadingState())},t.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Fr},t.resetStartWhenNotLoaded=function(e){this.loadedmetadata||(this.startFragRequested=!1,null!=(e=this.levels?this.levels[e].details:null)&&e.live?(this.startPosition=-1,this.setStartPosition(e,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition)},t.resetWhenMissingContext=function(e){this.warn("The loading context changed while buffering fragment "+e.sn+" of level "+e.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(e.level),this.resetLoadingState()},t.removeUnbufferedFrags=function(e){void 0===e&&(e=0),this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)},t.updateLevelTiming=function(d,r,n,a){var s=this,o=n.details;if(o){if(Object.keys(d.elementaryStreams).reduce(function(l,t){var e=d.elementaryStreams[t];if(e){var r=e.endPTS-e.startPTS;return 0>=r?(s.warn("Could not parse fragment "+d.sn+" "+t+" duration reliably ("+r+")"),l||!1):(r=a?0:xe(o,d,e.startPTS,e.endPTS,e.startDTS,e.endDTS),s.hls.trigger(G.LEVEL_PTS_UPDATED,{details:o,level:n,drift:r,type:t,frag:d,start:e.startPTS,end:e.endPTS}),!0)}return l},!1))n.fragmentError=0;else if(null===(null==(t=this.transmuxer)?void 0:t.error)){var t=new Error("Found no media in fragment "+d.sn+" of level "+n.id+" resetting transmuxer to fallback to playlist timing");if(this.warn(t.message),this.hls.trigger(G.ERROR,{type:rt.MEDIA_ERROR,details:it.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:d,reason:"Found no media in msn "+d.sn+" of level \""+n.url+"\""}),!this.hls)return;this.resetTransmuxer()}this.state=Gr,this.hls.trigger(G.FRAG_PARSED,{frag:d,part:r})}else this.warn("level.details undefined")},t.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},t.recoverWorkerError=function(e){"demuxerWorker"===e.event&&(this.resetTransmuxer(),this.resetLoadingState())},qt(a,[{key:"state",get:function(){return this._state},set:function(a){var t=this._state;t!==a&&(this._state=a,this.log(t+"->"+a))}}]),a}(yr),Ld=((Yn=Qr.prototype).resetInitSegment=function(){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},Yn.resetTimeStamp=function(e){this.initPTS=e,this.resetContiguity()},Yn.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},Yn.canParse=function(){return!1},Yn.appendFrame=function(){},Yn.demux=function(d,c){this.cachedData&&(d=It(this.cachedData,d),this.cachedData=null);var f=tt(d,0),e=f?f.length:0,g=this._audioTrack,o=this._id3Track,l=f?function(){for(var a=st(f),t=0,n;t<a.length;t++)if(n=a[t],ot(n))return function(a){if(8===a.data.byteLength){var r=new Uint8Array(a.data),a=1&r[3],r=(r[4]<<23)+(r[5]<<15)+(r[6]<<7)+r[7];return r/=45,a&&(r+=47721858.84),Math.round(r)}}(n)}():void 0,u=d.length,m,p,y;for((null===this.basePTS||0===this.frameIndex&&yd(l))&&(this.basePTS=Rd(l,c,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),f&&0<f.length&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:f,type:fe,duration:Number.POSITIVE_INFINITY});e<u;)this.canParse(d,e)?(p=this.appendFrame(g,d,e))?(this.frameIndex++,this.lastPTS=p.sample.pts,m=e+=p.length):e=u:$(p=d,y=e)&&Z(p,y+6)+10<=p.length-y?(f=tt(d,e),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:f,type:fe,duration:Number.POSITIVE_INFINITY}),m=e+=f.length):e++,e===u&&m!==u&&(y=z(d,m),this.cachedData=this.cachedData?It(this.cachedData,y):y);return{audioTrack:g,videoTrack:Xr(),id3Track:o,textTrack:Xr()}},Yn.demuxSampleAes=function(){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},Yn.flush=function(){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Xr(),id3Track:this._id3Track,textTrack:Xr()}},Yn.destroy=function(){},Qr),Rd=function(a,t,e){return yd(a)?90*a:9e4*t+(e?9e4*e.baseTime/e.timescale:0)},ti=function(a){function r(n,t){var e;return(e=a.call(this)||this).observer=void 0,e.config=void 0,e.observer=n,e.config=t,e}Za(r,a);var t=r.prototype;return t.resetInitSegment=function(n,t,e,r){a.prototype.resetInitSegment.call(this,n,t,e,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}},r.probe=function(a){if(!a)return!1;for(var t=(tt(a,0)||[]).length,n=a.length;t<n;t++)if(function(a,t){if(ri(a,t)){var e=Jr(a,t);if(t+e>=a.length)return;var r=ei(a,t);return r<=e?void 0:(r=t+r,r===a.length||ri(a,r))}}(a,t))return nt.log("ADTS sync word found !"),!0;return!1},t.canParse=function(a,r){return(r=r)+5<(a=a).length&&$r(a,r)&&ei(a,r)<=a.length-r},t.appendFrame=function(a,t,e){if(ai(a,this.observer,t,e,a.manifestCodec),e=ii(a,t,e,this.basePTS,this.frameIndex),e&&0===e.missing)return e},r}(Ld),vd=((Xi=oi.prototype).resetTimeStamp=function(){},Xi.resetInitSegment=function(d,c,e,r){var i=this.videoTrack=Xr("video",1),o=this.audioTrack=Xr("audio",1),l=this.txtTrack=Xr("text",1),u,f,g;this.id3Track=Xr("id3",1),this.timeOffset=0,null!=d&&d.byteLength&&((f=kt(d)).video&&(d=(u=f.video).id,g=u.timescale,u=u.codec,i.id=d,i.timescale=l.timescale=g,i.codec=u),f.audio&&(u=(g=f.audio).id,f=g.timescale,g=g.codec,o.id=u,o.timescale=f,o.codec=g),l.id=Et.text,i.sampleDuration=0,i.duration=o.duration=r)},Xi.resetContiguity=function(){this.remainderData=null},oi.probe=function(e){return 0<At(e=16384<e.length?e.subarray(0,16384):e,["moof"]).length},Xi.demux=function(a,d){this.timeOffset=d;var e=a,o=this.videoTrack,i=this.txtTrack;return this.config.progressive?(this.remainderData&&(e=It(this.remainderData,a)),a=function(a){var t={valid:null,remainder:null},e=At(a,["moof"]);return e?2>e.length?(t.remainder=a,t):(e=e[e.length-1],t.valid=z(a,0,e.byteOffset-8),t.remainder=z(a,e.byteOffset-8),t):t}(e),this.remainderData=a.remainder,o.samples=a.valid||new Uint8Array):o.samples=e,e=this.extractID3Track(o,d),(i.samples=bt(d,o),{videoTrack:o,audioTrack:this.audioTrack,id3Track:e,textTrack:this.txtTrack})},Xi.flush=function(){var a=this.timeOffset,t=this.videoTrack,e=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var r=this.extractID3Track(t,this.timeOffset);return e.samples=bt(a,t),{videoTrack:t,audioTrack:Xr(),id3Track:r,textTrack:Xr()}},Xi.extractID3Track=function(e,a){var i=this.id3Track;return!e.samples.length||(e=At(e.samples,["emsg"]))&&e.forEach(function(n){var d=function(d){var t=d[0],c="",f="",g=0,m=0,p=0,y=0,T=0,E=0;if(0===t){for(;"\0"!==ut(d.subarray(E,E+1));)c+=ut(d.subarray(E,E+1)),E+=1;for(c+=ut(d.subarray(E,E+1)),E+=1;"\0"!==ut(d.subarray(E,E+1));)f+=ut(d.subarray(E,E+1)),E+=1;f+=ut(d.subarray(E,E+1)),E+=1,g=ht(d,12),m=ht(d,16),y=ht(d,20),T=ht(d,24),E=28}else if(1===t){g=ht(d,E+=4);var S=ht(d,E+=4),t=ht(d,E+=4);for(E+=4,p=Math.pow(2,32)*S+t,Number.isSafeInteger(p)||(p=Number.MAX_SAFE_INTEGER,nt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),y=ht(d,E),T=ht(d,E+=4),E+=4;"\0"!==ut(d.subarray(E,E+1));)c+=ut(d.subarray(E,E+1)),E+=1;for(c+=ut(d.subarray(E,E+1)),E+=1;"\0"!==ut(d.subarray(E,E+1));)f+=ut(d.subarray(E,E+1)),E+=1;f+=ut(d.subarray(E,E+1)),E+=1}return{schemeIdUri:c,value:f,timeScale:g,presentationTime:p,presentationTimeDelta:m,eventDuration:y,id:T,payload:d.subarray(E,d.byteLength)}}(n),o;/\/emsg[-/]ID3/i.test(d.schemeIdUri)&&(o=yd(d.presentationTime)?d.presentationTime/d.timeScale:a+d.presentationTimeDelta/d.timeScale,.001>=(n=4294967295===d.eventDuration?Number.POSITIVE_INFINITY:d.eventDuration/d.timeScale)&&(n=Number.POSITIVE_INFINITY),d=d.payload,i.samples.push({data:d,len:d.byteLength,dts:o,pts:o,type:Te,duration:n}))}),i},Xi.demuxSampleAes=function(){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},Xi.destroy=function(){},oi),Ad=null,kd=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],fi=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],gi=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],mi=[0,1,1,4],vi=((ld=Ei.prototype).loadWord=function(){var a=this.data,t=this.bytesAvailable,n=a.byteLength-t,r=new Uint8Array(4),t=Math.min(4,t);if(0===t)throw new Error("no bytes available");r.set(a.subarray(n,n+t)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*t,this.bytesAvailable-=t},ld.skipBits=function(a){var r;a=Math.min(a,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>a||(a-=this.bitsAvailable,a-=(r=a>>3)<<3,this.bytesAvailable-=r,this.loadWord()),this.word<<=a,this.bitsAvailable-=a},ld.readBits=function(a){var t=Math.min(this.bitsAvailable,a),n=this.word>>>32-t;if(32<a&&nt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,0<this.bitsAvailable)this.word<<=t;else{if(!(0<this.bytesAvailable))throw new Error("no bits available");this.loadWord()}return 0<(t=a-t)&&this.bitsAvailable?n<<t|this.readBits(t):n},ld.skipLZ=function(){for(var e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},ld.skipUEG=function(){this.skipBits(1+this.skipLZ())},ld.skipEG=function(){this.skipBits(1+this.skipLZ())},ld.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},ld.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},ld.readBoolean=function(){return 1===this.readBits(1)},ld.readUByte=function(){return this.readBits(8)},ld.readUShort=function(){return this.readBits(16)},ld.readUInt=function(){return this.readBits(32)},ld.skipScalingList=function(a){for(var t=8,n=8,d=0;d<a;d++)0!=n&&(n=(t+this.readEG()+256)%256),t=0==n?t:n},ld.readSPS=function(){var y=0,T=0,E=0,S=0,L=this.readUByte.bind(this),o=this.readBits.bind(this),R=this.readUEG.bind(this),u=this.readBoolean.bind(this),h=this.skipBits.bind(this),d=this.skipEG.bind(this),c=this.skipUEG.bind(this),A=this.skipScalingList.bind(this),g,k,D;L();var I=L();if(o(5),h(3),L(),c(),100===I||110===I||122===I||244===I||44===I||83===I||86===I||118===I||128===I){var m=R();if(3===m&&h(1),c(),c(),h(1),u())for(k=3===m?12:8,D=0;D<k;D++)u()&&A(6>D?16:64)}if(c(),m=R(),0===m)R();else if(1===m)for(h(1),d(),d(),g=R(),D=0;D<g;D++)d();c(),h(1),m=R(),c=R(),o=o(1),0===o&&h(1),h(1),u()&&(y=R(),T=R(),E=R(),S=R());var b=[1,1];if(u()&&u())switch(L()){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:b=[L()<<8|L(),L()<<8|L()];}return{width:Math.ceil(16*(m+1)-2*y-2*T),height:16*((2-o)*(c+1))-(o?2:4)*(E+S),pixelRatio:b}},ld.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},Ei),Li=((Nn=Ti.prototype).decryptBuffer=function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)},Nn.decryptAacSample=function(d,e,r){var i=this,n=d[e].unit,a;16>=n.length||(a=(a=n.subarray(16,n.length-n.length%16)).buffer.slice(a.byteOffset,a.byteOffset+a.length),this.decryptBuffer(a).then(function(a){a=new Uint8Array(a),n.set(a,16),i.decrypter.isSync()||i.decryptAacSamples(d,e+1,r)}))},Nn.decryptAacSamples=function(a,t,n){for(;;t++){if(t>=a.length)return void n();if(!(32>a[t].unit.length||(this.decryptAacSample(a,t,n),this.decrypter.isSync())))return}},Nn.getAvcEncryptedData=function(a){for(var t=16*Math.floor((a.length-48)/160)+16,e=new Int8Array(t),r=0,d=32;d<a.length-16;d+=160,r+=16)e.set(a.subarray(d,d+16),r);return e},Nn.getAvcDecryptedUnit=function(a,t){for(var e=new Uint8Array(t),r=0,d=32;d<a.length-16;d+=160,r+=16)a.set(e.subarray(r,r+16),d);return a},Nn.decryptAvcSample=function(d,e,r,i,n){var a=this,s=_t(n.data),o=this.getAvcEncryptedData(s);this.decryptBuffer(o.buffer).then(function(o){n.data=a.getAvcDecryptedUnit(s,o),a.decrypter.isSync()||a.decryptAvcSamples(d,e,r+1,i)})},Nn.decryptAvcSamples=function(d,t,o,s){if(d instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,o=0){if(t>=d.length)return void s();for(var i=d[t].units,n;!(o>=i.length);o++)if(n=i[o],!(48>=n.data.length||1!==n.type&&5!==n.type||(this.decryptAvcSample(d,t,o,s,n),this.decrypter.isSync())))return}},Ti),Ri=188,Ai=function(){function C(a,t,e){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=a,this.config=t,this.typeSupported=e}C.probe=function(e){return e=C.syncOffset(e),0<e&&nt.warn("MPEG2-TS detected but first sync word found @ offset "+e),-1!==e},C.syncOffset=function(d){for(var t=d.length,e=Math.min(940,d.length-Ri)+1,l=0;l<e;){for(var u=!1,c=-1,f=0,g=l;g<t;g+=Ri){if(71!==d[g]){if(f)return-1;break}if(f++,-1===c&&0!==(c=g)&&(e=Math.min(c+18612,d.length-Ri)+1),(u=u||0===Di(d,g))&&1<f&&(0===c&&2<f||e<g+Ri))return c}l++}return-1},C.createTrack=function(a,t){return{container:"video"===a||"audio"===a?"video/mp2t":void 0,type:a,id:Et[a],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===a?t:void 0}};var e=C.prototype;return e.resetInitSegment=function(a,t,e,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=C.createTrack("video"),this._audioTrack=C.createTrack("audio",r),this._id3Track=C.createTrack("id3"),this._txtTrack=C.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=e,this._duration=r},e.resetTimeStamp=function(){},e.resetContiguity=function(){var a=this._audioTrack,t=this._avcTrack,e=this._id3Track;a&&(a.pesData=null),t&&(t.pesData=null),e&&(e.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},e.demux=function(I,_,e,x){var P;void 0===e&&(e=!1),void 0===x&&(x=!1),e||(this.sampleAes=null);var F=this._avcTrack,a=this._audioTrack,s=this._id3Track,o=this._txtTrack,l=F.pid,O=F.pesData,w=a.pid,M=s.pid,N=a.pesData,B=s.pesData,U=null,K=this.pmtParsed,H=this._pmtId,V=I.length;if(this.remainderData&&(V=(I=It(this.remainderData,I)).length,this.remainderData=null),V<Ri&&!x)return this.remainderData=I,{audioTrack:a,videoTrack:F,id3Track:s,textTrack:o};var Y=Math.max(0,C.syncOffset(I));(V-=(V-Y)%Ri)<I.byteLength&&!x&&(this.remainderData=new Uint8Array(I.buffer,V,I.buffer.byteLength-V));for(var T=0,W=Y,q;W<V;W+=Ri)if(71===I[W]){var z=!!(64&I[W+1]),R=Di(I,W),A=void 0;if(!(1<(48&I[W+3])>>4))A=W+4;else if((A=W+5+I[W+4])===W+Ri)continue;switch(R){case l:z&&(O&&(P=Ii(O))&&this.parseAVCPES(F,o,P,!1),O={data:[],size:0}),O&&(O.data.push(I.subarray(A,W+Ri)),O.size+=W+Ri-A);break;case w:if(z){if(N&&(P=Ii(N)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,P);break;case"mp3":this.parseMPEGPES(a,P);}N={data:[],size:0}}N&&(N.data.push(I.subarray(A,W+Ri)),N.size+=W+Ri-A);break;case M:z&&(B&&(P=Ii(B))&&this.parseID3PES(s,P),B={data:[],size:0}),B&&(B.data.push(I.subarray(A,W+Ri)),B.size+=W+Ri-A);break;case 0:z&&(A+=I[A]+1),H=this._pmtId=(31&(q=I)[(X=A)+10])<<8|q[X+11];break;case H:z&&(A+=I[A]+1);var X=function(d,t,o,r){var i={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},n=t+3+((15&d[t+1])<<8|d[t+2])-4;for(t+=12+((15&d[t+10])<<8|d[t+11]);t<n;){var a=Di(d,t);switch(d[t]){case 207:if(!r){nt.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===i.audio&&(i.audio=a);break;case 21:-1===i.id3&&(i.id3=a);break;case 219:if(!r){nt.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===i.avc&&(i.avc=a);break;case 3:case 4:!0!==o.mpeg&&!0!==o.mp3?nt.log("MPEG audio found, not supported in this browser"):-1===i.audio&&(i.audio=a,i.segmentCodec="mp3");break;case 36:nt.warn("Unsupported HEVC stream type found");}t+=5+((15&d[t+3])<<8|d[t+4])}return i}(I,A,this.typeSupported,e);0<(l=X.avc)&&(F.pid=l),0<(w=X.audio)&&(a.pid=w,a.segmentCodec=X.segmentCodec),0<(M=X.id3)&&(s.pid=M),null===U||K||(nt.warn("MPEG-TS PMT found at "+W+" after unknown PID '"+U+"'. Backtracking to sync byte @"+Y+" to parse all TS packets."),U=null,W=Y-188),K=this.pmtParsed=!0;break;case 17:case 8191:break;default:U=R;}}else T++;0<T&&(j=new Error("Found "+T+" TS packet/s that do not start with 0x47"),this.observer.emit(G.ERROR,G.ERROR,{type:rt.MEDIA_ERROR,details:it.FRAG_PARSING_ERROR,fatal:!1,error:j,reason:j.message})),F.pesData=O,a.pesData=N,s.pesData=B;var j={audioTrack:a,videoTrack:F,id3Track:s,textTrack:o};return x&&this.extractRemainingSamples(j),j},e.flush=function(){var e=this.remainderData;return this.remainderData=null,e=e?this.demux(e,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},e.extractRemainingSamples=function(d){var l=d.audioTrack,r=d.videoTrack,i=d.id3Track,n=d.textTrack,a=r.pesData,s=l.pesData,d=i.pesData,o;if(a&&(o=Ii(a))?(this.parseAVCPES(r,n,o,!0),r.pesData=null):r.pesData=a,s&&(o=Ii(s))){switch(l.segmentCodec){case"aac":this.parseAACPES(l,o);break;case"mp3":this.parseMPEGPES(l,o);}l.pesData=null}else null!=s&&s.size&&nt.log("last AAC PES packet truncated,might overlap between fragments"),l.pesData=s;d&&(o=Ii(d))?(this.parseID3PES(i,o),i.pesData=null):i.pesData=d},e.demuxSampleAes=function(a,t,n){return n=this.demux(a,n,!0,!this.config.progressive),t=this.sampleAes=new Li(this.observer,this.config,t),this.decrypt(n,t)},e.decrypt=function(a,i){return new Promise(function(n){var t=a.audioTrack,e=a.videoTrack;t.samples&&"aac"===t.segmentCodec?i.decryptAacSamples(t.samples,0,function(){e.samples?i.decryptAvcSamples(e.samples,0,0,function(){n(a)}):n(a)}):e.samples&&i.decryptAvcSamples(e.samples,0,0,function(){n(a)})})},e.destroy=function(){this._duration=0},e.parseAVCPES=function(g,o,l,a){var u=this,t=this.parseAVCNALu(g,l.data),d=this.avcSample,m=!1,p;l.data=null,d&&t.length&&!g.audFound&&(bi(d,g),d=this.avcSample=Si(!1,l.pts,l.dts,"")),t.forEach(function(c){switch(c.type){case 1:p=!0,(d=d||(u.avcSample=Si(!0,l.pts,l.dts,""))).frame=!0;var t=c.data;m&&4<t.length&&(2!==(f=new vi(t).readSliceType())&&4!==f&&7!==f&&9!==f||(d.key=!0));break;case 5:p=!0,(d=d||(u.avcSample=Si(!0,l.pts,l.dts,""))).key=!0,d.frame=!0;break;case 6:p=!0,Ct(c.data,1,l.pts,o.samples);break;case 7:if(m=p=!0,!g.sps){var t=c.data,f=new vi(t).readSPS();g.width=f.width,g.height=f.height,g.pixelRatio=f.pixelRatio,g.sps=[t],g.duration=u._duration;for(var y=t.subarray(1,4),i="avc1.",h=0,T;3>h;h++)T=y[h].toString(16),2>T.length&&(T="0"+T),i+=T;g.codec=i}break;case 8:p=!0,g.pps||(g.pps=[c.data]);break;case 9:p=!1,g.audFound=!0,d&&bi(d,g),d=u.avcSample=Si(!1,l.pts,l.dts,"");break;case 12:p=!0;break;default:p=!1,d&&(d.debug+="unknown NAL "+c.type+" ");}d&&p&&d.units.push(c)}),a&&d&&(bi(d,g),this.avcSample=null)},e.getLastNalUnit=function(a){var t=this.avcSample,n;return t&&0!==t.units.length||(t=a[a.length-1]),null!=t&&t.units&&(n=(n=t.units)[n.length-1]),n},e.parseAVCNALu=function(m,t){var e=t.byteLength,l=m.naluState||0,p=l,y=[],d=0,h=-1,T=0,E,S,L,R,v,A;for(-1===l&&(T=31&t[h=0],l=0,d=1);d<e;)E=t[d++],l=l?1===l?E?0:2:E?1===E?(0<=h?(R={data:t.subarray(h,d-l-1),type:T},y.push(R)):(L=this.getLastNalUnit(m.samples))&&(p&&d<=4-p&&L.state&&(L.data=L.data.subarray(0,L.data.byteLength-p)),0<(S=d-l-1))&&((R=new Uint8Array(L.data.byteLength+S)).set(L.data,0),R.set(t.subarray(0,S),L.data.byteLength),L.data=R,L.state=0),d<e?(T=31&t[h=d],0):-1):0:3:E?0:1;return 0<=h&&0<=l&&(A={data:t.subarray(h,e),type:T,state:l},y.push(A)),0!==y.length||(v=this.getLastNalUnit(m.samples))&&((A=new Uint8Array(v.data.byteLength+t.byteLength)).set(v.data,0),A.set(t,v.data.byteLength),v.data=A),m.naluState=l,y},e.parseAACPES=function(g,t){var m=0,p=this.aacOverFlow,o=t.data,y,T,E,S;for(p&&(this.aacOverFlow=null,L=p.missing,E=p.sample.unit.byteLength,-1===L?((S=new Uint8Array(E+o.byteLength)).set(p.sample.unit,0),S.set(o,E),o=S):(R=E-L,p.sample.unit.set(o.subarray(0,L),R),g.samples.push(p.sample),m=p.missing)),y=m,T=o.length;y<T-1&&!ri(o,y);y++);if(y!==m){var L=y<T-1,R=L?"AAC PES did not start with ADTS header,offset:"+y:"No ADTS header found in AAC PES",m=new Error(R);if(nt.warn("parsing error: "+R),this.observer.emit(G.ERROR,G.ERROR,{type:rt.MEDIA_ERROR,details:it.FRAG_PARSING_ERROR,fatal:!1,levelRetry:L,error:m,reason:R}),!L)return}if(ai(g,this.observer,o,y,this.audioCodec),void 0!==t.pts)v=t.pts;else{if(!p)return void nt.warn("[tsdemuxer]: AAC PES unknown PTS");var t=ni(g.samplerate),v=p.sample.pts+t}for(var A=0,k;y<T;){if(y+=(k=ii(g,o,y,v,A)).length,k.missing){this.aacOverFlow=k;break}for(A++;y<T-1&&!ri(o,y);y++);}},e.parseMPEGPES=function(d,t){var e=t.data,r=e.length,i=0,l=0,u=t.pts;if(void 0!==u){for(;l<r;)if(yi(e,l)){var s=si(d,e,l,u,i);if(!s)break;l+=s.length,i++}else l++;}else nt.warn("[tsdemuxer]: MPEG PES unknown PTS")},e.parseID3PES=function(a,t){void 0===t.pts?nt.warn("[tsdemuxer]: ID3 PES unknown PTS"):(t=qa({},t,{type:this._avcTrack?Te:fe,duration:Number.POSITIVE_INFINITY}),a.samples.push(t))},C}(),Dd=function(a){function r(){return a.apply(this,arguments)||this}Za(r,a);var t=r.prototype;return t.resetInitSegment=function(n,t,e,r){a.prototype.resetInitSegment.call(this,n,t,e,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}},r.probe=function(a){if(!a)return!1;for(var t=(tt(a,0)||[]).length,n=a.length;t<n;t++)if(function(a,t){if(t+1<a.length&&pi(a,t)){var e=li(a,t),r=4;return null!=e&&e.frameLength&&(r=e.frameLength),r=t+r,r===a.length||yi(a,r)}}(a,t))return nt.log("MPEG Audio sync word found !"),!0;return!1},t.canParse=function(a,t){return pi(a,t)&&4<=a.length-t},t.appendFrame=function(a,t,e){if(null!==this.basePTS)return si(a,t,e,this.basePTS,this.frameIndex)},r}(Ld),Id=(_i.getSilentFrame=function(a,t){return"mp4a.40.2"===a?1===t?new Uint8Array([0,200,0,128,35,128]):2===t?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):void 0:1===t?new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]):2===t||3===t?new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]):void 0},_i),xi=Math.pow(2,32)-1,Fi=(Ci.init=function(){for(var a in Ci.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})Ci.types.hasOwnProperty(a)&&(Ci.types[a]=[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)]);var t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Ci.HDLR_TYPES={video:t,audio:d};var o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);Ci.STTS=Ci.STSC=Ci.STCO=i,Ci.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Ci.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Ci.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Ci.STSD=new Uint8Array([0,0,0,0,0,0,0,1]),t=new Uint8Array([105,115,111,109]),d=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]),Ci.FTYP=Ci.box(Ci.types.ftyp,t,i,t,d),Ci.DINF=Ci.box(Ci.types.dinf,Ci.box(Ci.types.dref,o))},Ci.box=function(d){for(var t=8,l=arguments.length,r=Array(1<l?l-1:0),i=1;i<l;i++)r[i-1]=arguments[i];for(var u=r.length,c=u;u--;)t+=r[u].byteLength;var s=new Uint8Array(t);for(s[0]=255&t>>24,s[1]=255&t>>16,s[2]=255&t>>8,s[3]=255&t,s.set(d,4),u=0,t=8;u<c;u++)s.set(r[u],t),t+=r[u].byteLength;return s},Ci.hdlr=function(e){return Ci.box(Ci.types.hdlr,Ci.HDLR_TYPES[e])},Ci.mdat=function(e){return Ci.box(Ci.types.mdat,e)},Ci.mdhd=function(a,t){t*=a;var n=Math.floor(t/(1+xi)),t=Math.floor(t%(1+xi));return Ci.box(Ci.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&a>>24,255&a>>16,255&a>>8,255&a,n>>24,255&n>>16,255&n>>8,255&n,t>>24,255&t>>16,255&t>>8,255&t,85,196,0,0]))},Ci.mdia=function(e){return Ci.box(Ci.types.mdia,Ci.mdhd(e.timescale,e.duration),Ci.hdlr(e.type),Ci.minf(e))},Ci.mfhd=function(e){return Ci.box(Ci.types.mfhd,new Uint8Array([0,0,0,0,e>>24,255&e>>16,255&e>>8,255&e]))},Ci.minf=function(e){return"audio"===e.type?Ci.box(Ci.types.minf,Ci.box(Ci.types.smhd,Ci.SMHD),Ci.DINF,Ci.stbl(e)):Ci.box(Ci.types.minf,Ci.box(Ci.types.vmhd,Ci.VMHD),Ci.DINF,Ci.stbl(e))},Ci.moof=function(a,t,e){return Ci.box(Ci.types.moof,Ci.mfhd(a),Ci.traf(e,t))},Ci.moov=function(a){for(var t=a.length,n=[];t--;)n[t]=Ci.trak(a[t]);return Ci.box.apply(null,[Ci.types.moov,Ci.mvhd(a[0].timescale,a[0].duration)].concat(n).concat(Ci.mvex(a)))},Ci.mvex=function(a){for(var t=a.length,n=[];t--;)n[t]=Ci.trex(a[t]);return Ci.box.apply(null,[Ci.types.mvex].concat(n))},Ci.mvhd=function(a,t){t*=a;var n=Math.floor(t/(1+xi)),t=Math.floor(t%(1+xi)),t=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&a>>24,255&a>>16,255&a>>8,255&a,n>>24,255&n>>16,255&n>>8,255&n,t>>24,255&t>>16,255&t>>8,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Ci.box(Ci.types.mvhd,t)},Ci.sdtp=function(a){for(var t=a.samples||[],r=new Uint8Array(4+t.length),i=0,d;i<t.length;i++)d=t[i].flags,r[i+4]=d.dependsOn<<4|d.isDependedOn<<2|d.hasRedundancy;return Ci.box(Ci.types.sdtp,r)},Ci.stbl=function(e){return Ci.box(Ci.types.stbl,Ci.stsd(e),Ci.box(Ci.types.stts,Ci.STTS),Ci.box(Ci.types.stsc,Ci.STSC),Ci.box(Ci.types.stsz,Ci.STSZ),Ci.box(Ci.types.stco,Ci.STCO))},Ci.avc1=function(d){for(var t=[],c=[],f=0,g,m;f<d.sps.length;f++)m=(g=d.sps[f]).byteLength,t.push(255&m>>>8),t.push(255&m),t=t.concat(Array.prototype.slice.call(g));for(f=0;f<d.pps.length;f++)m=(g=d.pps[f]).byteLength,c.push(255&m>>>8),c.push(255&m),c=c.concat(Array.prototype.slice.call(g));var p=Ci.box(Ci.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|d.sps.length].concat(t).concat([d.pps.length]).concat(c))),s=d.width,o=d.height,l=d.pixelRatio[0],u=d.pixelRatio[1];return Ci.box(Ci.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255&s>>8,255&s,255&o>>8,255&o,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),p,Ci.box(Ci.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Ci.box(Ci.types.pasp,new Uint8Array([l>>24,255&l>>16,255&l>>8,255&l,u>>24,255&u>>16,255&u>>8,255&u])))},Ci.esds=function(a){var t=a.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(a.config).concat([6,1,2]))},Ci.mp4a=function(a){var t=a.samplerate;return Ci.box(Ci.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,a.channelCount,0,16,0,0,0,0,255&t>>8,255&t,0,0]),Ci.box(Ci.types.esds,Ci.esds(a)))},Ci.mp3=function(a){var t=a.samplerate;return Ci.box(Ci.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,a.channelCount,0,16,0,0,0,0,255&t>>8,255&t,0,0]))},Ci.stsd=function(e){return"audio"===e.type?"mp3"===e.segmentCodec&&"mp3"===e.codec?Ci.box(Ci.types.stsd,Ci.STSD,Ci.mp3(e)):Ci.box(Ci.types.stsd,Ci.STSD,Ci.mp4a(e)):Ci.box(Ci.types.stsd,Ci.STSD,Ci.avc1(e))},Ci.tkhd=function(a){var d=a.id,e=a.duration*a.timescale,o=a.width,i=a.height,a=Math.floor(e/(1+xi)),e=Math.floor(e%(1+xi));return Ci.box(Ci.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&d>>24,255&d>>16,255&d>>8,255&d,0,0,0,0,a>>24,255&a>>16,255&a>>8,255&a,e>>24,255&e>>16,255&e>>8,255&e,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,255&o>>8,255&o,0,0,255&i>>8,255&i,0,0]))},Ci.traf=function(a,t){var d=Ci.sdtp(a),r=a.id,i=Math.floor(t/(1+xi)),t=Math.floor(t%(1+xi));return Ci.box(Ci.types.traf,Ci.box(Ci.types.tfhd,new Uint8Array([0,0,0,0,r>>24,255&r>>16,255&r>>8,255&r])),Ci.box(Ci.types.tfdt,new Uint8Array([1,0,0,0,i>>24,255&i>>16,255&i>>8,255&i,t>>24,255&t>>16,255&t>>8,255&t])),Ci.trun(a,d.length+16+20+8+16+8+8),d)},Ci.trak=function(e){return e.duration=e.duration||4294967295,Ci.box(Ci.types.trak,Ci.tkhd(e),Ci.mdia(e))},Ci.trex=function(e){return e=e.id,Ci.box(Ci.types.trex,new Uint8Array([0,0,0,0,e>>24,255&e>>16,255&e>>8,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},Ci.trun=function(d,t){var c=d.samples||[],o=c.length,l=12+16*o,u=new Uint8Array(l),f,g,m,p,y;for(t+=8+l,u.set(["video"===d.type?1:0,0,15,1,255&o>>>24,255&o>>>16,255&o>>>8,255&o,255&t>>>24,255&t>>>16,255&t>>>8,255&t],0),f=0;f<o;f++)g=(y=c[f]).duration,m=y.size,p=y.flags,y=y.cts,u.set([255&g>>>24,255&g>>>16,255&g>>>8,255&g,255&m>>>24,255&m>>>16,255&m>>>8,255&m,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,61440&p.degradPrio,15&p.degradPrio,255&y>>>24,255&y>>>16,255&y>>>8,255&y],12+16*f);return Ci.box(Ci.types.trun,u)},Ci.initSegment=function(a){Ci.types||Ci.init();var r=Ci.moov(a),a=new Uint8Array(Ci.FTYP.byteLength+r.byteLength);return a.set(Ci.FTYP),a.set(r,Ci.FTYP.byteLength),a},Ci),Mi,bd,Cd,_d;Fi.types=void 0,Fi.HDLR_TYPES=void 0,Fi.STTS=void 0,Fi.STSC=void 0,Fi.STCO=void 0,Fi.STSZ=void 0,Fi.VMHD=void 0,Fi.SMHD=void 0,Fi.STSD=void 0,Fi.FTYP=void 0,Fi.DINF=void 0;var xd=null,Pd=null,yr=((C=Ni.prototype).destroy=function(){},C.resetTimeStamp=function(e){nt.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},C.resetNextTimestamp=function(){nt.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},C.resetInitSegment=function(){nt.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},C.getVideoStartPts=function(e){var a=!1,e=e.reduce(function(n,t){var e=t.pts-n;return-4294967296>e?(a=!0,Bi(n,t.pts)):0<e?n:t.pts},e[0].pts);return a&&nt.debug("PTS rollover detected"),e},C.remux=function(L,t,e,r,i,n,a,R){var o=i,A=i,k=-1<L.pid,D=-1<t.pid,y=t.samples.length,I=0<L.samples.length,E=a&&0<y||1<y,S,b,C,_,x,P,F;return(k&&!I||D&&!E)&&!this.ISGenerated&&!a||(this.ISGenerated||(b=this.generateIS(L,t,i,n)),k=this.isVideoContiguous,a=-1,E&&(a=function(a){for(var t=0;t<a.length;t++)if(a[t].key)return t;return-1}(t.samples),!k&&this.config.forceKeyFrameOnDiscontinuity)&&(x=!0,0<a?(nt.warn("[mp4-remuxer]: Dropped "+a+" out of "+y+" video samples due to a missing keyframe"),P=this.getVideoStartPts(t.samples),t.samples=t.samples.slice(a),t.dropped+=a,P=A+=(t.samples[0].pts-P)/t.inputTimeScale):-1===a&&(nt.warn("[mp4-remuxer]: No keyframe found out of "+y+" video samples"),x=!1)),this.ISGenerated&&(I&&E&&(y=this.getVideoStartPts(t.samples),y=(Bi(L.samples[0].pts,y)-y)/t.inputTimeScale,o+=Math.max(0,y),A+=Math.max(0,-y)),I?(L.samplerate||(nt.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),b=this.generateIS(L,t,i,n)),S=this.remuxAudio(L,o,this.isAudioContiguous,n,D||E||R===le?A:void 0),E&&(F=S?S.endPTS-S.startPTS:0,t.inputTimeScale||(nt.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),b=this.generateIS(L,t,i,n)),F=this.remuxVideo(t,A,k,F))):E&&(F=this.remuxVideo(t,A,k,0)),F&&(F.firstKeyFrame=a,F.independent=-1!==a,F.firstKeyFramePTS=P))),this.ISGenerated&&this._initPTS&&this._initDTS&&(e.samples.length&&(_=Ui(e,i,this._initPTS,this._initDTS)),r.samples.length&&(C=Hi(r,i,this._initPTS))),{audio:S,video:F,initSegment:b,independent:x,text:C,id3:_}},C.generateIS=function(f,t,e,g){var m=f.samples,o=t.samples,l=this.typeSupported,u={},p=this._initPTS,y=!p||g,g="audio/mp4",h,T,E;if(y&&(E=T=1/0),f.config&&m.length&&(f.timescale=f.samplerate,"mp3"===f.segmentCodec&&(l.mpeg?(g="audio/mpeg",f.codec=""):l.mp3&&(f.codec="mp3")),u.audio={id:"audio",container:g,codec:f.codec,initSegment:"mp3"===f.segmentCodec&&l.mpeg?new Uint8Array(0):Fi.initSegment([f]),metadata:{channelCount:f.channelCount}},y&&(h=f.inputTimeScale,p&&h===p.timescale?y=!1:E=T=m[0].pts-Math.round(h*e))),t.sps&&t.pps&&o.length&&(t.timescale=t.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Fi.initSegment([t]),metadata:{width:t.width,height:t.height}},y)&&(h=t.inputTimeScale,p&&h===p.timescale?y=!1:(p=this.getVideoStartPts(o),e=Math.round(h*e),T=Math.min(T,Bi(o[0].dts,p)-e),E=Math.min(E,p-e))),Object.keys(u).length)return this.ISGenerated=!0,y?(this._initPTS={baseTime:E,timescale:h},this._initDTS={baseTime:T,timescale:h}):E=h=void 0,{tracks:u,initPTS:E,timescale:h}},C.remuxVideo=function(ee,t,te,ae){var i=ee.inputTimeScale,a=ee.samples,s=[],o=a.length,l=this._initPTS,re=this.nextAvcDts,ne=8,ie=this.videoSampleDuration,de=Number.POSITIVE_INFINITY,oe=Number.NEGATIVE_INFINITY,se=!1,le;te&&null!==re||(re=t*i-(a[0].pts-Bi(a[0].dts,a[0].pts)));for(var ue=l.baseTime*i/l.timescale,v=0,ce;v<o;v++)ce=a[v],ce.pts=Bi(ce.pts-ue,re),ce.dts=Bi(ce.dts-ue,re),ce.dts<a[0<v?v-1:v].dts&&(se=!0);se&&a.sort(function(a,t){var n=a.dts-t.dts,t=a.pts-t.pts;return n||t}),le=a[0].dts;var l=(t=a[a.length-1].dts)-le,fe=l?Math.round(l/(o-1)):ie||ee.inputTimeScale/30;te&&(l=-1>(Ae=le-re),((te=fe<Ae)||l)&&(te?nt.warn("AVC: "+wi(Ae,!0)+" ms ("+Ae+"dts) hole between fragments detected, filling it"):nt.warn("AVC: "+wi(-Ae,!0)+" ms ("+Ae+"dts) overlapping between fragments detected"),!l||re>=a[0].pts)&&(le=re,l=a[0].pts-Ae,a[0].dts=le,a[0].pts=l,nt.log("Video: First PTS/DTS adjusted: "+wi(l,!0)+"/"+wi(le,!0)+", delta: "+wi(Ae,!0)+" ms"))),le=Math.max(0,le);for(var T=0,ge=0,me=0;me<o;me++){for(var pe=a[me],R=pe.units,A=R.length,k=0,ye=0;ye<A;ye++)k+=R[ye].data.length;ge+=k,T+=A,pe.length=k,pe.dts=Math.max(pe.dts,le),de=Math.min(pe.pts,de),oe=Math.max(pe.pts,oe)}t=a[o-1].dts;var he=ge+4*T+8,w;try{w=new Uint8Array(he)}catch(e){return void this.observer.emit(G.ERROR,G.ERROR,{type:rt.MUX_ERROR,details:it.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:he,reason:"fail allocating video mdat "+he})}var Te=new DataView(w.buffer);Te.setUint32(0,he),w.set(Fi.types.mdat,4);for(var C=!1,Ee=Number.POSITIVE_INFINITY,Se=Number.POSITIVE_INFINITY,Le=Number.NEGATIVE_INFINITY,Re=Number.NEGATIVE_INFINITY,ve=0,Ae;ve<o;ve++){for(var ke=a[ve],U=ke.units,B=0,De=0,Ie=U.length;De<Ie;De++){var H=U[De],be=H.data,H=H.data.byteLength;Te.setUint32(ne,H),ne+=4,w.set(be,ne),ne+=H,B+=4+H}var Y=void 0,Ce,_e;ve<o-1?(ie=a[ve+1].dts-ke.dts,Y=a[ve+1].pts-ke.pts):(Ce=this.config,xe=0<ve?ke.dts-a[ve-1].dts:fe,Y=0<ve?ke.pts-a[ve-1].pts:fe,Ce.stretchShortVideoTrack&&null!==this.nextAudioPts&&Math.floor(Ce.maxBufferHole*i)<(_e=(ae?de+ae*i:this.nextAudioPts)-ke.pts)?(0>(ie=_e-xe)?ie=xe:C=!0,nt.log("[mp4-remuxer]: It is approximately "+_e/90+" ms to the next segment; using duration "+ie/90+" ms for the last video frame.")):ie=xe);var xe=Math.round(ke.pts-ke.dts),Ee=Math.min(Ee,ie),Le=Math.max(Le,ie),Se=Math.min(Se,Y),Re=Math.max(Re,Y);s.push(new Fd(ke.key,ie,B,xe))}if(s.length)if(xd)70>xd&&((Ae=s[0].flags).dependsOn=2,Ae.isNonSync=0);else if(Pd&&Re-Se<Le-Ee&&.025>fe/Le&&0===s[0].cts){nt.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Pe=le,Fe=0,Oe=s.length;Fe<Oe;Fe++){var $=Pe+s[Fe].duration,Z=Pe+s[Fe].cts,we;Fe<Oe-1?(we=$+s[Fe+1].cts,s[Fe].duration=we-Z):s[Fe].duration=Fe?s[Fe-1].duration:fe,s[Fe].cts=0,Pe=$}}return ie=C||!ie?fe:ie,this.nextAvcDts=re=t+ie,this.videoSampleDuration=ie,this.isVideoContiguous=!0,t={data1:Fi.moof(ee.sequenceNumber++,le,qa({},ee,{samples:s})),data2:w,startPTS:de/i,endPTS:(oe+ie)/i,startDTS:le/i,endDTS:re/i,type:"video",hasAudio:!1,hasVideo:!0,nb:s.length,dropped:ee.dropped},(ee.samples=[],ee.dropped=0,t)},C.remuxAudio=function(B,t,e,U,K){var H=B.inputTimeScale,a=H/(B.samplerate||H),s="aac"===B.segmentCodec?1024:1152,o=s*a,l=this._initPTS,V="mp3"===B.segmentCodec&&this.typeSupported.mpeg,h=[],d=void 0!==K,c=B.samples,Y=V?0:8,W=this.nextAudioPts||-1,q=t*H,v=l.baseTime*H/l.timescale;if(this.isAudioContiguous=e=e||c.length&&0<W&&(U&&9e3>Math.abs(q-W)||Math.abs(Bi(c[0].pts-v,q)-W)<20*o),c.forEach(function(e){e.pts=Bi(e.pts-v,q)}),!e||0>W){if(!(c=c.filter(function(e){return 0<=e.pts})).length)return;W=0===K?0:U&&!d?Math.max(0,q):c[0].pts}if("aac"===B.segmentCodec)for(var p=this.config.maxAudioFramesDrift,y=0,z=W;y<c.length;y++){var X=c[y],S=X.pts,L=S-z,R=Math.abs(1e3*L/H);if(L<=-p*o&&d)0===y&&(nt.warn("Audio frame @ "+(S/H).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*L/H)+" ms."),this.nextAudioPts=W=z=S);else if(p*o<=L&&1e4>R&&d){var A=Math.round(L/o);0>(z=S-A*o)&&(A--,z+=o),0===y&&(this.nextAudioPts=W=z),nt.warn("[mp4-remuxer]: Injecting "+A+" audio frame @ "+(z/H).toFixed(3)+"s due to "+Math.round(1e3*L/H)+" ms gap.");for(var j=0;j<A;j++){var Q=Math.max(z,0),D=Id.getSilentFrame(B.manifestCodec||B.codec,B.channelCount);D||(nt.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),D=X.unit.subarray()),c.splice(y,0,{unit:D,pts:Q}),z+=o,y++}}X.pts=z,z+=o}for(var Z=null,$=null,J=0,ee=c.length,te;ee--;)J+=c[ee].unit.byteLength;for(var ae=0,re=c.length;ae<re;ae++){var M=c[ae],ne=M.unit,M=M.pts;if(null!==$)h[ae-1].duration=Math.round((M-$)/a);else{if(e&&"aac"===B.segmentCodec&&(M=W),Z=M,!(0<J))return;J+=Y;try{te=new Uint8Array(J)}catch(e){return void this.observer.emit(G.ERROR,G.ERROR,{type:rt.MUX_ERROR,details:it.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:J,reason:"fail allocating audio mdat "+J})}V||(new DataView(te.buffer).setUint32(0,J),te.set(Fi.types.mdat,4))}te.set(ne,Y),ne=ne.byteLength,Y+=ne,h.push(new Fd(!0,s,ne,0)),$=M}if(l=h.length,l)return K=h[h.length-1],this.nextAudioPts=W=$+a*K.duration,U=Z/H,K=W/H,l={data1:V?new Uint8Array(0):Fi.moof(B.sequenceNumber++,Z/a,qa({},B,{samples:h})),data2:te,startPTS:U,endPTS:K,startDTS:U,endDTS:K,type:"audio",hasAudio:!0,hasVideo:!(B.samples=[]),nb:l},(this.isAudioContiguous=!0,l)},C.remuxEmptyAudio=function(m,t,e,r){var i=m.inputTimeScale,n=i/(m.samplerate||i),a=this.nextAudioPts,s=this._initDTS,s=9e4*s.baseTime/s.timescale,p=(null===a?r.startDTS*i:a)+s,s=r.endDTS*i+s,l=1024*n,u=Math.ceil((s-p)/l),y=Id.getSilentFrame(m.manifestCodec||m.codec,m.channelCount);if(nt.warn("[mp4-remuxer]: remux empty Audio"),y){for(var d=[],c=0,h;c<u;c++)h=p+c*l,d.push({unit:y,pts:h,dts:h});return m.samples=d,this.remuxAudio(m,t,e,!1)}nt.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},Ni),Fd=function(a,t,e,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=e,this.cts=r,this.flags=new qi(a)},qi=function(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1},Xi=((Yn=Vi.prototype).destroy=function(){},Yn.resetTimeStamp=function(e){this.initPTS=e,this.lastEndTime=null},Yn.resetNextTimestamp=function(){this.lastEndTime=null},Yn.resetInitSegment=function(a,t,e,r){this.audioCodec=t,this.videoCodec=e,this.generateInitSegment(function(e){if(!e||!r)return e;var a=r.keyId;return a&&r.isCommonEncryption&&At(e,["moov","trak"]).forEach(function(n){var i=At(n,["mdia","minf","stbl","stsd"])[0].subarray(8),n=At(i,["enca"]),d=0<n.length;d||(n=At(i,["encv"])),n.forEach(function(e){At(d?e.subarray(28):e.subarray(78),["sinf"]).forEach(function(r){var n=Dt(r);n&&((r=n.subarray(8,24)).some(function(e){return 0!==e})||(nt.log("[eme] Patching keyId in 'enc"+(d?"a":"v")+">sinf>>tenc' box: "+lt(r)+" -> "+lt(a)),n.set(a,8)))})})}),e}(a)),this.emitInitSegment=!0},Yn.generateInitSegment=function(a){var t=this.audioCodec,d=this.videoCodec;if(null==a||!a.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var o=this.initData=kt(a),t=t||Yi(o.audio,A),d=d||Yi(o.video,I),i={};o.audio&&o.video?i.audiovideo={container:"video/mp4",codec:t+","+d,initSegment:a,id:"main"}:o.audio?i.audio={container:"audio/mp4",codec:t,initSegment:a,id:"audio"}:o.video?i.video={container:"video/mp4",codec:d,initSegment:a,id:"main"}:nt.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i},Yn.remux=function(p,y,T,r,i,n){var E=this.initPTS,S=this.lastEndTime,L={audio:void 0,video:void 0,text:r,id3:T,initSegment:void 0};yd(S)||(S=this.lastEndTime=i||0);var l=y.samples;if(null==l||!l.length)return L;var u={initPTS:void 0,timescale:1},h=this.initData;if(null!=h&&h.length||(this.generateInitSegment(l),h=this.initData),null==h||!h.length)return nt.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),L;this.emitInitSegment&&(u.tracks=this.initTracks,this.emitInitSegment=!1);var R=function(E,t){for(var e=0,S=0,L=0,R=At(E,["moof","traf"]),a=0;a<R.length;a++){var k=R[a],o=At(k,["tfhd"])[0],l=t[ht(o,4)];if(l){var u=l.default,h=ht(o,0)|(null==u?void 0:u.flags),d=null==u?void 0:u.duration;8&h&&(d=ht(o,2&h?12:8));for(var D=l.timescale||9e4,f=At(k,["trun"]),g=0;g<f.length;g++)!(e=function(d){var t=ht(d,0),e=8;1&t&&(e+=4),4&t&&(e+=4);for(var o=0,s=ht(d,4),n=0;n<s;n++)256&t&&(o+=ht(d,e),e+=4),512&t&&(e+=4),1024&t&&(e+=4),2048&t&&(e+=4);return o}(f[g]))&&d&&(e=d*ht(f[g],4)),l.type===I?S+=e/D:l.type===A&&(L+=e/D)}}if(0!=S||0!==L)return S||L;for(var b=0,C=At(E,["sidx"]),p=0,_;p<C.length;p++)_=function(d){var t=[],e=d[0],r=8,c=ht(d,r);r+=4,r+=0===e?8:16,r+=2;var n=d.length+0,f=yt(d,r);r+=2;for(var s=0;s<f;s++){var g=r,m=ht(d,g);g+=4;var p=2147483647&m;if(1==(2147483648&m)>>>31)return nt.warn("SIDX has hierarchical references (not supported)"),null;m=ht(d,g),g+=4,t.push({referenceSize:p,subsegmentDuration:m,info:{duration:m/c,start:n,end:n+p-1}}),n+=p,r=g+=4}return{earliestPresentationTime:0,timescale:c,version:e,referencesCount:f,references:t}}(C[p]),null!=_&&_.references&&(b+=_.references.reduce(function(a,t){return a+t.info.duration||0},0));return b}(l,h),y=(f=h,At(l,["moof","traf"]).reduce(function(a,t){var d=At(t,["tfdt"])[0],i=d[0],t=At(t,["tfhd"]).reduce(function(a,t){var n=ht(t,4),t=f[n];if(t){if(n=ht(d,4),1===i){if(n===pt)return nt.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),a;n*=1+pt,n+=ht(d,8)}if(t=n/(t.timescale||9e4),isFinite(t)&&(null===a||t<a))return t}return a},null);return null!==t&&isFinite(t)&&(null===a||t<a)?t:a},null)),y=null===y?i:y,f;((function(a,n,e){if(null===a)return 1;var r=Math.max(R,1),a=n-a.baseTime/a.timescale;return Math.abs(a-e)>r})(E,y,i)||u.timescale!==E.timescale&&n)&&(u.initPTS=y-i,E&&1===E.timescale&&nt.warn("Adjusting initPTS by "+(u.initPTS-E.baseTime)),this.initPTS=E={baseTime:u.initPTS,timescale:1});var n=p?y-E.baseTime/E.timescale:S,p=n+R,v,k;return v=h,k=E.baseTime/E.timescale,At(l,["moof","traf"]).forEach(function(a){At(a,["tfhd"]).forEach(function(e){var e=ht(e,4),e=v[e],n;e&&(n=e.timescale||9e4,At(a,["tfdt"]).forEach(function(a){var t=a[0],i=ht(a,4);0===t?(i-=k*n,Rt(a,4,i=Math.max(i,0))):(i*=Math.pow(2,32),i+=ht(a,8),i-=k*n,i=Math.max(i,0),t=Math.floor(i/(1+pt)),i=Math.floor(i%(1+pt)),Rt(a,4,t),Rt(a,8,i))}))})}),0<R?this.lastEndTime=p:(nt.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp()),y=!!h.audio,S=!!h.video,h="",y&&(h+="audio"),S&&(h+="video"),S={data1:l,startPTS:n,startDTS:n,endPTS:p,endDTS:p,type:h,hasAudio:y,hasVideo:S,nb:1,dropped:0},(L.audio="audio"===S.type?S:void 0,L.video="audio"===S.type?void 0:S,L.initSegment=u,L.id3=Ui(T,i,E,E),r.samples.length&&(L.text=Hi(r,i,E)),L)},Vi),Od;try{Od=self.performance.now.bind(self.performance)}catch(e){nt.debug("Unable to use Performance API on this environment"),Od="undefined"!=typeof self&&self.Date.now}var wd=[{demux:vd,remux:Xi},{demux:Ai,remux:yr},{demux:ti,remux:yr},{demux:Dd,remux:yr}],Ji=((ld=Wi.prototype).configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},ld.push=function(T,E,e,r){var S=this,n=e.transmuxing;n.executeStart=Od();var a=new Uint8Array(T),L=this.currentTransmuxState,R=this.transmuxConfig;r&&(this.currentTransmuxState=r);var A=r||L,k=A.contiguous,h=A.discontinuity,d=A.trackSwitch,c=A.accurateTimeOffset,D=A.timeOffset,I=A.initSegmentChange,m=R.audioCodec,T=R.videoCodec,r=R.defaultInitPts,L=R.duration,A=R.initSegmentData,R=(R=null,0<a.byteLength&&null!=E&&null!=E.key&&null!==E.iv&&null!=E.method&&(R=E),R);if(R&&"AES-128"===R.method){var v=this.getDecrypter();if(!v.isSync())return this.decryptionPromise=v.webCryptoDecrypt(a,R.key.buffer,R.iv.buffer).then(function(a){return a=S.push(a,null,e),S.decryptionPromise=null,a}),this.decryptionPromise;var b=v.softwareDecrypt(a,R.key.buffer,R.iv.buffer);if(-1<e.part&&(b=v.flush()),!b)return n.executeEnd=Od(),Zi(e);a=new Uint8Array(b)}return(v=this.needsProbing(h,d),v&&(b=this.configureTransmuxer(a),b))?(nt.warn("[transmuxer] "+b.message),this.observer.emit(G.ERROR,G.ERROR,{type:rt.MEDIA_ERROR,details:it.FRAG_PARSING_ERROR,fatal:!1,error:b,reason:b.message}),n.executeEnd=Od(),Zi(e)):((h||d||I||v)&&this.resetInitSegment(A,m,T,L,E),(h||I||v)&&this.resetInitialTimestamp(r),k||this.resetContiguity(),D=this.transmux(a,R,D,c,e),c=this.currentTransmuxState,(c.contiguous=!0,c.discontinuity=!1,c.trackSwitch=!1,n.executeEnd=Od(),D))},ld.flush=function(d){var e=this,r=d.transmuxing;r.executeStart=Od();var t=this.decrypter,l=this.currentTransmuxState,u=this.decryptionPromise;if(u)return u.then(function(){return e.flush(d)});var a=[],l=l.timeOffset;!t||(s=t.flush())&&a.push(this.push(s,null,d));var t=this.demuxer,s=this.remuxer;return t&&s?(l=t.flush(l),en(l)?l.then(function(r){return e.flushRemux(a,r,d),a}):(this.flushRemux(a,l,d),a)):(r.executeEnd=Od(),[Zi(d)])},ld.flushRemux=function(d,t,l){var r=t.audioTrack,i=t.videoTrack,n=t.id3Track,a=t.textTrack,s=this.currentTransmuxState,t=s.accurateTimeOffset,s=s.timeOffset;nt.log("[transmuxer.ts]: Flushed fragment "+l.sn+(-1<l.part?" p: "+l.part:"")+" of level "+l.level),t=this.remuxer.remux(r,i,n,a,s,t,!0,this.id),d.push({remuxResult:t,chunkMeta:l}),l.transmuxing.executeEnd=Od()},ld.resetInitialTimestamp=function(a){var t=this.demuxer,e=this.remuxer;t&&e&&(t.resetTimeStamp(a),e.resetTimeStamp(a))},ld.resetContiguity=function(){var a=this.demuxer,t=this.remuxer;a&&t&&(a.resetContiguity(),t.resetNextTimestamp())},ld.resetInitSegment=function(d,t,e,r,i){var n=this.demuxer,a=this.remuxer;n&&a&&(n.resetInitSegment(d,t,e,r),a.resetInitSegment(d,t,e,i))},ld.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},ld.transmux=function(a,t,e,r,i){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(a,t,e,r,i):this.transmuxUnencrypted(a,e,r,i)},ld.transmuxUnencrypted=function(d,o,e,r){var i=this.demuxer.demux(d,o,!1,!this.config.progressive),l=i.audioTrack,a=i.videoTrack,d=i.id3Track,i=i.textTrack;return{remuxResult:this.remuxer.remux(l,a,d,i,o,e,!1,this.id),chunkMeta:r}},ld.transmuxSampleAes=function(d,t,e,r,i){var n=this;return this.demuxer.demuxSampleAes(d,t,e).then(function(a){return{remuxResult:n.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,e,r,!1,n.id),chunkMeta:i}})},ld.configureTransmuxer=function(c){for(var t=this.config,r=this.observer,i=this.typeSupported,n=this.vendor,a=0,f=wd.length,o;a<f;a++)if(wd[a].demux.probe(c)){o=wd[a];break}if(!o)return new Error("Failed to find demuxer by probing fragment data");var g=this.demuxer,l=this.remuxer,u=o.remux,m=o.demux;l&&l instanceof u||(this.remuxer=new u(r,t,i,n)),g&&g instanceof m||(this.demuxer=new m(r,t,i),this.probe=m.probe)},ld.needsProbing=function(a,t){return!this.demuxer||!this.remuxer||a||t},ld.getDecrypter=function(){return this.decrypter||(this.decrypter=new Pr(this.config))},Wi),Zi=function(e){return{remuxResult:{},chunkMeta:e}},tn={exports:{}},ln,Md;Nn=tn,ln=Object.prototype.hasOwnProperty,Md="~",Object.create&&(an.prototype=Object.create(null),new an().__proto__||(Md=!1)),cn.prototype.eventNames=function(){var a=[],r,n;if(0===this._eventsCount)return a;for(n in r=this._events)ln.call(r,n)&&a.push(Md?n.slice(1):n);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(r)):a},cn.prototype.listeners=function(a){var a=Md?Md+a:a,d=this._events[a];if(!d)return[];if(d.fn)return[d.fn];for(var e=0,o=d.length,i=Array(o);e<o;e++)i[e]=d[e].fn;return i},cn.prototype.listenerCount=function(e){return e=Md?Md+e:e,e=this._events[e],e?e.fn?1:e.length:0},cn.prototype.emit=function(f,t,e,r,i,n){var a=Md?Md+f:f;if(!this._events[a])return!1;var s=this._events[a],l=arguments.length,u;if(s.fn){switch(s.once&&this.removeListener(f,s.fn,void 0,!0),l){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,t),!0;case 3:return s.fn.call(s.context,t,e),!0;case 4:return s.fn.call(s.context,t,e,r),!0;case 5:return s.fn.call(s.context,t,e,r,i),!0;case 6:return s.fn.call(s.context,t,e,r,i,n),!0;}for(d=1,u=Array(l-1);d<l;d++)u[d-1]=arguments[d];s.fn.apply(s.context,u)}else for(var g=s.length,d=0,m;d<g;d++)switch(s[d].once&&this.removeListener(f,s[d].fn,void 0,!0),l){case 1:s[d].fn.call(s[d].context);break;case 2:s[d].fn.call(s[d].context,t);break;case 3:s[d].fn.call(s[d].context,t,e);break;case 4:s[d].fn.call(s[d].context,t,e,r);break;default:if(!u)for(m=1,u=Array(l-1);m<l;m++)u[m-1]=arguments[m];s[d].fn.apply(s[d].context,u);}return!0},cn.prototype.on=function(a,t,e){return hn(this,a,t,e,!1)},cn.prototype.once=function(a,t,e){return hn(this,a,t,e,!0)},cn.prototype.removeListener=function(d,l,e,r){if(d=Md?Md+d:d,!this._events[d])return this;if(!l)return dn(this,d),this;var i=this._events[d];if(i.fn)i.fn!==l||r&&!i.once||e&&i.context!==e||dn(this,d);else{for(var n=0,u=[],s=i.length;n<s;n++)(i[n].fn!==l||r&&!i[n].once||e&&i[n].context!==e)&&u.push(i[n]);u.length?this._events[d]=1===u.length?u[0]:u:dn(this,d)}return this},cn.prototype.removeAllListeners=function(e){return e?(e=Md?Md+e:e,this._events[e]&&dn(this,e)):(this._events=new an,this._eventsCount=0),this},cn.prototype.off=cn.prototype.removeListener,cn.prototype.addListener=cn.prototype.on,cn.prefixed=Md,cn.EventEmitter=cn,Nn.exports=cn;var Nd=(pn=tn.exports)&&pn.__esModule&&Object.prototype.hasOwnProperty.call(pn,"default")?pn.default:pn,pn,Bd,Ud;void 0!==R&&R&&(Bd=self,(Ud=new Nd).on(G.FRAG_DECRYPTED,En),Ud.on(G.ERROR,En),Bd.addEventListener("message",function(a){var d=a.data;switch(d.cmd){case"init":var e=JSON.parse(d.config);Bd.transmuxer=new Ji(Ud,d.typeSupported,e,d.vendor,d.id),td(e.debug,d.id),Sn(),En("init",null);break;case"configure":Bd.transmuxer.configure(d.config);break;case"demux":var t=Bd.transmuxer.push(d.data,d.decryptdata,d.chunkMeta,d.state);en(t)?(Bd.transmuxer.async=!0,t.then(function(e){fn(Bd,e)}).catch(function(e){En(G.ERROR,{type:rt.MEDIA_ERROR,details:it.FRAG_PARSING_ERROR,chunkMeta:d.chunkMeta,fatal:!1,error:e,err:e,reason:"transmuxer-worker push error"})})):(Bd.transmuxer.async=!1,fn(Bd,t));break;case"flush":var r=d.chunkMeta,t=Bd.transmuxer.flush(r);en(t)||Bd.transmuxer.async?(en(t)||(t=Promise.resolve(t)),t.then(function(e){Tn(Bd,e,r)}).catch(function(e){En(G.ERROR,{type:rt.MEDIA_ERROR,details:it.FRAG_PARSING_ERROR,chunkMeta:d.chunkMeta,fatal:!1,error:e,err:e,reason:"transmuxer-worker flush error"})})):Tn(Bd,t,r);}}));var Gd=Bt()||{isTypeSupported:function(){return!1}},Rn=((Ld=Fn.prototype).resetWorker=function(){var a,r;this.workerContext&&(a=(r=this.workerContext).worker,(r=r.objectURL)&&self.URL.revokeObjectURL(r),a.removeEventListener("message",this.onwmsg),a.onerror=null,a.terminate(),this.workerContext=null)},Ld.destroy=function(){this.workerContext?(this.resetWorker(),this.onwmsg=void 0):(e=this.transmuxer)&&(e.destroy(),this.transmuxer=null);var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},Ld.push=function(L,t,e,r,i,n,a,s,o,l){var R=this;o.transmuxing.start=self.performance.now();var h=this.transmuxer,d=(n||i).start,c=i.decryptdata,f=this.frag,A=!(f&&i.cc===f.cc),m=!(f&&o.level===f.level),v=f?o.sn-f.sn:-1,p=this.part?o.part-this.part.index:-1,y=0==v&&1<o.id&&o.id===(null==f?void 0:f.stats.chunkCount),k=!m&&(1==v||0==v&&(1==p||y&&0>=p)),y=self.performance.now();(m||v||0===i.stats.parsing.start)&&(i.stats.parsing.start=y),n&&(p||!k)&&(n.stats.parsing.start=y);var f=!(f&&(null==(E=i.initSegment)?void 0:E.url)===(null==(E=f.initSegment)?void 0:E.url)),E=new nn(A,k,s,m,d,f);(!k||A||f)&&(nt.log("[transmuxer-interface, "+i.type+"]: Starting new transmux session for sn: "+o.sn+" p: "+o.part+" level: "+o.level+" id: "+o.id+"\n        discontinuity: "+A+"\n        trackSwitch: "+m+"\n        contiguous: "+k+"\n        accurateTimeOffset: "+s+"\n        timeOffset: "+d+"\n        initSegmentChange: "+f),l=new rn(e,r,t,a,l),this.configureTransmuxer(l)),this.frag=i,this.part=n,this.workerContext?this.workerContext.worker.postMessage({cmd:"demux",data:L,decryptdata:c,chunkMeta:o,state:E},L instanceof ArrayBuffer?[L]:[]):h&&(en(E=h.push(L,c,o,E))?(h.async=!0,E.then(function(e){R.handleTransmuxComplete(e)}).catch(function(e){R.transmuxerError(e,o,"transmuxer-interface push error")})):(h.async=!1,this.handleTransmuxComplete(E)))},Ld.flush=function(a){var e=this;a.transmuxing.start=self.performance.now();var r=this.transmuxer,n;this.workerContext?this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:a}):r&&(en(n=r.flush(a))||r.async?(en(n)||(n=Promise.resolve(n)),n.then(function(r){e.handleFlushResult(r,a)}).catch(function(r){e.transmuxerError(r,a,"transmuxer-interface flush error")})):this.handleFlushResult(n,a))},Ld.transmuxerError=function(a,t,e){this.hls&&(this.error=a,this.hls.trigger(G.ERROR,{type:rt.MEDIA_ERROR,details:it.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:a,err:a,reason:e}))},Ld.handleFlushResult=function(a,t){var e=this;a.forEach(function(a){e.handleTransmuxComplete(a)}),this.onFlush(t)},Ld.onWorkerMessage=function(a){var t=a.data,e=this.hls;switch(t.event){case"init":var r=null==(r=this.workerContext)?void 0:r.objectURL;r&&self.URL.revokeObjectURL(r);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":nt[t.data.logType]&&nt[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,e.trigger(t.event,t.data);}},Ld.configureTransmuxer=function(a){var t=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:a}):t&&t.configure(a)},Ld.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},Fn),An=((C=xn.prototype).destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},C.poll=function(d,c){var f=this.config,g=this.media,i=this.stalled;if(null!==g){var m=g.currentTime,a=g.seeking,s=this.seeking&&!a,p=!this.seeking&&a;if(this.seeking=a,m!==d)this.moved=!0,null!==i&&(this.stallReported&&(i=self.performance.now()-i,nt.warn("playback not stuck anymore @"+m+", after "+Math.round(i)+"ms"),this.stallReported=!1),this.stalled=null,this.nudgeRetry=0);else if(p||s)this.stalled=null;else if(!(g.paused&&!a||g.ended||0===g.playbackRate)&&Er.getBuffered(g).length&&(d=Er.bufferInfo(g,m,0),p=0<d.len,s=d.nextStart||0,p||s)){if(a){if(p=2<d.len,c=!s||c&&c.start<=m||2<s-m&&!this.fragmentTracker.getPartialFragment(m),p||c)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var s=Math.max(s,d.start||0)-m,y=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,T=null!=y&&null!=(T=y.details)&&T.live?2*y.details.targetduration:2,y=this.fragmentTracker.getPartialFragment(m);if(0<s&&(s<=T||y))return void this._trySkipBufferHole(y)}T=self.performance.now(),null===i?this.stalled=T:(y=T-i,!a&&250<=y&&(this._reportStall(d),!this.media)||(f=Er.bufferInfo(g,m,f.maxBufferHole),this._tryFixBufferStall(f,y)))}}},C._tryFixBufferStall=function(a,t){var e=this.config,r=this.fragmentTracker,d=this.media;null!==d&&(d=d.currentTime,(!(r=r.getPartialFragment(d))||!this._trySkipBufferHole(r)&&this.media)&&(a.len>e.maxBufferHole||a.nextStart&&a.nextStart-d<e.maxBufferHole)&&t>1e3*e.highBufferWatchdogPeriod&&(nt.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer()))},C._reportStall=function(a){var t=this.hls,e=this.media;!this.stallReported&&e&&(this.stallReported=!0,e=new Error("Playback stalling at @"+e.currentTime+" due to low buffer ("+JSON.stringify(a)+")"),nt.warn(e.message),t.trigger(G.ERROR,{type:rt.MEDIA_ERROR,details:it.BUFFER_STALLED_ERROR,fatal:!1,error:e,buffer:a.len}))},C._trySkipBufferHole=function(g){var t=this.config,m=this.hls,r=this.media;if(null===r)return 0;var i=r.currentTime,p=Er.bufferInfo(r,i,0),y=i<p.start?p.start:p.nextStart;if(y){var s=p.len<=t.maxBufferHole,o=0<p.len&&1>p.len&&3>r.readyState,p=y-i;if(0<p&&(s||o)){if(p>t.maxBufferHole){var l=this.fragmentTracker,p=!1;if(0!==i||(t=l.getAppendedFrag(0,oe))&&y<t.end&&(p=!0),!p){var u=g||l.getAppendedFrag(i,oe);if(u){for(var T=!1,E=u.end,S;E<y;){if(S=l.getPartialFragment(E),!S){T=!0;break}E+=S.duration}if(T)return 0}}}return u=Math.max(y+.05,i+.1),nt.warn("skipping hole, adjusting currentTime from "+i+" to "+u),this.moved=!0,this.stalled=null,r.currentTime=u,g&&!g.gap&&(i=new Error("fragment loaded with buffer holes, seeking from "+i+" to "+u),m.trigger(G.ERROR,{type:rt.MEDIA_ERROR,details:it.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:i,reason:i.message,frag:g})),u}}return 0},C._tryNudgeBuffer=function(){var d=this.config,o=this.hls,i=this.media,n=this.nudgeRetry,s,l;null!==i&&(s=i.currentTime,this.nudgeRetry++,n<d.nudgeMaxRetry?(l=s+(n+1)*d.nudgeOffset,n=new Error("Nudging 'currentTime' from "+s+" to "+l),nt.warn(n.message),i.currentTime=l,o.trigger(G.ERROR,{type:rt.MEDIA_ERROR,details:it.BUFFER_NUDGE_ON_STALL,error:n,fatal:!1})):(d=new Error("Playhead still not moving while enough data buffered @"+s+" after "+d.nudgeMaxRetry+" nudges"),nt.error(d.message),o.trigger(G.ERROR,{type:rt.MEDIA_ERROR,details:it.BUFFER_STALLED_ERROR,error:d,fatal:!0})))},xn),kn=function(a){function r(n,t,e){return(e=a.call(this,n,t,e,"[stream-controller]",oe)||this).audioCodecSwap=!1,e.gapController=null,e.level=-1,e._forceStartLoad=!1,e.altAudio=!1,e.audioOnly=!1,e.fragPlaying=null,e.onvplaying=null,e.onvseeked=null,e.fragLastKbps=0,e.couldBacktrack=!1,e.backtrackFragment=null,e.audioCodecSwitch=!1,e.videoBuffer=null,e._registerListeners(),e}Za(r,a);var t=r.prototype;return t._registerListeners=function(){var e=this.hls;e.on(G.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(G.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(G.MANIFEST_LOADING,this.onManifestLoading,this),e.on(G.MANIFEST_PARSED,this.onManifestParsed,this),e.on(G.LEVEL_LOADING,this.onLevelLoading,this),e.on(G.LEVEL_LOADED,this.onLevelLoaded,this),e.on(G.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(G.ERROR,this.onError,this),e.on(G.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(G.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(G.BUFFER_CREATED,this.onBufferCreated,this),e.on(G.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(G.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(G.FRAG_BUFFERED,this.onFragBuffered,this)},t._unregisterListeners=function(){var e=this.hls;e.off(G.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(G.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(G.MANIFEST_LOADING,this.onManifestLoading,this),e.off(G.MANIFEST_PARSED,this.onManifestParsed,this),e.off(G.LEVEL_LOADED,this.onLevelLoaded,this),e.off(G.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(G.ERROR,this.onError,this),e.off(G.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(G.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(G.BUFFER_CREATED,this.onBufferCreated,this),e.off(G.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(G.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(G.FRAG_BUFFERED,this.onFragBuffered,this)},t.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},t.startLoad=function(a){var n,d,o;this.levels?(n=this.lastCurrentTime,d=this.hls,this.stopLoad(),this.setInterval(100),this.level=-1,this.startFragRequested||(-1===(o=d.startLevel)&&(d.config.testBandwidth&&1<this.levels.length?(o=0,this.bitrateTest=!0):o=d.nextAutoLevel),this.level=d.nextLoadLevel=o,this.loadedmetadata=!1),0<n&&-1===a&&(this.log("Override startPosition with lastCurrentTime @"+n.toFixed(3)),a=n),this.state=Fr,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()):(this._forceStartLoad=!0,this.state=xr)},t.stopLoad=function(){this._forceStartLoad=!1,a.prototype.stopLoad.call(this)},t.doTick=function(){switch(this.state){case Yr:var a=this.levels,t=this.level,t=null==a||null==(n=a[t])?void 0:n.details;if(t&&(!t.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(t))break;this.state=Fr;break}if(this.hls.nextLoadLevel===this.level)break;this.state=Fr;break;case Nr:var n=self.performance.now(),t=this.retryDate;(!t||t<=n||null!=(n=this.media)&&n.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=Fr);}this.state===Fr&&this.doTickIdle(),this.onTickEnd()},t.onTickEnd=function(){a.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},t.doTickIdle=function(){var d=this.hls,u=this.levelLastLoaded,e=this.levels,c=this.media,f=d.config,g=d.nextLoadLevel;if(null!==u&&(c||!this.startFragRequested&&f.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&null!=e&&e[g]&&(c=e[g],f=this.getMainFwdBufferInfo(),null!==f)){if(e=this.getLevelDetails(),e&&this._streamEnded(f,e)){var m={};return this.altAudio&&(m.type="video"),this.hls.trigger(G.BUFFER_EOS,m),void(this.state=Kr)}if(d.loadLevel!==g&&-1===d.manualLevel&&this.log("Adapting to level "+g+" from level "+this.level),this.level=d.nextLoadLevel=g,e=c.details,!e||this.state===Yr||e.live&&this.levelLastLoaded!==g)return this.level=g,void(this.state=Yr);var m=f.len,d=this.getMaxBufferLength(c.maxBitrate),p,y;d<=m||(this.backtrackFragment&&this.backtrackFragment.start>f.end&&(this.backtrackFragment=null),g=this.backtrackFragment?this.backtrackFragment.start:f.end,m=this.getNextFragment(g,e),this.couldBacktrack&&!this.fragPrevious&&m&&"initSegment"!==m.sn&&this.fragmentTracker.getState(m)!==nr?(p=(null==(y=this.backtrackFragment)?m:y).sn-e.startSN,(y=e.fragments[p-1])&&m.cc===y.cc&&(m=y,this.fragmentTracker.removeFragment(y))):this.backtrackFragment&&f.len&&(this.backtrackFragment=null),m&&this.isLoopLoading(m,g)&&(m.gap||(y=((p=this.audioOnly&&!this.altAudio?A:I)==I?this.videoBuffer:this.mediaBuffer)||this.media)&&this.afterBufferFlushed(y,p,oe),m=this.getNextFragmentLoopLoading(m,e,f,oe,d)),m&&(!m.initSegment||m.initSegment.data||this.bitrateTest||(m=m.initSegment),this.loadFragment(m,c,g)))}},t.loadFragment=function(n,t,e){var r=this.fragmentTracker.getState(n);this.fragCurrent=n,r===$e||r===ir?"initSegment"===n.sn?this._loadInitSegment(n,t):this.bitrateTest?(this.log("Fragment "+n.sn+" of level "+n.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(n,t)):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,n,t,e)):this.clearTrackerIfNeeded(n)},t.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,oe)},t.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},t.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},t.nextLevelSwitch=function(){var d=this.levels,t=this.media;if(null!=t&&t.readyState){var o=this.getAppendedFrag(t.currentTime);o&&1<o.start&&this.flushMainBuffer(0,o.start-1);var s=this.getLevelDetails();if(null!=s&&s.live&&(o=this.getMainFwdBufferInfo(),!o||o.len<2*s.targetduration))return;l=!t.paused&&d?(l=d[this.hls.nextLoadLevel],(i=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*l.maxBitrate/(1e3*i)+1:0):0;var i=this.getBufferedFrag(t.currentTime+l),l;!i||(t=this.followingBufferedFrag(i))&&(this.abortCurrentFrag(),l=t.maxStartPTS||t.start,t=t.duration,t=Math.max(i.end,l+Math.min(Math.max(t-this.config.maxFragLookUpTolerance,.5*t),.75*t)),this.flushMainBuffer(t,Number.POSITIVE_INFINITY))}},t.abortCurrentFrag=function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Mr:case Or:case Nr:case Br:case Gr:this.state=Fr;}this.nextLoadPosition=this.getLoadPosition()},t.flushMainBuffer=function(r,t){a.prototype.flushMainBuffer.call(this,r,t,this.altAudio?"video":null)},t.onMediaAttached=function(r,t){a.prototype.onMediaAttached.call(this,r,t),t=t.media,this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),t.addEventListener("playing",this.onvplaying),t.addEventListener("seeked",this.onvseeked),this.gapController=new An(this.config,t,this.fragmentTracker,this.hls)},t.onMediaDetaching=function(){var e=this.media;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),a.prototype.onMediaDetaching.call(this)},t.onMediaPlaying=function(){this.tick()},t.onMediaSeeked=function(){var e=this.media,e=e?e.currentTime:null;yd(e)&&this.log("Media seeked to "+e.toFixed(3)),e=this.getMainFwdBufferInfo(),null!==e&&0!==e.len?this.tick():this.warn("Main forward buffer length on \"seeked\" event "+(e?e.len:"empty")+")")},t.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(G.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1},t.onManifestParsed=function(d,t){var e=!1,o=!1,l,u,c;t.levels.forEach(function(a){(l=a.audioCodec)&&(-1!==l.indexOf("mp4a.40.2")&&(e=!0),-1!==l.indexOf("mp4a.40.5")&&(o=!0))}),this.audioCodecSwitch=e&&o&&"function"!=typeof(null==(c=zr())||null==(u=c.prototype)?void 0:u.changeType),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},t.onLevelLoading=function(a,t){var e=this.levels;!e||this.state!==Fr||(!(e=e[t.level]).details||e.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(e.details))&&(this.state=Yr)},t.onLevelLoaded=function(d,t){var o=this.levels,s=t.level,i=t.details,n=i.totalduration;if(o){this.log("Level "+s+" loaded ["+i.startSN+","+i.endSN+"]"+(i.lastPartSn?"[part-"+i.lastPartSn+"-"+i.lastPartIndex+"]":"")+", cc ["+i.startCC+", "+i.endCC+"] duration:"+n);var n=o[s],o=this.fragCurrent;if(o&&(this.state===Or||this.state===Nr)&&(o.level!==t.level||o.urlId!==n.urlId)&&o.loader&&this.abortCurrentFrag(),t=0,i.live||null!=(o=n.details)&&o.live){if(i.fragments[0]||(i.deltaUpdateFailed=!0),i.deltaUpdateFailed)return;t=this.alignPlaylists(i,n.details)}if(n.details=i,this.levelLastLoaded=s,this.hls.trigger(G.LEVEL_UPDATED,{details:i,level:s}),this.state===Yr){if(this.waitForCdnTuneIn(i))return;this.state=Fr}this.startFragRequested?i.live&&this.synchronizeToLiveEdge(i):this.setStartPosition(i,t),this.tick()}else this.warn("Levels were reset while loading level "+s)},t._handleFragmentLoadProgress=function(d){var c=d.frag,e=d.part,r=d.payload,i=this.levels;if(i){var f=i[c.level],g=f.details;if(!g)return this.warn("Dropping fragment "+c.sn+" of level "+c.level+" after level details were reset"),void this.fragmentTracker.removeFragment(c);var s=f.videoCodec,o=g.PTSKnown||!g.live,l=null==(u=c.initSegment)?void 0:u.data,d=this._getAudioCodec(f),i=this.transmuxer=this.transmuxer||new Rn(this.hls,oe,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),u=e?e.index:-1,f=-1!==u,u=new cr(c.level,c.sn,c.stats.chunkCount,r.byteLength,u,f),f=this.initPTS[c.cc];i.push(r,l,d,s,c,e,g.totalduration,o,u,f)}else this.warn("Levels were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered")},t.onAudioTrackSwitching=function(a,t){var e=this.altAudio,n;t.url||(this.mediaBuffer===this.media?this.audioOnly&&this.resetTransmuxer():(this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,(n=this.fragCurrent)&&(this.log("Switching to main audio track, cancel main fragment load"),n.abortRequests(),this.fragmentTracker.removeFragment(n)),this.resetTransmuxer(),this.resetLoadingState()),n=this.hls,e&&(n.trigger(G.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),n.trigger(G.AUDIO_TRACK_SWITCHED,t))},t.onAudioTrackSwitched=function(a,t){var n=t.id,t=!!this.hls.audioTracks[n].url;!t||(n=this.videoBuffer)&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n),this.altAudio=t,this.tick()},t.onBufferCreated=function(d,t){var e=t.tracks,i=!1,u;for(u in e){var c=e[u],l,f,g;"main"===c.id?(g=c,"video"===(f=u)&&(l=e[u])&&(this.videoBuffer=l.buffer)):i=!0}i&&g?(this.log("Alternate track found, use "+f+".buffered to schedule main fragment loading"),this.mediaBuffer=g.buffer):this.mediaBuffer=this.media},t.onFragBuffered=function(a,t){var n=t.frag,r=t.part;if(!n||n.type===oe){if(this.fragContextChanged(n))return this.warn("Fragment "+n.sn+(r?" p: "+r.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===Gr&&(this.state=Fr));t=(r||n).stats,this.fragLastKbps=Math.round(8*t.total/(t.buffering.end-t.loading.first)),"initSegment"!==n.sn&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}},t.onError=function(a,t){var e;if(t.fatal)this.state=Hr;else switch(t.details){case it.FRAG_GAP:case it.FRAG_PARSING_ERROR:case it.FRAG_DECRYPT_ERROR:case it.FRAG_LOAD_ERROR:case it.FRAG_LOAD_TIMEOUT:case it.KEY_LOAD_ERROR:case it.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(oe,t);break;case it.LEVEL_LOAD_ERROR:case it.LEVEL_LOAD_TIMEOUT:case it.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Yr||(null==(e=t.context)?void 0:e.type)!==ne||(this.state=Fr);break;case it.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case it.INTERNAL_EXCEPTION:this.recoverWorkerError(t);}},t.checkBuffer=function(){var a=this.media,e=this.gapController,r;a&&e&&a.readyState&&(!this.loadedmetadata&&Er.getBuffered(a).length||(r=this.state===Fr?null:this.fragCurrent,e.poll(this.lastCurrentTime,r)),this.lastCurrentTime=a.currentTime)},t.onFragLoadEmergencyAborted=function(){this.state=Fr,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},t.onBufferFlushed=function(a,t){var n=t.type;(n!==A||this.audioOnly&&!this.altAudio)&&(t=(n===I?this.videoBuffer:this.mediaBuffer)||this.media,this.afterBufferFlushed(t,n,oe))},t.onLevelsUpdated=function(a,t){this.levels=t.levels},t.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},t.seekToStartPos=function(){var a=this.media,n,i,d;a&&(n=a.currentTime,0<=(i=this.startPosition)&&n<i&&(a.seeking?this.log("could not seek to "+i+", already seeking at "+n):(0<(d=((d=Er.getBuffered(a)).length?d.start(0):0)-i)&&(d<this.config.maxBufferHole||d<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+d+" to match buffer start"),i+=d,this.startPosition=i),this.log("seek to target start position "+i+" from current time "+n),a.currentTime=i)))},t._getAudioCodec=function(e){return e=this.config.defaultAudioCodec||e.audioCodec,this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e=-1===e.indexOf("mp4a.40.5")?"mp4a.40.5":"mp4a.40.2"),e},t._loadBitrateTestFrag=function(d,i){var n=this;d.bitrateTest=!0,this._doFragLoad(d,i).then(function(a){var t=n.hls,r;a&&!n.fragContextChanged(d)&&(i.fragmentError=0,n.state=Fr,n.startFragRequested=!1,n.bitrateTest=!1,(r=d.stats).parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),t.trigger(G.FRAG_LOADED,a),d.bitrateTest=!1)})},t._handleTransmuxComplete=function(r){var y=this.hls,i=r.remuxResult,T=r.chunkMeta,a=this.getCurrentContext(T),E;if(a){var S=a.frag,o=a.part,l=a.level,u=i.video,L=i.text,R=i.id3,k=i.initSegment,r=l.details,a=this.altAudio?void 0:i.audio;if(this.fragContextChanged(S))this.fragmentTracker.removeFragment(S);else{if(this.state=Br,k&&(null!=k&&k.tracks&&(C=S.initSegment||S,this._bufferInitSegment(l,k.tracks,C,T),y.trigger(G.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:"main",tracks:k.tracks})),D=k.initPTS,C=k.timescale,yd(D)&&(this.initPTS[S.cc]={baseTime:D,timescale:C},y.trigger(G.INIT_PTS_FOUND,{frag:S,id:"main",initPTS:D,timescale:C}))),u&&!1!==i.independent){if(r){var k=u.startPTS,D=u.endPTS,I=u.startDTS,b=u.endDTS;if(o)o.elementaryStreams[u.type]={startPTS:k,endPTS:D,startDTS:I,endDTS:b};else if(u.firstKeyFrame&&u.independent&&1===T.id&&(this.couldBacktrack=!0),u.dropped&&u.independent){var C=this.getMainFwdBufferInfo();if((C?C.end:this.getLoadPosition())+this.config.maxBufferHole<(u.firstKeyFramePTS||k)-this.config.maxBufferHole)return void this.backtrack(S);S.setElementaryStreamInfo(u.type,S.start,D,S.start,b,!0)}S.setElementaryStreamInfo(u.type,k,D,I,b),this.backtrackFragment&&(this.backtrackFragment=S),this.bufferFragmentData(u,S,o,T)}}else if(!1===i.independent)return void this.backtrack(S);a&&(I=a.startPTS,b=a.endPTS,u=a.startDTS,i=a.endDTS,o&&(o.elementaryStreams[A]={startPTS:I,endPTS:b,startDTS:u,endDTS:i}),S.setElementaryStreamInfo(A,I,b,u,i),this.bufferFragmentData(a,S,o,T)),r&&null!=R&&null!=(E=R.samples)&&E.length&&(R={id:"main",frag:S,details:r,samples:R.samples},y.trigger(G.FRAG_PARSING_METADATA,R)),r&&L&&(L={id:"main",frag:S,details:r,samples:L.samples},y.trigger(G.FRAG_PARSING_USERDATA,L))}}else this.resetWhenMissingContext(T)},t._bufferInitSegment=function(d,c,r,i){var n=this,t,u,f,g,m;this.state===Br&&(this.audioOnly=!!c.audio&&!c.video,this.altAudio&&!this.audioOnly&&delete c.audio,t=c.audio,u=c.video,f=c.audiovideo,t&&(g=d.audioCodec,m=navigator.userAgent.toLowerCase(),this.audioCodecSwitch&&(g=g&&(-1===g.indexOf("mp4a.40.5")?"mp4a.40.5":"mp4a.40.2"),1!==t.metadata.channelCount&&-1===m.indexOf("firefox")&&(g="mp4a.40.5")),-1!==m.indexOf("android")&&"audio/mpeg"!==t.container&&(g="mp4a.40.2",this.log("Android: force audio codec to "+g)),d.audioCodec&&d.audioCodec!==g&&this.log("Swapping manifest audio codec \""+d.audioCodec+"\" for \""+g+"\""),t.levelCodec=g,t.id="main",this.log("Init audio buffer, container:"+t.container+", codecs[selected/level/parsed]=["+(g||"")+"/"+(d.audioCodec||"")+"/"+t.codec+"]")),u&&(u.levelCodec=d.videoCodec,u.id="main",this.log("Init video buffer, container:"+u.container+", codecs[level/parsed]=["+(d.videoCodec||"")+"/"+u.codec+"]")),f&&this.log("Init audiovideo buffer, container:"+f.container+", codecs[level/parsed]=["+(d.attrs.CODECS||"")+"/"+f.codec+"]"),this.hls.trigger(G.BUFFER_CODECS,c),Object.keys(c).forEach(function(a){var t=c[a].initSegment;null!=t&&t.byteLength&&n.hls.trigger(G.BUFFER_APPENDING,{type:a,data:t,frag:r,part:null,chunkMeta:i,parent:r.type})}),this.tick())},t.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer||this.media,oe)},t.backtrack=function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Fr},t.checkFragmentChanged=function(){var a=this.media,n=null,i;a&&1<a.readyState&&!1===a.seeking&&(i=a.currentTime,Er.isBuffered(a,i)?n=this.getAppendedFrag(i):Er.isBuffered(a,i+.1)&&(n=this.getAppendedFrag(i+.1)),n&&(this.backtrackFragment=null,a=this.fragPlaying,i=n.level,a&&n.sn===a.sn&&a.level===i&&n.urlId===a.urlId||(this.fragPlaying=n,this.hls.trigger(G.FRAG_CHANGED,{frag:n}),a&&a.level===i||this.hls.trigger(G.LEVEL_SWITCHED,{level:i}))))},qt(r,[{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}},{key:"currentProgramDateTime",get:function(){var a=this.media;if(a){var r=a.currentTime,a=this.currentFrag;if(a&&yd(r)&&yd(a.programDateTime))return a=a.programDateTime+1e3*(r-a.start),new Date(a)}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),r}(Wr),bn=((Yn=Pn.prototype).sample=function(a,t){var e=Math.pow(this.alpha_,a);this.estimate_=t*(1-e)+e*this.estimate_,this.totalWeight_+=a},Yn.getTotalWeight=function(){return this.totalWeight_},Yn.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},Pn),Dn=((vd=_n.prototype).update=function(a,t){var e=this.slow_,r=this.fast_,i=this.ttfb_;e.halfLife!==a&&(this.slow_=new bn(a,e.getEstimate(),e.getTotalWeight())),r.halfLife!==t&&(this.fast_=new bn(t,r.getEstimate(),r.getTotalWeight())),i.halfLife!==a&&(this.ttfb_=new bn(a,i.getEstimate(),i.getTotalWeight()))},vd.sample=function(a,r){a=(a=Math.max(a,this.minDelayMs_))/1e3,r=8*r/a,this.fast_.sample(a,r),this.slow_.sample(a,r)},vd.sampleTTFB=function(a){var t=a/1e3,t=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(t,Math.max(a,5))},vd.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},vd.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},vd.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},vd.destroy=function(){},_n),Ai=((Xi=Cn.prototype).registerListeners=function(){var e=this.hls;e.on(G.FRAG_LOADING,this.onFragLoading,this),e.on(G.FRAG_LOADED,this.onFragLoaded,this),e.on(G.FRAG_BUFFERED,this.onFragBuffered,this),e.on(G.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(G.LEVEL_LOADED,this.onLevelLoaded,this)},Xi.unregisterListeners=function(){var e=this.hls;e.off(G.FRAG_LOADING,this.onFragLoading,this),e.off(G.FRAG_LOADED,this.onFragLoaded,this),e.off(G.FRAG_BUFFERED,this.onFragBuffered,this),e.off(G.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(G.LEVEL_LOADED,this.onLevelLoaded,this)},Xi.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},Xi.onFragLoading=function(a,t){var n=t.frag;this.ignoreFragment(n)||(this.fragCurrent=n,this.partCurrent=null==(t=t.part)?null:t,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))},Xi.onLevelSwitching=function(){this.clearTimer()},Xi.getTimeToLoadFrag=function(a,t,e,r){return a+e/t+(r?this.lastLevelLoadSec:0)},Xi.onLevelLoaded=function(a,t){var e=this.hls.config,r=t.stats,d=r.total,r=r.bwEstimate;yd(d)&&yd(r)&&(this.lastLevelLoadSec=8*d/r),t.details.live?this.bwEstimator.update(e.abrEwmaSlowLive,e.abrEwmaFastLive):this.bwEstimator.update(e.abrEwmaSlowVoD,e.abrEwmaFastVoD)},Xi._abandonRulesCheck=function(){var T=this.fragCurrent,t=this.partCurrent,e=this.hls,r=e.autoLevelEnabled,E=e.media;if(T&&E){var S=performance.now(),L=(t||T).stats,s=(t||T).duration,o=S-L.loading.start;if(L.aborted||L.loaded&&L.loaded===L.total||0===T.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(r&&!E.paused&&E.playbackRate&&E.readyState){var l=e.mainForwardBufferInfo;if(null!==l){var R=this.bwEstimator.getEstimateTTFB(),h=Math.abs(E.playbackRate);if(!(o<=Math.max(R,1e3*(s/(2*h))))){var A=l.len/h;if(!(2*s/h<=A)){var S=L.loading.first?L.loading.first-L.loading.start:-1,r=L.loaded&&-1<S,E=this.bwEstimator.getEstimate(),c=e.levels,f=e.minAutoLevel,l=c[T.level],h=L.total||Math.max(L.loaded,Math.round(s*l.maxBitrate/8)),l=o-S;if(1>l&&r&&(l=Math.min(o,8*L.loaded/E)),l=r?1e3*L.loaded/l:0,h=l?(h-L.loaded)/l:8*h/E+R/1e3,!(h<=A)){for(var g=l?8*l:E,m=Number.POSITIVE_INFINITY,k=T.level-1,D;f<k&&(D=c[k].maxBitrate,!((m=this.getTimeToLoadFrag(R/1e3,g,s*D,!c[k].details))<A));k--);h<=m||10*s<m||(e.nextLoadLevel=k,r?this.bwEstimator.sample(o-Math.min(R,S),L.loaded):this.bwEstimator.sampleTTFB(o),this.clearTimer(),nt.warn("[abr] Fragment "+T.sn+(t?" part "+t.index:"")+" of level "+T.level+" is loading too slowly;\n      Time to underbuffer: "+A.toFixed(3)+" s\n      Estimated load time for current fragment: "+h.toFixed(3)+" s\n      Estimated load time for down switch fragment: "+m.toFixed(3)+" s\n      TTFB estimate: "+S+"\n      Current BW estimate: "+(yd(E)?(E/1024).toFixed(3):"Unknown")+" Kb/s\n      New BW estimate: "+(this.bwEstimator.getEstimate()/1024).toFixed(3)+" Kb/s\n      Aborting and switching to level "+k),T.loader&&(this.fragCurrent=this.partCurrent=null,T.abortRequests()),e.trigger(G.FRAG_LOAD_EMERGENCY_ABORTED,{frag:T,part:t,stats:L}))}}}}}}},Xi.onFragLoaded=function(d,t){var o=t.frag,n=t.part,l=(n||o).stats,s,u;o.type===oe&&this.bwEstimator.sampleTTFB(l.loading.first-l.loading.start),this.ignoreFragment(o)||(this.clearTimer(),this.lastLoadedFragLevel=o.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate&&(u=(n||o).duration,t=((s=this.hls.levels[o.level]).loaded?s.loaded.bytes:0)+l.loaded,u=(s.loaded?s.loaded.duration:0)+u,s.loaded={bytes:t,duration:u},s.realBitrate=Math.round(8*t/u)),o.bitrateTest&&(n={stats:l,frag:o,part:n,id:o.type},this.onFragBuffered(G.FRAG_BUFFERED,n),o.bitrateTest=!1))},Xi.onFragBuffered=function(a,t){var n=t.frag,r=t.part,t=(null!=r&&r.stats.loaded?r:n).stats;t.aborted||this.ignoreFragment(n)||(r=t.parsing.end-t.loading.start-Math.min(t.loading.first-t.loading.start,this.bwEstimator.getEstimateTTFB()),this.bwEstimator.sample(r,t.loaded),t.bwEstimate=this.bwEstimator.getEstimate(),this.bitrateTestDelay=n.bitrateTest?r/1e3:0)},Xi.ignoreFragment=function(e){return e.type!==oe||"initSegment"===e.sn},Xi.clearTimer=function(){self.clearInterval(this.timer)},Xi.getNextABRAutoLevel=function(){var d=this.fragCurrent,c=this.partCurrent,f=this.hls,g=f.maxAutoLevel,i=f.config,n=f.minAutoLevel,a=f.media,m=c?c.duration:d?d.duration:0,o=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,p=this.bwEstimator?this.bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,u=f.mainForwardBufferInfo,c=(u?u.len:0)/o,d=this.findBestLevel(p,n,g,c,i.abrBandWidthFactor,i.abrBandWidthUpFactor);return 0<=d?d:(nt.trace("[abr] "+(c?"rebuffering expected":"buffer is empty")+", finding optimal quality level"),a=m?Math.min(m,i.maxStarvationDelay):i.maxStarvationDelay,f=i.abrBandWidthFactor,u=i.abrBandWidthUpFactor,(c||(o=this.bitrateTestDelay)&&(a=(m?Math.min(m,i.maxLoadingDelay):i.maxLoadingDelay)-o,nt.trace("[abr] bitrate test took "+Math.round(1e3*o)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*a)+" ms"),f=u=1),d=this.findBestLevel(p,n,g,c+a,f,u),Math.max(d,0)))},Xi.findBestLevel=function(R,t,e,r,i,n){for(var a=this.fragCurrent,o=this.partCurrent,l=this.lastLoadedFragLevel,u=this.hls.levels,h=u[l],d=null!=h&&null!=(D=h.details)&&D.live,c=null==h?void 0:h.codecSet,f=o?o.duration:a?a.duration:0,g=this.bwEstimator.getEstimateTTFB()/1e3,m=t,A=-1,k=e,D,I;t<=k;k--)if(I=u[k],!I||c&&I.codecSet!==c)I&&(m=Math.min(k,m),A=Math.max(k,A));else{-1!==A&&nt.trace("[abr] Skipped level(s) "+m+"-"+A+" with CODECS:\""+u[A].attrs.CODECS+"\"; not compatible with \""+h.attrs.CODECS+"\"");var b=I.details,C=(o?null==b?void 0:b.partTarget:null==b?void 0:b.averagetargetduration)||f,S=k<=l?i*R:n*R,I=u[k].maxBitrate,b=this.getTimeToLoadFrag(g,S,I*C,void 0===b);if(nt.trace("[abr] level:"+k+" adjustedbw-bitrate:"+Math.round(S-I)+" avgDuration:"+C.toFixed(1)+" maxFetchDuration:"+r.toFixed(1)+" fetchDuration:"+b.toFixed(1)),I<S&&(0===b||!yd(b)||d&&!this.bitrateTestDelay||b<r))return k}return-1},qt(Cn,[{key:"nextAutoLevel",get:function(){var a=this._nextAutoLevel,t=this.bwEstimator;if(-1!==a&&!t.canEstimate())return a;var n=this.getNextABRAutoLevel();return-1!==a&&(t=this.hls.levels,t.length>Math.max(a,n)&&t[a].loadError<=t[n].loadError)?a:(-1!==a&&(n=Math.min(a,n)),n)},set:function(e){this._nextAutoLevel=e}}]),Cn),In=((ti=Ln.prototype).push=function(e){this.chunks.push(e),this.dataLength+=e.length},ti.flush=function(){var e=this.chunks,d=this.dataLength;return e.length?(e=1===e.length?e[0]:function(a){for(var t=new Uint8Array(d),e=0,o=0,s;o<a.length;o++)s=a[o],t.set(s,e),e+=s.length;return t}(e),this.reset(),e):new Uint8Array(0)},ti.reset=function(){this.chunks.length=0,this.dataLength=0},Ln),Dd=function(d){function a(a,t,e){return(e=d.call(this,a,t,e,"[audio-stream-controller]",le)||this).videoBuffer=null,e.videoTrackCC=-1,e.waitingVideoCC=-1,e.bufferedTrack=null,e.switchingTrack=null,e.trackId=-1,e.waitingData=null,e.mainDetails=null,e.bufferFlushed=!1,e.cachedTrackLoadedData=null,e._registerListeners(),e}Za(a,d);var t=a.prototype;return t.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null},t._registerListeners=function(){var e=this.hls;e.on(G.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(G.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(G.MANIFEST_LOADING,this.onManifestLoading,this),e.on(G.LEVEL_LOADED,this.onLevelLoaded,this),e.on(G.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(G.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(G.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(G.ERROR,this.onError,this),e.on(G.BUFFER_RESET,this.onBufferReset,this),e.on(G.BUFFER_CREATED,this.onBufferCreated,this),e.on(G.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(G.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(G.FRAG_BUFFERED,this.onFragBuffered,this)},t._unregisterListeners=function(){var e=this.hls;e.off(G.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(G.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(G.MANIFEST_LOADING,this.onManifestLoading,this),e.off(G.LEVEL_LOADED,this.onLevelLoaded,this),e.off(G.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(G.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(G.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(G.ERROR,this.onError,this),e.off(G.BUFFER_RESET,this.onBufferReset,this),e.off(G.BUFFER_CREATED,this.onBufferCreated,this),e.off(G.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(G.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(G.FRAG_BUFFERED,this.onFragBuffered,this)},t.onInitPtsFound=function(a,t){var d=t.frag,r=t.id,o=t.initPTS,t=t.timescale;"main"===r&&(r=d.cc,this.initPTS[d.cc]={baseTime:o,timescale:t},this.log("InitPTS for cc: "+r+" found from main: "+o),this.videoTrackCC=r,this.state===Vr&&this.tick())},t.startLoad=function(a){if(!this.levels)return this.startPosition=a,void(this.state=xr);var r=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),0<r&&-1===a?(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),a=r,this.state=Fr):(this.loadedmetadata=!1,this.state=Ur),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()},t.doTick=function(){switch(this.state){case Fr:this.doTickIdle();break;case Ur:var o=this.levels,t=this.trackId,e=null==o||null==(e=o[t])?void 0:e.details;if(e){if(this.waitForCdnTuneIn(e))break;this.state=Vr}break;case Nr:var l=performance.now(),u=this.retryDate;(!u||u<=l||null!=(c=this.media)&&c.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=Fr);break;case Vr:var e=this.waitingData,c,f;e?(u=e.frag,l=e.part,c=e.cache,e=e.complete,void 0===this.initPTS[u.cc]?this.videoTrackCC===this.waitingVideoCC?(f=this.getLoadPosition(),0>je((f=Er.bufferInfo(this.mediaBuffer,f,this.config.maxBufferHole)).end,this.config.maxFragLookUpTolerance,u)&&(this.log("Waiting fragment cc ("+u.cc+") @ "+u.start+" cancelled because another fragment at "+f.end+" is needed"),this.clearWaitingFragment())):(this.log("Waiting fragment cc ("+u.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment()):(this.waitingData=null,this.waitingVideoCC=-1,this.state=Or,f={frag:u,part:l,payload:c.flush(),networkDetails:null},this._handleFragmentLoadProgress(f),e&&d.prototype._handleFragmentLoadComplete.call(this,f))):this.state=Fr;}this.onTickEnd()},t.clearWaitingFragment=function(){var e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Fr)},t.resetLoadingState=function(){this.clearWaitingFragment(),d.prototype.resetLoadingState.call(this)},t.onTickEnd=function(){var e=this.media;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)},t.doTickIdle=function(){var d=this.hls,c=this.levels,f=this.media,g=this.trackId,m=d.config;if(null!=c&&c[g]&&(f||!this.startFragRequested&&m.startFragPrefetch)){var p=c[g],a=p.details;if(!a||a.live&&this.levelLastLoaded!==g||this.waitForCdnTuneIn(a))this.state=Ur;else{var y=this.mediaBuffer||this.media;this.bufferFlushed&&y&&(this.bufferFlushed=!1,this.afterBufferFlushed(y,A,le));var T=this.getFwdBufferInfo(y,le);if(null!==T){var l=this.bufferedTrack,u=this.switchingTrack;if(!u&&this._streamEnded(T,a))return d.trigger(G.BUFFER_EOS,{type:"audio"}),void(this.state=Kr);if(m=this.getFwdBufferInfo(this.videoBuffer||this.media,oe),c=T.len,g=this.getMaxBufferLength(null==m?void 0:m.len),!(g<=c)||u)if(y=a.fragments[0].start,d=T.end,u&&f&&(c=this.getLoadPosition(),l&&u.attrs!==l.attrs&&(d=c),a.PTSKnown&&c<y&&(T.end>y||T.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),f.currentTime=y+.05)),f=this.getNextFragment(d,a),y=!1,(f&&this.isLoopLoading(f,d)&&(y=!!f.gap,f=this.getNextFragmentLoopLoading(f,a,T,oe,g)),f)){if(g=m&&f.start>m.end+a.targetduration,g||(null==m||!m.len)&&T.len){if(a=this.getAppendedFrag(f.start,oe),null===a)return;if(y=y||!!a.gap||!!g&&0===m.len,g&&!y||y&&T.nextStart&&T.nextStart<a.end)return}this.loadFragment(f,p,d)}else this.bufferFlushed=!0}}}},t.getMaxBufferLength=function(a){var t=d.prototype.getMaxBufferLength.call(this);return a?Math.min(Math.max(t,a),this.config.maxMaxBufferLength):t},t.onMediaDetaching=function(){this.videoBuffer=null,d.prototype.onMediaDetaching.call(this)},t.onAudioTracksUpdated=function(a,t){t=t.audioTracks,this.resetTransmuxer(),this.levels=t.map(function(e){return new De(e)})},t.onAudioTrackSwitching=function(a,t){var e=!!t.url;this.trackId=t.id;var r=this.fragCurrent;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),e?this.setInterval(100):this.resetTransmuxer(),e?(this.switchingTrack=t,this.state=Fr):(this.switchingTrack=null,this.bufferedTrack=t,this.state=xr),this.tick()},t.onManifestLoading=function(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1},t.onLevelLoaded=function(a,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(G.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},t.onAudioTrackLoaded=function(d,t){if(null!=this.mainDetails){var e=this.levels,o=t.details,i=t.id;if(e){this.log("Track "+i+" loaded ["+o.startSN+","+o.endSN+"]"+(o.lastPartSn?"[part-"+o.lastPartSn+"-"+o.lastPartIndex+"]":"")+",duration:"+o.totalduration);var n=e[i],e=0;if(o.live||null!=(a=n.details)&&a.live){var a=this.mainDetails;if(o.fragments[0]||(o.deltaUpdateFailed=!0),o.deltaUpdateFailed||!a)return;e=!n.details&&o.hasProgramDateTime&&a.hasProgramDateTime?(Dr(o,a),o.fragments[0].start):this.alignPlaylists(o,n.details)}n.details=o,this.levelLastLoaded=i,this.startFragRequested||!this.mainDetails&&o.live||this.setStartPosition(n.details,e),this.state!==Ur||this.waitForCdnTuneIn(o)||(this.state=Fr),this.tick()}else this.warn("Audio tracks were reset while loading level "+i)}else this.cachedTrackLoadedData=t},t._handleFragmentLoadProgress=function(d){var c=d.frag,e=d.part,r=d.payload,i=this.config,f=this.trackId,a=this.levels;if(a){var g=a[f];if(g){var m=g.details;if(!m)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(c.start);var l=i.defaultAudioCodec||g.audioCodec||"mp4a.40.2",u=(u=this.transmuxer)||(this.transmuxer=new Rn(this.hls,le,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this))),d=this.initPTS[c.cc],i=null==(a=c.initSegment)?void 0:a.data;void 0===d?(this.log("Unknown video PTS for cc "+c.cc+", waiting for video PTS before demuxing audio frag "+c.sn+" of ["+m.startSN+" ,"+m.endSN+"],track "+f),(this.waitingData=this.waitingData||{frag:c,part:e,cache:new In,complete:!1}).cache.push(new Uint8Array(r)),this.waitingVideoCC=this.videoTrackCC,this.state=Vr):(a=-1!==(g=e?e.index:-1),a=new cr(c.level,c.sn,c.stats.chunkCount,r.byteLength,g,a),u.push(r,i,l,"",c,e,m.totalduration,!1,a,d))}else this.warn("Audio track is undefined on fragment load progress")}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered")},t._handleFragmentLoadComplete=function(e){this.waitingData?this.waitingData.complete=!0:d.prototype._handleFragmentLoadComplete.call(this,e)},t.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},t.onBufferCreated=function(a,t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)},t.onFragBuffered=function(a,t){var n=t.frag,d=t.part;n.type===le?this.fragContextChanged(n)?this.warn("Fragment "+n.sn+(d?" p: "+d.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false")):("initSegment"!==n.sn&&(this.fragPrevious=n,(t=this.switchingTrack)&&(this.bufferedTrack=t,this.switchingTrack=null,this.hls.trigger(G.AUDIO_TRACK_SWITCHED,j({},t)))),this.fragBufferedComplete(n,d)):this.loadedmetadata||n.type!==oe||(n=this.videoBuffer||this.media)&&Er.getBuffered(n).length&&(this.loadedmetadata=!0)},t.onError=function(a,t){var e;if(t.fatal)this.state=Hr;else switch(t.details){case it.FRAG_GAP:case it.FRAG_PARSING_ERROR:case it.FRAG_DECRYPT_ERROR:case it.FRAG_LOAD_ERROR:case it.FRAG_LOAD_TIMEOUT:case it.KEY_LOAD_ERROR:case it.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(le,t);break;case it.AUDIO_TRACK_LOAD_ERROR:case it.AUDIO_TRACK_LOAD_TIMEOUT:case it.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Ur||(null==(e=t.context)?void 0:e.type)!==ae||(this.state=Fr);break;case it.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,d.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case it.INTERNAL_EXCEPTION:this.recoverWorkerError(t);}},t.onBufferFlushed=function(a,t){t.type===A&&(this.bufferFlushed=!0,this.state===Kr&&(this.state=Fr))},t._handleTransmuxComplete=function(f){var g=this.hls,u=f.remuxResult,m=f.chunkMeta,d=this.getCurrentContext(m),p,y,T,E,S,L,R,v;d?(y=d.frag,T=d.part,E=d.level.details,S=u.audio,v=u.text,R=u.id3,f=u.initSegment,!this.fragContextChanged(y)&&E?(this.state=Br,this.switchingTrack&&S&&this.completeAudioSwitch(this.switchingTrack),null!=f&&f.tracks&&(L=y.initSegment||y,this._bufferInitSegment(f.tracks,L,m),g.trigger(G.FRAG_PARSING_INIT_SEGMENT,{frag:L,id:"audio",tracks:f.tracks})),S&&(d=S.startPTS,u=S.endPTS,L=S.startDTS,f=S.endDTS,T&&(T.elementaryStreams[A]={startPTS:d,endPTS:u,startDTS:L,endDTS:f}),y.setElementaryStreamInfo(A,d,u,L,f),this.bufferFragmentData(S,y,T,m)),null!=R&&null!=(p=R.samples)&&p.length&&(R=qa({id:"audio",frag:y,details:E},R),g.trigger(G.FRAG_PARSING_METADATA,R)),v&&(v=qa({id:"audio",frag:y,details:E},v),g.trigger(G.FRAG_PARSING_USERDATA,v))):this.fragmentTracker.removeFragment(y)):this.resetWhenMissingContext(m)},t._bufferInitSegment=function(a,t,e){var r;this.state===Br&&(a.video&&delete a.video,(r=a.audio)&&(r.levelCodec=r.codec,r.id="audio",this.log("Init audio buffer, container:"+r.container+", codecs[parsed]=["+r.codec+"]"),this.hls.trigger(G.BUFFER_CODECS,a),null!=(r=r.initSegment)&&r.byteLength&&(r={type:"audio",frag:t,part:null,chunkMeta:e,parent:t.type,data:r},this.hls.trigger(G.BUFFER_APPENDING,r)),this.tick()))},t.loadFragment=function(a,t,e){var r=this.fragmentTracker.getState(a);this.fragCurrent=a,this.switchingTrack||r===$e||r===ir?"initSegment"===a.sn?this._loadInitSegment(a,t):null!=(r=t.details)&&r.live&&!this.initPTS[a.cc]?(this.log("Waiting for video PTS in continuity counter "+a.cc+" of live stream before loading audio fragment "+a.sn+" of level "+this.trackId),this.state=Vr):(this.startFragRequested=!0,d.prototype.loadFragment.call(this,a,t,e)):this.clearTrackerIfNeeded(a)},t.completeAudioSwitch=function(a){var t=this.hls,e=this.media,r=this.bufferedTrack,o=null==r?void 0:r.attrs,r=a.attrs;e&&o&&(o.CHANNELS!==r.CHANNELS||o.NAME!==r.NAME||o.LANGUAGE!==r.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),d.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=a,this.switchingTrack=null,t.trigger(G.AUDIO_TRACK_SWITCHED,j({},a))},a}(Wr),yr=function(d){function a(e){return(e=d.call(this,e,"[audio-track-controller]")||this).tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.currentTrack=null,e.selectDefaultTrack=!0,e.registerListeners(),e}Za(a,d);var t=a.prototype;return t.registerListeners=function(){var e=this.hls;e.on(G.MANIFEST_LOADING,this.onManifestLoading,this),e.on(G.MANIFEST_PARSED,this.onManifestParsed,this),e.on(G.LEVEL_LOADING,this.onLevelLoading,this),e.on(G.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(G.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(G.ERROR,this.onError,this)},t.unregisterListeners=function(){var e=this.hls;e.off(G.MANIFEST_LOADING,this.onManifestLoading,this),e.off(G.MANIFEST_PARSED,this.onManifestParsed,this),e.off(G.LEVEL_LOADING,this.onLevelLoading,this),e.off(G.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(G.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(G.ERROR,this.onError,this)},t.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,d.prototype.destroy.call(this)},t.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},t.onManifestParsed=function(a,t){this.tracks=t.audioTracks||[]},t.onAudioTrackLoaded=function(d,t){var e=t.id,i=t.groupId,n=t.details,a=this.tracksInGroup[e],o;a&&a.groupId===i?(o=a.details,a.details=t.details,this.log("audio-track "+e+" \""+a.name+"\" lang:"+a.lang+" group:"+i+" loaded ["+n.startSN+"-"+n.endSN+"]"),e===this.trackId&&this.playlistLoaded(e,t,o)):this.warn("Track with id:"+e+" and group:"+i+" not found in active group "+a.groupId)},t.onLevelLoading=function(a,t){this.switchLevel(t.level)},t.onLevelSwitching=function(a,t){this.switchLevel(t.level)},t.switchLevel=function(a){var n=this.hls.levels[a],i;null!=n&&n.audioGroupIds&&(i=n.audioGroupIds[n.urlId],this.groupId===i?this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId):(this.groupId=i||null,a=this.tracks.filter(function(e){return!i||e.groupId===i}),this.selectDefaultTrack&&!a.some(function(e){return e.default})&&(this.selectDefaultTrack=!1),n={audioTracks:this.tracksInGroup=a},this.log("Updating audio tracks, "+a.length+" track(s) found in group:"+i),this.hls.trigger(G.AUDIO_TRACKS_UPDATED,n),this.selectInitialTrack()))},t.onError=function(a,t){!t.fatal&&t.context&&t.context.type===ae&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))},t.setAudioTrack=function(a){var t=this.tracksInGroup,d,o,s;0>a||a>=t.length?this.warn("Invalid id passed to audio-track controller"):(this.clearTimer(),s=this.currentTrack,t[this.trackId],o=(d=t[a]).groupId,t=d.name,this.log("Switching to audio-track "+a+" \""+t+"\" lang:"+d.lang+" group:"+o),this.trackId=a,this.currentTrack=d,this.selectDefaultTrack=!1,this.hls.trigger(G.AUDIO_TRACK_SWITCHING,j({},d)),d.details&&!d.details.live||(s=this.switchParams(d.url,null==s?void 0:s.details),this.loadPlaylist(s)))},t.selectInitialTrack=function(){var a=this.tracksInGroup,r=this.findTrackId(this.currentTrack)|this.findTrackId(null);-1==r?(a=new Error("No track found for running audio group-ID: "+this.groupId+" track count: "+a.length),this.warn(a.message),this.hls.trigger(G.ERROR,{type:rt.MEDIA_ERROR,details:it.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:a})):this.setAudioTrack(r)},t.findTrackId=function(a){for(var t=this.tracksInGroup,e=0,n;e<t.length;e++)if(n=t[e],!this.selectDefaultTrack||n.default){if(!a||void 0!==a.attrs["STABLE-RENDITION-ID"]&&a.attrs["STABLE-RENDITION-ID"]===n.attrs["STABLE-RENDITION-ID"])return n.id;if(a.name===n.name&&a.lang===n.lang)return n.id}return-1},t.loadPlaylist=function(a){d.prototype.loadPlaylist.call(this);var t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){var e=t.id,r=t.groupId,i=t.url;if(a)try{i=a.addDirectives(i)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("loading audio-track playlist "+e+" \""+t.name+"\" lang:"+t.lang+" group:"+r),this.clearTimer(),this.hls.trigger(G.AUDIO_TRACK_LOADING,{url:i,id:e,groupId:r,deliveryDirectives:a||null})}},qt(a,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}}]),a}(ze),ld=function(a){function r(n,t,e){return(e=a.call(this,n,t,e,"[subtitle-stream-controller]",ue)||this).levels=[],e.currentTrackId=-1,e.tracksBuffered=[],e.mainDetails=null,e._registerListeners(),e}Za(r,a);var t=r.prototype;return t.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},t._registerListeners=function(){var e=this.hls;e.on(G.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(G.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(G.MANIFEST_LOADING,this.onManifestLoading,this),e.on(G.LEVEL_LOADED,this.onLevelLoaded,this),e.on(G.ERROR,this.onError,this),e.on(G.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(G.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(G.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(G.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(G.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(G.FRAG_BUFFERED,this.onFragBuffered,this)},t._unregisterListeners=function(){var e=this.hls;e.off(G.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(G.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(G.MANIFEST_LOADING,this.onManifestLoading,this),e.off(G.LEVEL_LOADED,this.onLevelLoaded,this),e.off(G.ERROR,this.onError,this),e.off(G.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(G.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(G.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(G.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(G.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(G.FRAG_BUFFERED,this.onFragBuffered,this)},t.startLoad=function(e){this.stopLoad(),this.state=Fr,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()},t.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},t.onMediaDetaching=function(){this.tracksBuffered=[],a.prototype.onMediaDetaching.call(this)},t.onLevelLoaded=function(a,t){this.mainDetails=t.details},t.onSubtitleFragProcessed=function(d,t){var o=t.frag,t=t.success;if(this.fragPrevious=o,this.state=Fr,t){var r=this.tracksBuffered[this.currentTrackId];if(r){for(var i=o.start,a=0,l;a<r.length;a++)if(i>=r[a].start&&i<=r[a].end){l=r[a];break}t=o.start+o.duration,l?l.end=t:(l={start:i,end:t},r.push(l)),this.fragmentTracker.fragBuffered(o)}}},t.onBufferFlushing=function(d,t){var e=t.startOffset,a=t.endOffset,o,s,l;0===e&&a!==Number.POSITIVE_INFINITY&&(o=this.currentTrackId,(s=this.levels).length&&s[o]&&s[o].details&&(0>=(l=a-s[o].details.targetduration)||(t.endOffsetSubtitles=Math.max(0,l),this.tracksBuffered.forEach(function(a){for(var t=0;t<a.length;)if(a[t].end<=l)a.shift();else{if(!(a[t].start<l))break;a[t].start=l,t++}}),this.fragmentTracker.removeFragmentsInRange(e,l,ue))))},t.onFragBuffered=function(a,t){this.loadedmetadata||t.frag.type!==oe||null!=(t=this.media)&&t.buffered.length&&(this.loadedmetadata=!0)},t.onError=function(a,t){t=t.frag,(null==t?void 0:t.type)===ue&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==xr&&(this.state=Fr))},t.onSubtitleTracksUpdated=function(a,t){var n=this,t=t.subtitleTracks;Mn(this.levels,t)?this.levels=t.map(function(e){return new De(e)}):(this.tracksBuffered=[],this.levels=t.map(function(e){return e=new De(e),n.tracksBuffered[e.id]=[],e}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ue),this.fragPrevious=null,this.mediaBuffer=null)},t.onSubtitleTrackSwitch=function(a,t){this.currentTrackId=t.id,this.levels.length&&-1!==this.currentTrackId?(this.mediaBuffer=null!=(t=this.levels[this.currentTrackId])&&t.details?this.mediaBufferTimeRanges:null,t&&this.setInterval(500)):this.clearInterval()},t.onSubtitleTrackLoaded=function(d,t){var o=t.details,r=t.id,i=this.currentTrackId,l=this.levels;if(l.length&&(t=l[i],!(r>=l.length||r!==i)&&t)){if(this.mediaBuffer=this.mediaBufferTimeRanges,l=0,o.live||null!=(u=t.details)&&u.live){if(i=this.mainDetails,o.deltaUpdateFailed||!i)return;var u=i.fragments[0];t.details?0===(l=this.alignPlaylists(o,t.details))&&u&&Oe(o,l=u.start):o.hasProgramDateTime&&i.hasProgramDateTime?(Dr(o,i),l=o.fragments[0].start):u&&Oe(o,l=u.start)}t.details=o,this.levelLastLoaded=r,this.startFragRequested||!this.mainDetails&&o.live||this.setStartPosition(t.details,l),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===Fr&&(Ye(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),t.details=void 0))}},t._handleFragmentLoadComplete=function(d){var o=this,s=d.frag,e=d.payload,d=s.decryptdata,n=this.hls,a;!this.fragContextChanged(s)&&e&&0<e.byteLength&&d&&d.key&&d.iv&&"AES-128"===d.method&&(a=performance.now(),this.decrypter.decrypt(new Uint8Array(e),d.key.buffer,d.iv.buffer).catch(function(e){throw n.trigger(G.ERROR,{type:rt.MEDIA_ERROR,details:it.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:s}),e}).then(function(r){var t=performance.now();n.trigger(G.FRAG_DECRYPTED,{frag:s,payload:r,stats:{tstart:a,tdecrypt:t}})}).catch(function(e){o.warn(e.name+": "+e.message),o.state=Fr}))},t.doTick=function(){var d,l,u,c,f,g,m,p;this.media?this.state===Fr&&(l=this.currentTrackId,d=(c=this.levels)[l],c.length&&d&&d.details&&(g=(m=d.details).targetduration,p=this.config,f=this.getLoadPosition(),l=(u=Er.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],f-g,p.maxBufferHole)).end,c=u.len,f=this.getFwdBufferInfo(this.media,oe),c>this.getMaxBufferLength(null==f?void 0:f.len)+g||(c=(u=m.fragments).length,f=m.edge,g=null,m=this.fragPrevious,l<f?(p=p.maxFragLookUpTolerance,!(g=Ye(m,u,Math.max(u[0].start,l),p))&&m&&m.start<u[0].start&&(g=u[0])):g=u[c-1],g&&(g=this.mapToInitFragWhenRequired(g),this.fragmentTracker.getState(g)===$e&&this.loadFragment(g,d,l))))):this.state=Fr},t.getMaxBufferLength=function(r){var t=a.prototype.getMaxBufferLength.call(this);return r?Math.max(t,r):t},t.loadFragment=function(n,t,e){"initSegment"===(this.fragCurrent=n).sn?this._loadInitSegment(n,t):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,n,t,e))},qt(r,[{key:"mediaBufferTimeRanges",get:function(){return new wn(this.tracksBuffered[this.currentTrackId]||[])}}]),r}(Wr),wn=function(a){function r(n,t,i){if((t>>>=0)>i-1)throw new DOMException("Failed to execute '"+n+"' on 'TimeRanges': The index provided ("+t+") is greater than the maximum bound ("+i+")");return a[t][n]}this.buffered=void 0,this.buffered={get length(){return a.length},end:function(e){return r("end",e,a.length)},start:function(e){return r("start",e,a.length)}}},Nn=function(d){function a(a){var t;return(t=d.call(this,a,"[subtitle-track-controller]")||this).media=null,t.tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.selectDefaultTrack=!0,t.queuedDefaultTrack=-1,t.trackChangeListener=function(){return t.onTextTracksChanged()},t.asyncPollTrackChange=function(){return t.pollTrackChange(0)},t.useTextTrackPolling=!1,t.subtitlePollingInterval=-1,t._subtitleDisplay=!0,t.registerListeners(),t}Za(a,d);var t=a.prototype;return t.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,d.prototype.destroy.call(this)},t.registerListeners=function(){var e=this.hls;e.on(G.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(G.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(G.MANIFEST_LOADING,this.onManifestLoading,this),e.on(G.MANIFEST_PARSED,this.onManifestParsed,this),e.on(G.LEVEL_LOADING,this.onLevelLoading,this),e.on(G.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(G.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(G.ERROR,this.onError,this)},t.unregisterListeners=function(){var e=this.hls;e.off(G.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(G.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(G.MANIFEST_LOADING,this.onManifestLoading,this),e.off(G.MANIFEST_PARSED,this.onManifestParsed,this),e.off(G.LEVEL_LOADING,this.onLevelLoading,this),e.off(G.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(G.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(G.ERROR,this.onError,this)},t.onMediaAttached=function(a,t){this.media=t.media,this.media&&(-1<this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},t.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},t.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),-1<this.trackId&&(this.queuedDefaultTrack=this.trackId),On(this.media.textTracks).forEach(function(e){ve(e)}),this.subtitleTrack=-1,this.media=null)},t.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},t.onManifestParsed=function(a,t){this.tracks=t.subtitleTracks},t.onSubtitleTrackLoaded=function(d,t){var e=t.id,r=t.details,i=this.trackId,o=this.tracksInGroup[i];o?(i=o.details,o.details=t.details,this.log("subtitle track "+e+" loaded ["+r.startSN+"-"+r.endSN+"]"),e===this.trackId&&this.playlistLoaded(e,t,i)):this.warn("Invalid subtitle track id "+e)},t.onLevelLoading=function(a,t){this.switchLevel(t.level)},t.onLevelSwitching=function(a,t){this.switchLevel(t.level)},t.switchLevel=function(a){var d=this.hls.levels[a],o,s,l;null!=d&&d.textGroupIds&&(o=d.textGroupIds[d.urlId],s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,this.groupId===o?this.shouldReloadPlaylist(s)&&this.setSubtitleTrack(this.trackId,s):(l=this.tracks.filter(function(e){return!o||e.groupId===o}),this.tracksInGroup=l,a=this.findTrackId(null==s?void 0:s.name)||this.findTrackId(),this.groupId=o||null,d={subtitleTracks:l},this.log("Updating subtitle tracks, "+l.length+" track(s) found in \""+o+"\" group-id"),this.hls.trigger(G.SUBTITLE_TRACKS_UPDATED,d),-1!==a&&this.setSubtitleTrack(a,s)))},t.findTrackId=function(a){for(var t=this.tracksInGroup,e=0,n;e<t.length;e++)if(n=t[e],(!this.selectDefaultTrack||n.default)&&(!a||a===n.name))return n.id;return-1},t.onError=function(a,t){!t.fatal&&t.context&&t.context.type===se&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)},t.loadPlaylist=function(a){d.prototype.loadPlaylist.call(this);var t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){var e=t.id,r=t.groupId,i=t.url;if(a)try{i=a.addDirectives(i)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("Loading subtitle playlist for id "+e),this.hls.trigger(G.SUBTITLE_TRACK_LOADING,{url:i,id:e,groupId:r,deliveryDirectives:a||null})}},t.toggleTrackModes=function(a){var d=this,r=this.media,o=this.trackId,s;r&&(r=(s=On(r.textTracks)).filter(function(e){return e.groupId===d.groupId}),-1===a?[].slice.call(s).forEach(function(e){e.mode="disabled"}):(o=r[o])&&(o.mode="disabled"),(a=r[a])&&(a.mode=this.subtitleDisplay?"showing":"hidden"))},t.setSubtitleTrack=function(d,t){var l=this.tracksInGroup,u,c,f,g,m;this.media?(this.trackId!==d&&this.toggleTrackModes(d),this.trackId===d&&(-1===d||null!=(g=l[d])&&g.details)||-1>d||d>=l.length||(this.clearTimer(),u=l[d],this.log("Switching to subtitle-track "+d+(u?" \""+u.name+"\" lang:"+u.lang+" group:"+u.groupId:"")),this.trackId=d,u?(c=u.id,f=void 0===(m=u.groupId)?"":m,g=u.name,l=u.type,m=u.url,this.hls.trigger(G.SUBTITLE_TRACK_SWITCH,{id:c,groupId:f,name:g,type:l,url:m}),t=this.switchParams(u.url,null==t?void 0:t.details),this.loadPlaylist(t)):this.hls.trigger(G.SUBTITLE_TRACK_SWITCH,{id:d}))):this.queuedDefaultTrack=d},t.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var a=-1,n=On(this.media.textTracks),e=0;e<n.length;e++)if("hidden"===n[e].mode)a=e;else if("showing"===n[e].mode){a=e;break}this.subtitleTrack!==a&&(this.subtitleTrack=a)}},qt(a,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,-1<this.trackId&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(a){this.selectDefaultTrack=!1;var t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(a,t)}}]),a}(ze),Kd=((Ld=fa.prototype).append=function(a,t){var e=this.queues[t];e.push(a),1===e.length&&this.buffers[t]&&this.executeNext(t)},Ld.insertAbort=function(a,t){this.queues[t].unshift(a),this.executeNext(t)},Ld.appendBlocker=function(a){var t=new Promise(function(e){n=e}),r={execute:n,onStart:function(){},onComplete:function(){},onError:function(){}},n;return this.append(r,a),t},Ld.executeNext=function(a){var t=this.buffers,d=this.queues,o=t[a],d=d[a];if(d.length){var i=d[0];try{i.execute()}catch(t){nt.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),i.onError(t),null!=o&&o.updating||(d.shift(),this.executeNext(a))}}},Ld.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},Ld.current=function(e){return this.queues[e][0]},fa),Hn=Bt(),Vn=/([ha]vc.)(?:\.[^.,]+)+/,Yn=((C=ca.prototype).hasSourceTypes=function(){return 0<this.getSourceBufferTypes().length||0<Object.keys(this.pendingTracks).length},C.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},C.registerListeners=function(){var e=this.hls;e.on(G.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(G.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(G.MANIFEST_LOADING,this.onManifestLoading,this),e.on(G.MANIFEST_PARSED,this.onManifestParsed,this),e.on(G.BUFFER_RESET,this.onBufferReset,this),e.on(G.BUFFER_APPENDING,this.onBufferAppending,this),e.on(G.BUFFER_CODECS,this.onBufferCodecs,this),e.on(G.BUFFER_EOS,this.onBufferEos,this),e.on(G.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(G.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(G.FRAG_PARSED,this.onFragParsed,this),e.on(G.FRAG_CHANGED,this.onFragChanged,this)},C.unregisterListeners=function(){var e=this.hls;e.off(G.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(G.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(G.MANIFEST_LOADING,this.onManifestLoading,this),e.off(G.MANIFEST_PARSED,this.onManifestParsed,this),e.off(G.BUFFER_RESET,this.onBufferReset,this),e.off(G.BUFFER_APPENDING,this.onBufferAppending,this),e.off(G.BUFFER_CODECS,this.onBufferCodecs,this),e.off(G.BUFFER_EOS,this.onBufferEos,this),e.off(G.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(G.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(G.FRAG_PARSED,this.onFragParsed,this),e.off(G.FRAG_CHANGED,this.onFragChanged,this)},C._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new Kd(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},C.onManifestLoading=function(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null},C.onManifestParsed=function(a,t){var e=2;(!t.audio||t.video)&&t.altAudio||(e=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=e,nt.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},C.onMediaAttaching=function(a,t){var n=this.media=t.media;n&&Hn&&((t=this.mediaSource=new Hn).addEventListener("sourceopen",this._onMediaSourceOpen),t.addEventListener("sourceended",this._onMediaSourceEnded),t.addEventListener("sourceclose",this._onMediaSourceClose),n.src=self.URL.createObjectURL(t),this._objectUrl=n.src,n.addEventListener("emptied",this._onMediaEmptied))},C.onMediaDetaching=function(){var a=this.media,t=this.mediaSource,e=this._objectUrl;if(t){if(nt.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(e){nt.warn("[buffer-controller]: onMediaDetaching: "+e.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),a&&(a.removeEventListener("emptied",this._onMediaEmptied),e&&self.URL.revokeObjectURL(e),a.src===e?(a.removeAttribute("src"),a.load()):nt.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(G.MEDIA_DETACHED,void 0)},C.onBufferReset=function(){var a=this;this.getSourceBufferTypes().forEach(function(r){var e=a.sourceBuffer[r];try{e&&(a.removeBufferListeners(r),a.mediaSource&&a.mediaSource.removeSourceBuffer(e),a.sourceBuffer[r]=void 0)}catch(e){nt.warn("[buffer-controller]: Failed to reset the "+r+" buffer",e)}}),this._initSourceBuffer()},C.onBufferCodecs=function(e,f){var g=this,d=this.getSourceBufferTypes().length;Object.keys(f).forEach(function(c){var t,m,p,y,h,T,E,S,L;d?(t=g.tracks[c])&&"function"==typeof t.buffer.changeType&&(m=(L=f[c]).id,p=L.codec,y=L.levelCodec,h=L.container,T=L.metadata,(E=(t.levelCodec||t.codec).replace(Vn,"$1"))!==(S=(y||p).replace(Vn,"$1"))&&(L=h+";codecs="+(y||p),g.appendChangeType(c,L),nt.log("[buffer-controller]: switching codec "+E+" to "+S),g.tracks[c]={buffer:t.buffer,codec:p,container:h,levelCodec:y,metadata:T,id:m})):g.pendingTracks[c]=f[c]}),d||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},C.appendChangeType=function(a,e){var r=this,i=this.operationQueue;i.append({execute:function(){var n=r.sourceBuffer[a];n&&(nt.log("[buffer-controller]: changing "+a+" sourceBuffer type to "+e),n.changeType(e)),i.shiftAndExecuteNext(a)},onStart:function(){},onComplete:function(){},onError:function(e){nt.warn("[buffer-controller]: Failed to change "+a+" SourceBuffer type",e)}},a)},C.onBufferAppending=function(p,t){var y=this,n=this.hls,r=this.operationQueue,i=this.tracks,T=t.data,s=t.type,o=t.frag,l=t.part,u=t.chunkMeta,h=u.buffering[s],t=self.performance.now();h.start=t;var d=o.stats.buffering,c=l?l.stats.buffering:null;0===d.start&&(d.start=t),c&&0===c.start&&(c.start=t);var i=i.audio,f=!1;"audio"===s&&"audio/mpeg"===(null==i?void 0:i.container)&&(f=!this.lastMpegAudioChunk||1===u.id||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);var E=o.start,i={execute:function(){var a,r;h.executeStart=self.performance.now(),f&&(a=y.sourceBuffer[s])&&(r=E-a.timestampOffset,.1<=Math.abs(r)&&(nt.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+E+" (delta: "+r+") sn: "+o.sn+")"),a.timestampOffset=E)),y.appendExecutor(T,s)},onStart:function(){},onComplete:function(){var a=self.performance.now();h.executeEnd=h.end=a,0===d.first&&(d.first=a),c&&0===c.first&&(c.first=a);var t=y.sourceBuffer,r={},n;for(n in t)r[n]=Er.getBuffered(t[n]);y.appendError=0,y.hls.trigger(G.BUFFER_APPENDED,{type:s,frag:o,part:l,chunkMeta:u,parent:o.type,timeRanges:r})},onError:function(a){nt.error("[buffer-controller]: Error encountered while trying to append to the "+s+" SourceBuffer",a);var t={type:rt.MEDIA_ERROR,parent:o.type,details:it.BUFFER_APPEND_ERROR,frag:o,part:l,chunkMeta:u,error:a,err:a,fatal:!1};a.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=it.BUFFER_FULL_ERROR:(y.appendError++,t.details=it.BUFFER_APPEND_ERROR,y.appendError>n.config.appendErrorMaxRetry&&(nt.error("[buffer-controller]: Failed "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),t.fatal=!0)),n.trigger(G.ERROR,t)}};r.append(i,s)},C.onBufferFlushing=function(a,t){function r(a){return{execute:d.removeExecutor.bind(d,a,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){d.hls.trigger(G.BUFFER_FLUSHED,{type:a})},onError:function(e){nt.warn("[buffer-controller]: Failed to remove from "+a+" SourceBuffer",e)}}}var d=this,e=this.operationQueue;t.type?e.append(r(t.type),t.type):this.getSourceBufferTypes().forEach(function(a){e.append(r(a),a)})},C.onFragParsed=function(d,t){var o=this,r=t.frag,i=t.part,n=[],t=(i||r).elementaryStreams;t[w]?n.push("audiovideo"):(t[A]&&n.push("audio"),t[I]&&n.push("video")),0===n.length&&nt.warn("Fragments must have at least one ElementaryStreamType set. type: "+r.type+" level: "+r.level+" sn: "+r.sn),this.blockBuffers(function(){var e=self.performance.now();r.stats.buffering.end=e,i&&(i.stats.buffering.end=e),e=(i||r).stats,o.hls.trigger(G.FRAG_BUFFERED,{frag:r,part:i,stats:e,id:r.type})},n)},C.onFragChanged=function(){this.flushBackBuffer()},C.onBufferEos=function(e,a){var i=this;this.getSourceBufferTypes().reduce(function(n,t){var e=i.sourceBuffer[t];return!e||a.type&&a.type!==t||(e.ending=!0,e.ended||(e.ended=!0,nt.log("[buffer-controller]: "+t+" sourceBuffer now EOS"))),n&&(!e||e.ended)},!0)&&(nt.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){i.getSourceBufferTypes().forEach(function(e){e=i.sourceBuffer[e],e&&(e.ending=!1)});var e=i.mediaSource;e&&"open"===e.readyState?(nt.log("[buffer-controller]: Calling mediaSource.endOfStream()"),e.endOfStream()):e&&nt.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+e.readyState)}))},C.onLevelUpdated=function(a,t){t=t.details,t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},C.flushBackBuffer=function(){var d=this.hls,s=this.details,o=this.media,u=this.sourceBuffer,r,l,c,f,g;!o||null===s||(r=this.getSourceBufferTypes()).length&&(f=s.live&&null!==d.config.liveBackBufferLength?d.config.liveBackBufferLength:d.config.backBufferLength,!yd(f)||0>f||(l=o.currentTime,c=s.levelTargetDuration,f=Math.max(f,c),g=Math.floor(l/c)*c-f,r.forEach(function(a){var t=u[a];if(t){var e=Er.getBuffered(t);if(0<e.length&&g>e.start(0)){if(d.trigger(G.BACK_BUFFER_REACHED,{bufferEnd:g}),s.live)d.trigger(G.LIVE_BACK_BUFFER_REACHED,{bufferEnd:g});else if(t.ended&&e.end(e.length-1)-l<2*c)return void nt.info("[buffer-controller]: Cannot flush "+a+" back buffer while SourceBuffer is in ended state");d.trigger(G.BUFFER_FLUSHING,{startOffset:0,endOffset:g,type:a})}}})))},C.updateMediaElementDuration=function(){var d,o,s,l,u,c;this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState&&(d=this.details,o=this.hls,c=this.media,s=this.mediaSource,l=d.fragments[0].start+d.totalduration,u=c.duration,c=yd(s.duration)?s.duration:0,d.live&&o.config.liveDurationInfinity?(nt.log("[buffer-controller]: Media Source duration is set to Infinity"),s.duration=1/0,this.updateSeekableRange(d)):(c<l&&u<l||!yd(u))&&(nt.log("[buffer-controller]: Updating Media Source duration to "+l.toFixed(3)),s.duration=l))},C.updateSeekableRange=function(a){var n=this.mediaSource,e=a.fragments;e.length&&a.live&&null!=n&&n.setLiveSeekableRange&&(e=Math.max(0,e[0].start),a=Math.max(e,e+a.totalduration),n.setLiveSeekableRange(e,a))},C.checkPendingTracks=function(){var a=this.bufferCodecEventsExpected,n=this.operationQueue,e=this.pendingTracks,t=Object.keys(e).length;(t&&!a||2===t)&&(this.createSourceBuffers(e),this.pendingTracks={},(e=this.getSourceBufferTypes()).length?(this.hls.trigger(G.BUFFER_CREATED,{tracks:this.tracks}),e.forEach(function(e){n.executeNext(e)})):(e=new Error("could not create source buffer for media codec(s)"),this.hls.trigger(G.ERROR,{type:rt.MEDIA_ERROR,details:it.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})))},C.createSourceBuffers=function(d){var t=this.sourceBuffer,r=this.mediaSource,i;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(i in d)if(!t[i]){var u=d[i];if(!u)throw Error("source buffer exists for track "+i+", however track does not");var n=u.levelCodec||u.codec,a=u.container+";codecs="+n;nt.log("[buffer-controller]: creating sourceBuffer("+a+")");try{var s=t[i]=r.addSourceBuffer(a),o=i;this.addBufferListener(o,"updatestart",this._onSBUpdateStart),this.addBufferListener(o,"updateend",this._onSBUpdateEnd),this.addBufferListener(o,"error",this._onSBUpdateError),this.tracks[i]={buffer:s,codec:n,container:u.container,levelCodec:u.levelCodec,metadata:u.metadata,id:u.id}}catch(e){nt.error("[buffer-controller]: error while trying to add sourceBuffer: "+e.message),this.hls.trigger(G.ERROR,{type:rt.MEDIA_ERROR,details:it.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,mimeType:a})}}},C._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},C._onSBUpdateEnd=function(a){var t=this.operationQueue;t.current(a).onComplete(),t.shiftAndExecuteNext(a)},C._onSBUpdateError=function(a,n){var e=new Error(a+" SourceBuffer error");nt.error("[buffer-controller]: "+e,n),this.hls.trigger(G.ERROR,{type:rt.MEDIA_ERROR,details:it.BUFFER_APPENDING_ERROR,error:e,fatal:!1}),a=this.operationQueue.current(a),a&&a.onError(n)},C.removeExecutor=function(d,t,o){var r=this.media,l=this.mediaSource,u=this.operationQueue,a=this.sourceBuffer[d];return r&&l&&a?void(r=yd(r.duration)?r.duration:1/0,l=yd(l.duration)?l.duration:1/0,t=Math.max(0,t),l=Math.min(o,r,l),t<l&&!a.ending?(a.ended=!1,nt.log("[buffer-controller]: Removing ["+t+","+l+"] from the "+d+" SourceBuffer"),a.remove(t,l)):u.shiftAndExecuteNext(d)):(nt.warn("[buffer-controller]: Attempting to remove from the "+d+" SourceBuffer, but it does not exist"),void u.shiftAndExecuteNext(d))},C.appendExecutor=function(a,t){var e=this.operationQueue,r=this.sourceBuffer[t];return r?void(r.ended=!1,r.appendBuffer(a)):(nt.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void e.shiftAndExecuteNext(t))},C.blockBuffers=function(a,t){var d=this;if(void 0===t&&(t=this.getSourceBufferTypes()),!t.length)return nt.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(a);var r=this.operationQueue,i=t.map(function(e){return r.appendBlocker(e)});Promise.all(i).then(function(){a(),t.forEach(function(a){var t=d.sourceBuffer[a];null!=t&&t.updating||r.shiftAndExecuteNext(a)})})},C.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},C.addBufferListener=function(a,t,e){var n=this.sourceBuffer[a];n&&(e=e.bind(this,a),this.listeners[a].push({event:t,listener:e}),n.addEventListener(t,e))},C.removeBufferListeners=function(a){var r=this.sourceBuffer[a];r&&this.listeners[a].forEach(function(e){r.removeEventListener(e.event,e.listener)})},ca),Hd={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},jn=100,qn={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Xn={17:2,18:4,21:6,22:8,23:10,19:13,20:15},zn={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Qn={25:2,26:4,29:6,30:8,31:10,27:13,28:15},$n=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Jn=(da.prototype.log=function(a,t){this.verboseLevel>=a&&(t="function"==typeof t?t():t,nt.log(this.time+" ["+a+"] "+t))},da),Zn=((vd=ha.prototype).reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},vd.setStyles=function(a){for(var t=["foreground","underline","italics","background","flash"],e=0,n;e<t.length;e++)n=t[e],a.hasOwnProperty(n)&&(this[n]=a[n])},vd.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},vd.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},vd.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},vd.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},ha),ta=((Xi=ua.prototype).reset=function(){this.uchar=" ",this.penState.reset()},Xi.setChar=function(a,t){this.uchar=a,this.penState.copy(t)},Xi.setPenState=function(e){this.penState.copy(e)},Xi.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},Xi.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},Xi.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},ua),ea=((ti=la.prototype).equals=function(a){for(var t=!0,n=0;n<jn;n++)if(!this.chars[n].equals(a.chars[n])){t=!1;break}return t},ti.copy=function(a){for(var t=0;t<jn;t++)this.chars[t].copy(a.chars[t])},ti.isEmpty=function(){for(var a=!0,r=0;r<jn;r++)if(!this.chars[r].isEmpty()){a=!1;break}return a},ti.setCursor=function(e){this.pos!==e&&(this.pos=e),0>this.pos?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>jn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=jn)},ti.moveCursor=function(a){var t=this.pos+a;if(1<a)for(var e=this.pos+1;e<t+1;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(t)},ti.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},ti.insertChar=function(a){var t=this;144<=a&&this.backSpace();var e=Bn(a);this.pos>=jn?this.logger.log(0,function(){return"Cannot insert "+a.toString(16)+" ("+e+") at position "+t.pos+". Skipping it!"}):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},ti.clearFromPos=function(a){for(var t=a;t<jn;t++)this.chars[t].reset()},ti.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},ti.clearToEndOfRow=function(){this.clearFromPos(this.pos)},ti.getTextString=function(){for(var a=[],t=!0,n=0,d;n<jn;n++)d=this.chars[n].uchar," "!==d&&(t=!1),a.push(d);return t?"":a.join("")},ti.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},la),ra=((Wr=oa.prototype).reset=function(){for(var e=0;15>e;e++)this.rows[e].clear();this.currRow=14},Wr.equals=function(a){for(var t=!0,n=0;15>n;n++)if(!this.rows[n].equals(a.rows[n])){t=!1;break}return t},Wr.copy=function(a){for(var t=0;15>t;t++)this.rows[t].copy(a.rows[t])},Wr.isEmpty=function(){for(var a=!0,r=0;15>r;r++)if(!this.rows[r].isEmpty()){a=!1;break}return a},Wr.backSpace=function(){this.rows[this.currRow].backSpace()},Wr.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},Wr.insertChar=function(e){this.rows[this.currRow].insertChar(e)},Wr.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},Wr.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},Wr.setCursor=function(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},Wr.setPAC=function(d){this.logger.log(2,function(){return"pacData = "+JSON.stringify(d)});var t=d.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var u=0;15>u;u++)this.rows[u].clear();var c=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var n=i.rows[c].cueStartTime,a=this.logger.time;if(n&&null!==a&&n<a)for(var f=0;f<this.nrRollUpRows;f++)this.rows[t-this.nrRollUpRows+f+1].copy(i.rows[c+f])}}this.currRow=t,a=this.rows[this.currRow],null!==d.indent&&(g=d.indent,g=Math.max(g-1,0),a.setCursor(d.indent),d.color=a.chars[g].penState.foreground);var g={foreground:d.color,underline:d.underline,italics:d.italics,background:"black",flash:!1};this.setPen(g)},Wr.setBkgData=function(e){this.logger.log(2,function(){return"bkgData = "+JSON.stringify(e)}),this.backSpace(),this.setPen(e),this.insertChar(32)},Wr.setRollUpRows=function(e){this.nrRollUpRows=e},Wr.rollUp=function(){var a=this,e;null===this.nrRollUpRows?this.logger.log(3,"roll_up but nrRollUpRows not set yet"):(this.logger.log(1,function(){return a.getDisplayText()}),e=this.currRow+1-this.nrRollUpRows,(e=this.rows.splice(e,1)[0]).clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up"))},Wr.getDisplayText=function(d){d=d||!1;for(var o=[],r="",s=0,l,u;15>s;s++)u=this.rows[s].getTextString(),u&&(l=s+1,d?o.push("Row "+l+": '"+u+"'"):o.push(u.trim()));return 0<o.length&&(r=d?"["+o.join(" | ")+"]":o.join("\n")),r},Wr.getTextAndFormat=function(){return this.rows},oa),ia=((ze=sa.prototype).reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},ze.getHandler=function(){return this.outputFilter},ze.setHandler=function(e){this.outputFilter=e},ze.setPAC=function(e){this.writeScreen.setPAC(e)},ze.setBkgData=function(e){this.writeScreen.setBkgData(e)},ze.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(2,function(){return"MODE="+e}),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},ze.insertChars=function(a){for(var t=this,e=0;e<a.length;e++)this.writeScreen.insertChar(a[e]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,function(){return n+": "+t.writeScreen.getDisplayText(!0)}),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,function(){return"DISPLAYED: "+t.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},ze.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},ze.ccBS=function(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},ze.ccAOF=function(){},ze.ccAON=function(){},ze.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},ze.ccRU=function(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},ze.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},ze.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},ze.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},ze.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},ze.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},ze.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},ze.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},ze.ccEOC=function(){var a=this,e;this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode&&(e=this.displayedMemory,this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,function(){return"DISP: "+a.displayedMemory.getDisplayText()})),this.outputDataUpdate(!0)},ze.ccTO=function(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},ze.ccMIDROW=function(a){var r={flash:!1};r.underline=1==a%2,r.italics=46<=a,r.italics?r.foreground="white":(a=Math.floor(a/2)-16,r.foreground=["white","green","blue","cyan","red","yellow","magenta"][a]),this.logger.log(2,"MIDROW: "+JSON.stringify(r)),this.writeScreen.setPen(r)},ze.outputDataUpdate=function(a){void 0===a&&(a=!1);var r=this.logger.time;null!==r&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,r,this.lastOutputScreen),a&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:r):this.cueStartTime=r,this.lastOutputScreen.copy(this.displayedMemory))},ze.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},sa),na=((Ld=Kn.prototype).getHandler=function(e){return this.channels[e].getHandler()},Ld.setHandler=function(a,t){this.channels[a].setHandler(t)},Ld.addData=function(d,t){var e=!1,l;this.logger.time=d;for(var u=0;u<t.length;u+=2){var c=127&t[u],s=127&t[u+1],o;0==c&&0==s||(this.logger.log(3,"["+Gn([t[u],t[u+1]])+"] -> ("+Gn([c,s])+")"),(l=this.parseCmd(c,s))||(l=this.parseMidrow(c,s)),!(l=(l=l||this.parsePAC(c,s))||this.parseBackgroundAttributes(c,s))&&(e=this.parseChars(c,s))&&((o=this.currentChannel)&&0<o?this.channels[o].insertChars(e):this.logger.log(2,"No channel found yet. TEXT-MODE?")),l||e||this.logger.log(2,"Couldn't parse cleaned data "+Gn([c,s])+" orig: "+Gn([t[u],t[u+1]])))}},Ld.parseCmd=function(a,t){var e=this.cmdHistory;if(!((20===a||28===a||21===a||29===a)&&32<=t&&47>=t||(23===a||31===a)&&33<=t&&35>=t))return!1;if(ma(a,t,e))return ga(null,null,e),this.logger.log(3,"Repeated command ("+Gn([a,t])+") is dropped"),!0;var r=20===a||21===a||23===a?1:2,i=this.channels[r];return 20===a||21===a||28===a||29===a?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47==t&&i.ccEOC():i.ccTO(t-32),ga(a,t,e),this.currentChannel=r,!0},Ld.parseMidrow=function(a,t){var e=0;return!!((17===a||25===a)&&32<=t&&47>=t)&&((e=17===a?1:2)===this.currentChannel?(e=this.channels[e],!!e&&(e.ccMIDROW(t),this.logger.log(3,"MIDROW ("+Gn([a,t])+")"),!0)):(this.logger.log(0,"Mismatch channel in midrow parsing"),!1))},Ld.parsePAC=function(d,t){var e=this.cmdHistory;if(!((17<=d&&23>=d||25<=d&&31>=d)&&64<=t&&127>=t||(16===d||24===d)&&64<=t&&95>=t))return!1;if(ma(d,t,e))return ga(null,null,e),!0;var r=23>=d?1:2,i=(64<=t&&95>=t?1==r?qn:zn:1==r?Xn:Qn)[d],n=this.channels[r];return!!n&&(n.setPAC(this.interpretPAC(i,t)),ga(d,t,e),this.currentChannel=r,!0)},Ld.interpretPAC=function(a,r){return a={color:null,italics:!1,indent:null,underline:!1,row:a},r=95<r?r-96:r-64,(a.underline=1==(1&r),13>=r?a.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:15>=r?(a.italics=!0,a.color="white"):a.indent=4*Math.floor((r-16)/2),a)},Ld.parseChars=function(d,t){var e=null,o=null,s,l;return 17<=(o=25<=d?(s=2,d-8):(s=1,d))&&19>=o?(l=17===o?t+80:18===o?t+112:t+144,this.logger.log(2,"Special char '"+Bn(l)+"' in channel "+s),e=[l]):32<=d&&127>=d&&(e=0===t?[d]:[d,t]),e&&(l=Gn(e),this.logger.log(3,"Char codes =  "+l.join(",")),ga(d,t,this.cmdHistory)),e},Ld.parseBackgroundAttributes=function(a,t){if(!((16===a||24===a)&&32<=t&&47>=t||(23===a||31===a)&&45<=t&&47>=t))return!1;var e={};16===a||24===a?(r=Math.floor((t-32)/2),e.background=$n[r],1==t%2&&(e.background+="_semi")):45===t?e.background="transparent":(e.foreground="black",47==t&&(e.underline=!0));var r=23>=a?1:2;return this.channels[r].setBkgData(e),ga(a,t,this.cmdHistory),!0},Ld.reset=function(){for(var a=0,r;a<Object.keys(this.channels).length;a++)r=this.channels[a],r&&r.reset();this.cmdHistory={a:null,b:null}},Ld.cueSplitAtTime=function(a){for(var t=0,n;t<this.channels.length;t++)n=this.channels[t],n&&n.cueSplitAtTime(a)},Kn),aa=((C=Ea.prototype).dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},C.newCue=function(a,t,e){(null===this.startTime||this.startTime>a)&&(this.startTime=a),this.endTime=t,this.screen=e,this.timelineController.createCaptionsTrack(this.trackName)},C.reset=function(){this.cueRanges=[],this.startTime=null},Ea),pa=function(){function a(a,t){return"string"==typeof t&&!!Array.isArray(a)&&(t=t.toLowerCase(),!!~a.indexOf(t)&&t)}function r(e){return a(d,e)}function E(d){for(var t=arguments.length,e=Array(1<t?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];for(var o=1;o<arguments.length;o++){var l=arguments[o],s;for(s in l)d[s]=l[s]}return d}function n(T,t,e){var S=this,L={enumerable:!0};S.hasBeenReset=!1;var n="",R=!1,A=T,k=t,D=e,I=null,b="",C=!0,_="auto",x="start",P=50,F="middle",O=50,w="middle";Object.defineProperty(S,"id",E({},L,{get:function(){return n},set:function(e){n=""+e}})),Object.defineProperty(S,"pauseOnExit",E({},L,{get:function(){return R},set:function(e){R=!!e}})),Object.defineProperty(S,"startTime",E({},L,{get:function(){return A},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");A=e,this.hasBeenReset=!0}})),Object.defineProperty(S,"endTime",E({},L,{get:function(){return k},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");k=e,this.hasBeenReset=!0}})),Object.defineProperty(S,"text",E({},L,{get:function(){return D},set:function(e){D=""+e,this.hasBeenReset=!0}})),Object.defineProperty(S,"region",E({},L,{get:function(){return I},set:function(e){I=e,this.hasBeenReset=!0}})),Object.defineProperty(S,"vertical",E({},L,{get:function(){return b},set:function(e){if(e=a(i,e),!1===e)throw new SyntaxError("An invalid or illegal string was specified.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(S,"snapToLines",E({},L,{get:function(){return C},set:function(e){C=!!e,this.hasBeenReset=!0}})),Object.defineProperty(S,"line",E({},L,{get:function(){return _},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(S,"lineAlign",E({},L,{get:function(){return x},set:function(e){if(e=r(e),!e)throw new SyntaxError("An invalid or illegal string was specified.");x=e,this.hasBeenReset=!0}})),Object.defineProperty(S,"position",E({},L,{get:function(){return P},set:function(e){if(0>e||100<e)throw new Error("Position must be between 0 and 100.");P=e,this.hasBeenReset=!0}})),Object.defineProperty(S,"positionAlign",E({},L,{get:function(){return F},set:function(e){if(e=r(e),!e)throw new SyntaxError("An invalid or illegal string was specified.");F=e,this.hasBeenReset=!0}})),Object.defineProperty(S,"size",E({},L,{get:function(){return O},set:function(e){if(0>e||100<e)throw new Error("Size must be between 0 and 100.");O=e,this.hasBeenReset=!0}})),Object.defineProperty(S,"align",E({},L,{get:function(){return w},set:function(e){if(e=r(e),!e)throw new SyntaxError("An invalid or illegal string was specified.");w=e,this.hasBeenReset=!0}})),S.displayState=void 0}if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var i=["","lr","rl"],d=["start","middle","end","left","right"];return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}(),ya=(va.prototype.decode=function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))},va),Ta=((vd=La.prototype).set=function(a,t){this.get(a)||""===t||(this.values[a]=t)},vd.get=function(a,t,e){return e?this.has(a)?this.values[a]:t[e]:this.has(a)?this.values[a]:t},vd.has=function(e){return e in this.values},vd.alt=function(a,t,e){for(var r=0;r<e.length;++r)if(t===e[r]){this.set(a,t);break}},vd.integer=function(a,t){/^-?\d+$/.test(t)&&this.set(a,parseInt(t,10))},vd.percent=function(a,t){return!!(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)&&(t=parseFloat(t),0<=t&&100>=t))&&(this.set(a,t),!0)},La),Ra=new pa(0,0,""),ba="middle"===Ra.align?"middle":"center",Da=((Xi=wa.prototype).parse=function(d){function t(){for(var a=0,n=ka(n=o.buffer);a<n.length&&"\r"!==n[a]&&"\n"!==n[a];)++a;var i=n.slice(0,a);return"\r"===n[a]&&++a,"\n"===n[a]&&++a,o.buffer=n.slice(a),i}var o=this;d&&(o.buffer+=o.decoder.decode(d,{stream:!0}));try{var e="";if("INITIAL"===o.state){if(!/\r\n|\n/.test(o.buffer))return this;var i=(e=t()).match(/^()?WEBVTT([ \t].*)?$/);if(null==i||!i[0])throw new Error("Malformed WebVTT signature.");o.state="HEADER"}for(var n=!1;o.buffer;){if(!/\r\n|\n/.test(o.buffer))return this;switch(n?n=!1:e=t(),o.state){case"HEADER":/:/.test(e)?Aa(e,function(){},/:/):e||(o.state="ID");continue;case"NOTE":e||(o.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){o.state="NOTE";break}if(!e)continue;if(o.cue=new pa(0,0,""),o.state="CUE",-1===e.indexOf("-->")){o.cue.id=e;continue}case"CUE":if(!o.cue){o.state="BADCUE";continue}try{!function(d,l,u){function n(){var e=Sa(d);if(null===e)throw new Error("Malformed timestamp: "+o);return d=d.replace(/^[^\sa-zA-Z-]+/,""),e}function s(){d=d.replace(/^\s+/,"")}var o=d,i,c;if(s(),l.startTime=n(),s(),"-->"!==d.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+o);d=d.slice(3),s(),l.endTime=n(),s(),i=d,l=l,c=new Ta,Aa(i,function(a,t){var e;switch(a){case"region":for(var n=u.length-1;0<=n;n--)if(u[n].id===t){c.set(a,u[n].region);break}break;case"vertical":c.alt(a,t,["rl","lr"]);break;case"line":e=t.split(","),c.integer(a,e[0]),c.percent(a,e[0])&&c.set("snapToLines",!1),c.alt(a,e[0],["auto"]),2===e.length&&c.alt("lineAlign",e[1],["start",ba,"end"]);break;case"position":e=t.split(","),c.percent(a,e[0]),2===e.length&&c.alt("positionAlign",e[1],["start",ba,"end","line-left","line-right","auto"]);break;case"size":c.percent(a,t);break;case"align":c.alt(a,t,["start",ba,"end","left","right"]);}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical",""),"auto"===(i=c.get("line","auto"))&&-1===Ra.line&&(i=-1),l.line=i,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",ba),"auto"===(i=c.get("position","auto"))&&50===Ra.position&&(i="start"===l.align||"left"===l.align?0:"end"===l.align||"right"===l.align?100:50),l.position=i}(e,o.cue,o.regionList)}catch(e){o.cue=null,o.state="BADCUE";continue}o.state="CUETEXT";continue;case"CUETEXT":var l=-1!==e.indexOf("-->");if(!e||l&&(n=!0)){o.oncue&&o.cue&&o.oncue(o.cue),o.cue=null,o.state="ID";continue}if(null===o.cue)continue;o.cue.text&&(o.cue.text+="\n"),o.cue.text+=e;continue;case"BADCUE":e||(o.state="ID");}}}catch(e){"CUETEXT"===o.state&&o.cue&&o.oncue&&o.oncue(o.cue),o.cue=null,o.state="INITIAL"===o.state?"BADWEBVTT":"BADCUE"}return this},Xi.flush=function(){var a=this;try{if(!a.cue&&"HEADER"!==a.state||(a.buffer+="\n\n",a.parse()),"INITIAL"===a.state||"BADWEBVTT"===a.state)throw new Error("Malformed WebVTT signature.")}catch(e){a.onparsingerror&&a.onparsingerror(e)}return a.onflush&&a.onflush(),this},wa),Ca=/\r\n|\n\r|\n|\r/g,_a=function(a){for(var t=5381,n=a.length;n;)t=33*t^a.charCodeAt(--n);return(t>>>0).toString()},Pa="stpp.ttml.im1t",Oa=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Na=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Ua={left:"start",center:"center",right:"end",start:"start",end:"end"};(ti=Wa.prototype).destroy=function(){var e=this.hls;e.off(G.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(G.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(G.MANIFEST_LOADING,this.onManifestLoading,this),e.off(G.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(G.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(G.FRAG_LOADING,this.onFragLoading,this),e.off(G.FRAG_LOADED,this.onFragLoaded,this),e.off(G.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(G.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(G.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(G.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(G.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},ti.addCues=function(c,t,e,r,f){for(var n=!1,g=f.length,m,p,y;g--;){var T=f[g],h=(m=T[0],p=T[1],h=t,Math.min(p,e)-Math.max(m,h));if(0<=h&&(T[0]=Math.min(T[0],t),T[1]=Math.max(T[1],e),n=!0,.5<h/(e-t)))return}n||f.push([t,e]),this.config.renderTextTracksNatively?(y=this.captionsTracks[c],this.Cues.newCue(y,t,e,r)):(r=this.Cues.newCue(null,t,e,r),this.hls.trigger(G.CUES_PARSED,{type:"captions",cues:r,track:c}))},ti.onInitPtsFound=function(d,t){var o=this,r=t.frag,i=t.id,n=t.initPTS,a=t.timescale,t=this.unparsedVttFrags;"main"===i&&(this.initPTS[r.cc]={baseTime:n,timescale:a}),t.length&&(this.unparsedVttFrags=[],t.forEach(function(e){o.onFragLoaded(G.FRAG_LOADED,e)}))},ti.getExistingTrack=function(a){var t=this.media;if(t)for(var e=0,n;e<t.textTracks.length;e++)if(n=t.textTracks[e],n[a])return n;return null},ti.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},ti.createNativeTrack=function(d){var t,o,s,l,u;this.captionsTracks[d]||(u=this.captionsProperties,t=this.captionsTracks,o=this.media,s=(l=u[d]).label,u=l.languageCode,(l=this.getExistingTrack(d))?(t[d]=l,ve(t[d]),ge(t[d],o)):(u=this.createTextTrack("captions",s,u))&&(u[d]=!0,t[d]=u))},ti.createNonNativeTrack=function(a){var t;this.nonNativeCaptionsTracks[a]||(t=this.captionsProperties[a])&&(t={_id:a,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media},this.nonNativeCaptionsTracks[a]=t,this.hls.trigger(G.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[t]}))},ti.createTextTrack=function(a,t,e){var r=this.media;if(r)return r.addTextTrack(a,t,e)},ti.onMediaAttaching=function(a,t){this.media=t.media,this._cleanTracks()},ti.onMediaDetaching=function(){var a=this.captionsTracks;Object.keys(a).forEach(function(e){ve(a[e]),delete a[e]}),this.nonNativeCaptionsTracks={}},ti.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},ti._cleanTracks=function(){var a=this.media;if(a){var t=a.textTracks;if(t)for(var e=0;e<t.length;e++)ve(t[e])}},ti.onSubtitleTracksUpdated=function(a,t){var d=this,n=t.subtitleTracks||[],t=n.some(function(e){return e.textCodec===Pa}),l;(this.config.enableWebVTT||t&&this.config.enableIMSC1)&&(Mn(this.tracks,n)?this.tracks=n:(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively?(l=this.media?this.media.textTracks:null,this.tracks.forEach(function(o,t){var u,c,f;if(l&&t<l.length){for(var g=null,m=0;m<l.length;m++)if(c=l[m],f=o,!!c&&c.label===f.name&&!(c.textTrack1||c.textTrack2)){g=l[m];break}g&&(u=g)}u?ve(u):(t=d._captionsOrSubtitlesFromCharacteristics(o),(u=d.createTextTrack(t,o.name,o.lang))&&(u.mode="disabled")),u&&(u.groupId=o.groupId,d.textTracks.push(u))})):this.tracks.length&&(n=this.tracks.map(function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}}),this.hls.trigger(G.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:n}))))},ti._captionsOrSubtitlesFromCharacteristics=function(a){if(a.attrs.CHARACTERISTICS){var r=/transcribes-spoken-dialog/gi.test(a.attrs.CHARACTERISTICS),a=/describes-music-and-sound/gi.test(a.attrs.CHARACTERISTICS);if(r&&a)return"captions"}return"subtitles"},ti.onManifestLoaded=function(a,t){var n=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(function(a){var t=/(?:CC|SERVICE)([1-4])/.exec(a.instreamId);t&&(t="textTrack"+t[1],(t=n.captionsProperties[t])&&(t.label=a.name,a.lang&&(t.languageCode=a.lang),t.media=a))})},ti.closedCaptionsForLevel=function(e){return e=this.hls.levels[e.level],null==e?void 0:e.attrs["CLOSED-CAPTIONS"]},ti.onFragLoading=function(d,t){var e=this.cea608Parser1,n=this.cea608Parser2,a=this.lastSn,s=this.lastPartIndex,o,l;this.enabled&&e&&n&&t.frag.type===oe&&(o=t.frag.sn,l=null==(l=null==t||null==(l=t.part)?void 0:l.index)?-1:l,o===a+1||o===a&&l===s+1||(e.reset(),n.reset()),this.lastSn=o,this.lastPartIndex=l)},ti.onFragLoaded=function(d,t){var o=t.frag,r=t.payload,i=this.initPTS,s=this.unparsedVttFrags;if(o.type===ue)if(r.byteLength){if(!i[o.cc])return s.push(t),void(i.length&&this.hls.trigger(G.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:new Error("Missing initial subtitle PTS")}));i=o.decryptdata,t="stats"in t,null!=i&&i.encrypted&&!t||(i=this.tracks[o.level],(t=this.vttCCs)[o.cc]||(t[o.cc]={start:o.start,prevCC:this.prevCC,new:!0},this.prevCC=o.cc),i&&i.textCodec===Pa?this._parseIMSC1(o,r):this._parseVTTs(o,r,t))}else this.hls.trigger(G.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:new Error("Empty subtitle payload")})},ti._parseIMSC1=function(a,e){var n=this,r=this.hls;Ma(e,this.initPTS[a.cc],function(e){n._appendCues(e,a.level),r.trigger(G.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})},function(e){nt.log("Failed to parse IMSC1: "+e),r.trigger(G.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:e})})},ti._parseVTTs=function(d,e,r){var o=this,n=this.hls,t;Fa(null!=(t=d.initSegment)&&t.data?It(d.initSegment.data,new Uint8Array(e)):e,this.initPTS[d.cc],r,d.cc,d.start,function(e){o._appendCues(e,d.level),n.trigger(G.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:d})},function(a){o._fallbackToIMSC1(d,e),nt.log("Failed to parse VTT cue: "+a),n.trigger(G.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d,error:a})})},ti._fallbackToIMSC1=function(a,t){var e=this,r=this.tracks[a.level];r.textCodec||Ma(t,this.initPTS[a.cc],function(){r.textCodec=Pa,e._parseIMSC1(a,t)},function(){r.textCodec="wvtt"})},ti._appendCues=function(a,t){var d=this.hls,n,o;this.config.renderTextTracksNatively?(n=this.textTracks[t])&&"disabled"!==n.mode&&a.forEach(function(e){return me(n,e)}):(o=this.tracks[t])&&(t=o.default?"default":"subtitles"+t,d.trigger(G.CUES_PARSED,{type:"subtitles",cues:a,track:t}))},ti.onFragDecrypted=function(a,t){var e=t.frag;e.type===ue&&(this.initPTS[e.cc]?this.onFragLoaded(G.FRAG_LOADED,t):this.unparsedVttFrags.push(t))},ti.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},ti.onFragParsingUserdata=function(d,t){var e=this.cea608Parser1,r=this.cea608Parser2;if(this.enabled&&e&&r){var i=t.frag,n=t.samples;if(i.type!==oe||"NONE"!==this.closedCaptionsForLevel(i))for(var a=0,l;a<n.length;a++)l=n[a].bytes,l&&(l=this.extractCea608Data(l),e.addData(n[a].pts,l[0]),r.addData(n[a].pts,l[1]))}},ti.onBufferFlushing=function(d,t){var l=t.startOffset,n=t.endOffset,a=t.endOffsetSubtitles,s=t.type,t=this.media,o,u;!t||t.currentTime<n||(s&&"video"!==s||(o=this.captionsTracks,Object.keys(o).forEach(function(e){return pe(o[e],l,n)})),this.config.renderTextTracksNatively&&0===l&&void 0!==a&&(u=this.textTracks,Object.keys(u).forEach(function(e){return pe(u[e],l,a)})))},ti.extractCea608Data=function(d){for(var t=[[],[]],e=31&d[0],r=2,l=0;l<e;l++){var u=d[r++],c=127&d[r++],s=127&d[r++];0==c&&0==s||0==(4&u)||0!=(u=3&u)&&1!=u||(t[u].push(c),t[u].push(s))}return t},Wr=Wa;var Ld=((ze=za.prototype).setStreamController=function(e){this.streamController=e},ze.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},ze.registerListeners=function(){var e=this.hls;e.on(G.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(G.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(G.MANIFEST_PARSED,this.onManifestParsed,this),e.on(G.BUFFER_CODECS,this.onBufferCodecs,this),e.on(G.MEDIA_DETACHING,this.onMediaDetaching,this)},ze.unregisterListener=function(){var e=this.hls;e.off(G.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(G.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(G.MANIFEST_PARSED,this.onManifestParsed,this),e.off(G.BUFFER_CODECS,this.onBufferCodecs,this),e.off(G.MEDIA_DETACHING,this.onMediaDetaching,this)},ze.onFpsDropLevelCapping=function(a,t){t=this.hls.levels[t.droppedLevel],this.isLevelAllowed(t)&&this.restrictedLevels.push({bitrate:t.bitrate,height:t.height,width:t.width})},ze.onMediaAttaching=function(a,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null},ze.onManifestParsed=function(a,t){var e=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,e.config.capLevelToPlayerSize&&t.video&&this.startCapping()},ze.onBufferCodecs=function(a,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},ze.onMediaDetaching=function(){this.stopCapping()},ze.detectPlayerSize=function(){var a,r;this.media&&0<this.mediaHeight&&0<this.mediaWidth&&(a=this.hls.levels).length&&((r=this.hls).autoLevelCapping=this.getMaxLevel(a.length-1),r.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=r.autoLevelCapping)},ze.getMaxLevel=function(a){var r=this,e=this.hls.levels;return e.length?(e=e.filter(function(n,t){return r.isLevelAllowed(n)&&t<=a}),this.clientRect=null,za.getMaxLevelByMediaSize(e,this.mediaWidth,this.mediaHeight)):-1},ze.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},ze.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},ze.getDimensions=function(){if(this.clientRect)return this.clientRect;var a=this.media,e={width:0,height:0},r;return a&&(r=a.getBoundingClientRect(),e.width=r.width,e.height=r.height,e.width||e.height||(e.width=r.right-r.left||a.width||0,e.height=r.bottom-r.top||a.height||0)),this.clientRect=e},ze.isLevelAllowed=function(a){return!this.restrictedLevels.some(function(e){return a.bitrate===e.bitrate&&a.width===e.width&&a.height===e.height})},za.getMaxLevelByMediaSize=function(d,t,e){if(null==d||!d.length)return-1;for(var r=d.length-1,o=0,l,u;o<d.length;o+=1)if(u=d[o],(u.width>=t||u.height>=e)&&(!(l=d[o+1])||u.width!==l.width||u.height!==l.height)){r=o;break}return r},qt(za,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return e}}]),za),vd=((C=Xa.prototype).setStreamController=function(e){this.streamController=e},C.registerListeners=function(){this.hls.on(G.MEDIA_ATTACHING,this.onMediaAttaching,this)},C.unregisterListeners=function(){this.hls.off(G.MEDIA_ATTACHING,this.onMediaAttaching,this)},C.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},C.onMediaAttaching=function(a,t){var n=this.hls.config;n.capLevelOnFPSDrop&&(t=t.media instanceof self.HTMLVideoElement?t.media:null,(this.media=t)&&"function"==typeof t.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod))},C.checkFPS=function(d,t,e){var r=performance.now(),o,l,u,c;t&&(this.lastTime&&(u=r-this.lastTime,o=e-this.lastDroppedFrames,c=t-this.lastDecodedFrames,l=1e3*o/u,(u=this.hls).trigger(G.FPS_DROP,{currentDropped:o,currentDecoded:c,totalDroppedFrames:e}),0<l&&o>u.config.fpsDroppedMonitoringThreshold*c&&(c=u.currentLevel,nt.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),0<c&&(-1===u.autoLevelCapping||u.autoLevelCapping>=c)&&(--c,u.trigger(G.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch()))),this.lastTime=r,this.lastDroppedFrames=e,this.lastDecodedFrames=t)},C.checkFPSInterval=function(){var a=this.media,e;a&&(this.isVideoPlaybackQualityAvailable?(e=a.getVideoPlaybackQuality(),this.checkFPS(a,e.totalVideoFrames,e.droppedVideoFrames)):this.checkFPS(a,a.webkitDecodedFrameCount,a.webkitDroppedFrameCount))},Xa),ti=((Xi=ja.prototype).destroy=function(){this.unregisterListeners(),this.onMediaDetached();var e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null},Xi.registerListeners=function(){this.hls.on(G.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(G.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(G.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(G.MANIFEST_LOADED,this.onManifestLoaded,this)},Xi.unregisterListeners=function(){this.hls.off(G.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(G.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(G.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(G.MANIFEST_LOADED,this.onManifestLoaded,this)},Xi.getLicenseServerUrl=function(a){var t=this.config,n=t.drmSystems,t=t.widevineLicenseUrl,n=n[a];if(n)return n.licenseUrl;if(a===W.WIDEVINE&&t)return t;throw new Error("no license server URL configured for key-system \""+a+"\"")},Xi.getServerCertificateUrl=function(a){var t=this.config.drmSystems[a];return t?t.serverCertificateUrl:void this.log("No Server Certificate in config.drmSystems[\""+a+"\"]")},Xi.attemptKeySystemAccess=function(i){function t(a,t,e){return!!a&&e.indexOf(a)===t}var d=this,e=this.hls.levels,s=e.map(function(e){return e.audioCodec}).filter(t),o=e.map(function(e){return e.videoCodec}).filter(t);return 0===s.length+o.length&&o.push("avc1.42e01e"),new Promise(function(e,n){!function a(l){var r=l.shift();d.getMediaKeysPromise(r,s,o).then(function(a){return e({keySystem:r,mediaKeys:a})}).catch(function(e){l.length?a(l):n(e instanceof Ba?e:new Ba({type:rt.KEY_SYSTEM_ERROR,details:it.KEY_SYSTEM_NO_ACCESS,error:e,fatal:!0},e.message))})}(i)})},Xi.requestMediaKeySystemAccess=function(a,t){var e=this.config.requestMediaKeySystemAccessFunc;return"function"==typeof e?e(a,t):(e="Configured requestMediaKeySystemAccess is not a function "+e,null===Q&&"http:"===self.location.protocol&&(e="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(e)))},Xi.getMediaKeysPromise=function(d,i,o){var s=this,i=function(d,t,e,o){var i,s;switch(d){case W.FAIRPLAY:i=["cenc","sinf"];break;case W.WIDEVINE:case W.PLAYREADY:i=["cenc"];break;case W.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+d);}return e=e,[{initDataTypes:i,persistentState:(s=o).persistentState||"not-allowed",distinctiveIdentifier:s.distinctiveIdentifier||"not-allowed",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:t.map(function(e){return{contentType:"audio/mp4; codecs=\""+e+"\"",robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null}}),videoCapabilities:e.map(function(e){return{contentType:"video/mp4; codecs=\""+e+"\"",robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}})}]}(d,i,o,this.config.drmSystemOptions),n=this.keySystemAccessPromises[d],o=null==n?void 0:n.keySystemAccess;if(o)return o.then(function(){return n.mediaKeys});this.log("Requesting encrypted media \""+d+"\" key-system access with config: "+JSON.stringify(i)),o=this.requestMediaKeySystemAccess(d,i);var l=this.keySystemAccessPromises[d]={keySystemAccess:o};return o.catch(function(e){s.log("Failed to obtain access to key-system \""+d+"\": "+e)}),o.then(function(e){s.log("Access for key-system \""+e.keySystem+"\" obtained");var t=s.fetchServerCertificate(d);return s.log("Create media-keys for \""+d+"\""),l.mediaKeys=e.createMediaKeys().then(function(a){return s.log("Media-keys created for \""+d+"\""),t.then(function(e){return e?s.setMediaKeysServerCertificate(a,d,e):a})}),l.mediaKeys.catch(function(e){s.error("Failed to create media-keys for \""+d+"\"}: "+e)}),l.mediaKeys})},Xi.createMediaKeySessionContext=function(a){var n=a.decryptdata,e=a.keySystem,r=a.mediaKeys;return this.log("Creating key-system session \""+e+"\" keyId: "+lt(n.keyId||[])),a=r.createSession(),a={decryptdata:n,keySystem:e,mediaKeys:r,mediaKeysSession:a,keyStatus:"status-pending"},(this.mediaKeySessions.push(a),a)},Xi.renewKeySession=function(a){var t=a.decryptdata,n,i;t.pssh?(n=this.createMediaKeySessionContext(a),i=this.getKeyIdString(t),this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,"cenc",t.pssh,"expired")):this.warn("Could not renew expired session. Missing pssh initData."),this.removeSession(a)},Xi.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return lt(e.keyId)},Xi.updateKeySession=function(a,n){var e=a.mediaKeysSession;return this.log("Updating key-session \""+e.sessionId+"\" for keyID "+lt((null==(a=a.decryptdata)?void 0:a.keyId)||[])+"\n      } (data length: "+(n&&n.byteLength)+")"),e.update(n)},Xi.selectKeySystemFormat=function(a){var t=Object.keys(a.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+a.sn+" "+a.type+": "+a.level+") key formats "+t.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise},Xi.getKeyFormatPromise=function(d){var n=this;return new Promise(function(a,r){var i=N(n.config),e=d.map(O).filter(function(e){return!!e&&-1!==i.indexOf(e)});return n.getKeySystemSelectionPromise(e).then(function(n){var i=n.keySystem,n=M(i);n?a(n):r(new Error("Unable to find format for key-system \""+i+"\""))}).catch(r)})},Xi.loadKey=function(d){var i=this,n=d.keyInfo.decryptdata,a=this.getKeyIdString(n),o="(keyId: "+a+" format: \""+n.keyFormat+"\" method: "+n.method+" uri: "+n.uri+")";this.log("Starting session for key "+o);var t=this.keyIdToKeySessionPromise[a];return t||(t=this.keyIdToKeySessionPromise[a]=this.getKeySystemForKeyPromise(n).then(function(a){var s=a.keySystem,e=a.mediaKeys;return i.throwIfDestroyed(),i.log("Handle encrypted media sn: "+d.frag.sn+" "+d.frag.type+": "+d.frag.level+" using key "+o),i.attemptSetMediaKeys(s,e).then(function(){i.throwIfDestroyed();var a=i.createMediaKeySessionContext({keySystem:s,mediaKeys:e,decryptdata:n});return i.generateRequestWithPreferredKeySession(a,"cenc",n.pssh,"playlist-key")})})).catch(function(e){return i.handleError(e)}),t},Xi.throwIfDestroyed=function(){if(!this.hls)throw new Error("invalid state")},Xi.handleError=function(e){this.hls&&(this.error(e.message),e instanceof Ba?this.hls.trigger(G.ERROR,e.data):this.hls.trigger(G.ERROR,{type:rt.KEY_SYSTEM_ERROR,details:it.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},Xi.getKeySystemForKeyPromise=function(a){var r=this.getKeyIdString(a),r=this.keyIdToKeySessionPromise[r];return r?r:(a=O(a.keyFormat),a=a?[a]:N(this.config),this.attemptKeySystemAccess(a))},Xi.getKeySystemSelectionPromise=function(e){if(e.length||(e=N(this.config)),0===e.length)throw new Ba({type:rt.KEY_SYSTEM_ERROR,details:it.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},Xi._onMediaEncrypted=function(m){var p=this,a=m.initDataType,s=m.initData,o,t;if(this.debug("\""+m.type+"\" event: init data type: \""+a+"\""),null!==s){if("sinf"===a&&this.config.drmSystems[W.FAIRPLAY]){var y=ut(new Uint8Array(s));try{var r=P(JSON.parse(y).sinf),r=Dt(new Uint8Array(r));if(!r)return;o=r.subarray(8,24),t=W.FAIRPLAY}catch(e){return void this.warn("Failed to parse sinf \"encrypted\" event message initData")}}else{var T=function(d){if(!(d instanceof ArrayBuffer)||32>d.byteLength)return null;var t={version:0,systemId:"",kids:null,data:null},e=new DataView(d),r=e.getUint32(0);if(d.byteLength!==r&&44<r)return null;if(1886614376!==e.getUint32(4))return null;if(t.version=e.getUint32(8)>>>24,1<t.version)return null;t.systemId=lt(new Uint8Array(d,12,16));var i=e.getUint32(28);if(0===t.version){if(r-32<i)return null;t.data=new Uint8Array(d,32,i)}else if(1===t.version){t.kids=[];for(var n=0;n<i;n++)t.kids.push(new Uint8Array(d,32+16*n,16))}return t}(s);if(null===T)return;0===T.version&&T.systemId===X&&T.data&&(o=T.data.subarray(8,24)),t=function(){if(T.systemId===X)return W.WIDEVINE}()}if(t&&o){for(var l=lt(o),u=this.keyIdToKeySessionPromise,h=this.mediaKeySessions,d=u[l],E=0,S;E<h.length&&(S=function(){var n=h[E],t=n.decryptdata;if(t.pssh||!t.keyId)return"continue";var e=lt(t.keyId);return l===e||-1!==t.uri.replace(/-/g,"").indexOf(l)?(d=u[e],delete u[e],t.pssh=new Uint8Array(s),t.keyId=o,d=u[l]=d.then(function(){return p.generateRequestWithPreferredKeySession(n,a,s,"encrypted-event-key-match")}),"break"):void 0}(),"continue"===S||"break"!==S);E++);(d=d||(u[l]=this.getKeySystemSelectionPromise([t]).then(function(n){var d=n.keySystem,e=n.mediaKeys;p.throwIfDestroyed();var r=new Td("ISO-23001-7",l,null==(n=M(d))?"":n);return r.pssh=new Uint8Array(s),r.keyId=o,p.attemptSetMediaKeys(d,e).then(function(){p.throwIfDestroyed();var n=p.createMediaKeySessionContext({decryptdata:r,keySystem:d,mediaKeys:e});return p.generateRequestWithPreferredKeySession(n,a,s,"encrypted-event-no-match")})}))).catch(function(e){return p.handleError(e)})}}},Xi._onWaitingForKey=function(e){this.log("\""+e.type+"\" event")},Xi.attemptSetMediaKeys=function(a,t){var e=this,r=this.setMediaKeysQueue.slice();this.log("Setting media-keys for \""+a+"\"");var i=Promise.all(r).then(function(){if(!e.media)throw new Error("Attempted to set mediaKeys without media element attached");return e.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(i),i.then(function(){e.log("Media-keys set for \""+a+"\""),r.push(i),e.setMediaKeysQueue=e.setMediaKeysQueue.filter(function(e){return-1===r.indexOf(e)})})},Xi.generateRequestWithPreferredKeySession=function(c,i,f,g){var m=this,r=null==(o=this.config.drmSystems)||null==(s=o[c.keySystem])?void 0:s.generateRequest,o,s;if(r)try{var p=r.call(this.hls,i,f,c);if(!p)throw new Error("Invalid response from configured generateRequest filter");i=p.initDataType,f=c.decryptdata.pssh=p.initData?new Uint8Array(p.initData):null}catch(e){if(this.warn(e.message),null!=(s=this.hls)&&s.config.debug)throw e}if(null===f)return this.log("Skipping key-session request for \""+g+"\" (no initData)"),Promise.resolve(c);var l=this.getKeyIdString(c.decryptdata);this.log("Generating key-session request for \""+g+"\": "+l+" (init data type: "+i+" length: "+(f?f.byteLength:null)+")");var u=new Nd;c.mediaKeysSession.onmessage=function(a){var n=c.mediaKeysSession,r;n?(r=a.messageType,a=a.message,m.log("\""+r+"\" message event for session \""+n.sessionId+"\" message size: "+a.byteLength),"license-request"===r||"license-renewal"===r?m.renewLicense(c,a).catch(function(e){m.handleError(e),u.emit("error",e)}):"license-release"===r?c.keySystem===W.FAIRPLAY&&(m.updateKeySession(c,F("acknowledged")),m.removeSession(c)):m.warn("unhandled media key message type \""+r+"\"")):u.emit("error",new Error("invalid state"))},c.mediaKeysSession.onkeystatuseschange=function(){var t;c.mediaKeysSession?(m.onKeyStatusChange(c),t=c.keyStatus,u.emit("keyStatus",t),"expired"===t&&(m.warn(c.keySystem+" expired for key "+l),m.renewKeySession(c))):u.emit("error",new Error("invalid state"))};var y=new Promise(function(a,e){u.on("error",e),u.on("keyStatus",function(r){r.startsWith("usable")?a():"output-restricted"===r?e(new Ba({type:rt.KEY_SYSTEM_ERROR,details:it.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===r?e(new Ba({type:rt.KEY_SYSTEM_ERROR,details:it.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},"key status changed to \""+r+"\"")):"expired"===r?e(new Error("key expired while generating request")):m.warn("unhandled key status change \""+r+"\"")})});return c.mediaKeysSession.generateRequest(i,f).then(function(){var e;m.log("Request generated for key-session \""+(null==(e=c.mediaKeysSession)?void 0:e.sessionId)+"\" keyId: "+l)}).catch(function(e){throw new Ba({type:rt.KEY_SYSTEM_ERROR,details:it.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},"Error generating key-session request: "+e)}).then(function(){return y}).catch(function(e){throw u.removeAllListeners(),m.removeSession(c),e}).then(function(){return u.removeAllListeners(),c})},Xi.onKeyStatusChange=function(a){var r=this;a.mediaKeysSession.keyStatuses.forEach(function(n,t){r.log("key status change \""+n+"\" for keyStatuses keyId: "+lt("buffer"in t?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t))+" session keyId: "+lt(new Uint8Array(a.decryptdata.keyId||[]))+" uri: "+a.decryptdata.uri),a.keyStatus=n})},Xi.fetchServerCertificate=function(n){var d=this.config,r=new d.loader(d),i=this.getServerCertificateUrl(n);return i?(this.log("Fetching serverCertificate for \""+n+"\""),new Promise(function(o,l){var a={responseType:"arraybuffer",url:i},s=d.certLoadPolicy.default,u={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},s={onSuccess:function(e){o(e.data)},onError:function(d,t,e){l(new Ba({type:rt.KEY_SYSTEM_ERROR,details:it.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:e,response:j({url:a.url,data:void 0},d)},"\""+n+"\" certificate request failed ("+i+"). Status: "+d.code+" ("+d.text+")"))},onTimeout:function(d,t,e){l(new Ba({type:rt.KEY_SYSTEM_ERROR,details:it.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:e,response:{url:a.url,data:void 0}},"\""+n+"\" certificate request timed out ("+i+")"))},onAbort:function(){l(new Error("aborted"))}};r.load(a,u,s)})):Promise.resolve()},Xi.setMediaKeysServerCertificate=function(d,r,n){var a=this;return new Promise(function(i,e){d.setServerCertificate(n).then(function(e){a.log("setServerCertificate "+(e?"success":"not supported by CDM")+" ("+(null==n?void 0:n.byteLength)+") on \""+r+"\""),i(d)}).catch(function(a){e(new Ba({type:rt.KEY_SYSTEM_ERROR,details:it.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})},Xi.renewLicense=function(a,e){var n=this;return this.requestLicense(a,new Uint8Array(e)).then(function(e){return n.updateKeySession(a,new Uint8Array(e)).catch(function(e){throw new Ba({type:rt.KEY_SYSTEM_ERROR,details:it.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)})})},Xi.setupLicenseXHR=function(d,e,r,i){var n=this,a=this.config.licenseXhrSetup;return a?Promise.resolve().then(function(){if(!r.decryptdata)throw new Error("Key removed");return a.call(n.hls,d,e,r,i)}).catch(function(o){if(!r.decryptdata)throw o;return d.open("POST",e,!0),a.call(n.hls,d,e,r,i)}).then(function(a){return d.readyState||d.open("POST",e,!0),{xhr:d,licenseChallenge:a||i}}):(d.open("POST",e,!0),Promise.resolve({xhr:d,licenseChallenge:i}))},Xi.requestLicense=function(d,e){var o=this,t=this.config.keyLoadPolicy.default;return new Promise(function(l,i){var n=o.getLicenseServerUrl(d.keySystem);o.log("Sending license request to URL: "+n);var a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=function(){if(!o.hls||!d.mediaKeysSession)return i(new Error("invalid state"));if(4===a.readyState)if(200===a.status){o._requestLicenseFailureCount=0;var s=a.response;o.log("License received "+(s instanceof ArrayBuffer?s.byteLength:s));var u=o.config.licenseResponseCallback;if(u)try{s=u.call(o.hls,a,n,d)}catch(e){o.error(e)}l(s)}else{var c=t.errorRetry,c=c?c.maxNumRetry:0;o._requestLicenseFailureCount++,o._requestLicenseFailureCount>c||400<=a.status&&500>a.status?i(new Ba({type:rt.KEY_SYSTEM_ERROR,details:it.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:n,data:void 0,code:a.status,text:a.statusText}},"License Request XHR failed ("+n+"). Status: "+a.status+" ("+a.statusText+")")):(c=c-o._requestLicenseFailureCount+1,o.warn("Retrying license request, "+c+" attempts left"),o.requestLicense(d,e).then(l,i))}},d.licenseXhr&&d.licenseXhr.readyState!==XMLHttpRequest.DONE&&d.licenseXhr.abort(),d.licenseXhr=a,o.setupLicenseXHR(a,n,d,e).then(function(a){var r=a.xhr,a=a.licenseChallenge;r.send(a)})})},Xi.onMediaAttached=function(a,t){this.config.emeEnabled&&(t=t.media,(this.media=t).addEventListener("encrypted",this.onMediaEncrypted),t.addEventListener("waitingforkey",this.onWaitingForKey))},Xi.onMediaDetached=function(){var a=this,e=this.media,r=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Td.clearKeyUriToKeyIdMap();var t=r.length;ja.CDMCleanupPromise=Promise.all(r.map(function(e){return a.removeSession(e)}).concat(null==e?void 0:e.setMediaKeys(null).catch(function(r){a.log("Could not clear media keys: "+r+". media.src: "+(null==e?void 0:e.src))}))).then(function(){t&&(a.log("finished closing key sessions and clearing media keys"),r.length=0)}).catch(function(r){a.log("Could not close sessions and clear media keys: "+r+". media.src: "+(null==e?void 0:e.src))})},Xi.onManifestLoading=function(){this.keyFormatPromise=null},Xi.onManifestLoaded=function(a,t){t=t.sessionKeys,t&&this.config.emeEnabled&&!this.keyFormatPromise&&(t=t.reduce(function(a,t){return-1===a.indexOf(t.keyFormat)&&a.push(t.keyFormat),a},[]),this.log("Selecting key-system from session-keys "+t.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(t))},Xi.removeSession=function(a){var n=this,e=a.mediaKeysSession,r=a.licenseXhr;if(e)return this.log("Remove licenses and keys and close session "+e.sessionId),e.onmessage=null,e.onkeystatuseschange=null,r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),a.mediaKeysSession=a.decryptdata=a.licenseXhr=void 0,a=this.mediaKeySessions.indexOf(a),(-1<a&&this.mediaKeySessions.splice(a,1),e.remove().catch(function(e){n.log("Could not remove session: "+e)}).then(function(){return e.close()}).catch(function(e){n.log("Could not close session: "+e)}))},ja);ti.CDMCleanupPromise=void 0;var Ba=(Za($i,qd=l(Error)),$i),C=((ze=Qi.prototype).registerListeners=function(){var e=this.hls;e.on(G.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(G.MEDIA_DETACHED,this.onMediaDetached,this),e.on(G.BUFFER_CREATED,this.onBufferCreated,this)},ze.unregisterListeners=function(){var e=this.hls;e.off(G.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(G.MEDIA_DETACHED,this.onMediaDetached,this),e.off(G.BUFFER_CREATED,this.onBufferCreated,this)},ze.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},ze.onMediaAttached=function(a,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},ze.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},ze.onBufferCreated=function(a,t){var n;this.audioBuffer=null==(n=t.tracks.audio)?void 0:n.buffer,this.videoBuffer=null==(t=t.tracks.video)?void 0:t.buffer},ze.createData=function(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},ze.apply=function(a,t){void 0===t&&(t={}),qa(t,this.createData());var n="i"===t.ot||"v"===t.ot||"av"===t.ot;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering),this.useHeaders?(n=Qi.toHeaders(t),Object.keys(n).length&&(a.headers||(a.headers={}),qa(a.headers,n))):(t=Qi.toQuery(t))&&(a.url=Qi.appendQueryToUri(a.url,t))},ze.getObjectType=function(a){var t=a.type;return"subtitle"===t?"tt":"initSegment"===a.sn?"i":"audio"===t?"a":"main"===t?this.hls.audioTracks.length?"v":"av":void 0},ze.getTopBandwidth=function(a){for(var d=0,o=this.hls,r=ed("a"===a?o.audioTracks:(a=-1<(a=o.maxAutoLevel)?a+1:o.levels.length,o.levels.slice(0,a))),i;!(i=r()).done;)i=i.value,i.bitrate>d&&(d=i.bitrate);return 0<d?d:NaN},ze.getBufferLength=function(a){var r=this.hls.media,a="a"===a?this.audioBuffer:this.videoBuffer;return a&&r?1e3*Er.bufferInfo(a,r.currentTime,this.config.maxBufferHole).len:NaN},ze.createPlaylistLoader=function(){function a(e){this.loader=void 0,this.loader=new i(e)}var r=this.config.pLoader,n=this.applyPlaylistData,i=r||this.config.loader;return(r=a.prototype).destroy=function(){this.loader.destroy()},r.abort=function(){this.loader.abort()},r.load=function(a,t,e){n(a),this.loader.load(a,t,e)},qt(a,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),a},ze.createFragmentLoader=function(){function a(e){this.loader=void 0,this.loader=new i(e)}var r=this.config.fLoader,n=this.applyFragmentData,i=r||this.config.loader;return(r=a.prototype).destroy=function(){this.loader.destroy()},r.abort=function(){this.loader.abort()},r.load=function(a,t,e){n(a),this.loader.load(a,t,e)},qt(a,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),a},Qi.uuid=function(){var a=URL.createObjectURL(new Blob),t=a.toString();return URL.revokeObjectURL(a),t.slice(t.lastIndexOf("/")+1)},Qi.serialize=function(d){for(var t=[],r=function(e){return Math.round(e)},i=function(e){return 100*r(e/100)},n={br:r,d:r,bl:i,dl:i,mtp:i,nor:function(e){return encodeURIComponent(e)},rtp:i,tb:r},a=ed(Object.keys(d||{}).sort()),s;!(f=a()).done;){var c=f.value,u=d[c],f,g;s=u,Number.isNaN(s)||null==s||""===s||!1===s||"v"===c&&1===u||"pr"==c&&1===u||((g=n[c])&&(u=g(u)),f=typeof u,g=void 0,g="ot"===c||"sf"===c||"st"===c?c+"="+u:"boolean"==f?c:"number"==f?c+"="+u:c+"="+JSON.stringify(u),t.push(g))}return t.join(",")},Qi.toHeaders=function(d){for(var t={},e=["Object","Request","Session","Status"],r=[{},{},{},{}],i={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},n=0,c=Object.keys(d),s;n<c.length;n++)s=c[n],r[null==i[s]?1:i[s]][s]=d[s];for(var f=0,g;f<r.length;f++)g=Qi.serialize(r[f]),g&&(t["CMCD-"+e[f]]=g);return t},Qi.toQuery=function(e){return"CMCD="+encodeURIComponent(Qi.serialize(e))},Qi.appendQueryToUri=function(a,t){if(!t)return a;var e=a.includes("?")?"&":"?";return a+e+t},Qi),ze=((Xi=Qa.prototype).registerListeners=function(){var e=this.hls;e.on(G.MANIFEST_LOADING,this.onManifestLoading,this),e.on(G.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(G.MANIFEST_PARSED,this.onManifestParsed,this),e.on(G.ERROR,this.onError,this)},Xi.unregisterListeners=function(){var e=this.hls;e&&(e.off(G.MANIFEST_LOADING,this.onManifestLoading,this),e.off(G.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(G.MANIFEST_PARSED,this.onManifestParsed,this),e.off(G.ERROR,this.onError,this))},Xi.startLoad=function(){var e;this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri&&(this.updated?(e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0),this.scheduleRefresh(this.uri,e)):this.loadSteeringManifest(this.uri))},Xi.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)},Xi.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},Xi.removeLevel=function(a){var e=this.levels;e&&(this.levels=e.filter(function(e){return e!==a}))},Xi.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},Xi.onManifestLoaded=function(a,t){t=t.contentSteering,null!==t&&(this.pathwayId=t.pathwayId,this.uri=t.uri,this.started&&this.startLoad())},Xi.onManifestParsed=function(a,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks},Xi.onError=function(a,t){var n=t.errorAction,i;2===(null==n?void 0:n.action)&&1===n.flags&&(i=this.pathwayPriority,t=this.pathwayId,this.penalizedPathways[t]||(this.penalizedPathways[t]=performance.now()),!i&&this.levels&&(i=this.levels.reduce(function(a,t){return-1===a.indexOf(t.pathwayId)&&a.push(t.pathwayId),a},[])),i&&1<i.length&&(this.updatePathwayPriority(i),n.resolved=this.pathwayId!==t))},Xi.filterParsedLevels=function(a){this.levels=a;var t=this.getLevelsForPathway(this.pathwayId),n;return 0===t.length&&(n=a[0].pathwayId,this.log("No levels found in Pathway "+this.pathwayId+". Setting initial Pathway to \""+n+"\""),t=this.getLevelsForPathway(n),this.pathwayId=n),t.length===a.length?a:(this.log("Found "+t.length+"/"+a.length+" levels in Pathway \""+this.pathwayId+"\""),t)},Xi.getLevelsForPathway=function(a){return null===this.levels?[]:this.levels.filter(function(e){return a===e.pathwayId})},Xi.updatePathwayPriority=function(d){this.pathwayPriority=d;var l=this.penalizedPathways,e=performance.now();Object.keys(l).forEach(function(a){3e5<e-l[a]&&delete l[a]});for(var t=0,r;t<d.length;t++)if(r=d[t],!l[r]){if(r===this.pathwayId)return;var u=this.hls.nextLoadLevel,a=this.hls.levels[u];if(0<(s=this.getLevelsForPathway(r)).length){this.log("Setting Pathway to \""+r+"\""),this.pathwayId=r,this.hls.trigger(G.LEVELS_UPDATED,{levels:s});var s=this.hls.levels[u];a&&s&&this.levels&&(s.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&s.bitrate!==a.bitrate&&this.log("Unstable Pathways change from bitrate "+a.bitrate+" to "+s.bitrate),this.hls.nextLoadLevel=u);break}}},Xi.clonePathways=function(e){var d=this,r=this.levels,l,u;r&&(l={},u={},e.forEach(function(i){var o=i.ID,t=i["BASE-ID"],n=i["URI-REPLACEMENT"];r.some(function(e){return e.pathwayId===o})||(t=d.getLevelsForPathway(t).map(function(a){var d=qa({},a);d.details=void 0,d.url=rd(a.uri,a.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",n);var s=new hd(a.attrs);s["PATHWAY-ID"]=o;var r=s.AUDIO&&s.AUDIO+"_clone_"+o,a=s.SUBTITLES&&s.SUBTITLES+"_clone_"+o;return r&&(l[s.AUDIO]=r,s.AUDIO=r),a&&(u[s.SUBTITLES]=a,s.SUBTITLES=a),d.attrs=s,d=new De(d),(Ze(d,"audio",r),Ze(d,"text",a),d)}),r.push.apply(r,t),ad(d.audioTracks,l,n,o),ad(d.subtitleTracks,u,n,o))}))},Xi.loadSteeringManifest=function(a){var d=this,t=this.hls.config,n=t.loader,u;this.loader&&this.loader.destroy(),this.loader=new n(t);try{u=new self.URL(a)}catch(e){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: "+a)}"data:"!==u.protocol&&(o=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate),u.searchParams.set("_HLS_pathway",this.pathwayId),u.searchParams.set("_HLS_throughput",""+o));var n={responseType:"json",url:u.href},o=t.steeringManifestLoadPolicy.default,t=o.errorRetry||o.timeoutRetry||{},o={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:t.maxNumRetry||0,retryDelay:t.retryDelayMs||0,maxRetryDelay:t.maxRetryDelayMs||0},t={onSuccess:function(i,t,e){d.log("Loaded steering manifest: \""+u+"\"");var r=i.data;if(1===r.VERSION){d.updated=performance.now(),d.timeToLoad=r.TTL;var n=r["RELOAD-URI"],a=r["PATHWAY-CLONES"],s=r["PATHWAY-PRIORITY"];if(n)try{d.uri=new self.URL(n,u).href}catch(e){return d.enabled=!1,void d.log("Failed to parse Steering Manifest RELOAD-URI: "+n)}d.scheduleRefresh(d.uri||e.url),a&&d.clonePathways(a),s&&d.updatePathwayPriority(s)}else d.log("Steering VERSION "+r.VERSION+" not supported!")},onError:function(a,r){if(d.log("Error loading steering manifest: "+a.code+" "+a.text+" ("+r.url+")"),d.stopLoad(),410===a.code)return d.enabled=!1,void d.log("Steering manifest "+r.url+" no longer available");var e=1e3*d.timeToLoad;429===a.code?("function"!=typeof(null==(a=d.loader)?void 0:a.getResponseHeader)||(a=a.getResponseHeader("Retry-After"))&&(e=1e3*parseFloat(a)),d.log("Steering manifest "+r.url+" rate limited")):d.scheduleRefresh(d.uri||r.url,e)},onTimeout:function(a,t){d.log("Timeout loading steering manifest ("+t.url+")"),d.scheduleRefresh(d.uri||t.url)}};this.log("Requesting steering manifest: "+u),this.loader.load(n,o,t)},Xi.scheduleRefresh=function(a,t){var n=this;void 0===t&&(t=1e3*this.timeToLoad),self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(function(){n.loadSteeringManifest(a)},t)},Qa),Ja=((Xi=id.prototype).destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},Xi.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))},Xi.abort=function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},Xi.load=function(a,t,e){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=a,this.config=t,this.callbacks=e,this.loadInternal()},Xi.loadInternal=function(){var d=this,n=this.config,o=this.context,a,s,t;n&&(a=this.loader=new self.XMLHttpRequest,(s=this.stats).loading.first=0,s.loaded=0,(t=this.xhrSetup)?Promise.resolve().then(function(){if(!d.stats.aborted)return t(a,o.url)}).catch(function(){return a.open("GET",o.url,!0),t(a,o.url)}).then(function(){d.stats.aborted||d.openAndSendXhr(a,o,n)}).catch(function(e){d.callbacks.onError({code:a.status,text:e.message},o,a,s)}):this.openAndSendXhr(a,o,n))},Xi.openAndSendXhr=function(d,t,e){d.readyState||d.open("GET",t.url,!0);var r=this.context.headers,i=e.loadPolicy,o=i.maxTimeToFirstByteMs,i=i.maxLoadTimeMs;if(r)for(var a in r)d.setRequestHeader(a,r[a]);t.rangeEnd&&d.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),d.onreadystatechange=this.readystatechange.bind(this),d.onprogress=this.loadprogress.bind(this),d.responseType=t.responseType,self.clearTimeout(this.requestTimeout),e.timeout=o&&yd(o)?o:i,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout),d.send()},Xi.readystatechange=function(){var d=this.context,n=this.loader,a=this.stats,o,s,l,u;d&&n&&(l=n.readyState,u=this.config,!a.aborted&&2<=l&&(0===a.loading.first&&(a.loading.first=Math.max(self.performance.now(),a.loading.start),u.timeout!==u.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),u.timeout=u.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),u.loadPolicy.maxLoadTimeMs-(a.loading.first-a.loading.start)))),4===l)&&(self.clearTimeout(this.requestTimeout),n.onreadystatechange=null,n.onprogress=null,o=n.status,s="text"!==n.responseType,200<=o&&300>o&&(s&&n.response||null!==n.responseText)?(a.loading.end=Math.max(self.performance.now(),a.loading.first),l=s?n.response:n.responseText,s="arraybuffer"===n.responseType?l.byteLength:l.length,a.loaded=a.total=s,a.bwEstimate=8e3*a.total/(a.loading.end-a.loading.first),this.callbacks&&((s=this.callbacks.onProgress)&&s(a,d,l,n),this.callbacks&&(l={url:n.responseURL,data:l,code:o},this.callbacks.onSuccess(l,a,d,n)))):Ve(u=u.loadPolicy.errorRetry,a.retry,!1,o)?this.retry(u):(nt.error(o+" while loading "+d.url),this.callbacks.onError({code:o,text:n.statusText},d,n,a))))},Xi.loadtimeout=function(){var e=null==(e=this.config)?void 0:e.loadPolicy.timeoutRetry;Ve(e,this.stats.retry,!0)?this.retry(e):(nt.warn("timeout while loading "+this.context.url),(e=this.callbacks)&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader)))},Xi.retry=function(a){var t=this.context,e=this.stats;this.retryDelay=Ke(a,e.retry),e.retry++,nt.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+t.url+", retrying "+e.retry+"/"+a.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},Xi.loadprogress=function(a){var t=this.stats;t.loaded=a.loaded,a.lengthComputable&&(t.total=a.total)},Xi.getCacheAge=function(){var a=null,r;return this.loader&&/^age:\s*[\d.]+\s*$/im.test(this.loader.getAllResponseHeaders())&&(a=(r=this.loader.getResponseHeader("age"))?parseFloat(r):null),a},Xi.getResponseHeader=function(e){return this.loader&&new RegExp("^"+e+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null},id),Vd=((Xi=nd.prototype).destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},Xi.abortInternal=function(){var e=this.response;null!=e&&e.ok||(this.stats.aborted=!0,this.controller.abort())},Xi.abort=function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},Xi.load=function(c,i,n){var a=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var o=function(a,t){return t={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(qa({},a.headers))},a.rangeEnd&&t.headers.set("Range","bytes="+a.rangeStart+"-"+(a.rangeEnd-1+"")),t}(c,this.controller.signal),f=n.onProgress,l="arraybuffer"===c.responseType,u=l?"byteLength":"length",t=i.loadPolicy,e=t.maxTimeToFirstByteMs,g=t.maxLoadTimeMs;this.context=c,this.config=i,this.callbacks=n,this.request=this.fetchSetup(c,o),self.clearTimeout(this.requestTimeout),i.timeout=e&&yd(e)?e:g,this.requestTimeout=self.setTimeout(function(){a.abortInternal(),n.onTimeout(s,c,a.response)},i.timeout),self.fetch(this.request).then(function(d){a.response=a.loader=d;var t=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(a.requestTimeout),i.timeout=g,a.requestTimeout=self.setTimeout(function(){a.abortInternal(),n.onTimeout(s,c,a.response)},g-(t-s.loading.start)),d.ok)return s.loading.first=t,s.total=function(a){var n=a.get("Content-Range");if(n){var e=function(){var e=/(\d+)-(\d+)\/(\d+)/.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}();if(yd(e))return e}return(a=a.get("Content-Length"),a)?parseInt(a):void 0}(d.headers)||s.total,f&&yd(i.highWaterMark)?a.loadProgressively(d,s,c,i.highWaterMark,f):l?d.arrayBuffer():"json"===c.responseType?d.json():d.text();var o=d.status,t=d.statusText;throw new Yd(t||"fetch, bad network response",o,d)}).then(function(d){var t=a.response;self.clearTimeout(a.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);var e=d[u];e&&(s.loaded=s.total=e),e={url:t.url,data:d,code:t.status},f&&!yd(i.highWaterMark)&&f(s,c,d,t),n.onSuccess(e,s,c,t)}).catch(function(i){var t,d;self.clearTimeout(a.requestTimeout),s.aborted||(t=i&&i.code||0,d=i?i.message:null,n.onError({code:t,text:d},c,i?i.details:null,s))})},Xi.getCacheAge=function(){var a=null,r;return this.response&&(a=(r=this.response.headers.get("age"))?parseFloat(r):null),a},Xi.getResponseHeader=function(e){return this.response?this.response.headers.get(e):null},Xi.loadProgressively=function(d,i,n,a,u){void 0===a&&(a=0);var o=new In,e=d.body.getReader();return function s(){return e.read().then(function(r){if(r.done)return o.dataLength&&u(i,n,o.flush(),d),Promise.resolve(new ArrayBuffer(0));var l=r.value,r=l.length;return i.loaded+=r,r<a||o.dataLength?(o.push(l),o.dataLength>=a&&u(i,n,o.flush(),d)):u(i,n,l,d),s()}).catch(function(){return Promise.reject()})}()},nd),Yd=(Za(od,zd=l(Error)),od),Wd=j(j({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Ja,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Ai,bufferController:Yn,capLevelController:Ld,errorController:We,fpsController:vd,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Q,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:{newCue:function(m,e,t,p){for(var i=[],l=self.VTTCue||self.TextTrackCue,u=0,y,T,E,S;u<p.rows.length;u++)if(T=!0,E=0,S="",!(y=p.rows[u]).isEmpty()){for(var L=0,R;L<y.chars.length;L++)/\s/.test(y.chars[L].uchar)&&T?E++:(S+=y.chars[L].uchar,T=!1);(y.cueStartTime=e)===t&&(t+=1e-4),16<=E?E--:E++;var v=ka(S.trim()),A=xa(e,t,v);null!=m&&null!=(R=m.cues)&&R.getCueById(A)||((v=new l(e,t,v)).id=A,v.line=u+1,v.align="left",v.position=10+Math.min(80,10*Math.floor(8*E/32)),i.push(v))}return m&&i.length&&(i.sort(function(a,t){return"auto"===a.line||"auto"===t.line?0:8<a.line&&8<t.line?t.line-a.line:a.line-t.line}),i.forEach(function(e){return me(m,e)})),i}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:ld,subtitleTrackController:Nn,timelineController:Wr,audioStreamController:Dd,audioTrackController:yr,emeController:ti,cmcdController:C,contentSteeringController:ze}),qd,zd;return ze=function(){function g(f){void 0===f&&(f={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Nd,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,td(f.debug||!1,"Hls instance");var m=this.config=function(a,d){if((d.liveSyncDurationCount||d.liveMaxLatencyDurationCount)&&(d.liveSyncDuration||d.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==d.liveMaxLatencyDurationCount&&(void 0===d.liveSyncDurationCount||d.liveMaxLatencyDurationCount<=d.liveSyncDurationCount))throw new Error("Illegal hls.js config: \"liveMaxLatencyDurationCount\" must be greater than \"liveSyncDurationCount\"");if(void 0!==d.liveMaxLatencyDuration&&(void 0===d.liveSyncDuration||d.liveMaxLatencyDuration<=d.liveSyncDuration))throw new Error("Illegal hls.js config: \"liveMaxLatencyDuration\" must be greater than \"liveSyncDuration\"");var n=sd(a),t=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(function(l){var u=("level"===l?"playlist":l)+"LoadPolicy",a=void 0===d[u],s=[];t.forEach(function(o){var t=l+"Loading"+o,e=d[t];if(void 0!==e&&a){s.push(t);var r=n[u].default;switch(d[u]={default:r},o){case"TimeOut":r.maxLoadTimeMs=e,r.maxTimeToFirstByteMs=e;break;case"MaxRetry":r.errorRetry.maxNumRetry=e,r.timeoutRetry.maxNumRetry=e;break;case"RetryDelay":r.errorRetry.retryDelayMs=e,r.timeoutRetry.retryDelayMs=e;break;case"MaxRetryTimeout":r.errorRetry.maxRetryDelayMs=e,r.timeoutRetry.maxRetryDelayMs=e;}}}),s.length&&nt.warn("hls.js config: \""+s.join("\", \"")+"\" setting(s) are deprecated, use \""+u+"\": "+JSON.stringify(d[u]))}),j(j({},n),d)}(g.DefaultConfig,f);this.userConfig=f,this._autoLevelCapping=-1,m.progressive&&((h=(L=m).loader)!==Vd&&h!==Ja?(nt.log("[config]: Custom loader detected, cannot enable progressive streaming"),L.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),1}catch(e){}}()&&(L.loader=Vd,L.progressive=!0,L.enableSoftwareAES=!0,nt.log("[config]: Progressive streaming enabled, using FetchLoader")));var e=m.abrController,p=m.bufferController,y=m.capLevelController,T=m.errorController,E=m.fpsController,S=new T(this),o=this.abrController=new e(this),l=this.bufferController=new p(this),u=this.capLevelController=new y(this),f=new E(this),h=new he(this),L=new Le(this),T=m.contentSteeringController,e=T?new T(this):null,p=this.levelController=new Ed(this,e),y=new ar(this),E=new pr(this.config),T=this.streamController=new kn(this,y,E);u.setStreamController(T),f.setStreamController(T),T=[h,p,T],e&&T.splice(1,0,e),this.networkControllers=T,f=[o,l,u,f,L,y],this.audioTrackController=this.createController(m.audioTrackController,T),L=m.audioStreamController,L&&T.push(new L(this,y,E)),this.subtitleTrackController=this.createController(m.subtitleTrackController,T),L=m.subtitleStreamController,L&&T.push(new L(this,y,E)),this.createController(m.timelineController,f),E.emeController=this.emeController=this.createController(m.emeController,f),this.cmcdController=this.createController(m.cmcdController,f),this.latencyController=this.createController(Ae,f),this.coreComponents=f,T.push(S),T=S.onErrorOut,"function"==typeof T&&this.on(G.ERROR,T,S)}g.isSupported=function(){var a=Bt();if(!a)return!1;var r=zr(),a=a&&"function"==typeof a.isTypeSupported&&a.isTypeSupported("video/mp4; codecs=\"avc1.42E01E,mp4a.40.2\""),r=!r||r.prototype&&"function"==typeof r.prototype.appendBuffer&&"function"==typeof r.prototype.remove;return!!a&&!!r};var e=g.prototype;return e.createController=function(a,r){return a?(a=new a(this),r&&r.push(a),a):null},e.on=function(a,t,e){void 0===e&&(e=this),this._emitter.on(a,t,e)},e.once=function(a,t,e){void 0===e&&(e=this),this._emitter.once(a,t,e)},e.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},e.off=function(a,t,e,n){void 0===e&&(e=this),this._emitter.off(a,t,e,n)},e.listeners=function(e){return this._emitter.listeners(e)},e.emit=function(a,t,e){return this._emitter.emit(a,t,e)},e.trigger=function(a,t){if(this.config.debug)return this.emit(a,a,t);try{return this.emit(a,a,t)}catch(t){nt.error("An internal error happened while handling event "+a+". Error message: \""+t.message+"\". Here is a stacktrace:",t),this.trigger(G.ERROR,{type:rt.OTHER_ERROR,details:it.INTERNAL_EXCEPTION,fatal:!1,event:a,error:t})}return!1},e.listenerCount=function(e){return this._emitter.listenerCount(e)},e.destroy=function(){nt.log("destroy"),this.trigger(G.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(e){return e.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(e){return e.destroy()}),this.coreComponents.length=0;var e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null},e.attachMedia=function(e){nt.log("attachMedia"),this._media=e,this.trigger(G.MEDIA_ATTACHING,{media:e})},e.detachMedia=function(){nt.log("detachMedia"),this.trigger(G.MEDIA_DETACHING,void 0),this._media=null},e.loadSource=function(a){this.stopLoad();var t=this.media,e=this.url,r=this.url=pd.buildAbsoluteURL(self.location.href,a,{alwaysNormalize:!0});nt.log("loadSource:"+r),t&&e&&(e!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(G.MANIFEST_LOADING,{url:a})},e.startLoad=function(a){void 0===a&&(a=-1),nt.log("startLoad("+a+")"),this.networkControllers.forEach(function(e){e.startLoad(a)})},e.stopLoad=function(){nt.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},e.swapAudioCodec=function(){nt.log("swapAudioCodec"),this.streamController.swapAudioCodec()},e.recoverMediaError=function(){nt.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},e.removeLevel=function(a,t){void 0===t&&(t=0),this.levelController.removeLevel(a,t)},qt(g,[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){nt.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){nt.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){nt.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){nt.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){nt.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){e=!!e,e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(nt.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"ttfbEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){-1<ke.indexOf(e)&&(this._maxHdcpLevel=e)}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var a=this.levels,t=this.config.minAutoBitrate;if(!a)return 0;for(var e=a.length,r=0;r<e;r++)if(a[r].maxBitrate>=t)return r;return 0}},{key:"maxAutoLevel",get:function(){var a=this.levels,t=this.autoLevelCapping,d=this.maxHdcpLevel,t=-1===t&&a&&a.length?a.length-1:t;if(d)for(var r=t,o;r--;)if(o=a[r].attrs["HDCP-LEVEL"],o&&o<=d)return r;return t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(a){var t=this.audioTrackController;t&&(t.audioTrack=a)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(a){var t=this.subtitleTrackController;t&&(t.subtitleTrack=a)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(a){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=a)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.4.5"}},{key:"Events",get:function(){return G}},{key:"ErrorTypes",get:function(){return rt}},{key:"ErrorDetails",get:function(){return it}},{key:"DefaultConfig",get:function(){return g.defaultConfig||Wd},set:function(e){g.defaultConfig=e}}]),g}(),ze.defaultConfig=void 0,ze};"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(a="undefined"==typeof globalThis?a||self:globalThis).Hls=n()}(!1);
